<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>verif_ehrhart.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11.1 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>verif_ehrhart.c</h1><a href="verif__ehrhart_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/*************************************************/</font>
00002 <font class="comment">/*     verif_ehrhart.c                           */</font>
00003 <font class="comment">/* program to compare effective number of points */</font>
00004 <font class="comment">/* in a polytope with the corresponding          */</font>
00005 <font class="comment">/* evaluation of the Ehrhart polynomial.         */</font>
00006 <font class="comment">/* Parameters vary in range -RANGE to RANGE      */</font>
00007 <font class="comment">/* (define below) by default.                    */</font>
00008 <font class="comment">/* Can be overridden by specifying               */</font>
00009 <font class="comment">/* -r&lt;RANGE&gt;, or -m&lt;min&gt; and -M&lt;max&gt;             */</font>
00010 <font class="comment">/*                                               */</font>
00011 <font class="comment">/* written by Vincent Loechner (c) 2000.         */</font>
00012 <font class="comment">/*  loechner@icps.u-strasbg.fr                   */</font>
00013 <font class="comment">/*************************************************/</font>
00014 
00015 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00016 <font class="preprocessor">#include &lt;string.h&gt;</font>
00017 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00018 
00019 <font class="preprocessor">#include &lt;polylib/polylib.h&gt;</font>
00020 <font class="preprocessor">#define MAXRAYS 1024</font>
00021 <font class="preprocessor"></font>
00022 <font class="comment">/* define this to print all the results */</font>
00023 <font class="comment">/* else, only a progress bar is printed */</font>
00024 <font class="comment">/* #define PRINT_ALL_RESULTS     */</font>
00025 <font class="comment">/* define this to continue the test after first error found */</font>
00026 <font class="comment">/* #define DONT_BREAK_ON_ERROR */</font>
00027 
00028 <font class="comment">/* RANGE : normal range for evalutations (-RANGE -&gt; RANGE) */</font>
00029 <font class="preprocessor">#define RANGE 50</font>
00030 <font class="preprocessor"></font>
00031 <font class="comment">/* SRANGE : small range for evalutations */</font>
00032 <font class="preprocessor">#define SRANGE 15</font>
00033 <font class="preprocessor"></font>
00034 <font class="comment">/* if dimension &gt;= BIDDIM, use SRANGE */</font>
00035 <font class="preprocessor">#define BIGDIM 5</font>
00036 <font class="preprocessor"></font>
00037 <font class="comment">/* VSRANGE : very small range for evalutations */</font>
00038 <font class="preprocessor">#define VSRANGE 5</font>
00039 <font class="preprocessor"></font>
00040 <font class="comment">/* if dimension &gt;= VBIDDIM, use VSRANGE */</font>
00041 <font class="preprocessor">#define VBIGDIM 8</font>
00042 <font class="preprocessor"></font>
00043 Value min, max;
00044 
00045 <font class="preprocessor">#ifdef DONT_BREAK_ON_ERROR</font>
00046 <font class="preprocessor"></font><font class="preprocessor">#define PRINT_ALL_RESULTS</font>
00047 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00048 <font class="preprocessor"></font>
00049 <font class="preprocessor">#ifndef PRINT_ALL_RESULTS</font>
00050 <font class="preprocessor"></font><font class="keywordtype">int</font> st;
00051 <font class="preprocessor">#endif</font>
00052 <font class="preprocessor"></font>
00053 <font class="comment">/****************************************************/</font>
00054 <font class="comment">/* function check_poly :                            */</font>
00055 <font class="comment">/* scans the parameter space from min to max (all   */</font>
00056 <font class="comment">/* directions). Computes the number of points in    */</font>
00057 <font class="comment">/* the polytope using both methods, and compare them*/</font>
00058 <font class="comment">/* returns 1 on success                             */</font>
00059 <font class="comment">/****************************************************/</font>
00060 
00061 <font class="keywordtype">int</font> check_poly(Polyhedron *S,Polyhedron *C,Enumeration *en,
00062                <font class="keywordtype">int</font> nparam,<font class="keywordtype">int</font> pos,Value *z)<font class="keyword"> </font>{
00063   
00064   <font class="keywordtype">int</font> cc,k;
00065   Value c,tmp,*ctmp;
00066   
00067   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(c); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
00068   
00069   <font class="keywordflow">if</font>(pos == nparam) {
00070     
00071     <font class="comment">/* Computes the ehrhart polynomial */</font>
00072     <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(c,*(ctmp=compute_poly(en,&amp;z[S-&gt;Dimension-nparam+1])));
00073     free(ctmp);
00074     <font class="comment">/* if c=0 we may be out of context. */</font>
00075     <font class="comment">/* scanning is useless in this case*/</font>
00076     <font class="keywordflow">if</font>(!in_domain(C,&amp;z[S-&gt;Dimension-nparam+1]))<font class="keyword"> </font>{
00077    
00078       <font class="comment">/* ok */</font> ;
00079     }
00080     <font class="keywordflow">else</font> {
00081       
00082 <font class="preprocessor">#ifdef PRINT_ALL_RESULTS</font>
00083 <font class="preprocessor"></font>      printf(<font class="stringliteral">"EP( "</font>);
00084       <a class="code" href="arithmetique_8h.html#a16">value_print</a>(stdout,<a class="code" href="arithmetique_8h.html#a5">VALUE_FMT</a>,z[S-&gt;Dimension-nparam+1]);
00085       <font class="keywordflow">for</font>(k=S-&gt;Dimension-nparam+2;k&lt;=S-&gt;Dimension;++k) {
00086         printf(<font class="stringliteral">", "</font>);
00087         <a class="code" href="arithmetique_8h.html#a16">value_print</a>(stdout,<a class="code" href="arithmetique_8h.html#a5">VALUE_FMT</a>,z[k]);
00088       }
00089       printf(<font class="stringliteral">" ) = "</font>);
00090       <a class="code" href="arithmetique_8h.html#a16">value_print</a>(stdout,<a class="code" href="arithmetique_8h.html#a5">VALUE_FMT</a>,c);
00091       printf(<font class="stringliteral">" "</font>);
00092 <font class="preprocessor">#endif</font>
00093 <font class="preprocessor"></font>
00094       <font class="comment">/* Count manually the number of points */</font>
00095       cc=count_points(1,S,z);
00096 <font class="preprocessor">#ifdef PRINT_ALL_RESULTS</font>
00097 <font class="preprocessor"></font>        printf(<font class="stringliteral">", count = %d. "</font>,cc);
00098 <font class="preprocessor">#endif</font>
00099 <font class="preprocessor"></font>
00100       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp,cc);
00101       <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a23">value_ne</a>(tmp,c))<font class="keyword"> </font>{
00102         printf(<font class="stringliteral">"\n"</font>); 
00103         fflush(stdout);
00104         fprintf(stderr,<font class="stringliteral">"Error !\n"</font>);
00105         fprintf(stderr,<font class="stringliteral">"EP( "</font>);
00106         <a class="code" href="arithmetique_8h.html#a16">value_print</a>(stderr,<a class="code" href="arithmetique_8h.html#a5">VALUE_FMT</a>,z[S-&gt;Dimension-nparam+1]);
00107         <font class="keywordflow">for</font>(k=S-&gt;Dimension-nparam+2;k&lt;=S-&gt;Dimension;++k) {
00108           fprintf(stderr,<font class="stringliteral">", "</font>);
00109           <a class="code" href="arithmetique_8h.html#a16">value_print</a>(stderr,<a class="code" href="arithmetique_8h.html#a5">VALUE_FMT</a>,z[k]);
00110         }
00111         fprintf(stderr,<font class="stringliteral">" ) should be %d,"</font>,cc);
00112         fprintf(stderr,<font class="stringliteral">" while EP eval gives "</font>);
00113         <a class="code" href="arithmetique_8h.html#a16">value_print</a>(stderr,<a class="code" href="arithmetique_8h.html#a5">VALUE_FMT</a>,c);
00114         fprintf(stderr,<font class="stringliteral">".\n"</font>);
00115 <font class="preprocessor">#ifndef DONT_BREAK_ON_ERROR</font>
00116 <font class="preprocessor"></font>        <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(c); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00117         <font class="keywordflow">return</font>(0);
00118 <font class="preprocessor">#endif</font>
00119 <font class="preprocessor"></font>      }
00120 
00121 <font class="preprocessor">#ifdef PRINT_ALL_RESULTS</font>
00122 <font class="preprocessor"></font>      <font class="keywordflow">else</font>
00123         printf(<font class="stringliteral">"OK.\n"</font>);
00124 <font class="preprocessor">#endif</font>
00125 <font class="preprocessor"></font>    }
00126   }
00127   <font class="keywordflow">else</font>
00128     <font class="keywordflow">for</font>(<a class="code" href="arithmetique_8h.html#a11">value_assign</a>(tmp,min); <a class="code" href="arithmetique_8h.html#a27">value_le</a>(tmp,max); <a class="code" href="arithmetique_8h.html#a45">value_increment</a>(tmp,tmp))<font class="keyword"> </font>{
00129 
00130 <font class="preprocessor">#ifndef PRINT_ALL_RESULTS</font>
00131 <font class="preprocessor"></font>      k = <a class="code" href="arithmetique_8h.html#a7">VALUE_TO_INT</a>(tmp);
00132       <font class="keywordflow">if</font>(!pos &amp;&amp; !(k%st)) {
00133         printf(<font class="stringliteral">"o"</font>);
00134         fflush(stdout);
00135       }
00136 <font class="preprocessor">#endif</font>
00137 <font class="preprocessor"></font>      
00138       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(z[pos+S-&gt;Dimension-nparam+1],tmp);
00139       <font class="keywordflow">if</font>(!check_poly(S,C,en,nparam,pos+1,z))<font class="keyword"> </font>{
00140         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(c); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00141         <font class="keywordflow">return</font>(0);
00142       }
00143     }
00144   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(c); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00145   <font class="keywordflow">return</font>(1);
00146 } <font class="comment">/* check_poly */</font>
00147 
00148 <font class="keywordtype">int</font> main(<font class="keywordtype">int</font> argc,<font class="keywordtype">char</font> *argv[])<font class="keyword"> </font>{
00149         
00150   Matrix *C1, *P1;
00151   Polyhedron *C, *P, *S;
00152   Polyhedron *CC, *PP;
00153   Enumeration *en;
00154   Value *p, tmp;
00155   <font class="keywordtype">int</font> i,j;
00156   <font class="keywordtype">int</font> <a class="code" href="polyparam_8c.html#a0">m</a>,M;
00157   
00158 <font class="comment">/******* Read the input *********/</font>
00159   P1 = <a class="code" href="matrix_8c.html#a4">Matrix_Read</a>();
00160   C1 = <a class="code" href="matrix_8c.html#a4">Matrix_Read</a>();
00161 
00162   <font class="keywordflow">if</font>(C1-&gt;NbColumns &lt; 2) {
00163     fprintf(stderr,<font class="stringliteral">"Not enough parameters !\n"</font>);
00164     exit(0);
00165   }
00166   
00167   P = <a class="code" href="polyhedron_8c.html#a24">Constraints2Polyhedron</a>(P1,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00168   C = <a class="code" href="polyhedron_8c.html#a24">Constraints2Polyhedron</a>(C1,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00169   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(C1);
00170   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(P1);
00171 
00172   <font class="comment">/******* Read the options: initialize min and max ********/</font>
00173   <font class="keywordflow">if</font>(P-&gt;Dimension &gt;= <a class="code" href="verif__ehrhart_8c.html#a5">VBIGDIM</a>)
00174     M = <a class="code" href="verif__ehrhart_8c.html#a4">VSRANGE</a>;
00175   <font class="keywordflow">else</font> <font class="keywordflow">if</font>(P-&gt;Dimension &gt;= <a class="code" href="verif__ehrhart_8c.html#a3">BIGDIM</a>)
00176     M = <a class="code" href="verif__ehrhart_8c.html#a2">SRANGE</a>;
00177   <font class="keywordflow">else</font>
00178     M = <a class="code" href="verif__ehrhart_8c.html#a1">RANGE</a>;
00179   <a class="code" href="polyparam_8c.html#a0">m</a> = -M;
00180   <font class="keywordflow">if</font>(argc != 1 ) {
00181     <font class="keywordflow">for</font>(i=1;i&lt;argc;i++) {
00182       <font class="keywordflow">if</font>(!strncmp(argv[i],<font class="stringliteral">"-m"</font>,2))<font class="keyword"> </font>{
00183         
00184         <font class="comment">/* min specified */</font>
00185         <a class="code" href="polyparam_8c.html#a0">m</a> = atoi(&amp;argv[i][2]);
00186       }
00187       <font class="keywordflow">else</font> <font class="keywordflow">if</font>(!strncmp(argv[i],<font class="stringliteral">"-M"</font>,2))<font class="keyword"> </font>{
00188         
00189         <font class="comment">/* max specified */</font>
00190         M = atoi(&amp;argv[i][2]);
00191       }
00192       <font class="keywordflow">else</font> <font class="keywordflow">if</font>(!strncmp(argv[i], <font class="stringliteral">"-r"</font>, 2))<font class="keyword"> </font>{
00193         
00194         <font class="comment">/* range specified */</font>
00195         M = atoi(&amp;argv[i][2]);
00196         <a class="code" href="polyparam_8c.html#a0">m</a> = -M;
00197       }
00198       <font class="keywordflow">else</font> {
00199         fprintf(stderr,<font class="stringliteral">"Unknown option: %s\n"</font>,argv[i]);
00200         fprintf(stderr,<font class="stringliteral">"Usage: %s [-m&lt;&gt;][-M&lt;&gt;][-r&lt;&gt;]\n"</font>,argv[0]);
00201         <font class="keywordflow">return</font>(-1);
00202       }
00203     }
00204   }
00205   <font class="keywordflow">if</font>(<a class="code" href="polyparam_8c.html#a0">m</a> &gt; M) {
00206     fprintf(stderr,<font class="stringliteral">"Nothing to do: min &gt; max !\n"</font>);
00207     <font class="keywordflow">return</font>(0);
00208   }
00209   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(min);
00210   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(max);
00211   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(min,<a class="code" href="polyparam_8c.html#a0">m</a>);
00212   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(max,M);
00213   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
00214 
00215   <font class="comment">/******* Compute true context *******/</font>
00216   CC = <a class="code" href="polyhedron_8c.html#a47">align_context</a>(C,P-&gt;Dimension,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00217   PP = <a class="code" href="polyhedron_8c.html#a32">DomainIntersection</a>(P,CC,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00218   <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(CC);
00219   C1 = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(C-&gt;Dimension+1,P-&gt;Dimension+1);
00220 
00221   <font class="keywordflow">for</font>(i=0;i&lt;C1-&gt;NbRows;i++)
00222     <font class="keywordflow">for</font>(j=0;j&lt;C1-&gt;NbColumns;j++)
00223       <font class="keywordflow">if</font>(i==j-P-&gt;Dimension+C-&gt;Dimension)
00224         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(C1-&gt;p[i][j],1);
00225       <font class="keywordflow">else</font>
00226         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(C1-&gt;p[i][j],0);
00227   CC = <a class="code" href="polyhedron_8c.html#a52">Polyhedron_Image</a>(PP,C1,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00228   <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(C);
00229   C = CC;
00230 
00231   <font class="comment">/******* Compute EP *********/</font>
00232   en = Polyhedron_Enumerate(P,C,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00233   
00234   <font class="comment">/******* Initializations for check *********/</font>
00235   p = (Value *)malloc(<font class="keyword">sizeof</font>(Value) * (P-&gt;Dimension+2));
00236   <font class="keywordflow">for</font>(i=0;i&lt;=P-&gt;Dimension;i++) {
00237     <a class="code" href="arithmetique_8h.html#a10">value_init</a>(p[i]);
00238     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(p[i],0);
00239   }
00240   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(p[i]);
00241   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(p[i],1);
00242 
00243   <font class="comment">/* S = scanning list of polyhedra */</font>
00244   S = <a class="code" href="polyhedron_8c.html#a48">Polyhedron_Scan</a>(P,C,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00245 
00246 <font class="preprocessor">#ifndef PRINT_ALL_RESULTS</font>
00247 <font class="preprocessor"></font>  <font class="keywordflow">if</font>(C-&gt;Dimension &gt; 0) {
00248     <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(tmp,max,min);
00249     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a7">VALUE_TO_INT</a>(tmp) &gt; 80)
00250       st = 1+(<a class="code" href="arithmetique_8h.html#a7">VALUE_TO_INT</a>(tmp))/80;
00251     <font class="keywordflow">else</font>
00252       st=1;
00253     <font class="keywordflow">for</font>(i=<a class="code" href="arithmetique_8h.html#a7">VALUE_TO_INT</a>(min);i&lt;=<a class="code" href="arithmetique_8h.html#a7">VALUE_TO_INT</a>(max);i+=st)
00254       printf(<font class="stringliteral">"."</font>);
00255     printf( <font class="stringliteral">"\r"</font> );
00256     fflush(stdout);
00257   }
00258 <font class="preprocessor">#endif</font>
00259 <font class="preprocessor"></font>
00260   <font class="comment">/******* CHECK NOW *********/</font>
00261   <font class="keywordflow">if</font>(!check_poly(S,C,en,C-&gt;Dimension,0,p))<font class="keyword"> </font>{
00262     fprintf(stderr,<font class="stringliteral">"Check failed !\n"</font>);
00263     <font class="keywordflow">for</font>(i=0;i&lt;=(P-&gt;Dimension+1);i++) 
00264       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p[i]);
00265     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);  
00266     <font class="keywordflow">return</font>(-1);
00267   }
00268     
00269 <font class="preprocessor">#ifndef PRINT_ALL_RESULTS</font>
00270 <font class="preprocessor"></font>  printf( <font class="stringliteral">"\n"</font> );
00271 <font class="preprocessor">#endif</font>
00272 <font class="preprocessor"></font>  
00273   <font class="keywordflow">for</font>(i=0;i&lt;=(P-&gt;Dimension+1);i++) 
00274     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p[i]);
00275   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00276   <font class="keywordflow">return</font>(0);
00277 } <font class="comment">/* main */</font>
00278 
00279 
00280 
00281 
</pre></div><hr><address><small>Generated on Fri Oct 4 16:14:27 2002 for Polylib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.11.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
