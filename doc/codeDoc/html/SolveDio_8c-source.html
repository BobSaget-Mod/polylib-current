<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SolveDio.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11.1 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>SolveDio.c</h1><a href="SolveDio_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00002 <font class="preprocessor">#include &lt;polylib/polylib.h&gt;</font>
00003 
00004 <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="SolveDio_8c.html#a0">RearrangeMatforSolveDio</a>(Matrix *M);
00005 
00006 <font class="comment">/*</font>
00007 <font class="comment"> *  Solve Diophantine Equations :</font>
00008 <font class="comment"> *        This function takes as input a system of equations in the form</font>
00009 <font class="comment"> *          Ax + C = 0 and finds the solution for it, if it exists</font>
00010 <font class="comment"> *       </font>
00011 <font class="comment"> *        Input : The matrix form the system of the equations Ax + C = 0</font>
00012 <font class="comment"> *                 ( a pointer to a Matrix. )</font>
00013 <font class="comment"> *                 A pointer to the pointer, where the matrix U </font>
00014 <font class="comment"> *                  corresponding to the free variables of the equation</font>
00015 <font class="comment"> *                  is stored.</font>
00016 <font class="comment"> *                 A pointer to the pointer of a vector is a solution to T.</font>
00017 <font class="comment"> *</font>
00018 <font class="comment"> *</font>
00019 <font class="comment"> *        Output : The above matrix U and the vector T.</font>
00020 <font class="comment"> *</font>
00021 <font class="comment"> *        Algorithm :</font>
00022 <font class="comment"> *                    Given an integral matrix A, we can split it such that</font>
00023 <font class="comment"> *                    A = HU, where H is in HNF (lowr triangular)</font>
00024 <font class="comment"> *                      and U is unimodular.</font>
00025 <font class="comment"> *                    So Ax = c -&gt; HUx = c -&gt; Ht = c ( where Ux = t).</font>
00026 <font class="comment"> *                       Solving for Ht = c is easy.</font>
00027 <font class="comment"> *                       Using 't' we find x = U(inverse) * t.</font>
00028 <font class="comment"> * </font>
00029 <font class="comment"> *        Steps :</font>
00030 <font class="comment"> *                   1) For the above algorithm to work correctly to</font>
00031 <font class="comment"> *                      need the condition that the first 'rank' rows are</font>
00032 <font class="comment"> *                      the rows which contribute to the rank of the matrix.</font>
00033 <font class="comment"> *                      So first we copy Input into a matrix 'A' and </font>
00034 <font class="comment"> *                      rearrange the rows of A (if required) such that</font>
00035 <font class="comment"> *                      the first rank rows contribute to the rank.</font>
00036 <font class="comment"> *                   2) Extract A and C from the matrix 'A'. A = n * l matrix.</font>
00037 <font class="comment"> *                   3) Find the Hermite normal form of the matrix A.</font>
00038 <font class="comment"> *                       ( the matrices the lower tri. H and the unimod U).</font>
00039 <font class="comment"> *                   4) Using H, find the values of T one by one.</font>
00040 <font class="comment"> *                      Here we use a sort of Gaussian elimination to find</font>
00041 <font class="comment"> *                      the solution. You have a lower triangular matrix</font>
00042 <font class="comment"> *                      and a vector, </font>
00043 <font class="comment"> *                      [ [a11, 0], [a21, a22, 0] ...,[arank1...a rankrank 0]]</font>
00044 <font class="comment"> *                       and the solution vector [t1.. tn] and the vector </font>
00045 <font class="comment"> *                      [ c1, c2 .. cl], now as we are traversing down the</font>
00046 <font class="comment"> *                      rows one by one, we will have all the information </font>
00047 <font class="comment"> *                      needed to calculate the next 't'.</font>
00048 <font class="comment"> *                      </font>
00049 <font class="comment"> *                      That is to say, when you want to calculate t2, </font>
00050 <font class="comment"> *                      you would have already calculated the value of t1</font>
00051 <font class="comment"> *                      and similarly if you are calculating t3, you will </font>
00052 <font class="comment"> *                      need t1 and t2 which will be available by that time.</font>
00053 <font class="comment"> *                      So, we apply a sort of Gaussian Elimination inorder</font>
00054 <font class="comment"> *                      to find the vector T.</font>
00055 <font class="comment"> *</font>
00056 <font class="comment"> *                   5) After finding t_rank, the remaining (l-rank) t's are</font>
00057 <font class="comment"> *                      made equal to zero, and we verify, if these values</font>
00058 <font class="comment"> *                      agree with the remaining (n-rank) rows of A.</font>
00059 <font class="comment"> *</font>
00060 <font class="comment"> *                   6) If a solution exists, find the values of X using </font>
00061 <font class="comment"> *                        U (inverse) * T.</font>
00062 <font class="comment"> */</font>
00063 
<a name="l00064"></a><a class="code" href="SolveDio_8c.html#a1">00064</a> <font class="keywordtype">int</font> <a class="code" href="SolveDio_8c.html#a1">SolveDiophantine</a>(Matrix *M, Matrix **U, Vector **X)<font class="keyword"> </font>{
00065   
00066   <font class="keywordtype">int</font> i, j, k1, k2, min, rank;
00067   Matrix *A, *temp, *hermi, *unimod,  *unimodinv ;
00068   Value *C; <font class="comment">/* temp storage for the vector C */</font>
00069   Value *T; <font class="comment">/* storage for the vector t */</font>
00070   Value sum, tmp;
00071   
00072 <font class="preprocessor">#ifdef DOMDEBUG</font>
00073 <font class="preprocessor"></font>  FILE *fp;
00074   fp = fopen(<font class="stringliteral">"_debug"</font>, <font class="stringliteral">"a"</font>);
00075   fprintf(fp,<font class="stringliteral">"\nEntered SOLVEDIOPHANTINE\n"</font>); 
00076   fclose(fp);
00077 <font class="preprocessor">#endif</font>
00078 <font class="preprocessor"></font>
00079   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(sum); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
00080   
00081   <font class="comment">/* Ensuring that the first rank row of A contribute to the rank*/</font> 
00082   A = <a class="code" href="Matop_8c.html#a5">Matrix_Copy</a>(M);
00083   <a class="code" href="SolveDio_8c.html#a0">RearrangeMatforSolveDio</a>(A);
00084   temp = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(A-&gt;NbRows-1, A-&gt;NbColumns-1);
00085   
00086   <font class="comment">/* Copying A into temp, ignoring the Homogeneous part */</font> 
00087   <font class="keywordflow">for</font> (i = 0; i &lt; A-&gt;NbRows -1; i++)
00088     <font class="keywordflow">for</font> (j = 0; j &lt; A-&gt;NbColumns-1; j++)
00089       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(temp-&gt;p[i][j],A-&gt;p[i][j]);
00090   
00091   <font class="comment">/* Copying C into a temp, ignoring the Homogeneous part */</font> 
00092   C = (Value *) malloc (<font class="keyword">sizeof</font>(Value) * (A-&gt;NbRows-1));
00093   k1 = A-&gt;NbRows-1;
00094   
00095   <font class="keywordflow">for</font> (i = 0; i &lt; k1; i++) {
00096     <a class="code" href="arithmetique_8h.html#a10">value_init</a>(C[i]);
00097     <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(C[i],A-&gt;p[i][A-&gt;NbColumns-1]);
00098   }
00099   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a> (A); 
00100   
00101   <font class="comment">/* Finding the HNF of temp */</font>  
00102   <a class="code" href="NormalForms_8c.html#a16">Hermite</a>(temp, &amp;hermi, &amp;unimod);
00103   
00104   <font class="comment">/* Testing for existence of a Solution */</font>
00105   
00106   min=(hermi-&gt;NbRows &lt;= hermi-&gt;NbColumns ) ? hermi-&gt;NbRows : hermi-&gt;NbColumns ;
00107   rank = 0;
00108   <font class="keywordflow">for</font> (i = 0; i &lt; min ; i++) {
00109     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(hermi-&gt;p[i][i]))
00110       rank ++;
00111     <font class="keywordflow">else</font>
00112       <font class="keywordflow">break</font> ;
00113   }
00114   
00115   <font class="comment">/* Solving the Equation using Gaussian Elimination*/</font>
00116   
00117   T = (Value *) malloc(<font class="keyword">sizeof</font>(Value) * temp-&gt;NbColumns);
00118   k2 = temp-&gt;NbColumns;
00119   <font class="keywordflow">for</font>(i=0;i&lt; k2; i++) 
00120     <a class="code" href="arithmetique_8h.html#a10">value_init</a>(T[i]);
00121 
00122   <font class="keywordflow">for</font> (i = 0; i &lt; rank ; i++) {
00123     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(sum,0);
00124     <font class="keywordflow">for</font> (j = 0; j &lt; i; j++) {
00125       <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp,T[j],hermi-&gt;p[i][j]);
00126       <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(sum,sum,tmp);
00127     } 
00128     <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(tmp,C[i],sum);
00129     <a class="code" href="arithmetique_8h.html#a52">value_modulus</a>(tmp,tmp,hermi-&gt;p[i][i]);
00130     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(tmp))<font class="keyword"> </font>{ <font class="comment">/* no solution to the equation */</font>
00131       *U = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(0,0);
00132       *X = <a class="code" href="vector_8c.html#a5">Vector_Alloc</a> (0);
00133       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(sum); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00134       <font class="keywordflow">for</font> (i = 0; i &lt; k1; i++) 
00135         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(C[i]);
00136       <font class="keywordflow">for</font> (i = 0; i &lt; k2; i++) 
00137         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(T[i]);
00138       free(C);
00139       free(T);
00140       <font class="keywordflow">return</font> (-1);
00141     };
00142     <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(tmp,C[i],sum);
00143     <a class="code" href="arithmetique_8h.html#a51">value_division</a>(tmp,tmp,hermi-&gt;p[i][i]);
00144     <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(T[i],tmp);
00145   }
00146   <font class="comment"></font>
00147 <font class="comment">  /** Case when rank &lt; Number of Columns; **/</font>
00148   
00149   <font class="keywordflow">for</font> (i = rank; i &lt; hermi-&gt;NbColumns; i++)
00150     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(T[i],0);
00151   <font class="comment"></font>
00152 <font class="comment">  /** Solved the equtions **/</font><font class="comment"></font>
00153 <font class="comment">  /** When rank &lt; hermi-&gt;NbRows; Verifying whether the solution agrees </font>
00154 <font class="comment">      with the remaining n-rank rows as well. **/</font>
00155   
00156   <font class="keywordflow">for</font> (i = rank; i &lt; hermi-&gt;NbRows; i++) {
00157     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(sum,0);
00158     <font class="keywordflow">for</font> (j = 0; j &lt; hermi-&gt;NbColumns; j++) {
00159       <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp,T[j],hermi-&gt;p[i][j]);
00160       <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(sum,sum,tmp);
00161     }  
00162     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a23">value_ne</a>(sum,C[i]))<font class="keyword"> </font>{
00163       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(sum); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00164       <font class="keywordflow">for</font> (i = 0; i &lt; k1; i++) 
00165         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(C[i]);
00166       <font class="keywordflow">for</font> (i = 0; i &lt; k2; i++) 
00167         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(T[i]);
00168       free(C);
00169       free(T);
00170       <font class="keywordflow">return</font> (-1);
00171     }
00172   }     
00173   unimodinv = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(unimod-&gt;NbRows, unimod-&gt;NbColumns);
00174   <a class="code" href="matrix_8c.html#a13">Matrix_Inverse</a>(unimod, unimodinv);
00175   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(unimod);
00176   *X = <a class="code" href="vector_8c.html#a5">Vector_Alloc</a>(M-&gt;NbColumns-1);
00177   
00178   <font class="keywordflow">if</font> (rank == hermi-&gt;NbColumns)
00179     *U = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(0,0);
00180   <font class="keywordflow">else</font> { <font class="comment">/* Extracting the General solution form U(inverse) */</font>
00181     
00182     *U = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(hermi-&gt;NbColumns, hermi-&gt;NbColumns-rank);   
00183     <font class="keywordflow">for</font> (i = 0; i &lt; U[0]-&gt;NbRows; i++)
00184       <font class="keywordflow">for</font> (j = 0; j &lt; U[0]-&gt;NbColumns; j++)
00185         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(U[0]-&gt;p[i][j],unimodinv-&gt;p[i][j+rank]);
00186   }
00187   
00188   <font class="keywordflow">for</font> (i = 0; i &lt; unimodinv-&gt;NbRows; i++) { 
00189     
00190     <font class="comment">/* Calculating the vector X = Uinv * T */</font>
00191     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(sum,0);
00192     <font class="keywordflow">for</font> (j = 0; j &lt; unimodinv-&gt;NbColumns; j++) {
00193       <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp,unimodinv-&gt;p[i][j],T[j]);
00194       <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(sum,sum,tmp);
00195     }  
00196     <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(X[0]-&gt;p[i],sum);
00197   }
00198   
00199   <font class="comment">/*</font>
00200 <font class="comment">    for (i = rank; i &lt; A-&gt;NbColumns; i ++)</font>
00201 <font class="comment">    X[0]-&gt;p[i] = 0;</font>
00202 <font class="comment">  */</font>
00203   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a> (unimodinv);
00204   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a> (hermi);
00205   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a> (temp);
00206   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(sum); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00207   <font class="keywordflow">for</font> (i = 0; i &lt; k1; i++) 
00208     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(C[i]);
00209   <font class="keywordflow">for</font> (i = 0; i &lt; k2; i++) 
00210     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(T[i]);
00211   free(C);
00212   free(T);
00213   <font class="keywordflow">return</font> (rank);  
00214 } <font class="comment">/* SolveDiophantine */</font>
00215 
00216 <font class="comment">/*</font>
00217 <font class="comment"> * Rearrange :</font>
00218 <font class="comment"> *            This function takes as input a matrix M (pointer to it)</font>
00219 <font class="comment"> *            and it returns the tranformed matrix M, such that the first</font>
00220 <font class="comment"> *            'rank' rows of the new matrix M are the ones which contribute</font>
00221 <font class="comment"> *            to the rank of the matrix M. </font>
00222 <font class="comment"> *          </font>
00223 <font class="comment"> *            1) For a start we try to put all the zero rows at the end.</font>
00224 <font class="comment"> *            2) Then cur = 1st row of the remaining matrix.</font>
00225 <font class="comment"> *            3) nextrow = 2ndrow of M.</font>
00226 <font class="comment"> *            4) temp = cur + nextrow</font>
00227 <font class="comment"> *            5) If (rank(temp) == temp-&gt;NbRows.) {cur = temp;nextrow ++}</font>
00228 <font class="comment"> *            6) Else (Exchange the nextrow of M with the currentlastrow.</font>
00229 <font class="comment"> *                     and currentlastrow --).</font>
00230 <font class="comment"> *            7) Repeat steps 4,5,6 till it is no longer possible.</font>
00231 <font class="comment"> *            </font>
00232 <font class="comment"> */</font>
<a name="l00233"></a><a class="code" href="SolveDio_8c.html#a0">00233</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="SolveDio_8c.html#a0">RearrangeMatforSolveDio</a>(Matrix *M)<font class="keyword"> </font>{
00234   
00235   <font class="keywordtype">int</font> i, j, curend, curRow, min, rank=1;
00236   Bool add = True;
00237   Matrix *A, *L, *H, *U;
00238   
00239   <font class="comment">/* Though I could have used the Lattice function</font>
00240 <font class="comment">        Extract Linear Part, I chose not to use it so that</font>
00241 <font class="comment">        this function can be independent of Lattice Operations */</font>
00242 
00243   L = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(M-&gt;NbRows-1,M-&gt;NbColumns-1);
00244   <font class="keywordflow">for</font> (i = 0; i &lt; L-&gt;NbRows; i++)
00245     <font class="keywordflow">for</font> (j = 0; j &lt; L-&gt;NbColumns; j++)
00246       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(L-&gt;p[i][j],M-&gt;p[i][j]);
00247   
00248   <font class="comment">/* Putting the zero rows at the end */</font>
00249   curend = L-&gt;NbRows-1;
00250   <font class="keywordflow">for</font> (i = 0; i &lt; curend; i++) {
00251     <font class="keywordflow">for</font> (j = 0; j &lt; L-&gt;NbColumns; j++) 
00252       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(L-&gt;p[i][j]))
00253         <font class="keywordflow">break</font>;
00254     <font class="keywordflow">if</font> (j == L-&gt;NbColumns) {
00255       <a class="code" href="Matop_8c.html#a2">ExchangeRows</a>(M,i,curend);
00256       curend --;
00257     }
00258   } 
00259   
00260   <font class="comment">/* Trying to put the redundant rows at the end */</font>
00261   
00262   <font class="keywordflow">if</font> (curend &gt; 0) { <font class="comment">/* there are some useful rows */</font>
00263     
00264     Matrix *temp;
00265     A = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(1, L-&gt;NbColumns); 
00266     
00267     <font class="keywordflow">for</font> (i = 0; i &lt;L-&gt;NbColumns; i++) 
00268       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(A-&gt;p[0][i],L-&gt;p[0][i]);     
00269     curRow = 1;    
00270     <font class="keywordflow">while</font> (add == True ) {
00271       temp= <a class="code" href="Matop_8c.html#a12">AddANullRow</a>(A);
00272       <font class="keywordflow">for</font> (i = 0;i &lt;A-&gt;NbColumns; i++)
00273         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(temp-&gt;p[curRow][i],L-&gt;p[curRow][i]);      
00274       <a class="code" href="NormalForms_8c.html#a16">Hermite</a>(temp, &amp;H, &amp;U);
00275       <font class="keywordflow">for</font> (i = 0; i &lt; H-&gt;NbRows; i++)
00276         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(H-&gt;p[i][i]))
00277           <font class="keywordflow">break</font>;
00278       <font class="keywordflow">if</font> (i != H-&gt;NbRows) {
00279         <a class="code" href="Matop_8c.html#a2">ExchangeRows</a>(M, curRow, curend);
00280         curend --;
00281       }
00282       <font class="keywordflow">else</font> {
00283         curRow ++;
00284         rank ++;
00285         <a class="code" href="matrix_8c.html#a1">Matrix_Free</a> (A);
00286         A = <a class="code" href="Matop_8c.html#a5">Matrix_Copy</a> (temp);
00287         <a class="code" href="matrix_8c.html#a1">Matrix_Free</a> (temp);
00288       }      
00289       <a class="code" href="matrix_8c.html#a1">Matrix_Free</a> (H);
00290       <a class="code" href="matrix_8c.html#a1">Matrix_Free</a> (U);
00291       min = (curend &gt;= L-&gt;NbColumns) ? L-&gt;NbColumns : curend ;
00292       <font class="keywordflow">if</font> (rank==min || curRow &gt;= curend)
00293         <font class="keywordflow">break</font>;
00294     }
00295   }
00296   <font class="keywordflow">return</font>;
00297 } <font class="comment">/* RearrangeMatforSolveDio */</font>
</pre></div><hr><address><small>Generated on Fri Oct 4 16:14:26 2002 for Polylib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.11.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
