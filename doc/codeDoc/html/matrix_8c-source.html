<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>matrix.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.15 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>matrix.c</h1><a href="matrix_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/* matrix.c </font>
00002 <font class="comment">     COPYRIGHT</font>
00003 <font class="comment">          Both this software and its documentation are</font>
00004 <font class="comment"></font>
00005 <font class="comment">              Copyright 1993 by IRISA /Universite de Rennes I -</font>
00006 <font class="comment">              France, Copyright 1995,1996 by BYU, Provo, Utah</font>
00007 <font class="comment">                         all rights reserved.</font>
00008 <font class="comment"></font>
00009 <font class="comment">          Permission is granted to copy, use, and distribute</font>
00010 <font class="comment">          for any commercial or noncommercial purpose under the terms</font>
00011 <font class="comment">          of the GNU General Public license, version 2, June 1991</font>
00012 <font class="comment">          (see file : LICENSING).</font>
00013 <font class="comment">*/</font>
00014 
00015 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00016 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00017 <font class="preprocessor">#include &lt;string.h&gt;</font>
00018 <font class="preprocessor">#include &lt;ctype.h&gt;</font>
00019 <font class="preprocessor">#include &lt;polylib/polylib.h&gt;</font>
00020 
00021 <font class="preprocessor">#ifdef mac_os</font>
00022 <font class="preprocessor"></font><font class="preprocessor">  #define abs __abs</font>
00023 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00024 <font class="preprocessor"></font>
00025 <font class="comment">/* </font>
00026 <font class="comment"> * Allocate space for matrix dimensioned by 'NbRows X NbColumns'.</font>
00027 <font class="comment"> */</font>
<a name="l00028"></a><a class="code" href="matrix_8c.html#a0">00028</a> Matrix *<a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(<font class="keywordtype">unsigned</font> NbRows,<font class="keywordtype">unsigned</font> NbColumns) {
00029   
00030   Matrix *Mat;
00031   <a class="code" href="arithmetique_8h.html#a93">Value</a> *p, **q;
00032   <font class="keywordtype">int</font> i,j;
00033 
00034   Mat=(Matrix *)malloc(<font class="keyword">sizeof</font>(Matrix));
00035   <font class="keywordflow">if</font>(!Mat) {    
00036     <a class="code" href="errormsg_8c.html#a1">errormsg1</a>(<font class="stringliteral">"Matrix_Alloc"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00037     <font class="keywordflow">return</font> 0;
00038   }
00039   Mat-&gt;NbRows=NbRows;
00040   Mat-&gt;NbColumns=NbColumns;
00041   <font class="keywordflow">if</font>(NbRows==0) {
00042     Mat-&gt;p = (<a class="code" href="arithmetique_8h.html#a93">Value</a> **)0;
00043     Mat-&gt;p_Init= (<a class="code" href="arithmetique_8h.html#a93">Value</a> *)0;
00044   }  
00045   <font class="keywordflow">else</font> {
00046     q = (<a class="code" href="arithmetique_8h.html#a93">Value</a> **)malloc(NbRows * <font class="keyword">sizeof</font>(*q));
00047     <font class="keywordflow">if</font>(!q) {
00048       free(Mat);
00049       <a class="code" href="errormsg_8c.html#a1">errormsg1</a>(<font class="stringliteral">"Matrix_Alloc"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00050       <font class="keywordflow">return</font> 0;
00051     }
00052     <font class="keywordflow">if</font>(NbColumns==0) {
00053       Mat-&gt;p = (<a class="code" href="arithmetique_8h.html#a93">Value</a> **)0;
00054       Mat-&gt;p_Init= (<a class="code" href="arithmetique_8h.html#a93">Value</a> *)0;
00055       free(q);
00056     }
00057     <font class="keywordflow">else</font> {
00058       p = (<a class="code" href="arithmetique_8h.html#a93">Value</a> *)malloc(NbRows * NbColumns * <font class="keyword">sizeof</font>(<a class="code" href="arithmetique_8h.html#a93">Value</a>));
00059       <font class="keywordflow">if</font>(!p) {
00060         free(q);
00061         free(Mat);
00062         <a class="code" href="errormsg_8c.html#a1">errormsg1</a>(<font class="stringliteral">"Matrix_Alloc"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00063         <font class="keywordflow">return</font> 0;
00064       }
00065       Mat-&gt;p = q;
00066       Mat-&gt;p_Init = p;
00067       <font class="keywordflow">for</font> (i=0;i&lt;NbRows;i++) {
00068         *q++ = p;
00069         <font class="keywordflow">for</font> (j=0;j&lt;NbColumns;j++)   
00070           <a class="code" href="arithmetique_8h.html#a10">value_init</a>(*(p+j));
00071         p += NbColumns;
00072       }
00073     }
00074   }
00075   p = NULL;
00076   q = NULL;
00077   Mat-&gt;p_Init_size = NbColumns*NbRows;
00078 
00079   <font class="keywordflow">return</font> Mat;
00080 } <font class="comment">/* Matrix_Alloc */</font>
00081 
00082 <font class="comment">/* </font>
00083 <font class="comment"> * Free the memory space occupied by Matrix 'Mat' </font>
00084 <font class="comment"> */</font>
<a name="l00085"></a><a class="code" href="matrix_8c.html#a1">00085</a> <font class="keywordtype">void</font> <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Matrix *Mat) {
00086   
00087   <font class="keywordtype">int</font> i,j;
00088   <a class="code" href="arithmetique_8h.html#a93">Value</a> *p;
00089 
00090   <font class="keywordflow">if</font>( Mat-&gt;p )
00091   {
00092     p = *(Mat-&gt;p);
00093     <font class="keywordflow">for</font>(i=0;i&lt;Mat-&gt;p_Init_size;i++) {
00094       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(*p++);
00095     }
00096   }
00097 
00098   <font class="keywordflow">if</font> (Mat-&gt;p_Init)
00099     free(Mat-&gt;p_Init);
00100   <font class="keywordflow">if</font> (Mat-&gt;p)
00101     free(Mat-&gt;p);
00102   free(Mat);
00103 
00104 } <font class="comment">/* Matrix_Free */</font>
00105 
00106 <font class="comment">/* </font>
00107 <font class="comment"> * Print the contents of the Matrix 'Mat'</font>
00108 <font class="comment"> */</font>
<a name="l00109"></a><a class="code" href="matrix_8c.html#a2">00109</a> <font class="keywordtype">void</font> <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(FILE *Dst,<font class="keywordtype">char</font> *Format,Matrix *Mat) {
00110   
00111   <a class="code" href="arithmetique_8h.html#a93">Value</a> *p;
00112   <font class="keywordtype">int</font> i, j;
00113   <font class="keywordtype">unsigned</font> NbRows, NbColumns;
00114   
00115   fprintf(Dst,<font class="stringliteral">"%d %d\n"</font>, NbRows=Mat-&gt;NbRows, NbColumns=Mat-&gt;NbColumns);
00116   <font class="keywordflow">for</font> (i=0;i&lt;NbRows;i++) {
00117     p=*(Mat-&gt;p+i);
00118     <font class="keywordflow">for</font> (j=0;j&lt;NbColumns;j++) {
00119       <font class="keywordflow">if</font> (!Format) {
00120         <a class="code" href="arithmetique_8h.html#a16">value_print</a>(Dst,<font class="stringliteral">" "</font>P_VALUE_FMT<font class="stringliteral">" "</font>,*p++);
00121       }
00122       <font class="keywordflow">else</font> { 
00123         <a class="code" href="arithmetique_8h.html#a16">value_print</a>(Dst,Format,*p++);
00124       } 
00125     }
00126     fprintf(Dst, <font class="stringliteral">"\n"</font>);
00127   }
00128 } <font class="comment">/* Matrix_Print */</font>
00129 
00130 <font class="comment">/* </font>
00131 <font class="comment"> * Read the contents of the Matrix 'Mat' </font>
00132 <font class="comment"> */</font>
<a name="l00133"></a><a class="code" href="matrix_8c.html#a3">00133</a> <font class="keywordtype">void</font> <a class="code" href="matrix_8c.html#a3">Matrix_Read_Input</a>(Matrix *Mat) {
00134   
00135   <a class="code" href="arithmetique_8h.html#a93">Value</a> *p;
00136   <font class="keywordtype">int</font> i,j,n;
00137   <font class="keywordtype">char</font> *c, s[1024],str[1024];
00138   
00139   p = Mat-&gt;p_Init;
00140   <font class="keywordflow">for</font> (i=0;i&lt;Mat-&gt;NbRows;i++) {
00141     <font class="keywordflow">do</font> {
00142       c = fgets(s, 1024, stdin);
00143       <font class="keywordflow">while</font>(isspace(*c) &amp;&amp; *c!=<font class="charliteral">'\n'</font>)
00144         ++c;
00145     } <font class="keywordflow">while</font>(c &amp;&amp; (*c ==<font class="charliteral">'#'</font> || *c== <font class="charliteral">'\n'</font>));
00146     
00147     <font class="keywordflow">if</font> (!c) {
00148       <a class="code" href="errormsg_8c.html#a1">errormsg1</a>( <font class="stringliteral">"Matrix_Read"</font>, <font class="stringliteral">"baddim"</font>, <font class="stringliteral">"not enough rows"</font> );
00149       <font class="keywordflow">break</font>;
00150     }
00151     <font class="keywordflow">for</font> (j=0;j&lt;Mat-&gt;NbColumns;j++) {
00152       <font class="keywordflow">if</font>(!c || *c==<font class="charliteral">'\n'</font> || *c==<font class="charliteral">'#'</font>) {
00153         <a class="code" href="errormsg_8c.html#a1">errormsg1</a>(<font class="stringliteral">"Matrix_Read"</font>, <font class="stringliteral">"baddim"</font>, <font class="stringliteral">"not enough columns"</font>);
00154         <font class="keywordflow">break</font>;
00155       }
00156       <font class="keywordflow">if</font> (sscanf(c,<font class="stringliteral">"%s%n"</font>,str,&amp;n) == 0) {
00157         <a class="code" href="errormsg_8c.html#a1">errormsg1</a>( <font class="stringliteral">"Matrix_Read"</font>, <font class="stringliteral">"baddim"</font>, <font class="stringliteral">"not enough columns"</font> );
00158         <font class="keywordflow">break</font>;
00159       }
00160       <a class="code" href="arithmetique_8h.html#a15">value_read</a>(*(p++),str);
00161       c += n;
00162     }
00163   }
00164 } <font class="comment">/* Matrix_Read_Input */</font>
00165 
00166 <font class="comment">/* </font>
00167 <font class="comment"> * Read the contents of the matrix 'Mat' from standard input. </font>
00168 <font class="comment"> * A '#' in the first column is a comment line </font>
00169 <font class="comment"> */</font>
<a name="l00170"></a><a class="code" href="matrix_8c.html#a4">00170</a> Matrix *<a class="code" href="matrix_8c.html#a4">Matrix_Read</a>(<font class="keywordtype">void</font>) {
00171   
00172   Matrix *Mat;
00173   <font class="keywordtype">unsigned</font> NbRows, NbColumns;
00174   <font class="keywordtype">char</font> s[1024];
00175   
00176   <font class="keywordflow">while</font>(fgets(s, 1024, stdin)==0);
00177   <font class="keywordflow">while</font> ((*s==<font class="charliteral">'#'</font> || *s==<font class="charliteral">'\n'</font>) ||
00178          (sscanf(s, <font class="stringliteral">"%d %d"</font>, &amp;NbRows, &amp;NbColumns)&lt;2))
00179     fgets(s, 1024, stdin);
00180   Mat = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbRows,NbColumns);
00181   <font class="keywordflow">if</font>(!Mat) {
00182     <a class="code" href="errormsg_8c.html#a1">errormsg1</a>(<font class="stringliteral">"Matrix_Read"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00183     <font class="keywordflow">return</font>(NULL);
00184   }
00185   <a class="code" href="matrix_8c.html#a3">Matrix_Read_Input</a>(Mat);
00186   <font class="keywordflow">return</font> Mat;
00187 } <font class="comment">/* Matrix_Read */</font>
00188 
00189 <font class="comment">/* </font>
00190 <font class="comment"> * Basic hermite engine </font>
00191 <font class="comment"> */</font>
<a name="l00192"></a><a class="code" href="matrix_8c.html#a5">00192</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="NormalForms_8c.html#a12">hermite</a>(Matrix *H,Matrix *U,Matrix *Q) {
00193   
00194   <font class="keywordtype">int</font> nc, nr, i, j, k, rank, reduced, pivotrow;
00195   <a class="code" href="arithmetique_8h.html#a93">Value</a> pivot,x,aux;
00196   <a class="code" href="arithmetique_8h.html#a93">Value</a> *temp1, *temp2;
00197   
00198   <font class="comment">/*                     T                     -1   T */</font>
00199   <font class="comment">/* Computes form: A = Q H  and U A = H  and U  = Q  */</font>
00200   
00201   <font class="keywordflow">if</font> (!H) { 
00202     <a class="code" href="errormsg_8c.html#a1">errormsg1</a>(<font class="stringliteral">"Domlib"</font>, <font class="stringliteral">"nullH"</font>, <font class="stringliteral">"hermite: ? Null H"</font>);
00203     <font class="keywordflow">return</font> -1;
00204   }
00205   nc = H-&gt;NbColumns;
00206   nr = H-&gt;NbRows;
00207   temp1 = (<a class="code" href="arithmetique_8h.html#a93">Value</a> *) malloc(nc * <font class="keyword">sizeof</font>(<a class="code" href="arithmetique_8h.html#a93">Value</a>));
00208   temp2 = (<a class="code" href="arithmetique_8h.html#a93">Value</a> *) malloc(nr * <font class="keyword">sizeof</font>(<a class="code" href="arithmetique_8h.html#a93">Value</a>));
00209   <font class="keywordflow">if</font> (!temp1 ||!temp2) {
00210     <a class="code" href="errormsg_8c.html#a1">errormsg1</a>(<font class="stringliteral">"Domlib"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00211     <font class="keywordflow">return</font> -1;
00212   }
00213   
00214   <font class="comment">/* Initialize all the 'Value' variables */</font>
00215   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(pivot); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(x); 
00216   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(aux);   
00217   <font class="keywordflow">for</font>(i=0;i&lt;nc;i++)
00218     <a class="code" href="arithmetique_8h.html#a10">value_init</a>(temp1[i]);
00219   <font class="keywordflow">for</font>(i=0;i&lt;nr;i++)
00220     <a class="code" href="arithmetique_8h.html#a10">value_init</a>(temp2[i]);
00221   
00222 <font class="preprocessor">#ifdef DEBUG</font>
00223 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"Start  -----------\n"</font>);
00224   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,H);
00225 <font class="preprocessor">#endif</font>
00226 <font class="preprocessor"></font>  <font class="keywordflow">for</font> (k=0, rank=0; k&lt;nc &amp;&amp; rank&lt;nr; k=k+1) {
00227     reduced = 1;        <font class="comment">/* go through loop the first time */</font>
00228 <font class="preprocessor">#ifdef DEBUG</font>
00229 <font class="preprocessor"></font>    fprintf(stderr, <font class="stringliteral">"Working on col %d.  Rank=%d ----------\n"</font>, k+1, rank+1);
00230 <font class="preprocessor">#endif</font>
00231 <font class="preprocessor"></font>    <font class="keywordflow">while</font> (reduced) {
00232       reduced=0;
00233       
00234       <font class="comment">/* 1. find pivot row */</font>
00235       <a class="code" href="arithmetique_8h.html#a55">value_absolute</a>(pivot,H-&gt;p[rank][k]);
00236       
00237       <font class="comment">/* the kth-diagonal element */</font>
00238       pivotrow = rank;
00239       
00240       <font class="comment">/* find the row i&gt;rank with smallest nonzero element in col k */</font>
00241       <font class="keywordflow">for</font> (i=rank+1; i&lt;nr; i++) {
00242         <a class="code" href="arithmetique_8h.html#a55">value_absolute</a>(x,H-&gt;p[i][k]);
00243         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(x) &amp;&amp;
00244             (<a class="code" href="arithmetique_8h.html#a26">value_lt</a>(x,pivot) || <a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(pivot))) {
00245           <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(pivot,x);
00246           pivotrow = i;
00247         }
00248       }
00249       
00250       <font class="comment">/* 2. Bring pivot to diagonal (exchange rows pivotrow and rank) */</font>
00251       <font class="keywordflow">if</font> (pivotrow != rank) {
00252         <a class="code" href="vector_8c.html#a10">Vector_Exchange</a>(H-&gt;p[pivotrow],H-&gt;p[rank],nc);
00253         <font class="keywordflow">if</font> (U)
00254           <a class="code" href="vector_8c.html#a10">Vector_Exchange</a>(U-&gt;p[pivotrow],U-&gt;p[rank],nr);
00255         <font class="keywordflow">if</font> (Q)
00256           <a class="code" href="vector_8c.html#a10">Vector_Exchange</a>(Q-&gt;p[pivotrow],Q-&gt;p[rank],nr);
00257 
00258 <font class="preprocessor">#ifdef DEBUG</font>
00259 <font class="preprocessor"></font>        fprintf(stderr,<font class="stringliteral">"Exchange rows %d and %d  -----------\n"</font>, rank+1, pivotrow+1);
00260         <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,H);
00261 <font class="preprocessor">#endif</font>
00262 <font class="preprocessor"></font>      }
00263       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(pivot,H-&gt;p[rank][k]);        <font class="comment">/* actual ( no abs() ) pivot */</font>
00264       
00265       <font class="comment">/* 3. Invert the row 'rank' if pivot is negative */</font>
00266       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a64">value_neg_p</a>(pivot)) {
00267         <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(pivot,pivot); <font class="comment">/* pivot = -pivot */</font>
00268         <font class="keywordflow">for</font> (j=0; j&lt;nc; j++)
00269           <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(H-&gt;p[rank][j],H-&gt;p[rank][j]);
00270         
00271         <font class="comment">/* H-&gt;p[rank][j] = -(H-&gt;p[rank][j]); */</font>
00272         <font class="keywordflow">if</font> (U)
00273           <font class="keywordflow">for</font> (j=0; j&lt;nr; j++)
00274             <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(U-&gt;p[rank][j],U-&gt;p[rank][j]);
00275         
00276         <font class="comment">/* U-&gt;p[rank][j] = -(U-&gt;p[rank][j]); */</font>
00277         <font class="keywordflow">if</font> (Q)
00278           <font class="keywordflow">for</font> (j=0; j&lt;nr; j++)
00279             <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(Q-&gt;p[rank][j],Q-&gt;p[rank][j]);
00280         
00281         <font class="comment">/* Q-&gt;p[rank][j] = -(Q-&gt;p[rank][j]); */</font>
00282 <font class="preprocessor">#ifdef DEBUG</font>
00283 <font class="preprocessor"></font>        fprintf(stderr,<font class="stringliteral">"Negate row %d  -----------\n"</font>, rank+1);
00284         <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,H);
00285 <font class="preprocessor">#endif</font>
00286 <font class="preprocessor"></font>
00287       }      
00288       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(pivot)) {
00289         
00290         <font class="comment">/* 4. Reduce the column modulo the pivot */</font>
00291         <font class="comment">/*    This eventually zeros out everything below the */</font>
00292         <font class="comment">/*    diagonal and produces an upper triangular matrix */</font>
00293         
00294         <font class="keywordflow">for</font> (i=rank+1;i&lt;nr;i++) {
00295           <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(x,H-&gt;p[i][k]);
00296           <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(x)) {         
00297             <a class="code" href="arithmetique_8h.html#a52">value_modulus</a>(aux,x,pivot);
00298             
00299             <font class="comment">/* floor[integer division] (corrected for neg x) */</font>
00300             <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a64">value_neg_p</a>(x) &amp;&amp; <a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(aux)) {
00301               
00302               <font class="comment">/* x=(x/pivot)-1; */</font>
00303               <a class="code" href="arithmetique_8h.html#a51">value_division</a>(x,x,pivot);
00304               <a class="code" href="arithmetique_8h.html#a50">value_decrement</a>(x,x);
00305             }   
00306             <font class="keywordflow">else</font> 
00307               <a class="code" href="arithmetique_8h.html#a51">value_division</a>(x,x,pivot);
00308             <font class="keywordflow">for</font> (j=0; j&lt;nc; j++) {
00309               <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(aux,x,H-&gt;p[rank][j]);
00310               <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(H-&gt;p[i][j],H-&gt;p[i][j],aux);
00311             }
00312             
00313             <font class="comment">/* U-&gt;p[i][j] -= (x * U-&gt;p[rank][j]); */</font>
00314             <font class="keywordflow">if</font> (U)
00315               <font class="keywordflow">for</font> (j=0; j&lt;nr; j++) {
00316                 <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(aux,x,U-&gt;p[rank][j]);
00317                 <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(U-&gt;p[i][j],U-&gt;p[i][j],aux);
00318               }
00319             
00320             <font class="comment">/* Q-&gt;p[rank][j] += (x * Q-&gt;p[i][j]); */</font>
00321             <font class="keywordflow">if</font> (Q)
00322               <font class="keywordflow">for</font>(j=0;j&lt;nr;j++) {
00323                 <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(aux,x,Q-&gt;p[i][j]);
00324                 <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(Q-&gt;p[rank][j],Q-&gt;p[rank][j],aux);
00325               }
00326             reduced = 1;
00327 
00328 <font class="preprocessor">#ifdef DEBUG</font>
00329 <font class="preprocessor"></font>            fprintf(stderr,
00330                     <font class="stringliteral">"row %d = row %d - %d row %d -----------\n"</font>, i+1, i+1, x, rank+1);
00331             <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,H);
00332 <font class="preprocessor">#endif</font>
00333 <font class="preprocessor"></font>        
00334           } <font class="comment">/* if (x) */</font>
00335         } <font class="comment">/* for (i) */</font>
00336       } <font class="comment">/* if (pivot != 0) */</font>
00337     } <font class="comment">/* while (reduced) */</font>
00338     
00339     <font class="comment">/* Last finish up this column */</font>
00340     <font class="comment">/* 5. Make pivot column positive (above pivot row) */</font>
00341     <font class="comment">/*    x should be zero for i&gt;k */</font>
00342     
00343     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(pivot)) {
00344       <font class="keywordflow">for</font> (i=0; i&lt;rank; i++) {
00345         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(x,H-&gt;p[i][k]);
00346         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(x)) {         
00347           <a class="code" href="arithmetique_8h.html#a52">value_modulus</a>(aux,x,pivot);
00348           
00349           <font class="comment">/* floor[integer division] (corrected for neg x) */</font>
00350           <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a64">value_neg_p</a>(x) &amp;&amp; <a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(aux)) {
00351             <a class="code" href="arithmetique_8h.html#a51">value_division</a>(x,x,pivot);
00352             <a class="code" href="arithmetique_8h.html#a50">value_decrement</a>(x,x);
00353             
00354             <font class="comment">/* x=(x/pivot)-1; */</font>
00355           }
00356           <font class="keywordflow">else</font>
00357             <a class="code" href="arithmetique_8h.html#a51">value_division</a>(x,x,pivot);
00358           
00359           <font class="comment">/* H-&gt;p[i][j] -= x * H-&gt;p[rank][j]; */</font>
00360           <font class="keywordflow">for</font> (j=0; j&lt;nc; j++) {
00361             <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(aux,x,H-&gt;p[rank][j]);
00362             <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(H-&gt;p[i][j],H-&gt;p[i][j],aux);
00363           }
00364           
00365           <font class="comment">/* U-&gt;p[i][j] -= x * U-&gt;p[rank][j]; */</font>
00366           <font class="keywordflow">if</font> (U)
00367             <font class="keywordflow">for</font> (j=0; j&lt;nr; j++) {
00368               <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(aux,x,U-&gt;p[rank][j]);
00369               <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(U-&gt;p[i][j],U-&gt;p[i][j],aux);
00370             }
00371           
00372           <font class="comment">/* Q-&gt;p[rank][j] += x * Q-&gt;p[i][j]; */</font>
00373           <font class="keywordflow">if</font> (Q)
00374             <font class="keywordflow">for</font> (j=0; j&lt;nr; j++) {
00375               <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(aux,x,Q-&gt;p[i][j]);
00376               <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(Q-&gt;p[rank][j],Q-&gt;p[rank][j],aux);
00377             }  
00378 <font class="preprocessor">#ifdef DEBUG</font>
00379 <font class="preprocessor"></font>          fprintf(stderr,
00380                   <font class="stringliteral">"row %d = row %d - %d row %d -----------\n"</font>, i+1, i+1, x, rank+1);
00381           <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,H);
00382 <font class="preprocessor">#endif</font>
00383 <font class="preprocessor"></font>        } <font class="comment">/* if (x) */</font>
00384       } <font class="comment">/* for (i) */</font>
00385       rank++;
00386     } <font class="comment">/* if (pivot!=0) */</font>
00387   } <font class="comment">/* for (k) */</font>
00388   
00389   <font class="comment">/* Clear all the 'Value' variables */</font>
00390   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(pivot); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(x); 
00391   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(aux); 
00392   <font class="keywordflow">for</font>(i=0;i&lt;nc;i++)
00393     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(temp1[i]);
00394   <font class="keywordflow">for</font>(i=0;i&lt;nr;i++)
00395     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(temp2[i]);
00396   free(temp2);
00397   free(temp1);
00398   <font class="keywordflow">return</font> rank;
00399 } <font class="comment">/* Hermite */</font> 
00400 
<a name="l00401"></a><a class="code" href="matrix_8c.html#a6">00401</a> <font class="keywordtype">void</font> <a class="code" href="matrix_8c.html#a6">right_hermite</a>(Matrix *A,Matrix **Hp,Matrix **Up,Matrix **Qp) {
00402   
00403   Matrix *H, *Q, *U;
00404   <font class="keywordtype">int</font> i, j, nr, nc, rank;
00405   <a class="code" href="arithmetique_8h.html#a93">Value</a> tmp;
00406   
00407   <font class="comment">/* Computes form: A = QH , UA = H */</font>  
00408   nc = A-&gt;NbColumns;
00409   nr = A-&gt;NbRows;
00410   
00411   <font class="comment">/* H = A */</font>
00412   *Hp = H = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(nr,nc);
00413   <font class="keywordflow">if</font> (!H) { 
00414     <a class="code" href="errormsg_8c.html#a1">errormsg1</a>(<font class="stringliteral">"DomRightHermite"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00415     <font class="keywordflow">return</font>;
00416   }
00417   
00418   <font class="comment">/* Initialize all the 'Value' variables */</font>
00419   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
00420   
00421   <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(A-&gt;p_Init,H-&gt;p_Init,nr*nc);
00422   
00423   <font class="comment">/* U = I */</font>
00424   <font class="keywordflow">if</font> (Up) {
00425     *Up = U = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(nr, nr);
00426     <font class="keywordflow">if</font> (!U) {
00427       <a class="code" href="errormsg_8c.html#a1">errormsg1</a>(<font class="stringliteral">"DomRightHermite"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00428       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00429       <font class="keywordflow">return</font>;
00430     }
00431     <a class="code" href="vector_8c.html#a9">Vector_Set</a>(U-&gt;p_Init,0,nr*nr);             <font class="comment">/* zero's */</font>
00432     <font class="keywordflow">for</font>(i=0;i&lt;nr;i++)                          <font class="comment">/* with diagonal of 1's */</font>
00433       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(U-&gt;p[i][i],1);
00434   }
00435   <font class="keywordflow">else</font>
00436     U = (Matrix *)0;
00437   
00438   <font class="comment">/* Q = I */</font>
00439   <font class="comment">/* Actually I compute Q transpose... its easier */</font>
00440   <font class="keywordflow">if</font> (Qp) {
00441     *Qp = Q = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(nr,nr);
00442     <font class="keywordflow">if</font> (!Q) {
00443       <a class="code" href="errormsg_8c.html#a1">errormsg1</a>(<font class="stringliteral">"DomRightHermite"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00444       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00445       <font class="keywordflow">return</font>;
00446     }
00447     <a class="code" href="vector_8c.html#a9">Vector_Set</a>(Q-&gt;p_Init,0,nr*nr);            <font class="comment">/* zero's */</font>
00448     <font class="keywordflow">for</font> (i=0;i&lt;nr;i++)                      <font class="comment">/* with diagonal of 1's */</font>
00449       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Q-&gt;p[i][i],1);
00450   }
00451   <font class="keywordflow">else</font>
00452     Q = (Matrix *)0;
00453   
00454   rank = <a class="code" href="NormalForms_8c.html#a12">hermite</a>(H,U,Q);
00455   
00456   <font class="comment">/* Q is returned transposed */</font> 
00457   <font class="comment">/* Transpose Q */</font>
00458   <font class="keywordflow">if</font> (Q) {
00459     <font class="keywordflow">for</font> (i=0; i&lt;nr; i++) {
00460       <font class="keywordflow">for</font> (j=i+1; j&lt;nr; j++) {
00461         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(tmp,Q-&gt;p[i][j]);
00462         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Q-&gt;p[i][j],Q-&gt;p[j][i] );
00463         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Q-&gt;p[j][i],tmp);
00464       }
00465     }
00466   }
00467   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00468   <font class="keywordflow">return</font>;
00469 } <font class="comment">/* right_hermite */</font>
00470 
<a name="l00471"></a><a class="code" href="matrix_8c.html#a7">00471</a> <font class="keywordtype">void</font> <a class="code" href="matrix_8c.html#a7">left_hermite</a>(Matrix *A,Matrix **Hp,Matrix **Qp,Matrix **Up) {
00472   
00473   Matrix *H, *HT, *Q, *U;
00474   <font class="keywordtype">int</font> i, j, nc, nr, rank;
00475   <a class="code" href="arithmetique_8h.html#a93">Value</a> tmp;
00476   
00477   <font class="comment">/* Computes left form: A = HQ , AU = H , </font>
00478 <font class="comment">     T    T T    T T   T</font>
00479 <font class="comment">     using right form  A  = Q H  , U A = H */</font>
00480   
00481   nr = A-&gt;NbRows;
00482   nc = A-&gt;NbColumns;
00483   
00484   <font class="comment">/* HT = A transpose */</font>
00485   HT = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(nc, nr);
00486   <font class="keywordflow">if</font> (!HT) {
00487     <a class="code" href="errormsg_8c.html#a1">errormsg1</a>(<font class="stringliteral">"DomLeftHermite"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00488     <font class="keywordflow">return</font>;
00489   }
00490   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
00491   <font class="keywordflow">for</font> (i=0; i&lt;nr; i++)
00492     <font class="keywordflow">for</font> (j=0; j&lt;nc; j++)
00493       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(HT-&gt;p[j][i],A-&gt;p[i][j]);
00494   
00495   <font class="comment">/* U = I */</font>
00496   <font class="keywordflow">if</font> (Up) {
00497     *Up = U = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(nc,nc);
00498     <font class="keywordflow">if</font> (!U) {
00499       <a class="code" href="errormsg_8c.html#a1">errormsg1</a>(<font class="stringliteral">"DomLeftHermite"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00500       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00501       <font class="keywordflow">return</font>;
00502     }
00503     <a class="code" href="vector_8c.html#a9">Vector_Set</a>(U-&gt;p_Init,0,nc*nc);            <font class="comment">/* zero's */</font>
00504     <font class="keywordflow">for</font> (i=0;i&lt;nc;i++)                        <font class="comment">/* with diagonal of 1's */</font>
00505       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(U-&gt;p[i][i],1);
00506   }
00507   <font class="keywordflow">else</font> U=(Matrix *)0;
00508   
00509   <font class="comment">/* Q = I */</font>
00510   <font class="keywordflow">if</font> (Qp) {
00511     *Qp = Q = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(nc, nc);
00512     <font class="keywordflow">if</font> (!Q) {
00513       <a class="code" href="errormsg_8c.html#a1">errormsg1</a>(<font class="stringliteral">"DomLeftHermite"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00514       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00515       <font class="keywordflow">return</font>;
00516     }
00517     <a class="code" href="vector_8c.html#a9">Vector_Set</a>(Q-&gt;p_Init,0,nc*nc);            <font class="comment">/* zero's */</font>
00518     <font class="keywordflow">for</font> (i=0;i&lt;nc;i++)                        <font class="comment">/* with diagonal of 1's */</font>
00519       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Q-&gt;p[i][i],1);
00520   }
00521   <font class="keywordflow">else</font> Q=(Matrix *)0;
00522   rank = <a class="code" href="NormalForms_8c.html#a12">hermite</a>(HT,U,Q);
00523   
00524   <font class="comment">/* H = HT transpose */</font>
00525   *Hp = H = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(nr,nc);
00526   <font class="keywordflow">if</font> (!H) {
00527     <a class="code" href="errormsg_8c.html#a1">errormsg1</a>(<font class="stringliteral">"DomLeftHermite"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00528     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00529     <font class="keywordflow">return</font>;
00530   }
00531   <font class="keywordflow">for</font> (i=0; i&lt;nr; i++)
00532     <font class="keywordflow">for</font> (j=0;j&lt;nc;j++)
00533       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(H-&gt;p[i][j],HT-&gt;p[j][i]);
00534   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(HT);
00535   
00536   <font class="comment">/* Transpose U */</font>
00537   <font class="keywordflow">if</font> (U) {
00538     <font class="keywordflow">for</font> (i=0; i&lt;nc; i++) {
00539       <font class="keywordflow">for</font> (j=i+1; j&lt;nc; j++) {
00540         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(tmp,U-&gt;p[i][j]);
00541         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(U-&gt;p[i][j],U-&gt;p[j][i] );
00542         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(U-&gt;p[j][i],tmp);
00543       }
00544     }
00545   }
00546 } <font class="comment">/* left_hermite */</font>
00547 
00548 <font class="comment">/*</font>
00549 <font class="comment"> * Given a integer matrix 'Mat'(k x k), compute its inverse rational matrix </font>
00550 <font class="comment"> * 'MatInv' k x (k+1). The last column of each row in matrix MatInv is used </font>
00551 <font class="comment"> * to store the common denominator of the entries in a row. The output is 1,</font>
00552 <font class="comment"> * if 'Mat' is non-singular (invertible), otherwise the output is 0. Note:: </font>
00553 <font class="comment"> * (1) Matrix 'Mat' is modified during the inverse operation.</font>
00554 <font class="comment"> * (2) Matrix 'MatInv' must be preallocated before passing into this function.</font>
00555 <font class="comment"> */</font>
<a name="l00556"></a><a class="code" href="matrix_8c.html#a8">00556</a> <font class="keywordtype">int</font> <a class="code" href="matrix_8c.html#a8">MatInverse</a>(Matrix *Mat,Matrix *MatInv ) {
00557   
00558   <font class="keywordtype">int</font> i, k, j, c;
00559   <a class="code" href="arithmetique_8h.html#a93">Value</a> x, gcd, piv;
00560   <a class="code" href="arithmetique_8h.html#a93">Value</a> m1,m2;
00561   
00562   <font class="keywordflow">if</font>(Mat-&gt;NbRows != Mat-&gt;NbColumns) {
00563    fprintf(stderr,<font class="stringliteral">"Trying to invert a non-square matrix !\n"</font>);
00564     <font class="keywordflow">return</font> 0;
00565   }
00566   
00567   <font class="comment">/* Initialize all the 'Value' variables */</font>
00568   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(x);  <a class="code" href="arithmetique_8h.html#a10">value_init</a>(gcd); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(piv);
00569   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(m1); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(m2);
00570 
00571   k = Mat-&gt;NbRows; 
00572 
00573   <font class="comment">/* Initialise MatInv */</font>
00574   <a class="code" href="vector_8c.html#a9">Vector_Set</a>(MatInv-&gt;p[0],0,k*(k+1));
00575 
00576   <font class="comment">/* Initialize 'MatInv' to Identity matrix form. Each diagonal entry is set*/</font>
00577   <font class="comment">/* to 1. Last column of each row (denominator of each entry in a row) is  */</font>
00578   <font class="comment">/* also set to 1.                                                         */</font> 
00579   <font class="keywordflow">for</font>(i=0;i&lt;k;++i) {
00580     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(MatInv-&gt;p[i][i],1);    
00581     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(MatInv-&gt;p[i][k],1);    <font class="comment">/* denum */</font>
00582   }  
00583   <font class="comment">/* Apply Gauss-Jordan elimination method on the two matrices 'Mat' and  */</font>
00584   <font class="comment">/* 'MatInv' in parallel.                                                */</font>
00585   <font class="keywordflow">for</font>(i=0;i&lt;k;++i) {
00586     
00587     <font class="comment">/* Check if the diagonal entry (new pivot) is non-zero or not */</font>
00588     <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(Mat-&gt;p[i][i])) {    
00589       
00590       <font class="comment">/* Search for a non-zero pivot down the column(i) */</font>
00591       <font class="keywordflow">for</font>(j=i;j&lt;k;++j)      
00592         <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat-&gt;p[j][i]))
00593           <font class="keywordflow">break</font>;
00594       
00595       <font class="comment">/* If no non-zero pivot is found, the matrix 'Mat' is non-invertible */</font>
00596       <font class="comment">/* Return 0.                                                         */</font>
00597       <font class="keywordflow">if</font>(j==k) {
00598         
00599         <font class="comment">/* Clear all the 'Value' variables */</font>
00600         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(x);  <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(gcd); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(piv);
00601         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00602         <font class="keywordflow">return</font> 0;
00603       } 
00604       
00605       <font class="comment">/* Exchange the rows, row(i) and row(j) so that the diagonal element */</font>
00606       <font class="comment">/* Mat-&gt;p[i][i] (pivot) is non-zero. Repeat the same operations on    */</font>
00607       <font class="comment">/* matrix 'MatInv'.                                                   */</font>
00608       <font class="keywordflow">for</font>(c=0;c&lt;k;++c) {
00609 
00610         <font class="comment">/* Interchange rows, row(i) and row(j) of matrix 'Mat'    */</font>
00611         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(x,Mat-&gt;p[j][c]);
00612         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Mat-&gt;p[j][c],Mat-&gt;p[i][c]);
00613         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Mat-&gt;p[i][c],x);
00614         
00615         <font class="comment">/* Interchange rows, row(i) and row(j) of matrix 'MatInv' */</font>
00616         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(x,MatInv-&gt;p[j][c]);
00617         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(MatInv-&gt;p[j][c],MatInv-&gt;p[i][c]);
00618         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(MatInv-&gt;p[i][c],x);
00619       }
00620     }
00621     
00622     <font class="comment">/* Make all the entries in column(i) of matrix 'Mat' zero except the */</font>
00623     <font class="comment">/* diagonal entry. Repeat the same sequence of operations on matrix  */</font>
00624     <font class="comment">/* 'MatInv'.                                                         */</font>
00625     <font class="keywordflow">for</font>(j=0;j&lt;k;++j) {
00626       <font class="keywordflow">if</font> (j==i) <font class="keywordflow">continue</font>;                <font class="comment">/* Skip the pivot */</font>
00627       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(x,Mat-&gt;p[j][i]);
00628       <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(x)) {
00629         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(piv,Mat-&gt;p[i][i]);
00630         <a class="code" href="vector_8c.html#a3">Gcd</a>(x,piv,&amp;gcd);
00631         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a70">value_notone_p</a>(gcd) ) {
00632           <a class="code" href="arithmetique_8h.html#a51">value_division</a>(x,x,gcd);
00633           <a class="code" href="arithmetique_8h.html#a51">value_division</a>(piv,piv,gcd);
00634         }
00635         <font class="keywordflow">for</font>(c=((j&gt;i)?i:0);c&lt;k;++c) {
00636           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(m1,piv,Mat-&gt;p[j][c]);
00637           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(m2,x,Mat-&gt;p[i][c]);
00638           <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(Mat-&gt;p[j][c],m1,m2); 
00639         }
00640         <font class="keywordflow">for</font>(c=0;c&lt;k;++c) {
00641           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(m1,piv,MatInv-&gt;p[j][c]);
00642           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(m2,x,MatInv-&gt;p[i][c]);
00643           <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(MatInv-&gt;p[j][c],m1,m2);
00644         }
00645               
00646         <font class="comment">/* Simplify row(j) of the two matrices 'Mat' and 'MatInv' by */</font>
00647         <font class="comment">/* dividing the rows with the common GCD.                     */</font>
00648         <a class="code" href="vector_8c.html#a23">Vector_Gcd</a>(&amp;MatInv-&gt;p[j][0],k,&amp;m1);
00649         <a class="code" href="vector_8c.html#a23">Vector_Gcd</a>(&amp;Mat-&gt;p[j][0],k,&amp;m2);
00650         <a class="code" href="vector_8c.html#a3">Gcd</a>(m1,m2,&amp;gcd);
00651         <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a70">value_notone_p</a>(gcd)) {
00652           <font class="keywordflow">for</font>(c=0;c&lt;k;++c) {
00653             <a class="code" href="arithmetique_8h.html#a51">value_division</a>(Mat-&gt;p[j][c],Mat-&gt;p[j][c],gcd);
00654             <a class="code" href="arithmetique_8h.html#a51">value_division</a>(MatInv-&gt;p[j][c],MatInv-&gt;p[j][c],gcd);
00655           }
00656         }
00657       }
00658     }
00659   }
00660   
00661   <font class="comment">/* Simplify every row so that 'Mat' reduces to Identity matrix. Perform  */</font>
00662   <font class="comment">/* the same sequence of operations on the matrix 'MatInv'.               */</font>
00663   <font class="keywordflow">for</font>(j=0;j&lt;k;++j) {
00664     <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(MatInv-&gt;p[j][k],Mat-&gt;p[j][j]);
00665     
00666     <font class="comment">/* Make the last column (denominator of each entry) of every row greater */</font>
00667     <font class="comment">/* than zero.                                                            */</font>
00668     <a class="code" href="vector_8c.html#a26">Vector_Normalize_Positive</a>(&amp;MatInv-&gt;p[j][0],k+1,k); 
00669   }
00670   
00671   <font class="comment">/* Clear all the 'Value' variables */</font>
00672   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(x);  <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(gcd); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(piv);
00673   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00674 
00675   <font class="keywordflow">return</font> 1;
00676 } <font class="comment">/* Mat_Inverse */</font>
00677 
00678 <font class="comment">/*</font>
00679 <font class="comment"> * Given (m x n) integer matrix 'X' and n x (k+1) rational matrix 'P', compute</font>
00680 <font class="comment"> * the rational m x (k+1) rational matrix  'S'. The last column in each row of</font>
00681 <font class="comment"> * the rational matrices is used to store the common denominator of elements</font>
00682 <font class="comment"> * in a row.                              </font>
00683 <font class="comment"> */</font>
<a name="l00684"></a><a class="code" href="matrix_8c.html#a9">00684</a> <font class="keywordtype">void</font> <a class="code" href="matrix_8c.html#a9">rat_prodmat</a>(Matrix *S,Matrix *X,Matrix *P) {
00685   
00686   <font class="keywordtype">int</font> i,j,k;
00687   <font class="keywordtype">int</font> last_column_index = P-&gt;NbColumns - 1;
00688   <a class="code" href="arithmetique_8h.html#a93">Value</a> lcm, old_lcm,gcd,last_column_entry,s1,s2;
00689   <a class="code" href="arithmetique_8h.html#a93">Value</a> m1,m2;
00690   
00691   <font class="comment">/* Initialize all the 'Value' variables */</font>
00692   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(lcm); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(old_lcm); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(gcd);
00693   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(last_column_entry); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(s1); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(s2);
00694   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(m1); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(m2);
00695 
00696   <font class="comment">/* Compute the LCM of last column entries (denominators) of rows */</font>
00697   <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(lcm,P-&gt;p[0][last_column_index]); 
00698   <font class="keywordflow">for</font>(k=1;k&lt;P-&gt;NbRows;++k) {
00699     <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(old_lcm,lcm);
00700     <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(last_column_entry,P-&gt;p[k][last_column_index]);
00701     <a class="code" href="vector_8c.html#a3">Gcd</a>(lcm,last_column_entry,&amp;gcd);
00702     <a class="code" href="arithmetique_8h.html#a51">value_division</a>(m1,last_column_entry,gcd);
00703     <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(lcm,lcm,m1);
00704   }
00705   
00706   <font class="comment">/* S[i][j] = Sum(X[i][k] * P[k][j] where Sum is extended over k = 1..nbrows*/</font>
00707   <font class="keywordflow">for</font>(i=0;i&lt;X-&gt;NbRows;++i)
00708     <font class="keywordflow">for</font>(j=0;j&lt;P-&gt;NbColumns-1;++j) {
00709       
00710       <font class="comment">/* Initialize s1 to zero. */</font>
00711       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(s1,0);
00712       <font class="keywordflow">for</font>(k=0;k&lt;P-&gt;NbRows;++k) {
00713         
00714         <font class="comment">/* If the LCM of last column entries is one, simply add the products */</font>
00715         <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a69">value_one_p</a>(lcm)) {
00716           <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(s2,0);
00717           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(s2,X-&gt;p[i][k],P-&gt;p[k][j]);
00718           <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(s1,s1,s2);
00719         }  
00720         
00721         <font class="comment">/* Numerator (num) and denominator (denom) of S[i][j] is given by :- */</font>
00722         <font class="comment">/* numerator  = Sum(X[i][k]*P[k][j]*lcm/P[k][last_column_index]) and */</font>
00723         <font class="comment">/* denominator= lcm where Sum is extended over k = 1..nbrows.        */</font>
00724         <font class="keywordflow">else</font> {
00725           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(m1,X-&gt;p[i][k],P-&gt;p[k][j]);
00726           <a class="code" href="arithmetique_8h.html#a51">value_division</a>(m2,lcm,P-&gt;p[k][last_column_index]);
00727           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(s2,m1,m2);
00728           <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(s1,s1,s2);
00729         }
00730       } 
00731       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(S-&gt;p[i][j],s1);
00732     }
00733   
00734   <font class="keywordflow">for</font>(i=0;i&lt;S-&gt;NbRows;++i) {
00735     <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(S-&gt;p[i][last_column_index],lcm);
00736 
00737     <font class="comment">/* Normalize the rows so that last element &gt;=0 */</font>
00738     <a class="code" href="vector_8c.html#a26">Vector_Normalize_Positive</a>(&amp;S-&gt;p[i][0],S-&gt;NbColumns,S-&gt;NbColumns-1);
00739   }
00740   
00741   <font class="comment">/* Clear all the 'Value' variables */</font>
00742   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(lcm); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(old_lcm); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(gcd);
00743   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(last_column_entry); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(s1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(s2);
00744   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00745  
00746   <font class="keywordflow">return</font>;
00747 } <font class="comment">/* rat_prodmat */</font>
00748 
00749 <font class="comment">/*</font>
00750 <font class="comment"> * Given a matrix 'Mat' and vector 'p1', compute the matrix-vector product </font>
00751 <font class="comment"> * and store the result in vector 'p2'. </font>
00752 <font class="comment"> */</font>
<a name="l00753"></a><a class="code" href="matrix_8c.html#a10">00753</a> <font class="keywordtype">void</font> <a class="code" href="matrix_8c.html#a10">Matrix_Vector_Product</a>(Matrix *Mat,<a class="code" href="arithmetique_8h.html#a93">Value</a> *p1,<a class="code" href="arithmetique_8h.html#a93">Value</a> *p2) {
00754 
00755   <font class="keywordtype">int</font> NbRows, NbColumns, i, j;
00756   <a class="code" href="arithmetique_8h.html#a93">Value</a> **cm, *q, *cp1, *cp2;
00757   <a class="code" href="arithmetique_8h.html#a93">Value</a> s;
00758   
00759   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(s);
00760   NbRows=Mat-&gt;NbRows;
00761   NbColumns=Mat-&gt;NbColumns;
00762   
00763   cm = Mat-&gt;p;
00764   cp2 = p2;
00765   <font class="keywordflow">for</font>(i=0;i&lt;NbRows;i++) {
00766     q = *cm++;
00767     cp1 = p1;
00768     <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(*cp2,*q,*cp1);
00769     q++;
00770     cp1++;
00771     
00772     <font class="comment">/* *cp2 = *q++ * *cp1++ */</font>
00773     <font class="keywordflow">for</font>(j=1;j&lt;NbColumns;j++) {
00774       
00775       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(s,0);
00776       <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(s,*q, *cp1);
00777       <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(*cp2,*cp2,s);
00778       q++;
00779       cp1++;
00780     }
00781     cp2++;
00782   }
00783   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(s);
00784   <font class="keywordflow">return</font>;
00785 } <font class="comment">/* Matrix_Vector_Product */</font>
00786 
00787 <font class="comment">/*</font>
00788 <font class="comment"> * Given a vector 'p1' and a matrix 'Mat', compute the vector-matrix product </font>
00789 <font class="comment"> * and store the result in vector 'p2'</font>
00790 <font class="comment"> */</font>
<a name="l00791"></a><a class="code" href="matrix_8c.html#a11">00791</a> <font class="keywordtype">void</font> <a class="code" href="matrix_8c.html#a11">Vector_Matrix_Product</a>(<a class="code" href="arithmetique_8h.html#a93">Value</a> *p1,Matrix *Mat,<a class="code" href="arithmetique_8h.html#a93">Value</a> *p2) {
00792   
00793   <font class="keywordtype">int</font> NbRows, NbColumns, i, j;
00794   <a class="code" href="arithmetique_8h.html#a93">Value</a> **cm, *cp1, *cp2;
00795   <a class="code" href="arithmetique_8h.html#a93">Value</a> s;
00796   
00797   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(s);
00798   NbRows=Mat-&gt;NbRows;
00799   NbColumns=Mat-&gt;NbColumns;
00800   cp2 = p2;
00801   cm  = Mat-&gt;p;
00802   <font class="keywordflow">for</font> (j=0;j&lt;NbColumns;j++) {
00803     cp1 = p1;
00804     <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(*cp2,*(*cm+j),*cp1);
00805     cp1++;
00806     
00807     <font class="comment">/* *cp2= *(*cm+j) * *cp1++; */</font>
00808     <font class="keywordflow">for</font> (i=1;i&lt;NbRows;i++) {
00809       
00810       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(s,0);
00811       <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(s,*(*(cm+i)+j),*cp1);
00812       <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(*cp2,*cp2,s);
00813       cp1++;
00814     }
00815     cp2++;
00816   }
00817   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(s);
00818   <font class="keywordflow">return</font>;
00819 } <font class="comment">/* Vector_Matrix_Product */</font>
00820 
00821 <font class="comment">/* </font>
00822 <font class="comment"> * Given matrices 'Mat1' and 'Mat2', compute the matrix product and store in </font>
00823 <font class="comment"> * matrix 'Mat3' </font>
00824 <font class="comment"> */</font>
<a name="l00825"></a><a class="code" href="matrix_8c.html#a12">00825</a> <font class="keywordtype">void</font> <a class="code" href="matrix_8c.html#a12">Matrix_Product</a>(Matrix *Mat1,Matrix *Mat2,Matrix *Mat3) {
00826   
00827   <font class="keywordtype">int</font> Size, i, j, k;
00828   <font class="keywordtype">unsigned</font> NbRows, NbColumns;
00829   <a class="code" href="arithmetique_8h.html#a93">Value</a> **q1, **q2, *p1, *p3,sum,s;
00830   
00831   NbRows    = Mat1-&gt;NbRows;
00832   NbColumns = Mat2-&gt;NbColumns;
00833   
00834   Size      = Mat1-&gt;NbColumns;
00835   <font class="keywordflow">if</font>(Mat2-&gt;NbRows!=Size||Mat3-&gt;NbRows!=NbRows||Mat3-&gt;NbColumns!=NbColumns) {
00836     fprintf(stderr, <font class="stringliteral">"? Matrix_Product : incompatable matrix dimension\n"</font>);
00837     <font class="keywordflow">return</font>;
00838   }     
00839   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(sum); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(s);
00840   p3 = Mat3-&gt;p_Init;
00841   q1 = Mat1-&gt;p;
00842   q2 = Mat2-&gt;p;
00843   
00844   <font class="comment">/* Mat3[i][j] = Sum(Mat1[i][k]*Mat2[k][j] where sum is over k = 1..nbrows */</font>
00845   <font class="keywordflow">for</font> (i=0;i&lt;NbRows;i++) {
00846     <font class="keywordflow">for</font> (j=0;j&lt;NbColumns;j++) {
00847       p1 = *(q1+i);
00848       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(sum,0);
00849       <font class="keywordflow">for</font> (k=0;k&lt;Size;k++) {
00850         
00851         <font class="comment">/* sum+=*p1++ * *(*(q2+k)+j); */</font>
00852         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(s,0);
00853         <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(s,*p1, *(*(q2+k)+j));
00854         <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(sum,sum,s);
00855         p1++;
00856       }
00857       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(*p3,sum);
00858       p3++;
00859     }
00860   }
00861   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(sum); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(s);
00862   <font class="keywordflow">return</font>;
00863 } <font class="comment">/* Matrix_Product */</font>
00864   
00865 <font class="comment">/*</font>
00866 <font class="comment"> * Given a rational matrix 'Mat'(k x k), compute its inverse rational matrix </font>
00867 <font class="comment"> * 'MatInv' k x k. The last column of each row in matrix MatInv is used </font>
00868 <font class="comment"> * to store the common denominator of the entries in a row. The output is 1,</font>
00869 <font class="comment"> * if 'Mat' is non-singular (invertible), otherwise the output is 0. Note:: </font>
00870 <font class="comment"> * (1) Matrix 'Mat' is modified during the inverse operation.</font>
00871 <font class="comment"> * (2) Matrix 'MatInv' must be preallocated before passing into this function.</font>
00872 <font class="comment"> */</font>
<a name="l00873"></a><a class="code" href="matrix_8c.html#a13">00873</a> <font class="keywordtype">int</font> <a class="code" href="matrix_8c.html#a13">Matrix_Inverse</a>(Matrix *Mat,Matrix *MatInv ) {
00874   
00875   <font class="keywordtype">int</font> i, k, j, c;
00876   <a class="code" href="arithmetique_8h.html#a93">Value</a> x, gcd, piv;
00877   <a class="code" href="arithmetique_8h.html#a93">Value</a> m1,m2;
00878   <a class="code" href="arithmetique_8h.html#a93">Value</a> *den;
00879   
00880   <font class="keywordflow">if</font>(Mat-&gt;NbRows != Mat-&gt;NbColumns) {
00881    fprintf(stderr,<font class="stringliteral">"Trying to invert a non-square matrix !\n"</font>);
00882     <font class="keywordflow">return</font> 0;
00883   }
00884   
00885   <font class="comment">/* Initialize all the 'Value' variables */</font>
00886   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(x);  <a class="code" href="arithmetique_8h.html#a10">value_init</a>(gcd); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(piv);
00887   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(m1); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(m2);
00888 
00889   k = Mat-&gt;NbRows; 
00890 
00891   <font class="comment">/* Initialise MatInv */</font>
00892   <a class="code" href="vector_8c.html#a9">Vector_Set</a>(MatInv-&gt;p[0],0,k*k);
00893 
00894   <font class="comment">/* Initialize 'MatInv' to Identity matrix form. Each diagonal entry is set*/</font>
00895   <font class="comment">/* to 1. Last column of each row (denominator of each entry in a row) is  */</font>
00896   <font class="comment">/* also set to 1.                                                         */</font> 
00897   <font class="keywordflow">for</font>(i=0;i&lt;k;++i) {
00898     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(MatInv-&gt;p[i][i],1);    
00899     <font class="comment">// value_set_si(MatInv-&gt;p[i][k],1); /* denum */</font>
00900   }  
00901   <font class="comment">/* Apply Gauss-Jordan elimination method on the two matrices 'Mat' and  */</font>
00902   <font class="comment">/* 'MatInv' in parallel.                                                */</font>
00903   <font class="keywordflow">for</font>(i=0;i&lt;k;++i) {
00904     
00905     <font class="comment">/* Check if the diagonal entry (new pivot) is non-zero or not */</font>
00906     <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(Mat-&gt;p[i][i])) {    
00907       
00908       <font class="comment">/* Search for a non-zero pivot down the column(i) */</font>
00909       <font class="keywordflow">for</font>(j=i;j&lt;k;++j)      
00910         <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat-&gt;p[j][i]))
00911           <font class="keywordflow">break</font>;
00912       
00913       <font class="comment">/* If no non-zero pivot is found, the matrix 'Mat' is non-invertible */</font>
00914       <font class="comment">/* Return 0.                                                         */</font>
00915       <font class="keywordflow">if</font>(j==k) {
00916         
00917         <font class="comment">/* Clear all the 'Value' variables */</font>
00918         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(x);  <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(gcd); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(piv);
00919         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00920         <font class="keywordflow">return</font> 0;
00921       } 
00922       
00923       <font class="comment">/* Exchange the rows, row(i) and row(j) so that the diagonal element */</font>
00924       <font class="comment">/* Mat-&gt;p[i][i] (pivot) is non-zero. Repeat the same operations on    */</font>
00925       <font class="comment">/* matrix 'MatInv'.                                                   */</font>
00926       <font class="keywordflow">for</font>(c=0;c&lt;k;++c) {
00927 
00928         <font class="comment">/* Interchange rows, row(i) and row(j) of matrix 'Mat'    */</font>
00929         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(x,Mat-&gt;p[j][c]);
00930         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Mat-&gt;p[j][c],Mat-&gt;p[i][c]);
00931         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Mat-&gt;p[i][c],x);
00932         
00933         <font class="comment">/* Interchange rows, row(i) and row(j) of matrix 'MatInv' */</font>
00934         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(x,MatInv-&gt;p[j][c]);
00935         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(MatInv-&gt;p[j][c],MatInv-&gt;p[i][c]);
00936         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(MatInv-&gt;p[i][c],x);
00937       }
00938     }
00939     
00940     <font class="comment">/* Make all the entries in column(i) of matrix 'Mat' zero except the */</font>
00941     <font class="comment">/* diagonal entry. Repeat the same sequence of operations on matrix  */</font>
00942     <font class="comment">/* 'MatInv'.                                                         */</font>
00943     <font class="keywordflow">for</font>(j=0;j&lt;k;++j) {
00944       <font class="keywordflow">if</font> (j==i) <font class="keywordflow">continue</font>;                <font class="comment">/* Skip the pivot */</font>
00945       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(x,Mat-&gt;p[j][i]);
00946       <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(x)) {
00947         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(piv,Mat-&gt;p[i][i]);
00948         <a class="code" href="vector_8c.html#a3">Gcd</a>(x,piv,&amp;gcd);
00949         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a70">value_notone_p</a>(gcd) ) {
00950           <a class="code" href="arithmetique_8h.html#a51">value_division</a>(x,x,gcd);
00951           <a class="code" href="arithmetique_8h.html#a51">value_division</a>(piv,piv,gcd);
00952         }
00953         <font class="keywordflow">for</font>(c=((j&gt;i)?i:0);c&lt;k;++c) {
00954           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(m1,piv,Mat-&gt;p[j][c]);
00955           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(m2,x,Mat-&gt;p[i][c]);
00956           <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(Mat-&gt;p[j][c],m1,m2); 
00957         }
00958         <font class="keywordflow">for</font>(c=0;c&lt;k;++c) {
00959           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(m1,piv,MatInv-&gt;p[j][c]);
00960           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(m2,x,MatInv-&gt;p[i][c]);
00961           <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(MatInv-&gt;p[j][c],m1,m2);
00962         }
00963               
00964         <font class="comment">/* Simplify row(j) of the two matrices 'Mat' and 'MatInv' by */</font>
00965         <font class="comment">/* dividing the rows with the common GCD.                     */</font>
00966         <a class="code" href="vector_8c.html#a23">Vector_Gcd</a>(&amp;MatInv-&gt;p[j][0],k,&amp;m1);
00967         <a class="code" href="vector_8c.html#a23">Vector_Gcd</a>(&amp;Mat-&gt;p[j][0],k,&amp;m2);
00968         <a class="code" href="vector_8c.html#a3">Gcd</a>(m1,m2,&amp;gcd);
00969         <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a70">value_notone_p</a>(gcd)) {
00970           <font class="keywordflow">for</font>(c=0;c&lt;k;++c) {
00971             <a class="code" href="arithmetique_8h.html#a51">value_division</a>(Mat-&gt;p[j][c],Mat-&gt;p[j][c],gcd);
00972             <a class="code" href="arithmetique_8h.html#a51">value_division</a>(MatInv-&gt;p[j][c],MatInv-&gt;p[j][c],gcd);
00973           }
00974         }
00975       }
00976     }
00977   }
00978   
00979   <font class="comment">/* Find common denom for each row */</font> 
00980    den = (<a class="code" href="arithmetique_8h.html#a93">Value</a> *)malloc(k*<font class="keyword">sizeof</font>(<a class="code" href="arithmetique_8h.html#a93">Value</a>));
00981    <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(x,1);
00982    <font class="keywordflow">for</font>(j=0 ; j&lt;k ; ++j) {
00983      <a class="code" href="arithmetique_8h.html#a10">value_init</a>(den[j]);
00984      <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(den[j],Mat-&gt;p[j][j]);
00985      
00986      <font class="comment">/* gcd is always positive */</font>
00987      <a class="code" href="vector_8c.html#a23">Vector_Gcd</a>(&amp;MatInv-&gt;p[j][0],k,&amp;gcd);
00988      <a class="code" href="vector_8c.html#a3">Gcd</a>(gcd,den[j],&amp;gcd);
00989      <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a64">value_neg_p</a>(den[j])) 
00990        <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(gcd,gcd); <font class="comment">/* make denominator positive */</font>
00991      <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a70">value_notone_p</a>(gcd)) {
00992        <font class="keywordflow">for</font> (c=0; c&lt;k; c++) 
00993          <a class="code" href="arithmetique_8h.html#a51">value_division</a>(MatInv-&gt;p[j][c],MatInv-&gt;p[j][c],gcd); <font class="comment">/* normalize */</font>
00994        <a class="code" href="arithmetique_8h.html#a51">value_division</a>(den[j],den[j],gcd);
00995      }  
00996      <a class="code" href="vector_8c.html#a3">Gcd</a>(x,den[j],&amp;gcd);
00997      <a class="code" href="arithmetique_8h.html#a51">value_division</a>(m1,den[j],gcd);
00998      <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(x,x,m1);
00999    }
01000    <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a70">value_notone_p</a>(x)) 
01001      <font class="keywordflow">for</font>(j=0 ; j&lt;k ; ++j) {       
01002        <font class="keywordflow">for</font> (c=0; c&lt;k; c++) {
01003          <a class="code" href="arithmetique_8h.html#a51">value_division</a>(m1,x,den[j]);
01004          <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(MatInv-&gt;p[j][c],MatInv-&gt;p[j][c],m1);  <font class="comment">/* normalize */</font>
01005        }
01006      }
01007 
01008    <font class="comment">/* Clear all the 'Value' variables */</font>
01009    <font class="keywordflow">for</font>(j=0 ; j&lt;k ; ++j) {
01010      <a class="code" href="arithmetique_8h.html#a10">value_init</a>(den[j]);
01011    }  
01012    <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(x);  <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(gcd); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(piv);
01013    <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
01014    
01015    <font class="keywordflow">return</font> 1;
01016 } <font class="comment">/* Matrix_Inverse */</font>
01017 
01018 
01019 
01020 
01021 
01022 
01023 
01024 
</pre></div><hr><address align="right"><small>Generated on Fri Nov 8 12:10:06 2002 for Polylib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.15 </small></address>
</body>
</html>
