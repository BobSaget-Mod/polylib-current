<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>polyhedron.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11.1 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>polyhedron.c</h1><a href="polyhedron_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/* polyhedron.c</font>
00002 <font class="comment">     COPYRIGHT</font>
00003 <font class="comment">          Both this software and its documentation are</font>
00004 <font class="comment"></font>
00005 <font class="comment">              Copyright 1993 by IRISA /Universite de Rennes I - France,</font>
00006 <font class="comment">              Copyright 1995,1996 by BYU, Provo, Utah</font>
00007 <font class="comment">                         all rights reserved.</font>
00008 <font class="comment"></font>
00009 <font class="comment">          Permission is granted to copy, use, and distribute</font>
00010 <font class="comment">          for any commercial or noncommercial purpose under the terms</font>
00011 <font class="comment">          of the GNU General Public license, version 2, June 1991</font>
00012 <font class="comment">          (see file : LICENSING).</font>
00013 <font class="comment">*/</font>
00014 
00015 <font class="comment">/*</font>
00016 <font class="comment"></font>
00017 <font class="comment">1997/12/02 - Olivier Albiez</font>
00018 <font class="comment">  Ce fichier contient les fonctions de la polylib de l'IRISA,</font>
00019 <font class="comment">  passees en 64bits.</font>
00020 <font class="comment">  La structure de la polylib a donc ete modifie pour permettre </font>
00021 <font class="comment">  le passage aux Value. La fonction Chernikova a ete reecrite.</font>
00022 <font class="comment"></font>
00023 <font class="comment">*/</font>
00024 
00025 <font class="comment">/*</font>
00026 <font class="comment"></font>
00027 <font class="comment">1998/26/02 - Vincent Loechner</font>
00028 <font class="comment">  Ajout de nombreuses fonctions, a la fin de ce fichier,</font>
00029 <font class="comment">  pour les polyedres parametres 64 bits.</font>
00030 <font class="comment">1998/16/03</font>
00031 <font class="comment">  #define DEBUG  printf</font>
00032 <font class="comment">  tests out of memory</font>
00033 <font class="comment">  compatibilite avec la version de doran</font>
00034 <font class="comment"></font>
00035 <font class="comment">*/</font>
00036 
00037 <font class="preprocessor">#undef POLY_DEBUG               </font><font class="comment">/* debug printf: general functions */</font>
00038 <font class="preprocessor">#undef POLY_RR_DEBUG            </font><font class="comment">/* debug printf: Remove Redundants */</font>
00039 <font class="preprocessor">#undef POLY_CH_DEBUG            </font><font class="comment">/* debug printf: Chernikova */</font>
00040 
00041 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00042 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00043 <font class="preprocessor">#include &lt;string.h&gt;</font>
00044 <font class="preprocessor">#include &lt;<a class="code" href="assert_8h.html">assert.h</a>&gt;</font>
00045 <font class="preprocessor">#include &lt;polylib/polylib.h&gt;</font>
00046 
00047 <font class="preprocessor">#ifdef MAC_OS</font>
00048 <font class="preprocessor"></font><font class="preprocessor">  #define abs __abs</font>
00049 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00050 <font class="preprocessor"></font>
00051 <font class="comment">/* WSIZE is the number of bits in a word or int type */</font> 
<a name="l00052"></a><a class="code" href="polyhedron_8c.html#a0">00052</a> <font class="preprocessor">#define WSIZE (8*sizeof(int)) </font>
00053 <font class="preprocessor"></font>
<a name="l00054"></a><a class="code" href="polyhedron_8c.html#a1">00054</a> <font class="preprocessor">#define bexchange(a, b, l)\</font>
00055 <font class="preprocessor">{\</font>
00056 <font class="preprocessor">  char *t = (char *)malloc(l*sizeof(char));\</font>
00057 <font class="preprocessor">  memcpy((t), (char *)(a), (int)(l));\</font>
00058 <font class="preprocessor">  memcpy((char *)(a), (char *)(b), (int)(l));\</font>
00059 <font class="preprocessor">  memcpy((char *)(b), (t), (int)(l));\</font>
00060 <font class="preprocessor">  free(t); \</font>
00061 <font class="preprocessor">}</font>
00062 <font class="preprocessor"></font>
<a name="l00063"></a><a class="code" href="polyhedron_8c.html#a2">00063</a> <font class="preprocessor">#define exchange(a, b, t)\</font>
00064 <font class="preprocessor">{ (t)=(a); (a)=(b); (b)=(t); }</font>
00065 <font class="preprocessor"></font>
00066 <font class="comment">/*  errormsg1 is an external function which is usually supplied by the</font>
00067 <font class="comment">    calling program (e.g. Domlib.c, ReadAlpha, etc...).</font>
00068 <font class="comment">    See errormsg.c for an example of such a function.  */</font>
00069 
00070 <font class="keywordtype">void</font> <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="keywordtype">char</font> *f , <font class="keywordtype">char</font> *msgname, <font class="keywordtype">char</font> *msg);
00071 
<a name="l00072"></a><a class="code" href="polyhedron_8c.html#a5">00072</a> <font class="keywordtype">int</font> Pol_status;                    <font class="comment">/* error status after operations */</font>
00073 
00074 <font class="comment">/*</font>
00075 <font class="comment"> * The Saturation matrix is defined to be an integer (int type) matrix.</font>
00076 <font class="comment"> * It is a boolean matrix which has a row for every constraint and a column</font>
00077 <font class="comment"> * for every line or ray. The bits in the binary format of each integer in </font>
00078 <font class="comment"> * the stauration matrix stores the information whether the corresponding</font>
00079 <font class="comment"> * constraint is saturated by ray(line) or not.   </font>
00080 <font class="comment"> */</font>
00081 
<a name="l00082"></a><a class="code" href="structSatMatrix.html">00082</a> <font class="keyword">typedef</font> <font class="keyword">struct </font>{
00083   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> NbRows;
00084   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> NbColumns;
<a name="l00085"></a><a class="code" href="structSatMatrix.html#m2">00085</a>   <font class="keywordtype">int</font> **p;
<a name="l00086"></a><a class="code" href="structSatMatrix.html#m3">00086</a>   <font class="keywordtype">int</font> *p_init;
00087 } <a class="code" href="structSatMatrix.html">SatMatrix</a>;
00088 
00089 <font class="comment">/*</font>
00090 <font class="comment"> * Allocate memory space for a saturation matrix. </font>
00091 <font class="comment"> */</font>
<a name="l00092"></a><a class="code" href="polyhedron_8c.html#a7">00092</a> <font class="keyword">static</font> <a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a23">SMAlloc</a>(<font class="keywordtype">int</font> rows,<font class="keywordtype">int</font> cols)<font class="keyword"> </font>{
00093   
00094   <font class="keywordtype">int</font> **q, *p, i;
00095   <a class="code" href="structSatMatrix.html">SatMatrix</a> *result;
00096   
00097   result = (<a class="code" href="structSatMatrix.html">SatMatrix</a> *) malloc (<font class="keyword">sizeof</font>(<a class="code" href="structSatMatrix.html">SatMatrix</a>));
00098   <font class="keywordflow">if</font>(!result) { 
00099     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"SMAlloc"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00100     <font class="keywordflow">return</font> 0;
00101   }
00102   result-&gt;<a class="code" href="structSatMatrix.html#m0">NbRows</a> = rows;
00103   result-&gt;<a class="code" href="structSatMatrix.html#m1">NbColumns</a> = cols;
00104   <font class="keywordflow">if</font>(rows == 0 || cols == 0) {
00105     result-&gt;<a class="code" href="structSatMatrix.html#m2">p</a> = NULL;
00106     <font class="keywordflow">return</font> result;
00107   }
00108   result-&gt;<a class="code" href="structSatMatrix.html#m2">p</a> = q = (<font class="keywordtype">int</font> **)malloc(rows * <font class="keyword">sizeof</font>(<font class="keywordtype">int</font> *));
00109   <font class="keywordflow">if</font>(!result-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>) {
00110     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"SMAlloc"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00111     <font class="keywordflow">return</font> 0;
00112   }
00113   result-&gt;<a class="code" href="structSatMatrix.html#m3">p_init</a> = p = (<font class="keywordtype">int</font> *)malloc (rows * cols * <font class="keyword">sizeof</font> (<font class="keywordtype">int</font>));
00114   <font class="keywordflow">if</font>(!result-&gt;<a class="code" href="structSatMatrix.html#m3">p_init</a>) {
00115     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"SMAlloc"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00116     <font class="keywordflow">return</font> 0;
00117   }
00118   <font class="keywordflow">for</font> (i=0; i&lt;rows; i++) {
00119     *q++ = p;
00120     p += cols;
00121   }
00122   <font class="keywordflow">return</font> result;
00123 } <font class="comment">/* SMAlloc */</font>
00124 
00125 <font class="comment">/* </font>
00126 <font class="comment"> * Free the memory space occupied by saturation matrix. </font>
00127 <font class="comment"> */</font> 
<a name="l00128"></a><a class="code" href="polyhedron_8c.html#a8">00128</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="polyparam_8c.html#a24">SMFree</a> (<a class="code" href="structSatMatrix.html">SatMatrix</a> **matrix)<font class="keyword"> </font>{
00129 
00130   <font class="keywordflow">if</font> (matrix[0]){ 
00131   free ((<font class="keywordtype">char</font> *) matrix[0]-&gt;p_init);
00132   free ((<font class="keywordtype">char</font> *) matrix[0]-&gt;p);
00133   free ((<font class="keywordtype">char</font> *) matrix[0]);
00134   matrix[0]=NULL;}
00135 } <font class="comment">/* SMFree */</font>
00136 
00137 <font class="comment">/*</font>
00138 <font class="comment"> * Print the contents of a saturation matrix.</font>
00139 <font class="comment"> * This function is defined only for debugging purpose. </font>
00140 <font class="comment"> */</font>
<a name="l00141"></a><a class="code" href="polyhedron_8c.html#a9">00141</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="polyhedron_8c.html#a9">SMPrint</a> (<a class="code" href="structSatMatrix.html">SatMatrix</a> *matrix)<font class="keyword"> </font>{
00142   
00143   <font class="keywordtype">int</font> *p;
00144   <font class="keywordtype">int</font> i, j;
00145   <font class="keywordtype">unsigned</font> NbRows, NbColumns;
00146   
00147   fprintf(stderr,<font class="stringliteral">"%d %d\n"</font>,NbRows=matrix-&gt;<a class="code" href="structSatMatrix.html#m0">NbRows</a>, NbColumns=matrix-&gt;<a class="code" href="structSatMatrix.html#m1">NbColumns</a>);
00148   <font class="keywordflow">for</font> (i=0;i&lt;NbRows;i++) {
00149     p = *(matrix-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>+i);
00150     <font class="keywordflow">for</font> (j=0;j&lt;NbColumns;j++)
00151       fprintf(stderr, <font class="stringliteral">" %10X "</font>, *p++);
00152     fprintf(stderr, <font class="stringliteral">"\n"</font>);
00153   }  
00154 } <font class="comment">/* SMPrint */</font>
00155 
00156 <font class="comment">/* </font>
00157 <font class="comment"> * Compute the bitwise OR of two saturation matrices.</font>
00158 <font class="comment"> */</font>
<a name="l00159"></a><a class="code" href="polyhedron_8c.html#a10">00159</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="polyhedron_8c.html#a10">SatVector_OR</a>(<font class="keywordtype">int</font> *p1,<font class="keywordtype">int</font> *p2,<font class="keywordtype">int</font> *p3,<font class="keywordtype">unsigned</font> length)<font class="keyword"> </font>{
00160   
00161   <font class="keywordtype">int</font> *cp1, *cp2, *cp3;
00162   <font class="keywordtype">int</font> i;
00163   
00164   cp1=p1;
00165   cp2=p2;
00166   cp3=p3;
00167   <font class="keywordflow">for</font> (i=0;i&lt;length;i++) {
00168     *cp3 = *cp1 | *cp2;
00169     cp3++;
00170     cp1++;
00171     cp2++;
00172   }
00173 } <font class="comment">/* SatVector_OR */</font>
00174 
00175 <font class="comment">/* </font>
00176 <font class="comment"> * Copy a saturation matrix to another (macro definition). </font>
00177 <font class="comment"> */</font>
<a name="l00178"></a><a class="code" href="polyhedron_8c.html#a3">00178</a> <font class="preprocessor">#define SMVector_Copy(p1, p2, length) \</font>
00179 <font class="preprocessor">  memcpy((char *)(p2), (char *)(p1), (int)((length)*sizeof(int)))</font>
00180 <font class="preprocessor"></font>
00181 <font class="comment">/*</font>
00182 <font class="comment"> * Initialize a saturation matrix with zeros (macro definition) </font>
00183 <font class="comment"> */</font>
<a name="l00184"></a><a class="code" href="polyhedron_8c.html#a4">00184</a> <font class="preprocessor">#define SMVector_Init(p1, length) \</font>
00185 <font class="preprocessor">  memset((char *)(p1), 0, (int)((length)*sizeof(int)))</font>
00186 <font class="preprocessor"></font>
00187 <font class="comment">/*</font>
00188 <font class="comment"> * Defining operations on polyhedron --</font>
00189 <font class="comment"> */</font>
00190 
00191 <font class="comment">/* </font>
00192 <font class="comment"> * Vector p3 is a linear combination of two vectors (p1 and p2) such that </font>
00193 <font class="comment"> * p3[pos] is zero. First element of each vector (p1,p2,p3) is a status </font>
00194 <font class="comment"> * element and is not changed in p3. The value of 'pos' may be 0 however.</font>
00195 <font class="comment"> * The parameter 'length' does not include status element one. </font>
00196 <font class="comment"> */</font>
<a name="l00197"></a><a class="code" href="polyhedron_8c.html#a11">00197</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="polyhedron_8c.html#a11">Combine</a>(Value *p1, Value *p2, Value *p3, <font class="keywordtype">int</font> pos, <font class="keywordtype">unsigned</font> length)<font class="keyword"> </font>{ 
00198 
00199   Value a1, a2, gcd;
00200   Value abs_a1,abs_a2,neg_a1;
00201 
00202   <font class="comment">/* Initialize all the 'Value' variables */</font>
00203   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(a1); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(a2); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(gcd);
00204   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(abs_a1); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(abs_a2); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(neg_a1);
00205   
00206   <font class="comment">/* a1 = p1[pos] */</font>
00207   <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(a1,p1[pos]); 
00208 
00209   <font class="comment">/* a2 = p2[pos] */</font>
00210   <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(a2,p2[pos]); 
00211 
00212   <font class="comment">/* a1_abs = |a1| */</font>
00213   <a class="code" href="arithmetique_8h.html#a55">value_absolute</a>(abs_a1,a1);
00214   
00215   <font class="comment">/* a2_abs = |a2| */</font>
00216   <a class="code" href="arithmetique_8h.html#a55">value_absolute</a>(abs_a2,a2);
00217 
00218   <font class="comment">/* gcd  = Gcd(abs(a1), abs(a2)) */</font>
00219   <a class="code" href="vector_8c.html#a3">Gcd</a>(abs_a1,abs_a2,&amp;gcd);
00220 
00221   <font class="comment">/* a1 = a1/gcd */</font>
00222   <a class="code" href="arithmetique_8h.html#a51">value_division</a> (a1,a1,gcd);
00223 
00224   <font class="comment">/* a2 = a2/gcd */</font>
00225   <a class="code" href="arithmetique_8h.html#a51">value_division</a> (a2,a2,gcd);
00226 
00227   <font class="comment">/* neg_a1 = -(a1) */</font>
00228   <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(neg_a1,a1);
00229 
00230   <a class="code" href="vector_8c.html#a20">Vector_Combine</a>(p1+1,p2+1,p3+1,a2,neg_a1,length);
00231   <a class="code" href="vector_8c.html#a25">Vector_Normalize</a>(p3+1,length);
00232 
00233   <font class="comment">/* Clear all the 'Value' variables */</font>
00234   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(a1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(a2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(gcd);
00235   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(abs_a1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(abs_a2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(neg_a1);    
00236   
00237   <font class="keywordflow">return</font>;
00238 } <font class="comment">/* Combine */</font>
00239 
00240 <font class="comment">/* </font>
00241 <font class="comment"> * Return the transpose of the saturation matrix 'Sat'. 'Mat' is a matrix</font>
00242 <font class="comment"> * of constraints and 'Ray' is a matrix of ray vectors and 'Sat' is the </font>
00243 <font class="comment"> * corresponding saturation matrix. </font>
00244 <font class="comment"> */</font>
<a name="l00245"></a><a class="code" href="polyhedron_8c.html#a12">00245</a> <font class="keyword">static</font> <a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyhedron_8c.html#a12">TransformSat</a>(Matrix *Mat, Matrix *Ray, <a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a6">Sat</a>)<font class="keyword"> </font>{ 
00246   
00247   <font class="keywordtype">int</font> i, j, sat_nbcolumns;
00248   <font class="keywordtype">unsigned</font> jx1, jx2, bx1, bx2;
00249   <a class="code" href="structSatMatrix.html">SatMatrix</a> *result;
00250 
00251   <font class="keywordflow">if</font> (Mat-&gt;NbRows != 0) 
00252     sat_nbcolumns = (Mat-&gt;NbRows-1) /(<font class="keyword">sizeof</font>(int)*8) + 1;
00253   <font class="keywordflow">else</font>                  
00254     sat_nbcolumns = 0;
00255 
00256   result = <a class="code" href="polyparam_8c.html#a23">SMAlloc</a>(Ray-&gt;NbRows, sat_nbcolumns);
00257   <a class="code" href="polyhedron_8c.html#a4">SMVector_Init</a>(result-&gt;<a class="code" href="structSatMatrix.html#m3">p_init</a>, Ray-&gt;NbRows * sat_nbcolumns);
00258 
00259   <font class="keywordflow">for</font>(i=0,jx1=0,bx1=MSB; i&lt;Ray-&gt;NbRows; i++) { 
00260     <font class="keywordflow">for</font>(j=0,jx2=0,bx2=MSB; j&lt;Mat-&gt;NbRows; j++) { 
00261       <font class="keywordflow">if</font> (<a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[j][jx1] &amp; bx1) 
00262         result-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i][jx2] |= bx2;
00263       NEXT(jx2,bx2);
00264     }
00265     NEXT(jx1, bx1);
00266   }
00267   <font class="keywordflow">return</font> result;
00268 } <font class="comment">/* TransformSat */</font>
00269 
00270 <font class="comment">/* </font>
00271 <font class="comment"> * Sort the rays (Ray, Sat) into three tiers as used in 'Chernikova' function:</font>
00272 <font class="comment"> * NbBid         &lt;= i &lt;  equal_bound    : saturates the constraint</font>
00273 <font class="comment"> * equal_bound   &lt;= i &lt;  sup_bound      : verifies the constraint</font>
00274 <font class="comment"> * sup_bound     &lt;= i &lt;  NbRay          : does not verify </font>
00275 <font class="comment"> *</font>
00276 <font class="comment"> * 'Ray' is the matrix of rays and 'Sat' is the corresponding saturation </font>
00277 <font class="comment"> * matrix. (jx,bx) pair specify the constraint in the saturation matrix. The</font>
00278 <font class="comment"> * status element of the 'Ray' matrix holds the saturation value w.r.t the </font>
00279 <font class="comment"> * constraint specified by (jx,bx). Thus</font>
00280 <font class="comment"> * Ray-&gt;p[i][0]  = 0 -&gt; ray(i) saturates the constraint</font>
00281 <font class="comment"> * Ray-&gt;p[i][0]  &gt; 0 -&gt; ray(i) verifies  the constraint</font>
00282 <font class="comment"> * Ray-&gt;p[i][0]  &lt; 0 -&gt; ray(i) doesn't verify the constraint  </font>
00283 <font class="comment"> */</font>  
<a name="l00284"></a><a class="code" href="polyhedron_8c.html#a13">00284</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="polyhedron_8c.html#a13">RaySort</a>(Matrix *Ray,<a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a6">Sat</a>,<font class="keywordtype">int</font> NbBid,<font class="keywordtype">int</font> NbRay,<font class="keywordtype">int</font> *equal_bound,<font class="keywordtype">int</font> *sup_bound,<font class="keywordtype">unsigned</font> RowSize1, <font class="keywordtype">unsigned</font> RowSize2, <font class="keywordtype">unsigned</font> bx, <font class="keywordtype">unsigned</font> jx)<font class="keyword"> </font>{                     
00285 
00286   <font class="keywordtype">int</font> inf_bound;
00287   Value **uni_eq, **uni_sup, **uni_inf;
00288   <font class="keywordtype">int</font> **inc_eq, **inc_sup, **inc_inf;
00289 
00290   <font class="comment">/* 'uni_eq' points to the first ray in the ray matrix which verifies a</font>
00291 <font class="comment">   * constraint, 'inc_eq' is the corresponding pointer in saturation </font>
00292 <font class="comment">   * matrix. 'uni_inf' points to the first ray (from top) which doesn't </font>
00293 <font class="comment">   * verify a constraint, 'inc_inf' is the corresponding pointer in </font>
00294 <font class="comment">   * saturation matrix. 'uni_sup' scans the ray matrix and 'inc_sup' is </font>
00295 <font class="comment">   * the corresponding pointer in saturation matrix. 'inf_bound' holds the </font>
00296 <font class="comment">   * number of the first ray which does not verify the constraints. </font>
00297 <font class="comment">   */</font>
00298 
00299   *sup_bound = *equal_bound = NbBid;
00300   uni_sup = uni_eq = Ray-&gt;p+NbBid;
00301   inc_sup = inc_eq = <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>+NbBid;
00302   inf_bound = NbRay;
00303   uni_inf = Ray-&gt;p+NbRay;
00304   inc_inf = <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>+NbRay;
00305   
00306   <font class="keywordflow">while</font> (inf_bound&gt;*sup_bound) {
00307     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(**uni_sup))<font class="keyword"> </font>{               <font class="comment">/* status = satisfy */</font>
00308       <a class="code" href="vector_8c.html#a10">Vector_Exchange</a>(*uni_eq,*uni_sup,RowSize1);
00309       <a class="code" href="polyhedron_8c.html#a1">bexchange</a>(*inc_eq,*inc_sup,RowSize2);
00310       (*equal_bound)++; uni_eq++; inc_eq++;
00311       (*sup_bound)++; uni_sup++; inc_sup++;
00312     }
00313     <font class="keywordflow">else</font> {
00314       *((*inc_sup)+jx)|=bx;
00315       
00316       <font class="comment">/* if (**uni_sup&lt;0) */</font>
00317       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a64">value_neg_p</a>(**uni_sup))<font class="keyword"> </font>{             <font class="comment">/* Status != verify  */</font>
00318         inf_bound--; uni_inf--; inc_inf--;
00319         <a class="code" href="vector_8c.html#a10">Vector_Exchange</a>(*uni_inf,*uni_sup,RowSize1);
00320         <a class="code" href="polyhedron_8c.html#a1">bexchange</a>(*inc_inf,*inc_sup,RowSize2);
00321       }
00322       <font class="keywordflow">else</font> {                                     <font class="comment">/* status == verify */</font>
00323          (*sup_bound)++; uni_sup++; inc_sup++;
00324       } 
00325     }
00326   }
00327 } <font class="comment">/* RaySort */</font> 
00328 
00329 <font class="comment">/* </font>
00330 <font class="comment"> * Compute the dual of matrix 'Mat' and place it in matrix 'Ray'.'Mat' </font>
00331 <font class="comment"> * contains the constraints (equalities and inequalities) in rows and 'Ray' </font>
00332 <font class="comment"> * contains the ray space (lines and rays) in its rows. 'Sat' is a boolean </font>
00333 <font class="comment"> * saturation matrix defined as Sat(i,j)=0 if ray(i) saturates constraint(j),</font>
00334 <font class="comment"> *  otherwise 1. The constraints in the 'Mat' matrix are processed starting at</font>
00335 <font class="comment"> * 'FirstConstraint', 'Ray' and 'Sat' matrices are changed accordingly.'NbBid'</font>
00336 <font class="comment"> * is the number of lines in the ray matrix and 'NbMaxRays' is the maximum </font>
00337 <font class="comment"> * number of rows (rays) permissible in the 'Ray' and 'Sat' matrix. Return 0 </font>
00338 <font class="comment"> * if successful, otherwise return 1.  </font>
00339 <font class="comment"> */</font>     
<a name="l00340"></a><a class="code" href="polyhedron_8c.html#a14">00340</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="polyhedron_8c.html#a14">Chernikova</a> (Matrix *Mat,Matrix *Ray,<a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a6">Sat</a>, <font class="keywordtype">unsigned</font> NbBid, <font class="keywordtype">unsigned</font> NbMaxRays, <font class="keywordtype">unsigned</font> FirstConstraint,<font class="keywordtype">unsigned</font> dual)<font class="keyword"> </font>{
00341 
00342   <font class="keywordtype">unsigned</font> NbRay, Dimension, NbConstraints, RowSize1, RowSize2, sat_nbcolumns;
00343   <font class="keywordtype">int</font> sup_bound, equal_bound, index_non_zero, bound;
00344   <font class="keywordtype">int</font> i, j, k, l, redundant, rayonly, nbcommonconstraints;
00345   <font class="keywordtype">int</font> *Temp, aux;
00346   <font class="keywordtype">int</font> *ip1, *ip2;
00347   <font class="keywordtype">unsigned</font> bx, <a class="code" href="polyparam_8c.html#a0">m</a>, jx;
00348   Value tmp;
00349   Value *p1, *p2, *p3;
00350 
00351 <font class="preprocessor">#ifdef POLY_CH_DEBUG</font>
00352 <font class="preprocessor"></font>  fprintf(stderr, <font class="stringliteral">"[Chernikova: Input]\nRay = "</font>);
00353   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
00354   fprintf(stderr, <font class="stringliteral">"\nConstraints = "</font>);
00355   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
00356   fprintf(stderr, <font class="stringliteral">"\nSat = "</font>);
00357   <a class="code" href="polyhedron_8c.html#a9">SMPrint</a>(<a class="code" href="polyparam_8c.html#a6">Sat</a>);
00358 <font class="preprocessor">#endif</font>
00359 <font class="preprocessor"></font>  
00360   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
00361   NbConstraints=Mat-&gt;NbRows;
00362   NbRay = Ray-&gt;NbRows;
00363   Dimension = Mat-&gt;NbColumns-1;         <font class="comment">/* Homogeneous Dimension */</font>
00364   sat_nbcolumns=<a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m1">NbColumns</a>;
00365   
00366   RowSize1=(Dimension+1);
00367   RowSize2=sat_nbcolumns * <font class="keyword">sizeof</font>(int);
00368 
00369   Temp=(<font class="keywordtype">int</font> *)malloc(RowSize2);
00370   <font class="keywordflow">if</font>(!Temp) {   
00371     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Chernikova"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00372     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00373     <font class="keywordflow">return</font> 0;
00374   }
00375   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
00376 
00377   <font class="comment">/* </font>
00378 <font class="comment">   * In case of overflow, free the allocated memory!</font>
00379 <font class="comment">   * Rethrow upwards the stack to forward the exception.</font>
00380 <font class="comment">   */</font>
00381     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00382     free(Temp);
00383     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
00384   }
00385   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
00386     jx = FirstConstraint/<a class="code" href="polyhedron_8c.html#a0">WSIZE</a>;    
00387     bx = MSB; bx &gt;&gt;= FirstConstraint%<a class="code" href="polyhedron_8c.html#a0">WSIZE</a>;
00388     <font class="keywordflow">for</font> (k=FirstConstraint; k&lt;NbConstraints; k++) {
00389       
00390       <font class="comment">/* Set the status word of each ray[i] to ray[i] dot constraint[k] */</font>
00391       <font class="comment">/* This is equivalent to evaluating each ray by the constraint[k] */</font>
00392       <font class="comment">/* 'index_non_zero' is assigned the smallest ray index which does */</font>
00393       <font class="comment">/* not saturate the constraint.                                   */</font>
00394       
00395       index_non_zero = NbRay;
00396       <font class="keywordflow">for</font> (i=0; i&lt;NbRay; i++) { 
00397         p1 = Ray-&gt;p[i]+1;
00398         p2 = Mat-&gt;p[k]+1;
00399         p3 = Ray-&gt;p[i];
00400         
00401         <font class="comment">/* *p3 = *p1 * *p2 */</font>     
00402         <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(*p3,*p1,*p2);
00403         p1++; p2++;
00404         <font class="keywordflow">for</font> (j=1; j&lt;Dimension; j++) {   
00405           
00406           <font class="comment">/* *p3 +=  *p1 * *p2 */</font>
00407           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp,*p1,*p2);
00408           <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(*p3,*p3,tmp);
00409           p1++; p2++;
00410         }
00411         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(*p3) &amp;&amp; (i&lt;index_non_zero)) 
00412           index_non_zero=i;
00413       }
00414       
00415 <font class="preprocessor">#ifdef POLY_CH_DEBUG</font>
00416 <font class="preprocessor"></font>      fprintf(stderr, <font class="stringliteral">"[Chernikova: A]\nRay = "</font>);
00417       <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
00418       fprintf(stderr, <font class="stringliteral">"\nConstraints = "</font>);
00419       <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
00420       fprintf(stderr, <font class="stringliteral">"\nSat = "</font>);
00421       <a class="code" href="polyhedron_8c.html#a9">SMPrint</a> (<a class="code" href="polyparam_8c.html#a6">Sat</a>);
00422 <font class="preprocessor">#endif</font>
00423 <font class="preprocessor"></font>      
00424       <font class="comment">/* Find a bidirectional ray z such that cz &lt;&gt; 0 */</font>  
00425       <font class="keywordflow">if</font> (index_non_zero&lt;NbBid) {
00426         
00427         <font class="comment">/* Discard index_non_zero bidirectional ray */</font>    
00428         NbBid--;
00429         <font class="keywordflow">if</font> (NbBid!=index_non_zero) 
00430           <a class="code" href="vector_8c.html#a10">Vector_Exchange</a>(Ray-&gt;p[index_non_zero],Ray-&gt;p[NbBid],RowSize1);       
00431 
00432 <font class="preprocessor">#ifdef POLY_CH_DEBUG    </font>
00433 <font class="preprocessor"></font>        fprintf(stderr,<font class="stringliteral">"************\n"</font>);
00434         <font class="keywordflow">for</font>(i=0;i&lt;RowSize1;i++) {
00435           <a class="code" href="arithmetique_8h.html#a16">value_print</a>(stderr,P_VALUE_FMT,Ray-&gt;p[index_non_zero][i]);
00436         }  
00437         fprintf(stderr,<font class="stringliteral">"\n******\n"</font>);
00438         <font class="keywordflow">for</font>(i=0;i&lt;RowSize1;i++) {
00439           <a class="code" href="arithmetique_8h.html#a16">value_print</a>(stderr,P_VALUE_FMT,Ray-&gt;p[NbBid][i]);
00440         }
00441         fprintf(stderr,<font class="stringliteral">"\n*******\n"</font>);
00442 <font class="preprocessor">#endif</font>
00443 <font class="preprocessor"></font>
00444         <font class="comment">/* Compute the new lineality space */</font>    
00445         <font class="keywordflow">for</font> (i=0; i&lt;NbBid; i++)
00446           <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Ray-&gt;p[i][0]))
00447             <a class="code" href="polyhedron_8c.html#a11">Combine</a>(Ray-&gt;p[i],Ray-&gt;p[NbBid],Ray-&gt;p[i],0,Dimension);
00448 
00449         <font class="comment">/* Add the positive part of index_non_zero bidirectional ray to  */</font>
00450         <font class="comment">/* the set of unidirectional rays                                */</font>
00451         
00452         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a64">value_neg_p</a>(Ray-&gt;p[NbBid][0]))<font class="keyword"> </font>{
00453           p1=Ray-&gt;p[NbBid]; 
00454           <font class="keywordflow">for</font> (j=0;j&lt;Dimension+1; j++) { 
00455             
00456             <font class="comment">/* *p1 = - *p1 */</font>   
00457             <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(*p1,*p1);
00458             p1++; 
00459           }
00460         }
00461         
00462 <font class="preprocessor">#ifdef POLY_CH_DEBUG</font>
00463 <font class="preprocessor"></font>        fprintf(stderr, <font class="stringliteral">"[Chernikova: B]\nRay = "</font>);
00464         Ray-&gt;NbRows=NbRay;
00465         <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
00466         fprintf(stderr, <font class="stringliteral">"\nConstraints = "</font>);
00467         <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
00468         fprintf(stderr, <font class="stringliteral">"\nSat = "</font>);
00469         <a class="code" href="polyhedron_8c.html#a9">SMPrint</a>(<a class="code" href="polyparam_8c.html#a6">Sat</a>);
00470 <font class="preprocessor">#endif</font>
00471 <font class="preprocessor"></font>        
00472         <font class="comment">/* Compute the new pointed cone */</font>
00473         <font class="keywordflow">for</font> (i=NbBid+1; i&lt;NbRay; i++)
00474           <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Ray-&gt;p[i][0]))
00475             <a class="code" href="polyhedron_8c.html#a11">Combine</a>(Ray-&gt;p[i],Ray-&gt;p[NbBid],Ray-&gt;p[i],0,Dimension);
00476         
00477         <font class="comment">/* Add the new ray */</font>
00478         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat-&gt;p[k][0]))<font class="keyword"> </font>{ <font class="comment">/* Constraint is an inequality */</font> 
00479           <font class="keywordflow">for</font> (j=0;j&lt;sat_nbcolumns;j++) {
00480             <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[NbBid][j] = 0;     <font class="comment">/* Saturation vec for new ray */</font>
00481           }
00482           <font class="comment">/* The new ray saturates everything except last inequality */</font>
00483           <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[NbBid][jx] |= bx;
00484         }
00485         <font class="keywordflow">else</font> {                        <font class="comment">/* Constraint is an equality */</font>
00486           NbRay--;
00487           <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Ray-&gt;p[NbRay],Ray-&gt;p[NbBid],Dimension+1);
00488           <a class="code" href="polyhedron_8c.html#a3">SMVector_Copy</a>(Sat-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[NbRay],Sat-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[NbBid],sat_nbcolumns);
00489         }
00490 
00491 <font class="preprocessor">#ifdef POLY_CH_DEBUG</font>
00492 <font class="preprocessor"></font>        fprintf(stderr, <font class="stringliteral">"[Chernikova: C]\nRay = "</font>);
00493         Ray-&gt;NbRows=NbRay;
00494         <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
00495         fprintf(stderr, <font class="stringliteral">"\nConstraints = "</font>);
00496         <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
00497         fprintf(stderr, <font class="stringliteral">"\nSat = "</font>);
00498         <a class="code" href="polyhedron_8c.html#a9">SMPrint</a> (<a class="code" href="polyparam_8c.html#a6">Sat</a>);
00499 <font class="preprocessor">#endif</font>
00500 <font class="preprocessor"></font>
00501       } 
00502       <font class="keywordflow">else</font> {  <font class="comment">/* If the new constraint satisfies all the rays */</font>
00503         <a class="code" href="polyhedron_8c.html#a13">RaySort</a>(Ray, <a class="code" href="polyparam_8c.html#a6">Sat</a>, NbBid, NbRay, &amp;equal_bound, &amp;sup_bound,
00504                 RowSize1, RowSize2,bx,jx);
00505         
00506         <font class="comment">/* Sort the unidirectional rays into R0, R+, R- */</font>
00507         <font class="comment">/* Ray </font>
00508 <font class="comment">           NbRay-&gt; bound-&gt; ________</font>
00509 <font class="comment">                           |  R-  |    R- ==&gt; ray.eq &lt; 0  (outside domain)</font>
00510 <font class="comment">                     sup-&gt; |------|</font>
00511 <font class="comment">                           |  R+  |    R+ ==&gt; ray.eq &gt; 0  (inside domain)</font>
00512 <font class="comment">                   equal-&gt; |------|</font>
00513 <font class="comment">                           |  R0  |    R0 ==&gt; ray.eq = 0  (on face of domain)</font>
00514 <font class="comment">                   NbBid-&gt; |______|</font>
00515 <font class="comment">        */</font>
00516 
00517 <font class="preprocessor">#ifdef POLY_CH_DEBUG</font>
00518 <font class="preprocessor"></font>        fprintf(stderr, <font class="stringliteral">"[Chernikova: D]\nRay = "</font>);
00519         Ray-&gt;NbRows=NbRay;
00520         <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
00521         fprintf(stderr, <font class="stringliteral">"\nConstraints = "</font>);
00522         <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
00523         fprintf(stderr, <font class="stringliteral">"\nSat = "</font>);
00524         <a class="code" href="polyhedron_8c.html#a9">SMPrint</a> (<a class="code" href="polyparam_8c.html#a6">Sat</a>);
00525 <font class="preprocessor">#endif</font>
00526 <font class="preprocessor"></font>
00527         <font class="comment">/* Compute only the new pointed cone */</font>
00528         bound=NbRay;
00529         <font class="keywordflow">for</font> (i=equal_bound; i&lt;sup_bound; i++) <font class="comment">/* for all pairs of R- and R+ */</font>
00530           <font class="keywordflow">for</font>(j=sup_bound; j&lt;bound; j++) {    
00531             
00532           <font class="comment">/*--------------------------------------------------------------*/</font>
00533           <font class="comment">/* Count the set of constraints saturated by R+ and R- */</font>
00534           <font class="comment">/* Includes equalities, inequalities and the positivity constraint */</font>
00535           <font class="comment">/*-----------------------------------------------------------------*/</font>
00536             
00537             nbcommonconstraints = 0;
00538             <font class="keywordflow">for</font> (l=0; l&lt;jx; l++) {
00539               aux = Temp[l] = <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i][l] | <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[j][l];
00540               <font class="keywordflow">for</font> (<a class="code" href="polyparam_8c.html#a0">m</a>=MSB; <a class="code" href="polyparam_8c.html#a0">m</a>!=0; <a class="code" href="polyparam_8c.html#a0">m</a>&gt;&gt;=1) 
00541                 <font class="keywordflow">if</font> (!(aux&amp;<a class="code" href="polyparam_8c.html#a0">m</a>)) 
00542                   nbcommonconstraints++;
00543             }
00544             aux = Temp[jx] =  <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i][jx] | <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[j][jx];
00545             <font class="keywordflow">for</font> (<a class="code" href="polyparam_8c.html#a0">m</a>=MSB; <a class="code" href="polyparam_8c.html#a0">m</a>!=bx; <a class="code" href="polyparam_8c.html#a0">m</a>&gt;&gt;=1) 
00546               <font class="keywordflow">if</font> (!(aux&amp;<a class="code" href="polyparam_8c.html#a0">m</a>)) 
00547                 nbcommonconstraints++;      
00548             rayonly = (<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(Ray-&gt;p[i][Dimension])  &amp;&amp; 
00549                        value_zero_p(Ray-&gt;p[j][Dimension]) &amp;&amp; 
00550                        (dual == 0));                
00551             <font class="keywordflow">if</font>(rayonly)
00552               nbcommonconstraints++;      <font class="comment">/* account for pos constr */</font>
00553 
00554           <font class="comment">/*-----------------------------------------------------------------*/</font>
00555           <font class="comment">/* Adjacency Test : is combination [R-,R+] a non redundant ray?    */</font>
00556           <font class="comment">/*-----------------------------------------------------------------*/</font>
00557           
00558             <font class="keywordflow">if</font> (nbcommonconstraints+NbBid&gt;=Dimension-2) { <font class="comment">/* Dimensionality check*/</font>
00559               <font class="comment">/* Check whether a ray m saturates the same set of constraints */</font>
00560               redundant=0;
00561               <font class="keywordflow">for</font> (<a class="code" href="polyparam_8c.html#a0">m</a>=NbBid; <a class="code" href="polyparam_8c.html#a0">m</a>&lt;bound; <a class="code" href="polyparam_8c.html#a0">m</a>++) 
00562                 <font class="keywordflow">if</font> ((<a class="code" href="polyparam_8c.html#a0">m</a>!=i)&amp;&amp;(<a class="code" href="polyparam_8c.html#a0">m</a>!=j)) {
00563                   
00564                   <font class="comment">/* Two rays (r+ r-) are never made redundant by a vertex */</font>
00565                   <font class="comment">/* because the positivity constraint saturates both rays */</font>
00566                   <font class="comment">/* but not the vertex                                    */</font>
00567                   
00568                   <font class="keywordflow">if</font> (rayonly &amp;&amp; <a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Ray-&gt;p[<a class="code" href="polyparam_8c.html#a0">m</a>][Dimension]))
00569                     <font class="keywordflow">continue</font>;
00570 
00571                   <font class="comment">/* (r+ r-) is redundant if there doesn't exist an equation */</font>
00572                   <font class="comment">/* which saturates both r+ and r- but not rm.              */</font>
00573                   
00574                   ip1 = Temp;
00575                   ip2 = <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[<a class="code" href="polyparam_8c.html#a0">m</a>];
00576                   <font class="keywordflow">for</font> (l=0; l&lt;=jx; l++,ip2++,ip1++)
00577                     <font class="keywordflow">if</font> (*ip2 &amp; ~*ip1) 
00578                       <font class="keywordflow">break</font>;
00579                   <font class="keywordflow">if</font> (l&gt;jx) { 
00580                     redundant=1;
00581                     <font class="keywordflow">break</font>;
00582                   }
00583                 }
00584 
00585 <font class="preprocessor">#ifdef POLY_CH_DEBUG</font>
00586 <font class="preprocessor"></font>              fprintf(stderr, <font class="stringliteral">"[Chernikova: E]\nRay = "</font>);
00587               Ray-&gt;NbRows=NbRay;
00588               <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
00589               fprintf(stderr, <font class="stringliteral">"\nConstraints = "</font>);
00590               <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
00591               fprintf(stderr, <font class="stringliteral">"\nSat = "</font>);
00592               <a class="code" href="polyhedron_8c.html#a9">SMPrint</a> (<a class="code" href="polyparam_8c.html#a6">Sat</a>);
00593 <font class="preprocessor">#endif</font>
00594 <font class="preprocessor"></font>              
00595               <font class="comment">/*------------------------------------------------------------*/</font>
00596               <font class="comment">/* Add new ray generated by [R+,R-]                           */</font>
00597               <font class="comment">/*------------------------------------------------------------*/</font>
00598             
00599               <font class="keywordflow">if</font> (!redundant) {
00600                 <font class="keywordflow">if</font> (NbRay==NbMaxRays) {
00601                   <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"chernikova"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of table space"</font>);
00602                   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
00603                   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00604                   <font class="keywordflow">return</font> 1;
00605                 }
00606                 
00607                 <font class="comment">/* Compute the new ray */</font>
00608                 <a class="code" href="polyhedron_8c.html#a11">Combine</a>(Ray-&gt;p[j],Ray-&gt;p[i],Ray-&gt;p[NbRay],0,Dimension);
00609                 <a class="code" href="polyhedron_8c.html#a10">SatVector_OR</a>(Sat-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[j],Sat-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i],Sat-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[NbRay],sat_nbcolumns);
00610                 <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[NbRay][jx] &amp;= ~bx;
00611                 NbRay++;
00612               }
00613             }
00614           }
00615 
00616 <font class="preprocessor">#ifdef POLY_CH_DEBUG</font>
00617 <font class="preprocessor"></font>        fprintf(stderr, 
00618                 <font class="stringliteral">"[Chernikova: F]\n"</font>
00619                 <font class="stringliteral">"sup_bound=%d\n"</font>
00620                 <font class="stringliteral">"equal_bound=%d\n"</font>
00621                 <font class="stringliteral">"bound=%d\n"</font>
00622                 <font class="stringliteral">"NbRay=%d\n"</font>
00623                 <font class="stringliteral">"Dimension = %d\n"</font>
00624                 <font class="stringliteral">"Ray = "</font>,sup_bound,equal_bound,bound,NbRay,Dimension);
00625 <font class="preprocessor">#endif</font>
00626 <font class="preprocessor"></font><font class="preprocessor">#ifdef POLY_CH_DEBUG</font>
00627 <font class="preprocessor"></font>        Ray-&gt;NbRows=NbRay;
00628         fprintf(stderr, <font class="stringliteral">"[Chernikova: F]:\nRay = "</font>);
00629         <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
00630 <font class="preprocessor">#endif</font>
00631 <font class="preprocessor"></font>        
00632         <font class="comment">/* Eliminates all non extremal rays */</font>
00633         <font class="comment">/* j = (Mat-&gt;p[k][0]) ? */</font>
00634         
00635         j = (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat-&gt;p[k][0])) ? 
00636           sup_bound : equal_bound;
00637         
00638         i = NbRay;
00639 <font class="preprocessor">#ifdef POLY_CH_DEBUG</font>
00640 <font class="preprocessor"></font>        fprintf(stderr, <font class="stringliteral">"i = %d\nj = %d \n"</font>, i, j);
00641 <font class="preprocessor">#endif</font>
00642 <font class="preprocessor"></font>        <font class="keywordflow">while</font> ((j&lt;bound)&amp;&amp;(i&gt;bound)) {
00643           i--;
00644           <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Ray-&gt;p[i],Ray-&gt;p[j],Dimension+1);
00645           <a class="code" href="polyhedron_8c.html#a3">SMVector_Copy</a>(Sat-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i],Sat-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[j],sat_nbcolumns);
00646           j++;
00647         }
00648 
00649 <font class="preprocessor">#ifdef POLY_CH_DEBUG</font>
00650 <font class="preprocessor"></font>        fprintf(stderr, <font class="stringliteral">"i = %d\nj = %d \n"</font>, i, j);
00651         fprintf(stderr, 
00652                 <font class="stringliteral">"[Chernikova: F]\n"</font>
00653                 <font class="stringliteral">"sup_bound=%d\n"</font>
00654                 <font class="stringliteral">"equal_bound=%d\n"</font>
00655                 <font class="stringliteral">"bound=%d\n"</font>
00656                 <font class="stringliteral">"NbRay=%d\n"</font>
00657                 <font class="stringliteral">"Dimension = %d\n"</font>
00658                 <font class="stringliteral">"Ray = "</font>,sup_bound,equal_bound,bound,NbRay, Dimension);
00659 <font class="preprocessor">#endif</font>
00660 <font class="preprocessor"></font><font class="preprocessor">#ifdef POLY_CH_DEBUG</font>
00661 <font class="preprocessor"></font>        Ray-&gt;NbRows=NbRay;
00662         fprintf(stderr, <font class="stringliteral">"[Chernikova: G]\nRay = "</font>); 
00663         <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
00664 <font class="preprocessor">#endif  </font>
00665 <font class="preprocessor"></font>        <font class="keywordflow">if</font> (j==bound) 
00666           NbRay=i;
00667         <font class="keywordflow">else</font> 
00668           NbRay=j;
00669       }
00670       NEXT(jx,bx);
00671     }    
00672     Ray-&gt;NbRows=NbRay;
00673     <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m0">NbRows</a>=NbRay;
00674     
00675   } <font class="comment">/* End of TRY */</font>
00676 
00677   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
00678   free(Temp);
00679   
00680 <font class="preprocessor">#ifdef POLY_CH_DEBUG</font>
00681 <font class="preprocessor"></font>  fprintf(stderr, <font class="stringliteral">"[Chernikova: Output]\nRay = "</font>);
00682   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
00683   fprintf(stderr, <font class="stringliteral">"\nConstraints = "</font>);
00684   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
00685   fprintf(stderr, <font class="stringliteral">"\nSat = "</font>);
00686   <a class="code" href="polyhedron_8c.html#a9">SMPrint</a> (<a class="code" href="polyparam_8c.html#a6">Sat</a>);
00687 <font class="preprocessor">#endif</font>
00688 <font class="preprocessor"></font>  
00689   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00690   <font class="keywordflow">return</font> 0;
00691 } <font class="comment">/* Chernikova */</font>
00692 
00693 <font class="comment">/*  </font>
00694 <font class="comment"> * Compute a minimal system of equations using Gausian elimination method.</font>
00695 <font class="comment"> * 'Mat' is a matrix of constraints in which the first 'Nbeq' constraints</font>
00696 <font class="comment"> * are equations. The dimension of the homogenous system is 'Dimension'. </font>
00697 <font class="comment"> * The function returns the rank of the matrix 'Mat'. </font>
00698 <font class="comment"> */</font>
<a name="l00699"></a><a class="code" href="polyhedron_8c.html#a15">00699</a> <font class="keywordtype">int</font> <a class="code" href="polyhedron_8c.html#a15">Gauss</a>(Matrix *Mat,<font class="keywordtype">int</font> NbEq,<font class="keywordtype">int</font> Dimension)<font class="keyword"> </font>{
00700 
00701   <font class="keywordtype">int</font> i, j, k, pivot, Rank;
00702   <font class="keywordtype">int</font> *column_index = NULL;
00703   Value gcd,tmp,*cp;
00704 
00705   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(gcd); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
00706   column_index=(<font class="keywordtype">int</font> *)malloc(Dimension * <font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
00707   <font class="keywordflow">if</font>(!column_index) {   
00708     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Gauss"</font>,<font class="stringliteral">"outofmem"</font>,<font class="stringliteral">"out of memory space"</font>);
00709     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(gcd); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00710     <font class="keywordflow">return</font> 0;
00711   }
00712   Rank=0;
00713   
00714 <font class="preprocessor">#ifdef POLY_DEBUG</font>
00715 <font class="preprocessor"></font>  fprintf(stderr, <font class="stringliteral">"[Gauss : Input]\nRay ="</font>);
00716   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
00717 <font class="preprocessor">#endif</font>
00718 <font class="preprocessor"></font>
00719   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
00720     <font class="keywordflow">if</font> (column_index)
00721       free(column_index);
00722     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(gcd); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00723     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
00724   }
00725   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
00726     
00727     <font class="keywordflow">for</font> (j=1; j&lt;=Dimension; j++) {   <font class="comment">/* for each column (except status) */</font>  
00728       <font class="keywordflow">for</font> (i=Rank; i&lt;NbEq; i++)      <font class="comment">/* starting at diagonal, look down */</font>
00729         
00730         <font class="comment">/* if (Mat-&gt;p[i][j] != 0) */</font>
00731         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat-&gt;p[i][j])) 
00732           <font class="keywordflow">break</font>;                    <font class="comment">/* Find the first non zero element  */</font>    
00733       <font class="keywordflow">if</font> (i!=NbEq) {                <font class="comment">/* If a non-zero element is found?  */</font>
00734         <font class="keywordflow">if</font> (i!=Rank)                <font class="comment">/* If it is found below the diagonal*/</font>
00735           <a class="code" href="vector_8c.html#a10">Vector_Exchange</a>(Mat-&gt;p[Rank]+1,Mat-&gt;p[i]+1,Dimension);
00736         
00737         <font class="comment">/* Normalize the pivot row by dividing it by the gcd */</font>      
00738         <font class="comment">/* gcd = Vector_Gcd(Mat-&gt;p[Rank]+1,Dimension) */</font>
00739         <a class="code" href="vector_8c.html#a23">Vector_Gcd</a>(Mat-&gt;p[Rank]+1,Dimension,&amp;gcd);
00740         
00741         <font class="comment">/* if (gcd &gt;= 2) */</font>
00742         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp,2);
00743         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a25">value_ge</a>(gcd,tmp))<font class="keyword"> </font>{ 
00744           cp = &amp;Mat-&gt;p[Rank][1];
00745           <font class="keywordflow">for</font> (k=0; k&lt;Dimension; k++) {
00746             <a class="code" href="arithmetique_8h.html#a51">value_division</a> (*cp,*cp,gcd);       <font class="comment">/* *cp /= gcd */</font>    
00747             cp++;
00748           }
00749         }
00750         
00751         <font class="comment">/* if (Mat-&gt;p[Rank][j] &lt; 0) */</font>
00752         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a64">value_neg_p</a>(Mat-&gt;p[Rank][j]))<font class="keyword"> </font>{ 
00753           cp = Mat-&gt;p[Rank]+1;  
00754           <font class="keywordflow">for</font> (k=0; k&lt;Dimension; k++) { 
00755             <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp,-1);
00756             <a class="code" href="arithmetique_8h.html#a47">value_multiply</a> (*cp,*cp,tmp); <font class="comment">/* *cp *= -1 */</font> 
00757             cp++;
00758           }
00759         }
00760         <font class="comment">/* End of normalize */</font>
00761         
00762         pivot=i;
00763         <font class="keywordflow">for</font> (i=pivot+1; i&lt;NbEq; i++) {  <font class="comment">/* Zero out the rest of the column */</font>
00764           
00765           <font class="comment">/* if (Mat-&gt;p[i][j] != 0) */</font>
00766           <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat-&gt;p[i][j]))
00767             <a class="code" href="polyhedron_8c.html#a11">Combine</a>(Mat-&gt;p[i],Mat-&gt;p[Rank],Mat-&gt;p[i],j,Dimension);
00768         }
00769         
00770         <font class="comment">/* For each row with non-zero entry Mat-&gt;p[Rank], store the column */</font>
00771         <font class="comment">/* number 'j' in 'column_index[Rank]'. This information will be    */</font>
00772         <font class="comment">/* useful in performing Gaussian elimination backward step.        */</font>
00773         
00774         column_index[Rank]=j;
00775         Rank++;
00776       }
00777     } <font class="comment">/* end of Gaussian elimination forward step */</font>
00778     
00779     <font class="comment">/* Back Substitution -- normalize the system of equations */</font>
00780     <font class="keywordflow">for</font> (k=Rank-1; k&gt;=0; k--) { 
00781       j = column_index[k];
00782       
00783       <font class="comment">/* Normalize the equations */</font>
00784       <font class="keywordflow">for</font> (i=0; i&lt;k; i++) { 
00785         
00786         <font class="comment">/* if (Mat-&gt;p[i][j] != 0) */</font>
00787         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat-&gt;p[i][j]))
00788           <a class="code" href="polyhedron_8c.html#a11">Combine</a>(Mat-&gt;p[i],Mat-&gt;p[k],Mat-&gt;p[i],j,Dimension);
00789       }
00790       
00791       <font class="comment">/* Normalize the inequalities */</font>
00792       <font class="keywordflow">for</font> (i=NbEq;i&lt;Mat-&gt;NbRows;i++) { 
00793         
00794         <font class="comment">/* if (Mat-&gt;p[i][j] != 0) */</font>
00795         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat-&gt;p[i][j]))
00796           <a class="code" href="polyhedron_8c.html#a11">Combine</a>(Mat-&gt;p[i],Mat-&gt;p[k],Mat-&gt;p[i],j,Dimension);
00797       }
00798     }
00799   } <font class="comment">/* end of TRY */</font>
00800   
00801   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
00802   free(column_index), column_index = NULL;
00803   
00804 #ifdef POLY_DEBUG
00805   fprintf(stderr, <font class="stringliteral">"[Gauss : Output]\nRay ="</font>);
00806   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
00807 <font class="preprocessor">#endif</font>
00808 <font class="preprocessor"></font>  
00809   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(gcd); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00810   <font class="keywordflow">return</font> Rank;
00811 } <font class="comment">/* Gauss */</font>
00812 
00813 <font class="comment">/*</font>
00814 <font class="comment"> * Given 'Mat' - a matrix of equations and inequalities, 'Ray' - a matrix of </font>
00815 <font class="comment"> * lines and rays, 'Sat' - the corresponding saturation matrix, and 'Filter'</font>
00816 <font class="comment"> * - an array to mark (with 1) the non-redundant equalities and inequalities, </font>
00817 <font class="comment"> * compute a polyhedron composed of 'Mat' as constraint matrix and 'Ray' as </font>
00818 <font class="comment"> * ray matrix after reductions. This function is usually called as a follow</font>
00819 <font class="comment"> * up to 'Chernikova' to remove redundant constraints or rays.</font>
00820 <font class="comment"> * Note: (1) 'Chernikova' ensures that there are no redundant lines and rays. </font>
00821 <font class="comment"> *       (2) The same function can be used with constraint and ray matrix used</font>
00822 <font class="comment">  interchangbly.</font>
00823 <font class="comment"> */</font> 
<a name="l00824"></a><a class="code" href="polyhedron_8c.html#a16">00824</a> <font class="keyword">static</font> Polyhedron *<a class="code" href="polyhedron_8c.html#a16">Remove_Redundants</a>(Matrix *Mat,Matrix *Ray,<a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a6">Sat</a>,<font class="keywordtype">unsigned</font> *Filter)<font class="keyword"> </font>{ 
00825   
00826   <font class="keywordtype">int</font> i, j, k;
00827   <font class="keywordtype">unsigned</font> Dimension, sat_nbcolumns, NbRay, NbConstraints, RowSize1, RowSize2, 
00828            *Trace = NULL, *bx = NULL, *jx = NULL, Dim_RaySpace, b;
00829   <font class="keywordtype">unsigned</font> NbBid, NbUni, NbEq, NbIneq;
00830   <font class="keywordtype">unsigned</font> NbBid2, NbUni2, NbEq2, NbIneq2;
00831   <font class="keywordtype">int</font> Redundant;
00832   <font class="keywordtype">int</font> aux, *temp2 = NULL;
00833   Polyhedron *Pol = NULL;
00834   Value *temp1 = NULL;
00835   Value *p, *q;
00836   Value Status,tmp1,tmp2,tmp3;
00837   
00838   Dimension = Mat-&gt;NbColumns-1;     <font class="comment">/* Homogeneous Dimension */</font>
00839   NbRay = Ray-&gt;NbRows;
00840   sat_nbcolumns = <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m1">NbColumns</a>;
00841   NbConstraints = Mat-&gt;NbRows;
00842   RowSize1=(Dimension+1);
00843   RowSize2=sat_nbcolumns * <font class="keyword">sizeof</font>(int);
00844   
00845   temp1=(Value *)malloc(RowSize1*<font class="keyword">sizeof</font>(Value));
00846   <font class="keywordflow">if</font>(!temp1) {  
00847     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Remove_Redundants"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00848     <font class="keywordflow">return</font> 0;
00849   }
00850 
00851   <font class="comment">/* Initialize all the 'Value' variables */</font>
00852   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(Status); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp1);
00853   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp2); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp3);
00854   
00855   <font class="keywordflow">for</font>(i=0;i&lt;RowSize1;i++)
00856     <a class="code" href="arithmetique_8h.html#a10">value_init</a>(temp1[i]);
00857 
00858   temp2=(<font class="keywordtype">int</font> *)malloc(RowSize2);
00859   <font class="keywordflow">if</font>(!temp2) {
00860     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Remove_Redundants"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00861     
00862     <font class="comment">/* Clear all the 'Value' variables */</font>
00863     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Status); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1);
00864     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp3);
00865     <font class="keywordflow">for</font>(i=0;i&lt;RowSize1;i++)
00866       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(temp1[i]);
00867     free(temp1);
00868     <font class="keywordflow">return</font> 0;
00869   }
00870   
00871   <font class="comment">/* Introduce indirections into saturation matrix 'Sat' to simplify */</font>
00872   <font class="comment">/* processing with 'Sat' and allow easy exchanges of columns.      */</font>
00873   bx = (<font class="keywordtype">unsigned</font> *)malloc(NbConstraints * <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font>));
00874   <font class="keywordflow">if</font>(!bx) {
00875     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Remove_Redundants"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00876     
00877     <font class="comment">/* Clear all the 'Value' variables */</font>
00878     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Status); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1);
00879     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp3);
00880     <font class="keywordflow">for</font>(i=0;i&lt;RowSize1;i++)
00881       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(temp1[i]);
00882     free(temp1); free(temp2);
00883     <font class="keywordflow">return</font> 0;
00884   }
00885   jx = (<font class="keywordtype">unsigned</font> *)malloc(NbConstraints * <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font>));
00886   <font class="keywordflow">if</font>(!jx) {
00887     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Remove_Redundants"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
00888     
00889     <font class="comment">/* Clear all the 'Value' variables */</font>
00890     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Status); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1);
00891     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp3);
00892     <font class="keywordflow">for</font>(i=0;i&lt;RowSize1;i++)
00893       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(temp1[i]);
00894     free(temp1); free(temp2); free(bx);
00895     <font class="keywordflow">return</font> 0;
00896   }
00897   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{  
00898     
00899     <font class="keywordflow">if</font> (temp1) {           
00900       <font class="keywordflow">for</font>(i=0;i&lt;RowSize1;i++)
00901         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(temp1[i]);
00902       free(temp1);
00903     }  
00904     <font class="keywordflow">if</font> (temp2) free(temp2);
00905     <font class="keywordflow">if</font> (bx) free(bx);
00906     <font class="keywordflow">if</font> (jx) free(jx);
00907     <font class="keywordflow">if</font> (Trace) free(Trace);
00908     <font class="keywordflow">if</font> (Pol) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(Pol);
00909 
00910     <font class="comment">/* Clear all the 'Value' variables */</font>
00911     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Status); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1);
00912     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp3);
00913     
00914     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
00915   }
00916   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
00917     
00918     <font class="comment">/* For each constraint 'j' following mapping is defined to facilitate  */</font>
00919     <font class="comment">/* data access from saturation matrix 'Sat' :-                         */</font>
00920     <font class="comment">/* (1) jx[j] -&gt; floor[j/(8*sizeof(int))]                               */</font>
00921     <font class="comment">/* (2) bx[j] -&gt; bin(00..10..0) where position of 1 = j%(8*sizeof(int)) */</font>
00922     
00923     i = 0;
00924     b = MSB;
00925     <font class="keywordflow">for</font> (j=0; j&lt;NbConstraints; j++) { 
00926       jx[j] = i;
00927       bx[j] = b;
00928       NEXT(i,b);
00929     }
00930     
00931     <font class="comment">/* </font>
00932 <font class="comment">     * STEP(0): Count the number of vertices among the rays while initializing</font>
00933 <font class="comment">     * the ray status count to 0. If no vertices are found, quit the procedure</font>
00934 <font class="comment">     * and return an empty polyhedron as the result. </font>
00935 <font class="comment">     */</font>            
00936     
00937     <font class="comment">/* Reset the status element of each ray to zero. Store the number of  */</font>
00938     <font class="comment">/* vertices in 'aux'.                                                 */</font>
00939     aux = 0;
00940     <font class="keywordflow">for</font> (i=0; i&lt;NbRay; i++) {  
00941       
00942       <font class="comment">/* Ray-&gt;p[i][0] = 0 */</font>
00943       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Ray-&gt;p[i][0],0);
00944       
00945       <font class="comment">/* If ray(i) is a vertex of the Inhomogenous system */</font>
00946       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Ray-&gt;p[i][Dimension]))
00947         aux++;              
00948     }
00949     
00950     <font class="comment">/* If no vertices, return an empty polyhedron. */</font>
00951     <font class="keywordflow">if</font> (!aux) { 
00952       
00953       <font class="comment">/* Clear all the 'Value' variables */</font>
00954       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Status); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1);
00955       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp3);
00956       <font class="keywordflow">for</font>(i=0;i&lt;RowSize1;i++)
00957         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(temp1[i]);
00958       
00959       <font class="comment">/* Return an empty polyhedron */</font>
00960       free(temp1); free(temp2); free(jx); free(bx);
00961       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
00962       <font class="keywordflow">return</font> <a class="code" href="polyhedron_8c.html#a22">Empty_Polyhedron</a>(Dimension-1);
00963     }
00964     
00965 <font class="preprocessor">#ifdef POLY_RR_DEBUG</font>
00966 <font class="preprocessor"></font>    fprintf(stderr, <font class="stringliteral">"[Remove_redundants : Init]\nConstraints ="</font>);
00967     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
00968     fprintf(stderr, <font class="stringliteral">"\nRays ="</font>);
00969     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
00970 <font class="preprocessor">#endif</font>
00971 <font class="preprocessor"></font>    
00972     <font class="comment">/* </font>
00973 <font class="comment">     * STEP(1): Compute status counts for both rays and inequalities. For each</font>
00974 <font class="comment">     * constraint, count the number of vertices/rays saturated by that </font>
00975 <font class="comment">     * constraint, and put the result in the status words. At the same time, </font>
00976 <font class="comment">     * for each vertex/ray, count the number of constraints saturated by it.</font>
00977 <font class="comment">     * Delete any positivity constraints, but give rays credit in their status</font>
00978 <font class="comment">     * counts for saturating the positivity constraint.</font>
00979 <font class="comment">     */</font>
00980     
00981     NbEq=0;
00982 <font class="preprocessor"> #ifdef JUNK</font>
00983 <font class="preprocessor"></font>    <font class="comment">/* JUNK is a temporary flag, the code in the JUNK part, should probably</font>
00984 <font class="comment">       be removed (see with Fabien and Doran) */</font>
00985    memset((<font class="keywordtype">char</font> *)temp2, 0, RowSize2);       
00986 <font class="preprocessor">#endif</font>
00987 <font class="preprocessor"></font>    
00988 <font class="preprocessor">#ifdef POLY_RR_DEBUG</font>
00989 <font class="preprocessor"></font>    fprintf (stderr, <font class="stringliteral">" j = "</font>);
00990 <font class="preprocessor">#endif</font>
00991 <font class="preprocessor"></font>    
00992     <font class="keywordflow">for</font> (j=0; j&lt;NbConstraints; j++) {
00993       
00994 <font class="preprocessor">#ifdef POLY_RR_DEBUG</font>
00995 <font class="preprocessor"></font>      fprintf (stderr, <font class="stringliteral">" %i "</font>, j);
00996       fflush (stderr);
00997 <font class="preprocessor">#endif</font>
00998 <font class="preprocessor"></font>      
00999 <font class="preprocessor">#ifdef JUNK</font>
01000 <font class="preprocessor"></font>      <font class="comment">/* If constraint(j) is an equality, mark '1' in array 'temp2' */</font>
01001       <font class="keywordflow">if</font> (Filter &amp;&amp; <a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(Mat-&gt;p[j][0]))  
01002         temp2[jx[j]] |= bx[j]; 
01003 <font class="preprocessor">#endif</font>
01004 <font class="preprocessor"></font>      <font class="comment">/* Reset the status element of each constraint to zero */</font>
01005       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[j][0],0);
01006       
01007       <font class="comment">/* Identify and remove the positivity constraint 1&gt;=0 */</font>
01008       <font class="keywordflow">for</font> (i=1, p = &amp;Mat-&gt;p[j][1]; i&lt;Dimension; i++) { 
01009         
01010         <font class="comment">/* if (*p) */</font>
01011         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(*p))<font class="keyword"> </font>{
01012           p++; 
01013           <font class="keywordflow">break</font>;
01014         }
01015         <font class="keywordflow">else</font> 
01016           p++;
01017       }
01018       
01019 <font class="preprocessor">#ifdef POLY_RR_DEBUG</font>
01020 <font class="preprocessor"></font>      fprintf(stderr, <font class="stringliteral">"[Remove_redundants : IntoStep1]\nConstraints ="</font>);
01021       <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
01022       fprintf (stderr, <font class="stringliteral">" j = %i \n"</font>, j);
01023 <font class="preprocessor">#endif</font>
01024 <font class="preprocessor"></font>      
01025       <font class="comment">/* Check if constraint(j) is a positivity constraint, 1 &gt;= 0, or if it */</font>
01026       <font class="comment">/* is 1==0. If constraint(j) saturates all the rays of the matrix 'Ray'*/</font>
01027       <font class="comment">/* then it is an equality. in this case, return an empty polyhedron.   */</font>
01028       
01029       <font class="keywordflow">if</font> (i==Dimension) { 
01030         <font class="keywordflow">for</font> (i=0; i&lt;NbRay; i++)
01031           <font class="keywordflow">if</font> (!(<a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i][jx[j]]&amp;bx[j])) {
01032             
01033             <font class="comment">/* Mat-&gt;p[j][0]++ */</font>
01034             <a class="code" href="arithmetique_8h.html#a45">value_increment</a>(Mat-&gt;p[j][0],Mat-&gt;p[j][0]);
01035           }
01036         
01037         <font class="comment">/* if ((Mat-&gt;p[j][0] == NbRay) &amp;&amp;   : it is an equality</font>
01038 <font class="comment">           (Mat-&gt;p[j][Dimension] != 0)) : and its not 0=0 */</font>
01039         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp1,NbRay);
01040         <font class="keywordflow">if</font> ((<a class="code" href="arithmetique_8h.html#a22">value_eq</a>(Mat-&gt;p[j][0],tmp1)) &amp;&amp;  
01041             (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat-&gt;p[j][Dimension]))) {
01042           
01043           <font class="comment">/* Clear all the 'Value' variables */</font>
01044           <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Status); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1);
01045           <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp3);
01046           <font class="keywordflow">for</font>(i=0;i&lt;RowSize1;i++)
01047             <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(temp1[i]);
01048           
01049           <font class="comment">/* Return an empty polyhedron */</font>
01050           free(temp1); free(temp2); free(jx); free(bx);
01051           <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
01052           <font class="keywordflow">return</font> <a class="code" href="polyhedron_8c.html#a22">Empty_Polyhedron</a>(Dimension-1);
01053         }
01054         
01055         <font class="comment">/* Delete the positivity constraint */</font>
01056         NbConstraints--;
01057         <font class="keywordflow">if</font> (j==NbConstraints) <font class="keywordflow">continue</font>;
01058         <a class="code" href="vector_8c.html#a10">Vector_Exchange</a>(Mat-&gt;p[j], Mat-&gt;p[NbConstraints],RowSize1);
01059         <a class="code" href="polyhedron_8c.html#a2">exchange</a>(jx[j], jx[NbConstraints], aux);
01060         <a class="code" href="polyhedron_8c.html#a2">exchange</a>(bx[j], bx[NbConstraints], aux);
01061         j--; <font class="keywordflow">continue</font>;
01062       }
01063       
01064       <font class="comment">/* Count the number of vertices/rays saturated by each constraint. At  */</font>
01065       <font class="comment">/* the same time, count the number of constraints saturated by each ray*/</font>
01066       <font class="keywordflow">for</font> (i=0; i&lt;NbRay; i++) 
01067         <font class="keywordflow">if</font> (!(<a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i][jx[j]]&amp;bx[j])) {  
01068           
01069           <font class="comment">/* Mat-&gt;p[j][0]++ */</font>
01070           <a class="code" href="arithmetique_8h.html#a45">value_increment</a>(Mat-&gt;p[j][0],Mat-&gt;p[j][0]);
01071           
01072           <font class="comment">/* Ray-&gt;p[i][0]++ */</font>
01073           <a class="code" href="arithmetique_8h.html#a45">value_increment</a> (Ray-&gt;p[i][0],Ray-&gt;p[i][0]);
01074         }
01075       
01076       <font class="comment">/* if (Mat-&gt;p[j][0]==NbRay) then increment the number of eq. count */</font>
01077       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp1,NbRay);
01078       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a22">value_eq</a>(Mat-&gt;p[j][0],tmp1)) 
01079         NbEq++;    <font class="comment">/* all vertices/rays are saturated */</font>
01080     }
01081     Mat-&gt;NbRows = NbConstraints;
01082     
01083     NbBid=0;
01084     <font class="keywordflow">for</font> (i=0; i&lt;NbRay; i++) {
01085       
01086       <font class="comment">/* Give rays credit for saturating the positivity constraint */</font>
01087       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(Ray-&gt;p[i][Dimension]))   
01088         
01089         <font class="comment">/* Ray-&gt;p[i][0]++ */</font>
01090         <a class="code" href="arithmetique_8h.html#a45">value_increment</a>(Ray-&gt;p[i][0],Ray-&gt;p[i][0]);
01091       
01092       <font class="comment">/* If ray(i) saturates all the constraints including positivity  */</font>
01093       <font class="comment">/* constraint then it is a bi-directional ray or line. Increment */</font>
01094       <font class="comment">/* 'NbBid' by one.                                               */</font>
01095       
01096       <font class="comment">/* if (Ray-&gt;p[i][0]==NbConstraints+1) */</font>
01097       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp1,(NbConstraints+1));
01098       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a22">value_eq</a>(Ray-&gt;p[i][0],tmp1))
01099         NbBid++;
01100     }
01101     
01102 <font class="preprocessor">#ifdef POLY_RR_DEBUG</font>
01103 <font class="preprocessor"></font>    fprintf(stderr, <font class="stringliteral">"[Remove_redundants : Step1]\nConstraints ="</font>);
01104     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
01105     fprintf(stderr, <font class="stringliteral">"\nRay ="</font>);
01106     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
01107 <font class="preprocessor">#endif</font>
01108 <font class="preprocessor"></font>    
01109     <font class="comment">/* </font>
01110 <font class="comment">     * STEP(2): Sort equalities to the top of constraint matrix 'Mat'. Detect</font>
01111 <font class="comment">     * implicit equations such as y&gt;=3; y&lt;=3. Keep Inequalities in same </font>
01112 <font class="comment">     * relative order. (Note: Equalities are constraints which saturate all of</font>
01113 <font class="comment">     * the rays)              </font>
01114 <font class="comment">     */</font>
01115     
01116     <font class="keywordflow">for</font> (i=0; i&lt;NbEq; i++) {
01117       
01118       <font class="comment">/* If constraint(i) doesn't saturate some ray, then it is an inequality*/</font>
01119       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp1,NbRay);
01120       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a23">value_ne</a>(Mat-&gt;p[i][0],tmp1))<font class="keyword"> </font>{ 
01121         
01122         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp1,NbRay);
01123         <font class="comment">/* Skip over inequalities and find an equality */</font>
01124         <font class="keywordflow">for</font> (k=i+1;<a class="code" href="arithmetique_8h.html#a23">value_ne</a>(Mat-&gt;p[k][0],tmp1) &amp;&amp; k&lt;NbConstraints;k++);
01125         <font class="keywordflow">if</font> (k==NbConstraints) <font class="comment">/* If none found then error */</font> <font class="keywordflow">break</font>;
01126         
01127         <font class="comment">/* Slide inequalities down the array 'Mat' and move equality up to */</font>
01128         <font class="comment">/* position 'i'.                                                   */</font>
01129         <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Mat-&gt;p[k], temp1,RowSize1);
01130         aux = jx[k];
01131         j   = bx[k];
01132         <font class="keywordflow">for</font> (;k&gt;i;k--) {  
01133           <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Mat-&gt;p[k-1],Mat-&gt;p[k],RowSize1);
01134           jx[k] = jx[k-1];
01135           bx[k] = bx[k-1];
01136         }
01137         <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(temp1,Mat-&gt;p[i],RowSize1);
01138         jx[i] = aux;
01139         bx[i] = j;
01140       }
01141     }
01142 
01143 <font class="preprocessor">#ifdef JUNK</font>
01144 <font class="preprocessor"></font>    <font class="keywordflow">if</font> (Filter)                     <font class="comment">/* for SIMPLIFY */</font>
01145       <font class="keywordflow">for</font> (i=0; i&lt;NbEq; i++) {
01146         
01147         <font class="comment">/* Detect implicit constraints such as y&gt;=3 and y&lt;=3 */</font>
01148         Redundant = 0;
01149         <font class="keywordflow">for</font> (j=i+1; j&lt;NbEq; j++) {
01150           <font class="keywordflow">for</font> (k=0, p=&amp;Mat-&gt;p[i][1], q=&amp;Mat-&gt;p[j][1]; k&lt;Dimension; k++,p++,q++) {  
01151             <font class="comment">/* if (*p!=*q) */</font>
01152             <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a23">value_ne</a>(*p, *q)) 
01153               <font class="keywordflow">break</font>;
01154           }
01155           
01156           <font class="comment">/* Redundant if both are same `and' constraint(j) was equality. */</font>
01157           <font class="comment">/* That is, 'temp2' has entry 1                                 */</font>
01158           <font class="keywordflow">if</font> (k==Dimension &amp;&amp; (temp2[jx[j]] &amp; bx[j])) { 
01159             Redundant=1; 
01160             <font class="keywordflow">break</font>;
01161           }
01162         }
01163         
01164         <font class="comment">/* Set 'Filter' entry to 1 corresponding to the irredundant equality*/</font>
01165         <font class="keywordflow">if</font> (!Redundant) Filter[jx[i]] |= bx[i];  <font class="comment">/* set flag */</font>
01166       }
01167 
01168 <font class="preprocessor">#endif</font>
01169 <font class="preprocessor"></font><font class="preprocessor">#ifdef POLY_RR_DEBUG</font>
01170 <font class="preprocessor"></font>    fprintf(stderr, <font class="stringliteral">"[Remove_redundants : Step2]\nConstraints ="</font>);
01171     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
01172     fprintf(stderr, <font class="stringliteral">"\nRay ="</font>);
01173     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
01174 <font class="preprocessor">#endif</font>
01175 <font class="preprocessor"></font>    
01176     <font class="comment">/* </font>
01177 <font class="comment">     * STEP(3): Perform Gaussian elimiation on the list of equalities. Obtain</font>
01178 <font class="comment">     * a minimal basis by solving for as many variables as possible. Use this </font>
01179 <font class="comment">     * solution to reduce the inequalities by eliminating as many variables as</font>
01180 <font class="comment">     * possible. Set NbEq2 to the rank of the system of equalities.</font>
01181 <font class="comment">     */</font>
01182     
01183     NbEq2 = <a class="code" href="polyhedron_8c.html#a15">Gauss</a>(Mat,NbEq,Dimension);
01184     
01185     <font class="comment">/* If number of equalities is not less then the homogenous dimension, */</font>
01186     <font class="comment">/* return an empty polyhedron.                                        */</font>
01187     
01188     <font class="keywordflow">if</font> (NbEq2&gt;=Dimension) {             
01189       
01190       <font class="comment">/* Clear all the 'Value' variables */</font>
01191       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Status); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1);
01192       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp3);
01193       <font class="keywordflow">for</font>(i=0;i&lt;RowSize1;i++)
01194         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(temp1[i]);
01195       
01196       free(temp1); free(temp2); free(jx); free(bx);
01197       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
01198       <font class="keywordflow">return</font> <a class="code" href="polyhedron_8c.html#a22">Empty_Polyhedron</a>(Dimension-1);
01199     }
01200     
01201 <font class="preprocessor">#ifdef POLY_RR_DEBUG</font>
01202 <font class="preprocessor"></font>    fprintf(stderr, <font class="stringliteral">"[Remove_redundants : Step3]\nConstraints ="</font>);
01203     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
01204     fprintf(stderr, <font class="stringliteral">"\nRay ="</font>);
01205     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
01206 <font class="preprocessor">#endif</font>
01207 <font class="preprocessor"></font>    
01208     <font class="comment">/*</font>
01209 <font class="comment">     * STEP(4): Sort lines to the top of ray matrix 'Ray', leaving rays</font>
01210 <font class="comment">     * afterwards. Detect implicit lines such as ray(1,2) and ray(-1,-2). </font>
01211 <font class="comment">     * (Note: Lines are rays which saturate all of the constraints including</font>
01212 <font class="comment">     * the positivity constraint 1&gt;=0. </font>
01213 <font class="comment">     */</font>
01214     
01215     
01216     <font class="keywordflow">for</font> (i=0, k=NbRay; i&lt;NbBid &amp;&amp; k&gt;i; i++) {
01217       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp1,(NbConstraints+1));
01218       
01219       <font class="comment">/* If ray(i) doesn't saturate some constraint then it is not a line */</font>
01220       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a23">value_ne</a>(Ray-&gt;p[i][0],tmp1))<font class="keyword"> </font>{ 
01221         
01222         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp1,(NbConstraints+1));
01223         <font class="comment">/* Skip over rays and vertices and find a line (bi-directional rays) */</font>
01224         <font class="keywordflow">while</font> (--k &gt;i &amp;&amp; <a class="code" href="arithmetique_8h.html#a23">value_ne</a>(Ray-&gt;p[k][0],tmp1)) ;
01225         
01226         <font class="comment">/* Exchange positions of ray(i) and line(k), thus sorting lines to */</font>
01227         <font class="comment">/* the top of matrix 'Ray'.                                        */</font>
01228         <a class="code" href="vector_8c.html#a10">Vector_Exchange</a>(Ray-&gt;p[i], Ray-&gt;p[k], RowSize1);
01229         <a class="code" href="polyhedron_8c.html#a1">bexchange</a>(Sat-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i], Sat-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[k], RowSize2);
01230       }     
01231     }   
01232 
01233 <font class="preprocessor">#ifdef POLY_RR_DEBUG</font>
01234 <font class="preprocessor"></font>    fprintf(stderr, <font class="stringliteral">"[Remove_redundants : Step4]\nConstraints ="</font>);
01235     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
01236     fprintf(stderr, <font class="stringliteral">"\nRay ="</font>);
01237     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
01238 <font class="preprocessor">#endif</font>
01239 <font class="preprocessor"></font>    
01240     <font class="comment">/* </font>
01241 <font class="comment">     * STEP(5): Perform Gaussian elimination on the lineality space to obtain</font>
01242 <font class="comment">     * a minimal basis of lines. Use this basis to reduce the represeentation</font>
01243 <font class="comment">     * of the uniderectional rays. Set 'NbBid2' to the rank of the system of </font>
01244 <font class="comment">     * lines. </font>
01245 <font class="comment">     */</font>
01246     
01247     NbBid2 = <a class="code" href="polyhedron_8c.html#a15">Gauss</a>(Ray, NbBid, Dimension);
01248     
01249 <font class="preprocessor">#ifdef POLY_RR_DEBUG</font>
01250 <font class="preprocessor"></font>    fprintf(stderr, <font class="stringliteral">"[Remove_redundants : After Gauss]\nRay ="</font>);
01251     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
01252 <font class="preprocessor">#endif</font>
01253 <font class="preprocessor"></font>    
01254     <font class="comment">/* If number of lines is not less then the homogenous dimension, return */</font>
01255     <font class="comment">/* an empty polyhedron.                                                 */</font>
01256     <font class="keywordflow">if</font> (NbBid2&gt;=Dimension) {
01257       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"RemoveRedundants"</font>, <font class="stringliteral">"rmrdt"</font>, <font class="stringliteral">"dimension error"</font>);
01258       
01259       <font class="comment">/* Clear all the 'Value' variables */</font>
01260       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Status); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1);
01261       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp3);
01262       <font class="keywordflow">for</font>(i=0;i&lt;RowSize1;i++)
01263         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(temp1[i]);
01264       
01265       free(temp1); free(temp2); free(jx); free(bx);
01266       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
01267       <font class="keywordflow">return</font> <a class="code" href="polyhedron_8c.html#a22">Empty_Polyhedron</a>(Dimension-1);
01268     }
01269     
01270     <font class="comment">/* Compute dimension of non-homogenous ray space */</font>
01271     Dim_RaySpace = Dimension-1-NbEq2-NbBid2;  
01272     
01273 <font class="preprocessor">#ifdef POLY_RR_DEBUG</font>
01274 <font class="preprocessor"></font>    fprintf(stderr, <font class="stringliteral">"[Remove_redundants : Step5]\nConstraints ="</font>);
01275     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
01276     fprintf(stderr, <font class="stringliteral">"\nRay ="</font>);
01277     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
01278 <font class="preprocessor">#endif</font>
01279 <font class="preprocessor"></font>    
01280     <font class="comment">/* </font>
01281 <font class="comment">     * STEP(6): Do a first pass filter of inequalities and equality identifi-</font>
01282 <font class="comment">     * cation. New positivity constraints may have been created by step(3). </font>
01283 <font class="comment">     * Check for and eliminate them. Count the irredundant inequalities and </font>
01284 <font class="comment">     * store count in 'NbIneq'.  </font>
01285 <font class="comment">     */</font>
01286  
01287     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp2,Dim_RaySpace);
01288     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp3,NbRay);
01289     NbIneq=0;
01290     <font class="keywordflow">for</font> (j=0; j&lt;NbConstraints; j++) {
01291       
01292       <font class="comment">/* Identify and remove the positivity constraint 1&gt;=0 */</font>
01293       <font class="keywordflow">for</font> (i=1, p = &amp;Mat-&gt;p[j][1]; i&lt;Dimension; i++)
01294         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a> (*p))<font class="keyword"> </font>{
01295           p++; 
01296           <font class="keywordflow">break</font>;
01297         }
01298         <font class="keywordflow">else</font>
01299           p++;
01300       
01301       <font class="comment">/* Check if constraint(j) is a positivity constraint, 1&gt;= 0, or if it */</font>
01302       <font class="comment">/* is 1==0.                                                           */</font>
01303       <font class="keywordflow">if</font> (i==Dimension) {  
01304         
01305         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp1,NbRay);
01306         
01307         <font class="comment">/* if ((Mat-&gt;p[j][0]==NbRay) &amp;&amp;   : it is an equality </font>
01308 <font class="comment">           (Mat-&gt;p[j][Dimension]!=0))    : and its not 0=0 */</font>
01309         <font class="keywordflow">if</font> ((<a class="code" href="arithmetique_8h.html#a22">value_eq</a> (Mat-&gt;p[j][0],tmp1)) &amp;&amp;
01310             (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat-&gt;p[j][Dimension]))) {
01311           
01312           <font class="comment">/* Clear all the 'Value' variables */</font>
01313           <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Status); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1);
01314           <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp3);
01315           <font class="keywordflow">for</font>(i=0;i&lt;RowSize1;i++)
01316             <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(temp1[i]);
01317           
01318           <font class="comment">/* Return an empty polyhedron */</font>
01319           free(temp1); free(temp2); free(jx); free(bx);
01320           <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
01321           <font class="keywordflow">return</font> <a class="code" href="polyhedron_8c.html#a22">Empty_Polyhedron</a>(Dimension-1);
01322         }       
01323         
01324         <font class="comment">/* Set the positivity constraint redundant by setting status element */</font>
01325         <font class="comment">/* equal to 2.                                                       */</font>
01326         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[j][0],2);
01327         <font class="keywordflow">continue</font>;
01328       }
01329       
01330       <font class="comment">/* Status = Mat-&gt;p[j][0] */</font>
01331       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Status, Mat-&gt;p[j][0]);
01332       
01333       <font class="comment">/* if (Status == 0) then constraint is redundant */</font>
01334       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(Status))         
01335         
01336         <font class="comment">/* Mat-&gt;p[j][0]=2 : redundant */</font>
01337         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[j][0],2);   
01338       
01339       <font class="comment">/* else if (Status&lt;Dim_RaySpace) then constraint is redundant */</font>   
01340       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a26">value_lt</a>(Status,tmp2))   
01341         
01342         <font class="comment">/* Mat-&gt;p[j][0]=2 : redundant */</font>
01343         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[j][0],2);   
01344       
01345       <font class="comment">/* else if (Status==NbRay) then constraint is an equality */</font>
01346       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a22">value_eq</a>(Status,tmp3))   
01347         
01348         <font class="comment">/* Mat-&gt;p[j][0]=0 : equality */</font>
01349         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[j][0],0);
01350       
01351       <font class="comment">/* else constraint is an irredundant inequality */</font> 
01352       <font class="keywordflow">else</font> { 
01353         NbIneq++;       
01354         
01355         <font class="comment">/* Mat-&gt;p[j][0]=1 : inequality */</font>
01356         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[j][0],1);
01357       }
01358     }
01359     
01360 <font class="preprocessor">#ifdef POLY_RR_DEBUG</font>
01361 <font class="preprocessor"></font>    fprintf(stderr, <font class="stringliteral">"[Remove_redundants : Step6]\nConstraints ="</font>);
01362     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
01363     fprintf(stderr, <font class="stringliteral">"\nRay ="</font>);
01364     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
01365 <font class="preprocessor">#endif</font>
01366 <font class="preprocessor"></font>    
01367     <font class="comment">/* </font>
01368 <font class="comment">     * STEP(7): Do a first pass filter of rays and identification of lines.</font>
01369 <font class="comment">     * Count the irredundant Rays and store count in 'NbUni'. </font>
01370 <font class="comment">     */</font>
01371     
01372     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp2,Dim_RaySpace);
01373     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp3,(NbConstraints+1));
01374     NbUni=0;
01375     <font class="keywordflow">for</font> (j=0; j&lt;NbRay; j++) { 
01376       
01377       <font class="comment">/* Status = Ray-&gt;p[j][0] */</font>
01378       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Status, Ray-&gt;p[j][0]);
01379       
01380       <font class="comment">/* if (Status &lt; Dim_RaySpace) the ray is redundant */</font>
01381       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a26">value_lt</a>(Status,tmp2))        
01382         
01383         <font class="comment">/* Ray-&gt;p[j][0]=2 : redundant */</font>
01384         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Ray-&gt;p[j][0],2);   
01385       
01386       <font class="comment">/* else if (Status == (NbConstraints+1)) then ray is a line */</font>
01387       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a22">value_eq</a>(Status,tmp3)) 
01388         
01389         <font class="comment">/* Ray-&gt;p[j][0]=0 : line */</font>
01390         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Ray-&gt;p[j][0],0);
01391       
01392       <font class="comment">/* else ray is an irredundant unidirectional ray. */</font>
01393       <font class="keywordflow">else</font> {
01394         NbUni++; 
01395         
01396         <font class="comment">/* Ray-&gt;p[j][0]=1 : ray */</font>
01397         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Ray-&gt;p[j][0],1);
01398       }
01399     }
01400     
01401     <font class="comment">/*</font>
01402 <font class="comment">     * STEP(8): Create the polyhedron (using approximate sizes).</font>
01403 <font class="comment">     * Number of constraints = NbIneq + NbEq2 + 1</font>
01404 <font class="comment">     * Number of rays = NbUni + NbBid2 </font>
01405 <font class="comment">     * Partially fill the polyhedron structure with the lines computed in step</font>
01406 <font class="comment">     * 3 and the equalities computed in step 5. </font>
01407 <font class="comment">     */</font>
01408     
01409     Pol = <a class="code" href="polyhedron_8c.html#a17">Polyhedron_Alloc</a>(Dimension-1, NbIneq+NbEq2+1, NbUni+NbBid2);
01410     <font class="keywordflow">if</font> (!Pol) {
01411       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Remove_redundants"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
01412       
01413       <font class="comment">/* Clear all the 'Value' variables */</font>
01414       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Status); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1);
01415       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp3);
01416       <font class="keywordflow">for</font>(i=0;i&lt;RowSize1;i++)
01417         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(temp1[i]);
01418       
01419       free(temp1); free(temp2); free(jx); free(bx);
01420       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
01421       <font class="keywordflow">return</font> 0;
01422     }
01423     Pol-&gt;NbBid = NbBid2;
01424     Pol-&gt;NbEq  = NbEq2;
01425     
01426     <font class="comment">/* Partially fill the polyhedron structure */</font>
01427     <font class="keywordflow">if</font> (NbBid2) <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Ray-&gt;p[0], Pol-&gt;Ray[0], (Dimension+1)*NbBid2);
01428     <font class="keywordflow">if</font> (NbEq2)  <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Mat-&gt;p[0], Pol-&gt;Constraint[0], (Dimension+1)*NbEq2);
01429     
01430 <font class="preprocessor">#ifdef POLY_RR_DEBUG</font>
01431 <font class="preprocessor"></font>    fprintf(stderr, <font class="stringliteral">"[Remove_redundants : Step7]\nConstraints ="</font>);
01432     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
01433     fprintf(stderr, <font class="stringliteral">"\nRay ="</font>);
01434     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
01435 <font class="preprocessor">#endif</font>
01436 <font class="preprocessor"></font>    
01437     <font class="comment">/* </font>
01438 <font class="comment">     * STEP(9): Final Pass filter of inequalities and detection of redundant</font>
01439 <font class="comment">     * inequaties. Redundant inequalities include: </font>
01440 <font class="comment">     * (1) Inequalities which are always true, such as 1&gt;=0, </font>
01441 <font class="comment">     * (2) Redundant inequalities such as y&gt;=4 given y&gt;=3, or x&gt;=1 given x=2. </font>
01442 <font class="comment">     * (3) Redundant inequalities such as x+y&gt;=5 given x&gt;=3 and y&gt;=2.</font>
01443 <font class="comment">     * Every 'good' inequality must saturate at least 'Dimension' rays and be </font>
01444 <font class="comment">     * unique.</font>
01445 <font class="comment">     */</font>
01446     
01447     <font class="comment">/* 'Trace' is a (1 X sat_nbcolumns) row matrix to hold the union of all */</font>
01448     <font class="comment">/* rows (corresponding to irredundant rays) of saturation matrix 'Sat'  */</font>
01449     <font class="comment">/* which saturate some constraint 'j'. See figure below:-               */</font>
01450     Trace=(<font class="keywordtype">unsigned</font> *)malloc(sat_nbcolumns * <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font>));
01451     <font class="keywordflow">if</font>(!Trace) {
01452       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Remove_Redundants"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
01453       
01454       <font class="comment">/* Clear all the 'Value' variables */</font>
01455       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Status); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1);
01456       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp3);
01457       <font class="keywordflow">for</font>(i=0;i&lt;RowSize1;i++)
01458         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(temp1[i]);
01459       
01460       free(temp1); free(temp2); free(jx); free(bx);
01461       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
01462       <font class="keywordflow">return</font> 0;
01463     }
01464     
01465     <font class="comment">/*                         NbEq      NbConstraints</font>
01466 <font class="comment">                               |-----------&gt;</font>
01467 <font class="comment">                                ___________j____</font>
01468 <font class="comment">                               |           |   |</font>
01469 <font class="comment">                               |      Mat  |   |</font>
01470 <font class="comment">                               |___________|___|</font>
01471 <font class="comment">                                           |                  </font>
01472 <font class="comment">     NbRay  ^ ________         ____________|____</font>
01473 <font class="comment">            | |-------|--------|-----------0---|t1</font>
01474 <font class="comment">            |i|-------|--------|-----------0---|t2</font>
01475 <font class="comment">            | | Ray   |        |    Sat        |</font>
01476 <font class="comment">     NbBid  - |-------|--------|-----------0---|tk</font>
01477 <font class="comment">              |_______|        |_______________|</font>
01478 <font class="comment">                                           |</font>
01479 <font class="comment">                                           |</font>
01480 <font class="comment">                                      -OR- (of rows t1,t2,...,tk)</font>
01481 <font class="comment">                               ________|___|____</font>
01482 <font class="comment">                               |_____Trace_0___|</font>
01483 <font class="comment">                               </font>
01484 <font class="comment">    */</font>
01485     
01486     NbIneq2 = 0;
01487     <font class="keywordflow">for</font> (j=NbEq; j&lt;NbConstraints; j++) {
01488       
01489       <font class="comment">/* if (Mat-&gt;p[j][0]==1) : non-redundant inequality */</font>
01490       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a69">value_one_p</a> (Mat-&gt;p[j][0]))<font class="keyword"> </font>{ 
01491         <font class="keywordflow">for</font> (k=0; k&lt;sat_nbcolumns; k++) Trace[k]=0;  <font class="comment">/* init Trace */</font>
01492         
01493         <font class="comment">/* Compute Trace: the union of all rows of Sat where constraint(j) */</font>
01494         <font class="comment">/* is saturated.                                                   */</font>
01495         <font class="keywordflow">for</font> (i=NbBid; i&lt;NbRay; i++) 
01496           
01497           <font class="comment">/* if (Ray-&gt;p[i][0]==1) */</font>
01498           <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a69">value_one_p</a>(Ray-&gt;p[i][0]))<font class="keyword"> </font>{ 
01499             <font class="keywordflow">if</font> (!(<a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i][jx[j]]&amp;bx[j])) 
01500               <font class="keywordflow">for</font> (k=0; k&lt;sat_nbcolumns; k++) Trace[k] |= <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i][k];
01501           }
01502         
01503         <font class="comment">/* Only constraint(j) should saturate this set of vertices/rays. */</font>
01504         <font class="comment">/* If another non-redundant constraint also saturates this set,  */</font>
01505         <font class="comment">/* then constraint(j) is redundant                               */</font>
01506         Redundant=0;
01507         <font class="keywordflow">for</font> (i=NbEq; i&lt;NbConstraints; i++) {
01508           
01509           <font class="comment">/* if ((Mat-&gt;p[i][0] ==1) &amp;&amp; (i!=j) &amp;&amp; !(Trace[jx[i]] &amp; bx[i]) ) */</font>
01510           <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a69">value_one_p</a>(Mat-&gt;p[i][0]) &amp;&amp; (i!=j) &amp;&amp; !(Trace[jx[i]] &amp; bx[i]))<font class="keyword"> </font>{
01511             Redundant=1;
01512             <font class="keywordflow">break</font>;
01513           }
01514         }
01515         <font class="keywordflow">if</font> (Redundant) {
01516           <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[j][0],2);
01517         }       
01518         <font class="keywordflow">else</font> {
01519           <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Mat-&gt;p[j], Pol-&gt;Constraint[NbEq2+NbIneq2], Dimension+1);
01520           <font class="keywordflow">if</font> (Filter) Filter[jx[j]] |= bx[j];           <font class="comment">/* for SIMPLIFY */</font>
01521           NbIneq2++;
01522         }
01523       }
01524     }
01525     free(Trace), Trace = NULL;
01526     
01527 #ifdef POLY_RR_DEBUG
01528     fprintf(stderr, <font class="stringliteral">"[Remove_redundants : Step8]\nConstraints ="</font>);
01529     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
01530     fprintf(stderr, <font class="stringliteral">"\nRay ="</font>);
01531     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
01532 <font class="preprocessor">#endif</font>
01533 <font class="preprocessor"></font>    
01534     <font class="comment">/* </font>
01535 <font class="comment">     * Step(10): Final pass filter of rays and detection of redundant rays.</font>
01536 <font class="comment">     * The final list of rays is written to polyhedron.                     </font>
01537 <font class="comment">     */</font>
01538     
01539     <font class="comment">/* Trace is a (NbRay x 1) column matrix to hold the union of all columns */</font>
01540     <font class="comment">/* (corresponding to irredundant inequalities) of saturation matrix 'Sat'*/</font>
01541     <font class="comment">/* which saturate some ray 'i'. See figure below:-                       */</font>
01542     
01543     Trace=(<font class="keywordtype">unsigned</font> *)malloc(NbRay * <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font>));
01544     <font class="keywordflow">if</font>(!Trace) {
01545       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Remove_Redundants"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
01546       
01547       <font class="comment">/* Clear all the 'Value' variables */</font>
01548       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Status); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1);
01549       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp3);
01550       <font class="keywordflow">for</font>(i=0;i&lt;RowSize1;i++)
01551         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(temp1[i]);
01552       
01553       free(bx); free(jx); free(temp2); free(temp1);
01554       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
01555       <font class="keywordflow">return</font> 0;
01556     }
01557     
01558     <font class="comment">/*                     NbEq     NbConstraints</font>
01559 <font class="comment">                             |----------&gt;</font>
01560 <font class="comment">                        ___________j_____</font>
01561 <font class="comment">                        |      | |   |  |</font>
01562 <font class="comment">                        |      Mat   |  |</font>
01563 <font class="comment">                        |______|_|___|__|</font>
01564 <font class="comment">                               | |   |</font>
01565 <font class="comment">NbRay ^ _________       _______|_|___|__   ___</font>
01566 <font class="comment">      | |       |       |      | |   |  |  |T|</font>
01567 <font class="comment">      | |  Ray  |       |   Sat| |   |  |  |r|</font>
01568 <font class="comment">      | |       |       |      | |   |  |  |a|  Trace = Union[col(t1,t2,..,tk)]</font>
01569 <font class="comment">      |i|-------|------&gt;i      0 0   0  |  |c|</font>
01570 <font class="comment">NbBid - |       |       |      | |   |  |  |e|</font>
01571 <font class="comment">        |_______|       |______|_|___|__|  |_|</font>
01572 <font class="comment">                              t1 t2  tk</font>
01573 <font class="comment">    */</font>    
01574   
01575     NbUni2 = 0;
01576     
01577     <font class="comment">/* Let 'aux' be the number of rays not vertices */</font> 
01578     aux = 0;     
01579     <font class="keywordflow">for</font> (i=NbBid; i&lt;NbRay; i++) {
01580       
01581       <font class="comment">/* if (Ray-&gt;p[i][0]==1) */</font>
01582       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a69">value_one_p</a> (Ray-&gt;p[i][0]))<font class="keyword"> </font>{ 
01583         
01584         <font class="comment">/* if (Ray-&gt;p[i][Dimension]!=0) : vertex */</font>
01585         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a> (Ray-&gt;p[i][Dimension]))
01586           <font class="keywordflow">for</font> (k=NbBid; k&lt;NbRay; k++) Trace[k]=0;         <font class="comment">/* init Trace */</font>
01587         <font class="keywordflow">else</font> <font class="comment">/* for ray */</font>
01588           
01589           <font class="comment">/* Include the positivity constraint incidences for rays. The */</font>
01590           <font class="comment">/* positivity constraint saturates all rays and no vertices   */</font>
01591           
01592           <font class="keywordflow">for</font> (k=NbBid; k&lt;NbRay; k++)
01593             
01594             <font class="comment">/* Trace[k]=(Ray-&gt;p[k][Dimension]!=0); */</font>
01595             Trace[k] = (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a> (Ray-&gt;p[k][Dimension]));
01596         
01597         <font class="comment">/* Compute Trace: the union of all columns of Sat where ray(i) is  */</font>
01598         <font class="comment">/* saturated.                                                      */</font>
01599         <font class="keywordflow">for</font> (j=NbEq; j&lt;NbConstraints; j++)
01600           
01601           <font class="comment">/* if (Mat-&gt;p[j][0]==1) : inequality */</font>
01602           <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a69">value_one_p</a> (Mat-&gt;p[j][0]))<font class="keyword"> </font>{ 
01603             <font class="keywordflow">if</font> (!(<a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i][jx[j]]&amp;bx[j]))
01604               <font class="keywordflow">for</font> (k=NbBid; k&lt;NbRay; k++) Trace[k] |= <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[k][jx[j]]&amp;bx[j];
01605           }
01606         
01607         <font class="comment">/* If ray i does not saturate any inequalities (other than the   */</font>
01608         <font class="comment">/* the positivity constraint, then it is the case that there is  */</font>
01609         <font class="comment">/* only one inequality and that ray is its orthogonal            */</font>
01610         
01611         <font class="comment">/* only ray(i) should saturate this set of inequalities. If      */</font>
01612         <font class="comment">/* another non-redundant ray also saturates this set, then ray(i)*/</font>
01613         <font class="comment">/* is redundant                                                  */</font>
01614         
01615         Redundant = 0;
01616         <font class="keywordflow">for</font> (j=NbBid; j&lt;NbRay; j++) { 
01617           
01618           <font class="comment">/* if ( (Ray-&gt;p[j][0]==1) &amp;&amp; (i!=j) &amp;&amp; !Trace[j] ) */</font>
01619           <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a69">value_one_p</a> (Ray-&gt;p[j][0]) &amp;&amp; (i!=j) &amp;&amp; !Trace[j])<font class="keyword"> </font>{ 
01620             Redundant=1;
01621             <font class="keywordflow">break</font>;
01622           }
01623         }
01624         <font class="keywordflow">if</font> (Redundant) 
01625           <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Ray-&gt;p[i][0],2); 
01626         <font class="keywordflow">else</font> {
01627           <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Ray-&gt;p[i], Pol-&gt;Ray[NbBid2+NbUni2], Dimension+1);
01628           NbUni2++;  <font class="comment">/* Increment number of uni-directional rays */</font>
01629           
01630           <font class="comment">/* if (Ray-&gt;p[i][Dimension]==0) */</font> 
01631           <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a> (Ray-&gt;p[i][Dimension]))
01632             aux++; <font class="comment">/* Increment number of rays which are not vertices */</font>
01633         }
01634       }
01635     }
01636     
01637     <font class="comment">/* Include the positivity constraint */</font>
01638     <font class="keywordflow">if</font> (aux&gt;=Dim_RaySpace) {
01639       <a class="code" href="vector_8c.html#a9">Vector_Set</a>(Pol-&gt;Constraint[NbEq2+NbIneq2],0,Dimension+1);
01640       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Pol-&gt;Constraint[NbEq2+NbIneq2][0],1);
01641       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Pol-&gt;Constraint[NbEq2+NbIneq2][Dimension],1);
01642       NbIneq2++;
01643     }   
01644   } <font class="comment">/* end of TRY */</font>
01645   
01646   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
01647   
01648 <font class="preprocessor">#ifdef POLY_RR_DEBUG</font>
01649 <font class="preprocessor"></font>  fprintf(stderr, <font class="stringliteral">"[Remove_redundants : Step9]\nConstraints ="</font>);
01650   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
01651   fprintf(stderr, <font class="stringliteral">"\nRay ="</font>);
01652   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
01653 <font class="preprocessor">#endif</font>
01654 <font class="preprocessor"></font>  
01655   free(Trace);
01656   free(bx);
01657   free(jx);
01658   free(temp2);
01659   
01660   Pol-&gt;NbConstraints = NbEq2 + NbIneq2;
01661   Pol-&gt;NbRays = NbBid2 + NbUni2;
01662   
01663   <font class="comment">/* Clear all the 'Value' variables */</font>
01664   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Status); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1);
01665   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp3);
01666   <font class="keywordflow">for</font>(i=0;i&lt;RowSize1;i++)
01667     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(temp1[i]);
01668   free(temp1);
01669   <font class="keywordflow">return</font> Pol;
01670 } <font class="comment">/* Remove_Redundants */</font>
01671 
01672 <font class="comment">/*</font>
01673 <font class="comment"> * Allocate memory space for polyhedron. </font>
01674 <font class="comment"> */</font>
<a name="l01675"></a><a class="code" href="polyhedron_8c.html#a17">01675</a> Polyhedron* <a class="code" href="polyhedron_8c.html#a17">Polyhedron_Alloc</a>(<font class="keywordtype">unsigned</font> Dimension,<font class="keywordtype">unsigned</font> NbConstraints,<font class="keywordtype">unsigned</font> NbRays)<font class="keyword"> </font>{ 
01676   
01677   Polyhedron *Pol;
01678   <font class="keywordtype">unsigned</font> NbRows,NbColumns;
01679   <font class="keywordtype">int</font> i,j;
01680   Value *p, **q; 
01681 
01682   Pol=(Polyhedron *)malloc(<font class="keyword">sizeof</font>(Polyhedron));
01683   <font class="keywordflow">if</font>(!Pol) {
01684     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Polyhedron_Alloc"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
01685     <font class="keywordflow">return</font> 0;
01686   }
01687   
01688   Pol-&gt;next          = (Polyhedron *)0;
01689   Pol-&gt;Dimension     = Dimension;
01690   Pol-&gt;NbConstraints = NbConstraints;
01691   Pol-&gt;NbRays        = NbRays;
01692   Pol-&gt;NbEq          = 0;
01693   Pol-&gt;NbBid         = 0;
01694   NbRows             = NbConstraints + NbRays;
01695   NbColumns          = Dimension + 2;
01696   
01697   q = (Value **)malloc(NbRows * <font class="keyword">sizeof</font>(Value *));
01698   <font class="keywordflow">if</font>(!q) {
01699     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Polyhedron_Alloc"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
01700     <font class="keywordflow">return</font> 0;
01701   }
01702   p = (Value *)malloc(NbRows * NbColumns * <font class="keyword">sizeof</font>(Value));
01703   <font class="keywordflow">if</font>(!p) {
01704     free(q);
01705     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Polyhedron_Alloc"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
01706     <font class="keywordflow">return</font> 0;
01707   }
01708   Pol-&gt;Constraint    = q;
01709   Pol-&gt;Ray           = q + NbConstraints;
01710   Pol-&gt;p_Init        = p;
01711   <font class="keywordflow">for</font> (i=0;i&lt;NbRows;i++) {
01712     *q++ = p;
01713     <font class="keywordflow">for</font>(j=0;j&lt;NbColumns;j++) 
01714       <a class="code" href="arithmetique_8h.html#a10">value_init</a>(*(p+j));
01715     p += NbColumns;
01716   }
01717   Pol-&gt;p_Init_size   = NbRows*NbColumns;
01718   <font class="keywordflow">return</font> Pol;
01719 } <font class="comment">/* Polyhedron_Alloc */</font>
01720 
01721 <font class="comment">/*    </font>
01722 <font class="comment"> * Free the memory space occupied by the single polyhedron.</font>
01723 <font class="comment"> */</font>
<a name="l01724"></a><a class="code" href="polyhedron_8c.html#a18">01724</a> <font class="keywordtype">void</font> <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(Polyhedron *Pol)<font class="keyword"> </font>{
01725   
01726   <font class="keywordtype">int</font> i,size;
01727   Value *p;
01728   
01729   <font class="keywordflow">if</font>(!Pol)
01730     <font class="keywordflow">return</font>;
01731   size = Pol-&gt;p_Init_size;
01732   p = Pol-&gt;p_Init;
01733   <font class="keywordflow">for</font>(i=0;i&lt;size;i++)
01734     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p[i]); 
01735   free(Pol-&gt;p_Init);
01736   free(Pol-&gt;Constraint);
01737   free(Pol);
01738   <font class="keywordflow">return</font>;
01739 } <font class="comment">/* Polyhedron_Free */</font>
01740 
01741 <font class="comment">/*</font>
01742 <font class="comment"> * Free the memory space occupied by the domain. </font>
01743 <font class="comment"> */</font>
<a name="l01744"></a><a class="code" href="polyhedron_8c.html#a19">01744</a> <font class="keywordtype">void</font> <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(Polyhedron *Pol)<font class="keyword">  </font>{
01745 
01746   <font class="keywordtype">int</font> i,size;
01747   Value *p;
01748   
01749   <font class="keywordflow">if</font>(!Pol)
01750     <font class="keywordflow">return</font>;
01751   <font class="keywordflow">if</font> (Pol-&gt;next) 
01752     <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(Pol-&gt;next);
01753 
01754   size = Pol-&gt;p_Init_size;
01755   p = Pol-&gt;p_Init;
01756   <font class="keywordflow">for</font>(i=0;i&lt;size;i++)
01757     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p[i]);  
01758   free(Pol-&gt;p_Init);
01759   free(Pol-&gt;Constraint);
01760   free(Pol);
01761   <font class="keywordflow">return</font>;
01762 } <font class="comment">/* Domain_Free */</font>
01763 
01764 <font class="comment">/*</font>
01765 <font class="comment"> * Print the contents of a polyhedron. </font>
01766 <font class="comment"> */</font>
<a name="l01767"></a><a class="code" href="polyhedron_8c.html#a20">01767</a> <font class="keywordtype">void</font> <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(FILE *Dst,<font class="keywordtype">char</font> *Format,Polyhedron *Pol)<font class="keyword"> </font>{ 
01768 
01769   <font class="keywordtype">unsigned</font> Dimension, NbConstraints, NbRays;
01770   <font class="keywordtype">int</font>      i, j;
01771   Value    *p;
01772   
01773   <font class="keywordflow">if</font> (!Pol) { 
01774     fprintf(Dst, <font class="stringliteral">"&lt;null polyhedron&gt;\n"</font>);
01775     <font class="keywordflow">return</font>;
01776   }
01777   
01778   Dimension     = Pol-&gt;Dimension + 2;  <font class="comment">/* Homogenous Dimension + status */</font>
01779   NbConstraints = Pol-&gt;NbConstraints;
01780   NbRays        = Pol-&gt;NbRays;
01781   fprintf(Dst, <font class="stringliteral">"POLYHEDRON Dimension:%d\n"</font>, Pol-&gt;Dimension);
01782   fprintf(Dst,<font class="stringliteral">"           Constraints:%d  Equations:%d  Rays:%d  Lines:%d\n"</font>,
01783           Pol-&gt;NbConstraints, Pol-&gt;NbEq, Pol-&gt;NbRays, Pol-&gt;NbBid);
01784   fprintf(Dst,<font class="stringliteral">"Constraints %d %d\n"</font>, NbConstraints, Dimension);
01785   
01786   <font class="keywordflow">for</font> (i=0;i&lt;NbConstraints;i++) {
01787     p=Pol-&gt;Constraint[i];
01788     
01789     <font class="comment">/* if (*p) */</font>
01790     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a> (*p))
01791       fprintf(Dst,<font class="stringliteral">"Inequality: ["</font>);
01792     <font class="keywordflow">else</font>      
01793       fprintf(Dst,<font class="stringliteral">"Equality:   ["</font>);
01794     p++;
01795     <font class="keywordflow">for</font> (j=1;j&lt;Dimension;j++) {
01796       <a class="code" href="arithmetique_8h.html#a16">value_print</a>(Dst,Format,*p++);
01797     }  
01798     (void)fprintf(Dst,<font class="stringliteral">" ]\n"</font>);
01799   }
01800 
01801   (void)fprintf(Dst, <font class="stringliteral">"Rays %d %d\n"</font>, NbRays, Dimension);
01802   <font class="keywordflow">for</font> (i=0;i&lt;NbRays;i++) {
01803     p=Pol-&gt;Ray[i];
01804     
01805     <font class="comment">/* if (*p) */</font>
01806     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a> (*p))<font class="keyword"> </font>{   
01807       p++;
01808       
01809       <font class="comment">/* if ( p[Dimension-2] ) */</font>
01810       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a> (p[Dimension-2]))
01811         fprintf(Dst, <font class="stringliteral">"Vertex: ["</font>);
01812       <font class="keywordflow">else</font>                  
01813         fprintf(Dst, <font class="stringliteral">"Ray:    ["</font>);
01814     }
01815     <font class="keywordflow">else</font> {
01816       p++;
01817       fprintf(Dst, <font class="stringliteral">"Line:   ["</font>);
01818     }
01819     <font class="keywordflow">for</font> (j=1; j &lt; Dimension-1; j++) {
01820       <a class="code" href="arithmetique_8h.html#a16">value_print</a>(Dst,Format,*p++);  
01821     }  
01822     
01823     <font class="comment">/* if (*p) */</font>
01824     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a> (*p))<font class="keyword"> </font>{
01825       fprintf( Dst, <font class="stringliteral">" ]/"</font> );
01826       <a class="code" href="arithmetique_8h.html#a16">value_print</a>(Dst,<a class="code" href="arithmetique_8h.html#a5">VALUE_FMT</a>,*p);
01827       fprintf( Dst, <font class="stringliteral">"\n"</font> );
01828     }
01829     <font class="keywordflow">else</font>    
01830       fprintf(Dst, <font class="stringliteral">" ]\n"</font>);
01831   }
01832   <font class="keywordflow">if</font> (Pol-&gt;next) {  
01833     fprintf(Dst, <font class="stringliteral">"UNION "</font>);
01834     <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(Dst,Format,Pol-&gt;next);
01835   }
01836 } <font class="comment">/* Polyhedron_Print */</font>
01837 
01838 <font class="comment">/* </font>
01839 <font class="comment"> * Print the contents of a polyhedron 'Pol' (used for debugging purpose).</font>
01840 <font class="comment"> */</font>
<a name="l01841"></a><a class="code" href="polyhedron_8c.html#a21">01841</a> <font class="keywordtype">void</font> <a class="code" href="polyhedron_8c.html#a21">PolyPrint</a> (Polyhedron *Pol)<font class="keyword"> </font>{
01842   <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,<font class="stringliteral">"%4d"</font>,Pol);
01843 } <font class="comment">/* PolyPrint */</font>
01844 
01845 <font class="comment">/* </font>
01846 <font class="comment"> * Create and return an empty polyhedron of non-homogenous dimension </font>
01847 <font class="comment"> * 'Dimension'. An empty polyhedron is characterized by :-</font>
01848 <font class="comment"> *  (a) The dimension of the ray-space is -1.  </font>
01849 <font class="comment"> *  (b) There is an over-constrained system of equations given by:</font>
01850 <font class="comment"> *      x=0, y=0, ...... z=0, 1=0</font>
01851 <font class="comment"> */</font>
<a name="l01852"></a><a class="code" href="polyhedron_8c.html#a22">01852</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a22">Empty_Polyhedron</a>(<font class="keywordtype">unsigned</font> Dimension)<font class="keyword"> </font>{
01853 
01854   Polyhedron *Pol;
01855   <font class="keywordtype">int</font> i;
01856 
01857   Pol = <a class="code" href="polyhedron_8c.html#a17">Polyhedron_Alloc</a>(Dimension, Dimension+1, 0);
01858   <font class="keywordflow">if</font> (!Pol) {
01859     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Empty_Polyhedron"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
01860     <font class="keywordflow">return</font> 0;
01861   }
01862   <a class="code" href="vector_8c.html#a9">Vector_Set</a>(Pol-&gt;Constraint[0],0,(Dimension+1)*(Dimension+2));
01863   <font class="keywordflow">for</font> (i=0; i&lt;=Dimension; i++) {
01864     
01865     <font class="comment">/* Pol-&gt;Constraint[i][i+1]=1 */</font>
01866     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Pol-&gt;Constraint[i][i+1],1);
01867   }
01868   Pol-&gt;NbEq = Dimension+1;
01869   Pol-&gt;NbBid = 0;
01870   <font class="keywordflow">return</font> Pol;
01871 } <font class="comment">/* Empty_Polyhedron */</font>
01872 
01873 <font class="comment">/* </font>
01874 <font class="comment"> * Create and return a universe polyhedron of non-homogenous dimension</font>
01875 <font class="comment"> * 'Dimension'. A universe polyhedron is characterized by :-</font>
01876 <font class="comment"> * (a) The dimension of rayspace is zero. </font>
01877 <font class="comment"> * (b) The dimension of lineality space is the dimension of the polyhedron.</font>
01878 <font class="comment"> * (c) There is only one constraint (positivity constraint) in the constraint</font>
01879 <font class="comment"> *     set given by : 1 &gt;= 0. </font>
01880 <font class="comment"> * (d) The bi-directional ray set is the canonical set of vectors. </font>
01881 <font class="comment"> * (e) The only vertex is the origin (0,0,0,....0).  </font>
01882 <font class="comment"> */</font>
<a name="l01883"></a><a class="code" href="polyhedron_8c.html#a23">01883</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a23">Universe_Polyhedron</a>(<font class="keywordtype">unsigned</font> Dimension)<font class="keyword"> </font>{ 
01884   
01885   Polyhedron *Pol;
01886   <font class="keywordtype">int</font> i;
01887   
01888   Pol = <a class="code" href="polyhedron_8c.html#a17">Polyhedron_Alloc</a>(Dimension,1,Dimension+1);
01889   <font class="keywordflow">if</font> (!Pol) {
01890     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Universe_Polyhedron"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
01891     <font class="keywordflow">return</font> 0;
01892   }
01893   <a class="code" href="vector_8c.html#a9">Vector_Set</a>(Pol-&gt;Constraint[0],0,(Dimension+2));
01894   
01895   <font class="comment">/* Pol-&gt;Constraint[0][0] = 1 */</font>
01896   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Pol-&gt;Constraint[0][0],1);
01897   
01898   <font class="comment">/* Pol-&gt;Constraint[0][Dimension+1] = 1 */</font>
01899   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Pol-&gt;Constraint[0][Dimension+1],1);
01900   <a class="code" href="vector_8c.html#a9">Vector_Set</a>(Pol-&gt;Ray[0],0,(Dimension+1)*(Dimension+2));
01901   <font class="keywordflow">for</font> (i=0;i&lt;=Dimension;i++) {
01902     
01903     <font class="comment">/* Pol-&gt;Ray[i][i+1]=1 */</font>
01904     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Pol-&gt;Ray[i][i+1],1);
01905   }  
01906   
01907   <font class="comment">/* Pol-&gt;Ray[Dimension][0] = 1 :  vertex status */</font>
01908   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Pol-&gt;Ray[Dimension][0],1);
01909   Pol-&gt;NbEq = 0;
01910   Pol-&gt;NbBid = Dimension;
01911   <font class="keywordflow">return</font> Pol;
01912 } <font class="comment">/* Universe_Polyhedron */</font>
01913 
01914 <font class="comment">/*</font>
01915 <font class="comment"> * Given a matrix of constraints ('Constraints'), construct and return a </font>
01916 <font class="comment"> * polyhedron. 'NbMaxRays' is the maximum allowed rays in the ray matrix</font>
01917 <font class="comment"> * of the polyhedron. </font>
01918 <font class="comment"> */</font> 
<a name="l01919"></a><a class="code" href="polyhedron_8c.html#a24">01919</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a24">Constraints2Polyhedron</a>(Matrix *Constraints,<font class="keywordtype">unsigned</font> NbMaxRays)<font class="keyword"> </font>{
01920   
01921   Polyhedron *Pol = NULL;
01922   Matrix *Ray = NULL;
01923   <a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a6">Sat</a> = NULL;
01924   <font class="keywordtype">unsigned</font> Dimension, nbcolumns;
01925   <font class="keywordtype">int</font> i;
01926 
01927   Dimension = Constraints-&gt;NbColumns - 1;  <font class="comment">/* Homogeneous Dimension */</font>
01928   <font class="keywordflow">if</font> (Dimension &lt; 1) {
01929     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Constraints2Polyhedron"</font>,<font class="stringliteral">"invalidpoly"</font>,<font class="stringliteral">"invalid polyhedron dimension"</font>);
01930     <font class="keywordflow">return</font> 0;
01931   }
01932   
01933   <font class="comment">/* If there is no constraint in the constraint matrix, return universe */</font>
01934   <font class="comment">/* polyhderon.                                                         */</font>
01935   <font class="keywordflow">if</font> (Constraints-&gt;NbRows==0) {  
01936     Pol = <a class="code" href="polyhedron_8c.html#a23">Universe_Polyhedron</a>(Dimension-1);
01937     <font class="keywordflow">return</font> Pol;
01938   }
01939 
01940   <font class="comment">/*</font>
01941 <font class="comment">   * Rather than adding a 'positivity constraint', it is better to</font>
01942 <font class="comment">   * initialize the lineality space with line in each of the index</font>
01943 <font class="comment">   * dimensions, but no line in the lambda dimension. Then initialize</font>
01944 <font class="comment">   * the ray space with an origin at 0.  This is what you get anyway,</font>
01945 <font class="comment">   * after the positivity constraint has been processed by Chernikova</font>
01946 <font class="comment">   * function.</font>
01947 <font class="comment">   */</font>
01948 
01949   <font class="comment">/* Allocate and initialize the Ray Space */</font>
01950   Ray = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbMaxRays, Dimension+1);
01951   <font class="keywordflow">if</font>(!Ray) {
01952     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Constraints2Polyhedron"</font>,<font class="stringliteral">"outofmem"</font>,<font class="stringliteral">"out of memory space"</font>);
01953     <font class="keywordflow">return</font> 0;
01954   }
01955   <a class="code" href="vector_8c.html#a9">Vector_Set</a>(Ray-&gt;p_Init,0, NbMaxRays * (Dimension+1));
01956   <font class="keywordflow">for</font> (i=0; i&lt;Dimension; i++) {    
01957     
01958     <font class="comment">/* Ray-&gt;p[i][i+1] = 1 */</font>
01959     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Ray-&gt;p[i][i+1],1);
01960   }
01961 
01962   <font class="comment">/* Ray-&gt;p[Dimension-1][0] = 1 : mark for ray */</font>
01963   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Ray-&gt;p[Dimension-1][0],1);
01964   Ray-&gt;NbRows = Dimension; 
01965 
01966   <font class="comment">/* Initialize the Sat Matrix */</font>
01967   nbcolumns = (Constraints-&gt;NbRows - 1)/(<font class="keyword">sizeof</font>(int)*8) + 1;
01968   <a class="code" href="polyparam_8c.html#a6">Sat</a> = <a class="code" href="polyparam_8c.html#a23">SMAlloc</a>(NbMaxRays, nbcolumns);
01969   <a class="code" href="polyhedron_8c.html#a4">SMVector_Init</a>(Sat-&gt;<a class="code" href="structSatMatrix.html#m3">p_init</a>,Dimension*nbcolumns);
01970   <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m0">NbRows</a> = Dimension;
01971 
01972   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
01973 
01974     <font class="comment">/* In case of overflow, free the allocated memory and forward. */</font>    
01975     <font class="keywordflow">if</font> (Sat) <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;<a class="code" href="polyparam_8c.html#a6">Sat</a>);
01976     <font class="keywordflow">if</font> (Ray) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Ray);
01977     <font class="keywordflow">if</font> (Pol) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(Pol);
01978     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
01979   }
01980   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
01981 
01982     <font class="comment">/* Create ray matrix 'Ray' from constraint matrix 'Constraints' */</font>
01983     <a class="code" href="polyhedron_8c.html#a14">Chernikova</a>(Constraints,Ray,<a class="code" href="polyparam_8c.html#a6">Sat</a>,Dimension-1,NbMaxRays,0,0);
01984 
01985 <font class="preprocessor">#ifdef POLY_DEBUG</font>
01986 <font class="preprocessor"></font>    fprintf(stderr, <font class="stringliteral">"[constraints2polyhedron]\nConstraints = "</font>);
01987     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Constraints);
01988     fprintf(stderr, <font class="stringliteral">"\nRay = "</font>);
01989     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
01990     fprintf(stderr, <font class="stringliteral">"\nSat = "</font>);
01991     <a class="code" href="polyhedron_8c.html#a9">SMPrint</a>(<a class="code" href="polyparam_8c.html#a6">Sat</a>);
01992 <font class="preprocessor">#endif</font>
01993 <font class="preprocessor"></font>    
01994     <font class="comment">/* Remove the redundant constraints and create the polyhedron */</font>
01995     Pol = <a class="code" href="polyhedron_8c.html#a16">Remove_Redundants</a>(Constraints,Ray,<a class="code" href="polyparam_8c.html#a6">Sat</a>,0);
01996   } <font class="comment">/* end of TRY */</font>
01997 
01998   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
01999   
02000 <font class="preprocessor">#ifdef POLY_DEBUG</font>
02001 <font class="preprocessor"></font>  fprintf(stderr, <font class="stringliteral">"\nPol = "</font>);
02002   <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,<font class="stringliteral">"%4d"</font>,Pol);
02003 <font class="preprocessor">#endif</font>
02004 <font class="preprocessor"></font>  
02005   <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;<a class="code" href="polyparam_8c.html#a6">Sat</a>), <a class="code" href="polyparam_8c.html#a6">Sat</a> = NULL;
02006   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Ray), Ray = NULL; 
02007   <font class="keywordflow">return</font> Pol;
02008 } <font class="comment">/* Constraints2Polyhedron */</font>
02009 
02010 #undef POLY_DEBUG
02011 
02012 <font class="comment">/* </font>
02013 <font class="comment"> * Given a polyhedron 'Pol', return a matrix of constraints. </font>
02014 <font class="comment"> */</font>
<a name="l02015"></a><a class="code" href="polyhedron_8c.html#a25">02015</a> Matrix *<a class="code" href="polyhedron_8c.html#a25">Polyhedron2Constraints</a>(Polyhedron *Pol)<font class="keyword"> </font>{
02016   
02017   Matrix     *Mat;
02018   <font class="keywordtype">unsigned</font> NbConstraints,Dimension;
02019   
02020   NbConstraints = Pol-&gt;NbConstraints;
02021   Dimension     = Pol-&gt;Dimension+2;
02022   Mat = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbConstraints,Dimension);
02023   <font class="keywordflow">if</font>(!Mat) {
02024     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Polyhedron2Constraints"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
02025     <font class="keywordflow">return</font> 0;
02026   }
02027   <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Pol-&gt;Constraint[0],Mat-&gt;p_Init,NbConstraints * Dimension);
02028   <font class="keywordflow">return</font> Mat;
02029 } <font class="comment">/* Polyhedron2Constraints */</font>
02030 
02031 <font class="comment">/* </font>
02032 <font class="comment"> * Given a matrix of rays 'Ray', create and return a polyhedron. </font>
02033 <font class="comment"> * 'NbMaxConstrs' is the maximum allowed constraints in the new </font>
02034 <font class="comment"> * polyhedron. </font>
02035 <font class="comment"> */</font>
<a name="l02036"></a><a class="code" href="polyhedron_8c.html#a26">02036</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a26">Rays2Polyhedron</a>(Matrix *Ray,<font class="keywordtype">unsigned</font> NbMaxConstrs)<font class="keyword"> </font>{
02037   
02038   Polyhedron *Pol = NULL;
02039   Matrix *Mat = NULL;
02040   <a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a6">Sat</a> = NULL, *SatTranspose = NULL;
02041   <font class="keywordtype">unsigned</font> Dimension, nbcolumns;
02042   <font class="keywordtype">int</font> i;
02043   
02044   Dimension = Ray-&gt;NbColumns-1;        <font class="comment">/* Homogeneous Dimension */</font>
02045   <a class="code" href="polyparam_8c.html#a6">Sat</a> = NULL;
02046   SatTranspose = NULL;
02047   Mat = NULL;
02048   
02049   <font class="keywordflow">if</font> (Ray-&gt;NbRows==0) {  
02050     
02051     <font class="comment">/* If there is no ray in the matrix 'Ray', return an empty polyhedron */</font>
02052     Pol = <a class="code" href="polyhedron_8c.html#a22">Empty_Polyhedron</a>(Dimension-1);
02053     <font class="keywordflow">return</font>(Pol);
02054   }
02055   
02056   <font class="comment">/* Allocate space for constraint matrix 'Mat' */</font>
02057   Mat = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbMaxConstrs,Dimension+1);
02058   <font class="keywordflow">if</font>(!Mat) {
02059     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Rays2Polyhedron"</font>,<font class="stringliteral">"outofmem"</font>,<font class="stringliteral">"out of memory space"</font>);
02060     <font class="keywordflow">return</font> 0;
02061   }
02062   
02063   <font class="comment">/* Initialize the constraint matrix 'Mat' */</font>
02064   <a class="code" href="vector_8c.html#a9">Vector_Set</a>(Mat-&gt;p_Init,0,NbMaxConstrs * (Dimension+1));
02065   <font class="keywordflow">for</font> (i=0; i&lt;Dimension; i++) {
02066     
02067     <font class="comment">/* Mat-&gt;p[i][i+1]=1 */</font>
02068     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[i][i+1],1);
02069   }
02070   
02071   <font class="comment">/* Allocate and assign the saturation matrix. Remember we are using a */</font>
02072   <font class="comment">/* transposed saturation matrix referenced by (constraint,ray) pair.  */</font>
02073   Mat-&gt;NbRows = Dimension;
02074   nbcolumns = (Ray-&gt;NbRows -1)/(<font class="keyword">sizeof</font>(int)*8) + 1;
02075   SatTranspose = <a class="code" href="polyparam_8c.html#a23">SMAlloc</a>(NbMaxConstrs,nbcolumns);
02076   <a class="code" href="polyhedron_8c.html#a4">SMVector_Init</a>(SatTranspose-&gt;p[0],Dimension * nbcolumns);
02077   SatTranspose-&gt;NbRows = Dimension;
02078   
02079 <font class="preprocessor">#ifdef POLY_DEBUG</font>
02080 <font class="preprocessor"></font>  fprintf(stderr, <font class="stringliteral">"[ray2polyhedron: Before]\nRay = "</font>);
02081   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
02082   fprintf(stderr, <font class="stringliteral">"\nConstraints = "</font>);
02083   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
02084   fprintf(stderr, <font class="stringliteral">"\nSatTranspose = "</font>);
02085   <a class="code" href="polyhedron_8c.html#a9">SMPrint</a> (SatTranspose);
02086 <font class="preprocessor">#endif</font>
02087 <font class="preprocessor"></font>  
02088   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
02089     
02090     <font class="comment">/* In case of overflow, free the allocated memory before forwarding</font>
02091 <font class="comment">     * the exception. </font>
02092 <font class="comment">     */</font>
02093     <font class="keywordflow">if</font> (SatTranspose) <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;SatTranspose);
02094     <font class="keywordflow">if</font> (Sat) <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;<a class="code" href="polyparam_8c.html#a6">Sat</a>);
02095     <font class="keywordflow">if</font> (Mat) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat);
02096     <font class="keywordflow">if</font> (Pol) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(Pol);
02097     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
02098   }
02099   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
02100     
02101     <font class="comment">/* Create constraint matrix 'Mat' from ray matrix 'Ray' */</font> 
02102     <a class="code" href="polyhedron_8c.html#a14">Chernikova</a>(Ray,Mat,SatTranspose,Dimension,NbMaxConstrs,0,1);
02103     
02104 <font class="preprocessor">#ifdef POLY_DEBUG</font>
02105 <font class="preprocessor"></font>    fprintf(stderr, <font class="stringliteral">"[ray2polyhedron: After]\nRay = "</font>);
02106     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Ray);
02107     fprintf(stderr, <font class="stringliteral">"\nConstraints = "</font>);
02108     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,0,Mat);
02109     fprintf(stderr, <font class="stringliteral">"\nSatTranspose = "</font>);
02110     <a class="code" href="polyhedron_8c.html#a9">SMPrint</a> (SatTranspose);
02111 <font class="preprocessor">#endif</font>
02112 <font class="preprocessor"></font>    
02113     <font class="comment">/* Transform the saturation matrix 'SatTranspose' in the standard  */</font>
02114     <font class="comment">/* format, that is, ray X constraint format.                       */</font>
02115     <a class="code" href="polyparam_8c.html#a6">Sat</a> = <a class="code" href="polyhedron_8c.html#a12">TransformSat</a>(Mat,Ray,SatTranspose);
02116     
02117 <font class="preprocessor">#ifdef POLY_DEBUG</font>
02118 <font class="preprocessor"></font>    fprintf(stderr, <font class="stringliteral">"\nSat ="</font>);
02119     <a class="code" href="polyhedron_8c.html#a9">SMPrint</a>(<a class="code" href="polyparam_8c.html#a6">Sat</a>);
02120 <font class="preprocessor">#endif</font>
02121 <font class="preprocessor"></font>    
02122     <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;SatTranspose), SatTranspose = NULL;
02123     
02124     <font class="comment">/* Remove redundant rays from the ray matrix 'Ray' */</font>
02125     Pol = <a class="code" href="polyhedron_8c.html#a16">Remove_Redundants</a>(Mat,Ray,<a class="code" href="polyparam_8c.html#a6">Sat</a>,0);
02126   } <font class="comment">/* of TRY */</font>
02127   
02128   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
02129   
02130 <font class="preprocessor">#ifdef POLY_DEBUG</font>
02131 <font class="preprocessor"></font>  fprintf(stderr, <font class="stringliteral">"\nPol = "</font>);
02132   <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,<font class="stringliteral">"%4d"</font>,Pol);
02133 <font class="preprocessor">#endif</font>
02134 <font class="preprocessor"></font>  
02135   <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;<a class="code" href="polyparam_8c.html#a6">Sat</a>);
02136   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat);
02137   <font class="keywordflow">return</font> Pol;
02138 } <font class="comment">/* Rays2Polyhedron */</font>
02139 
02140 <font class="comment">/*   </font>
02141 <font class="comment"> * Build a saturation matrix from constraint matrix 'Mat' and ray matrix </font>
02142 <font class="comment"> * 'Ray'. Only 'NbConstraints' constraint of matrix 'Mat' are considered </font>
02143 <font class="comment"> * in creating the saturation matrix. 'NbMaxRays' is the maximum number </font>
02144 <font class="comment"> * of rows (rays) allowed in the saturation matrix.</font>
02145 <font class="comment"> * Vin100's stuff, for the polyparam vertices to work.</font>
02146 <font class="comment"> */</font>
<a name="l02147"></a><a class="code" href="polyhedron_8c.html#a27">02147</a> <font class="keyword">static</font> <a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyhedron_8c.html#a27">BuildSat</a>(Matrix *Mat,Matrix *Ray,<font class="keywordtype">unsigned</font> NbConstraints,<font class="keywordtype">unsigned</font> NbMaxRays)<font class="keyword"> </font>{
02148   
02149   <a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a6">Sat</a> = NULL;
02150   <font class="keywordtype">int</font> i, j, k, jx;
02151   Value *p1, *p2, *p3;
02152   Value tmp;
02153   <font class="keywordtype">unsigned</font> Dimension, NbRay, bx, nbcolumns;
02154   
02155   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
02156   
02157   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
02158     <font class="keywordflow">if</font> (Sat) 
02159       <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;<a class="code" href="polyparam_8c.html#a6">Sat</a>);
02160     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
02161     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
02162   }
02163   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
02164     NbRay = Ray-&gt;NbRows;
02165     Dimension = Mat-&gt;NbColumns-1;   <font class="comment">/* Homogeneous Dimension */</font>
02166     
02167     <font class="comment">/* Build the Sat matrix */</font>
02168     nbcolumns = (Mat-&gt;NbRows - 1)/(<font class="keyword">sizeof</font>(int)*8) + 1;
02169     <a class="code" href="polyparam_8c.html#a6">Sat</a> = <a class="code" href="polyparam_8c.html#a23">SMAlloc</a>(NbMaxRays,nbcolumns);
02170     <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m0">NbRows</a> = NbRay;
02171     <a class="code" href="polyhedron_8c.html#a4">SMVector_Init</a>(Sat-&gt;<a class="code" href="structSatMatrix.html#m3">p_init</a>, nbcolumns * NbRay);
02172     jx=0; bx=MSB;
02173     <font class="keywordflow">for</font> (k=0; k&lt;NbConstraints; k++) {
02174       <font class="keywordflow">for</font> (i=0; i&lt;NbRay; i++) {
02175         
02176         <font class="comment">/* Compute the dot product of ray(i) and constraint(k) and */</font>
02177         <font class="comment">/* store in the status element of ray(i).                  */</font>
02178         p1 = Ray-&gt;p[i]+1;
02179         p2 = Mat-&gt;p[k]+1;
02180         p3 = Ray-&gt;p[i];
02181         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(*p3,0);
02182         <font class="keywordflow">for</font> (j=0; j&lt;Dimension; j++) {
02183           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp,*p1,*p2);
02184           <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(*p3,*p3,tmp);
02185           p1++; p2++;
02186         }
02187       }
02188       <font class="keywordflow">for</font> (j=0; j&lt;NbRay; j++) {
02189         
02190         <font class="comment">/* Set 1 in the saturation matrix if the ray doesn't saturate */</font>
02191         <font class="comment">/* the constraint, otherwise the entry is 0.                  */</font>
02192         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Ray-&gt;p[j][0]))
02193           <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[j][jx]|=bx;
02194       }
02195       NEXT(jx, bx);
02196     }
02197   } <font class="comment">/* end of TRY */</font>
02198   
02199   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
02200   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
02201   <font class="keywordflow">return</font> <a class="code" href="polyparam_8c.html#a6">Sat</a>;
02202 } <font class="comment">/* BuildSat */</font>
02203 
02204 <font class="comment">/* </font>
02205 <font class="comment"> * Add 'Nbconstraints' new constraints to polyhedron 'Pol'. Constraints are </font>
02206 <font class="comment"> * pointed by 'Con' and the maximum allowed rays in the new polyhedron is</font>
02207 <font class="comment"> * 'NbMaxRays'.   </font>
02208 <font class="comment"> */</font>
<a name="l02209"></a><a class="code" href="polyhedron_8c.html#a28">02209</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a28">AddConstraints</a>(Value *Con,<font class="keywordtype">unsigned</font> NbConstraints,Polyhedron *Pol,<font class="keywordtype">unsigned</font> NbMaxRays)<font class="keyword"> </font>{
02210 
02211   Polyhedron *NewPol = NULL;
02212   Matrix   *Mat = NULL, *Ray = NULL;
02213   <a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a6">Sat</a> = NULL;
02214   <font class="keywordtype">unsigned</font> NbRay, NbCon, Dimension;
02215   
02216   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
02217     <font class="keywordflow">if</font> (NewPol) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(NewPol);
02218     <font class="keywordflow">if</font> (Mat) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat);
02219     <font class="keywordflow">if</font> (Ray) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Ray);
02220     <font class="keywordflow">if</font> (Sat) <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;<a class="code" href="polyparam_8c.html#a6">Sat</a>);
02221     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
02222   }
02223   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
02224     NbRay       = Pol-&gt;NbRays;
02225     NbCon       = Pol-&gt;NbConstraints + NbConstraints;
02226     Dimension   = Pol-&gt;Dimension + 2;   <font class="comment">/* Homogeneous Dimension + Status */</font>
02227     
02228     Mat = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbCon, Dimension);
02229     <font class="keywordflow">if</font>(!Mat) {
02230       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"AddConstraints"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
02231       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
02232       <font class="keywordflow">return</font> 0;
02233     }
02234     
02235     <font class="comment">/* Copy constraints of polyhedron 'Pol' to matrix 'Mat' */</font>
02236     <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Pol-&gt;Constraint[0], Mat-&gt;p[0], Pol-&gt;NbConstraints * Dimension);
02237     
02238     <font class="comment">/* Add the new constraints pointed by 'Con' to matrix 'Mat' */</font>
02239     <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Con, Mat-&gt;p[Pol-&gt;NbConstraints], NbConstraints * Dimension);  
02240     
02241     <font class="comment">/* Allocate space for ray matrix 'Ray' */</font>
02242     Ray = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbMaxRays, Dimension);
02243     <font class="keywordflow">if</font>(!Ray) {
02244       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"AddConstraints"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
02245       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
02246       <font class="keywordflow">return</font> 0;
02247     }
02248     Ray-&gt;NbRows = NbRay;
02249 
02250     <font class="comment">/* Copy rays of polyhedron 'Pol' to matrix 'Ray' */</font>
02251     <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Pol-&gt;Ray[0], Ray-&gt;p[0], NbRay * Dimension);  
02252     
02253     <font class="comment">/* Create the saturation matrix 'Sat' from constraint matrix 'Mat' and */</font>
02254     <font class="comment">/* ray matrix 'Ray' .                                                  */</font> 
02255     <a class="code" href="polyparam_8c.html#a6">Sat</a> = <a class="code" href="polyhedron_8c.html#a27">BuildSat</a>(Mat, Ray, Pol-&gt;NbConstraints, NbMaxRays);
02256     
02257     <font class="comment">/* Create the ray matrix 'Ray' from the constraint matrix 'Mat' */</font>
02258     Pol_status = <a class="code" href="polyhedron_8c.html#a14">Chernikova</a>(Mat, Ray, <a class="code" href="polyparam_8c.html#a6">Sat</a>, Pol-&gt;NbBid, NbMaxRays, Pol-&gt;NbConstraints,0);
02259     
02260     <font class="comment">/* Remove redundant constraints from matrix 'Mat' */</font>
02261     NewPol = <a class="code" href="polyhedron_8c.html#a16">Remove_Redundants</a>(Mat, Ray, <a class="code" href="polyparam_8c.html#a6">Sat</a>, 0);
02262     
02263   } <font class="comment">/* end of TRY */</font>
02264   
02265   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);  
02266   <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;<a class="code" href="polyparam_8c.html#a6">Sat</a>);
02267   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Ray);
02268   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat);  
02269   <font class="keywordflow">return</font> NewPol;
02270 } <font class="comment">/* AddConstraints */</font>
02271 
02272 <font class="comment">/* </font>
02273 <font class="comment"> * Return 1 if 'Pol1' includes (covers) 'Pol2', 0 otherwise. </font>
02274 <font class="comment"> * Polyhedron 'A' includes polyhedron 'B' if the rays of 'B' saturate</font>
02275 <font class="comment"> * the equalities and verify the inequalities of 'A'. Both 'Pol1' and </font>
02276 <font class="comment"> * 'Pol2' have same dimensions. </font>
02277 <font class="comment"> */</font>
<a name="l02278"></a><a class="code" href="polyhedron_8c.html#a29">02278</a> <font class="keywordtype">int</font> <a class="code" href="polyhedron_8c.html#a29">PolyhedronIncludes</a>(Polyhedron *Pol1,Polyhedron *Pol2)<font class="keyword"> </font>{
02279         
02280   <font class="keywordtype">int</font> Dimension = Pol1-&gt;Dimension + 1;   <font class="comment">/* Homogenous Dimension */</font>
02281   <font class="keywordtype">int</font> i, j, k;
02282   Value *p1, *p2, p3, tmp;
02283   
02284   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(p3); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
02285   <font class="keywordflow">for</font> (k=0; k&lt;Pol1-&gt;NbConstraints; k++) {
02286     <font class="keywordflow">for</font> (i=0;i&lt;Pol2-&gt;NbRays;i++) {
02287       
02288       <font class="comment">/* Compute the dot product of ray(i) and constraint(k) and store in p3 */</font>
02289       p1 = Pol2-&gt;Ray[i]+1;
02290       p2 = Pol1-&gt;Constraint[k]+1;
02291       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(p3,0);
02292       <font class="keywordflow">for</font>(j=0;j&lt;Dimension;j++) {
02293         <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp,*p1,*p2);
02294         <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(p3,p3,tmp);
02295         p1++; p2++;
02296       }
02297      
02298       <font class="comment">/* If (p3 &lt; 0) or (p3 &gt; 0 and (constraint(k) is equality</font>
02299 <font class="comment">                                     or ray(i) is a line)), return 0 */</font>
02300       <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a64">value_neg_p</a>(p3) ||
02301           (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(p3)
02302              &amp;&amp; (<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(Pol1-&gt;Constraint[k][0]) || (value_zero_p(Pol2-&gt;Ray[i][0]))   ) ))<font class="keyword"> </font>{
02303         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p3); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
02304         <font class="keywordflow">return</font> 0;
02305       }
02306     }
02307   } 
02308   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p3); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
02309   <font class="keywordflow">return</font> 1;
02310 } <font class="comment">/* PolyhedronIncludes */</font>
02311 
02312 <font class="comment">/*</font>
02313 <font class="comment"> * Add Polyhedron 'Pol' to polhedral domain 'PolDomain'. If 'Pol' covers</font>
02314 <font class="comment"> * some polyhedron in the domain 'PolDomain', it is removed from the list.</font>
02315 <font class="comment"> * On the other hand if some polyhedron in the domain covers polyhedron </font>
02316 <font class="comment"> * 'Pol' then 'Pol' is not included in the domain.   </font>
02317 <font class="comment"> */</font>
<a name="l02318"></a><a class="code" href="polyhedron_8c.html#a30">02318</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a>(Polyhedron *Pol,Polyhedron *PolDomain)<font class="keyword"> </font>{
02319   
02320   Polyhedron *p, *pnext, *p_domain_end = (Polyhedron *) 0;
02321   <font class="keywordtype">int</font> Redundant;
02322   
02323   <font class="keywordflow">if</font> (!Pol) 
02324     <font class="keywordflow">return</font> PolDomain;
02325   <font class="keywordflow">if</font> (!PolDomain)       
02326     <font class="keywordflow">return</font> Pol;
02327   
02328   <font class="comment">/* Check for emptiness of polyhedron 'Pol' */</font>
02329   <font class="keywordflow">if</font> (emptyQ(Pol))<font class="keyword"> </font>{
02330     <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(Pol);
02331     <font class="keywordflow">return</font> PolDomain;
02332   }
02333   
02334   <font class="comment">/* Check for emptiness of polyhedral domain 'PolDomain' */</font>
02335   <font class="keywordflow">if</font> (emptyQ(PolDomain))<font class="keyword"> </font>{
02336     <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(PolDomain);
02337     <font class="keywordflow">return</font> Pol;
02338   }
02339   
02340   <font class="comment">/* Test 'Pol' against the domain 'PolDomain' */</font>
02341   Redundant = 0;
02342   <font class="keywordflow">for</font> (p=PolDomain,PolDomain=(Polyhedron *)0; p; p=pnext) {
02343     
02344     <font class="comment">/* If 'Pol' covers 'p' */</font>    
02345     <font class="keywordflow">if</font> (<a class="code" href="polyhedron_8c.html#a29">PolyhedronIncludes</a>(Pol, p))<font class="keyword"></font>
02346 <font class="keyword">    </font>{
02347        <font class="comment">/* free p */</font>
02348                  pnext = p-&gt;next;
02349        <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>( p );
02350        <font class="keywordflow">continue</font>;
02351     }
02352 
02353     <font class="comment">/* Add polyhedron p to the new domain list */</font>
02354     <font class="keywordflow">if</font> (!PolDomain) PolDomain = p; <font class="keywordflow">else</font> p_domain_end-&gt;next = p;
02355     p_domain_end = p;
02356     
02357     <font class="comment">/* If p covers Pol */</font>
02358     <font class="keywordflow">if</font> (<a class="code" href="polyhedron_8c.html#a29">PolyhedronIncludes</a>(p,Pol))<font class="keyword"> </font>{
02359       Redundant = 1;
02360       <font class="keywordflow">break</font>;
02361     }
02362     pnext = p-&gt;next;
02363   }
02364   <font class="keywordflow">if</font> (!Redundant) {  
02365     
02366     <font class="comment">/* The whole list has been checked. Add new polyhedron 'Pol' to the */</font>
02367     <font class="comment">/* new domain list.                                                 */</font> 
02368     <font class="keywordflow">if</font> (!PolDomain) PolDomain = Pol; <font class="keywordflow">else</font> p_domain_end-&gt;next = Pol;
02369   }
02370   <font class="keywordflow">else</font> {
02371     
02372     <font class="comment">/* The rest of the list is just inherited from p */</font>
02373     <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(Pol);
02374   }
02375   <font class="keywordflow">return</font> PolDomain;
02376 } <font class="comment">/* AddPolyToDomain */</font>
02377 
02378 <font class="comment">/* </font>
02379 <font class="comment"> * Given a polyhedra 'Pol' and a single constraint 'Con' and an integer 'Pass' </font>
02380 <font class="comment"> * whose value ranges from 0 to 3, add the inverse of constraint 'Con' to the </font>
02381 <font class="comment"> * constraint set of 'Pol' and return the new polyhedron. 'NbMaxRays' is the </font>
02382 <font class="comment"> * maximum allowed rays in the new generated polyhedron. </font>
02383 <font class="comment"> * If Pass == 0, add ( -constraint -1) &gt;= 0</font>
02384 <font class="comment"> * If Pass == 1, add ( +constraint -1) &gt;= 0</font>
02385 <font class="comment"> * If Pass == 2, add ( -constraint   ) &gt;= 0</font>
02386 <font class="comment"> * If Pass == 3, add ( +constraint   ) &gt;= 0</font>
02387 <font class="comment"> */</font>
<a name="l02388"></a><a class="code" href="polyhedron_8c.html#a31">02388</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a31">SubConstraint</a>(Value *Con,Polyhedron *Pol,<font class="keywordtype">unsigned</font> NbMaxRays,<font class="keywordtype">int</font> Pass)<font class="keyword"> </font>{
02389   
02390   Polyhedron *NewPol = NULL;
02391   Matrix   *Mat = NULL, *Ray = NULL;
02392   <a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a6">Sat</a> = NULL;
02393   <font class="keywordtype">unsigned</font> NbRay, NbCon, NbEle1, Dimension;
02394   <font class="keywordtype">int</font> i;
02395   
02396   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
02397     <font class="keywordflow">if</font> (NewPol) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(NewPol);
02398     <font class="keywordflow">if</font> (Mat) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat);
02399     <font class="keywordflow">if</font> (Ray) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Ray);
02400     <font class="keywordflow">if</font> (Sat) <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;<a class="code" href="polyparam_8c.html#a6">Sat</a>);
02401     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
02402   }
02403   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
02404     
02405     <font class="comment">/* If 'Con' is the positivity constraint, return Null */</font>
02406     Dimension  = Pol-&gt;Dimension+1;      <font class="comment">/* Homogeneous Dimension */</font>
02407     <font class="keywordflow">for</font> (i=1; i&lt;Dimension; i++)
02408       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Con[i])) <font class="keywordflow">break</font>;
02409     <font class="keywordflow">if</font> (i==Dimension) {
02410       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
02411       <font class="keywordflow">return</font> (Polyhedron *) 0;
02412     }
02413     
02414     NbRay     = Pol-&gt;NbRays;
02415     NbCon     = Pol-&gt;NbConstraints;
02416     Dimension = Pol-&gt;Dimension+2;       <font class="comment">/* Homogeneous Dimension + Status */</font>
02417     NbEle1    = NbCon * Dimension;
02418     
02419     Mat = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbCon + 1, Dimension);
02420     <font class="keywordflow">if</font>(!Mat) {
02421       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"SubConstraint"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
02422       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
02423       <font class="keywordflow">return</font> 0;
02424     }
02425     
02426     <font class="comment">/* Set the constraints of Pol */</font>
02427     <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Pol-&gt;Constraint[0], Mat-&gt;p[0], NbEle1);
02428     
02429     <font class="comment">/* Add the new constraint */</font>
02430     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[NbCon][0],1);
02431     <font class="keywordflow">if</font> (!(Pass&amp;1))
02432       <font class="keywordflow">for</font>(i=1; i&lt;Dimension; i++) 
02433         <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(Mat-&gt;p[NbCon][i],Con[i]);
02434     <font class="keywordflow">else</font>
02435       <font class="keywordflow">for</font>(i=1; i&lt;Dimension; i++)
02436         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Mat-&gt;p[NbCon][i],Con[i]);
02437     <font class="keywordflow">if</font> (!(Pass&amp;2))
02438       <a class="code" href="arithmetique_8h.html#a50">value_decrement</a>(Mat-&gt;p[NbCon][Dimension-1],Mat-&gt;p[NbCon][Dimension-1]);
02439    
02440     <font class="comment">/* Allocate the ray matrix. */</font>
02441     Ray = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbMaxRays, Dimension);
02442     <font class="keywordflow">if</font>(!Ray) {
02443       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"SubConstraint"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
02444       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
02445       <font class="keywordflow">return</font> 0;
02446     }
02447     
02448     <font class="comment">/* Initialize the ray matrix with the rays of polyhedron 'Pol' */</font>
02449     Ray-&gt;NbRows = NbRay;
02450     <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Pol-&gt;Ray[0], Ray-&gt;p[0], NbRay * Dimension);   
02451     
02452     <font class="comment">/* Create the saturation matrix from the constraint matrix 'mat' and */</font>
02453     <font class="comment">/* ray matrix 'Ray'.                                                 */</font>
02454     <a class="code" href="polyparam_8c.html#a6">Sat</a> = <a class="code" href="polyhedron_8c.html#a27">BuildSat</a>(Mat, Ray, NbCon, NbMaxRays);
02455     
02456     <font class="comment">/* Create the ray matrix 'Ray' from consraint matrix 'Mat'           */</font>
02457     Pol_status = <a class="code" href="polyhedron_8c.html#a14">Chernikova</a>(Mat, Ray, <a class="code" href="polyparam_8c.html#a6">Sat</a>, Pol-&gt;NbBid, NbMaxRays, NbCon,0);
02458     
02459     <font class="comment">/* Remove redundant constraints from matrix 'Mat' */</font> 
02460     NewPol = <a class="code" href="polyhedron_8c.html#a16">Remove_Redundants</a>(Mat, Ray, <a class="code" href="polyparam_8c.html#a6">Sat</a>, 0);
02461     
02462   } <font class="comment">/* end of TRY */</font>
02463   
02464   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
02465   
02466   <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;<a class="code" href="polyparam_8c.html#a6">Sat</a>);
02467   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Ray);
02468   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat);
02469   <font class="keywordflow">return</font> NewPol;
02470 } <font class="comment">/* SubConstraint */</font>
02471 
02472 <font class="comment">/*</font>
02473 <font class="comment"> * Return the intersection of two polyhedral domains 'Pol1' and 'Pol2'. </font>
02474 <font class="comment"> * The maximum allowed rays in the new polyhedron generated is 'NbMaxRays'. </font>
02475 <font class="comment"> */</font>
<a name="l02476"></a><a class="code" href="polyhedron_8c.html#a32">02476</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a32">DomainIntersection</a>(Polyhedron *Pol1,Polyhedron *Pol2,<font class="keywordtype">unsigned</font> NbMaxRays)<font class="keyword"> </font>{
02477   
02478   Polyhedron *p1, *p2, *p3, *d;
02479   
02480   <font class="keywordflow">if</font> (!Pol1 || !Pol2) <font class="keywordflow">return</font> (Polyhedron*) 0;
02481   <font class="keywordflow">if</font> (Pol1-&gt;Dimension != Pol2-&gt;Dimension) {
02482     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>( <font class="stringliteral">"DomainIntersection"</font>, <font class="stringliteral">"diffdim"</font>,
02483                <font class="stringliteral">"operation on different dimensions"</font>);
02484     <font class="keywordflow">return</font> (Polyhedron*) 0;
02485   }
02486   
02487   <font class="comment">/* For every polyhedron pair (p1,p2) where p1 belongs to domain Pol1 and */</font>
02488   <font class="comment">/* p2 belongs to domain Pol2, compute the intersection and add it to the */</font>
02489   <font class="comment">/* new domain 'd'.                                                       */</font>
02490   d = (Polyhedron *)0;
02491   <font class="keywordflow">for</font> (p1=Pol1; p1; p1=p1-&gt;next) {
02492     <font class="keywordflow">for</font> (p2=Pol2; p2; p2=p2-&gt;next) {
02493       p3 = <a class="code" href="polyhedron_8c.html#a28">AddConstraints</a>(p2-&gt;Constraint[0],
02494                           p2-&gt;NbConstraints, p1, NbMaxRays);      
02495       d = <a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a>(p3,d);
02496     }
02497   }
02498   <font class="keywordflow">if</font> (!d)
02499     <font class="keywordflow">return</font> <a class="code" href="polyhedron_8c.html#a22">Empty_Polyhedron</a>(Pol1-&gt;Dimension);
02500   <font class="keywordflow">else</font>
02501     <font class="keywordflow">return</font> d;
02502   
02503 } <font class="comment">/* DomainIntersection */</font>
02504 
02505 <font class="comment">/*</font>
02506 <font class="comment"> * Given a polyhedron 'Pol', return a matrix of rays. </font>
02507 <font class="comment"> */</font>
<a name="l02508"></a><a class="code" href="polyhedron_8c.html#a33">02508</a> Matrix *<a class="code" href="polyhedron_8c.html#a33">Polyhedron2Rays</a>(Polyhedron *Pol)<font class="keyword"> </font>{
02509   
02510   Matrix     *Ray;
02511   <font class="keywordtype">unsigned</font> NbRays, Dimension;
02512   
02513   NbRays    = Pol-&gt;NbRays;
02514   Dimension = Pol-&gt;Dimension+2;         <font class="comment">/* Homogeneous Dimension + Status */</font>
02515   Ray = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbRays, Dimension);
02516   <font class="keywordflow">if</font>(!Ray) {
02517     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Polyhedron2Rays"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
02518     <font class="keywordflow">return</font> 0;
02519   }
02520   <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Pol-&gt;Ray[0], Ray-&gt;p_Init, NbRays*Dimension);
02521   <font class="keywordflow">return</font> Ray;
02522 } <font class="comment">/* Polyhedron2Rays */</font>
02523 
02524 <font class="comment">/*</font>
02525 <font class="comment"> * Add 'NbAddedRays' rays to polyhedron 'Pol'. Rays are pointed by 'AddedRays'</font>
02526 <font class="comment"> * and the maximum allowed constraints in the new polyhedron is 'NbMaxConstrs'.</font>
02527 <font class="comment"> */</font> 
<a name="l02528"></a><a class="code" href="polyhedron_8c.html#a34">02528</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a34">AddRays</a>(Value *AddedRays,<font class="keywordtype">unsigned</font> NbAddedRays,Polyhedron *Pol,<font class="keywordtype">unsigned</font> NbMaxConstrs)<font class="keyword"> </font>{
02529 
02530   Polyhedron *NewPol = NULL;
02531   Matrix   *Mat = NULL, *Ray = NULL;
02532   <a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a6">Sat</a> = NULL, *SatTranspose = NULL;
02533   <font class="keywordtype">unsigned</font> NbCon, NbRay,NbEle1, Dimension;
02534   
02535   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
02536     <font class="keywordflow">if</font> (NewPol) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(NewPol);
02537     <font class="keywordflow">if</font> (Mat) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat);
02538     <font class="keywordflow">if</font> (Ray) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Ray);
02539     <font class="keywordflow">if</font> (Sat) <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;<a class="code" href="polyparam_8c.html#a6">Sat</a>);
02540     <font class="keywordflow">if</font> (SatTranspose) <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;SatTranspose);
02541     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
02542   }
02543   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
02544     
02545     NbCon      = Pol-&gt;NbConstraints;
02546     NbRay      = Pol-&gt;NbRays;
02547     Dimension  = Pol-&gt;Dimension + 2;    <font class="comment">/* Homogeneous Dimension + Status */</font>
02548     NbEle1     = NbRay * Dimension;
02549     
02550     Ray = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbAddedRays + NbRay, Dimension);
02551     <font class="keywordflow">if</font>(!Ray) {
02552       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"AddRays"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
02553       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
02554       <font class="keywordflow">return</font> 0;
02555     }
02556     
02557     <font class="comment">/* Copy rays of polyhedron 'Pol' to matrix 'Ray' */</font>
02558     <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Pol-&gt;Ray[0], Ray-&gt;p_Init, NbEle1);
02559     
02560     <font class="comment">/* Add the new rays pointed by 'AddedRays' to matrix 'Ray' */</font>
02561     <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(AddedRays, Ray-&gt;p_Init+NbEle1, NbAddedRays * Dimension);
02562     
02563     <font class="comment">/* Allocate space for constraint matrix 'Mat' */</font>
02564     Mat = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbMaxConstrs, Dimension);
02565     <font class="keywordflow">if</font>(!Mat) {
02566       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"AddRays"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
02567       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
02568       <font class="keywordflow">return</font> 0;
02569     }
02570     Mat-&gt;NbRows = NbCon;
02571     
02572     <font class="comment">/* Copy constraints of polyhedron 'Pol' to matrix 'Mat' */</font>
02573     <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Pol-&gt;Constraint[0], Mat-&gt;p_Init, NbCon*Dimension);
02574 
02575     <font class="comment">/* Create the saturation matrix 'SatTranspose' from constraint matrix */</font>
02576     <font class="comment">/* 'Mat' and ray matrix 'Ray'. Remember the saturation matrix is      */</font>
02577     <font class="comment">/* referenced by (constraint,ray) pair                                */</font> 
02578     SatTranspose = <a class="code" href="polyhedron_8c.html#a27">BuildSat</a>(Ray, Mat, NbRay, NbMaxConstrs);
02579     
02580     <font class="comment">/* Create the constraint matrix 'Mat' from the ray matrix 'Ray' */</font>
02581     Pol_status = <a class="code" href="polyhedron_8c.html#a14">Chernikova</a>(Ray, Mat, SatTranspose, Pol-&gt;NbEq, NbMaxConstrs, NbRay,1);
02582     
02583     <font class="comment">/* Transform the saturation matrix 'SatTranspose' in the standard format */</font>
02584     <font class="comment">/* , that is, (ray X constraint) format.                                 */</font>
02585     <a class="code" href="polyparam_8c.html#a6">Sat</a> = <a class="code" href="polyhedron_8c.html#a12">TransformSat</a>(Mat, Ray, SatTranspose);
02586     <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;SatTranspose), SatTranspose = NULL;
02587     
02588     <font class="comment">/* Remove redundant rays from the ray matrix 'Ray' */</font>
02589     NewPol = <a class="code" href="polyhedron_8c.html#a16">Remove_Redundants</a>(Mat, Ray, <a class="code" href="polyparam_8c.html#a6">Sat</a>, 0);
02590     
02591     <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;<a class="code" href="polyparam_8c.html#a6">Sat</a>), <a class="code" href="polyparam_8c.html#a6">Sat</a> = NULL;
02592     <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat), Mat = NULL;
02593     <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Ray), Ray = NULL;  
02594   } <font class="comment">/* end of TRY */</font>
02595   
02596   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);  
02597   <font class="keywordflow">return</font> NewPol;
02598 } <font class="comment">/* AddRays */</font>
02599 
02600 <font class="comment">/* </font>
02601 <font class="comment"> * Add rays pointed by 'Ray' to each and every polyhedron in the polyhedral </font>
02602 <font class="comment"> * domain 'Pol'. 'NbMaxConstrs' is maximum allowed constraints in the </font>
02603 <font class="comment"> * constraint set of a polyhedron.                         </font>
02604 <font class="comment"> */</font> 
<a name="l02605"></a><a class="code" href="polyhedron_8c.html#a35">02605</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a35">DomainAddRays</a>(Polyhedron *Pol,Matrix *Ray,<font class="keywordtype">unsigned</font> NbMaxConstrs)<font class="keyword"> </font>{
02606   
02607   Polyhedron *PolA, *PolEndA, *p1, *p2, *p3;
02608   <font class="keywordtype">int</font> Redundant;
02609   
02610   <font class="keywordflow">if</font> (!Pol) <font class="keywordflow">return</font> (Polyhedron*) 0;
02611   <font class="keywordflow">if</font> (!Ray ) <font class="keywordflow">return</font> Pol;
02612   <font class="keywordflow">if</font> (Pol-&gt;Dimension != Ray-&gt;NbColumns-2) {
02613     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(
02614               <font class="stringliteral">"DomainAddRays"</font>, <font class="stringliteral">"diffdim"</font>, <font class="stringliteral">"operation on different dimensions"</font>);
02615     <font class="keywordflow">return</font> (Polyhedron*) 0;
02616   }
02617   
02618   <font class="comment">/* Copy Pol to PolA */</font>
02619   PolA = PolEndA = (Polyhedron *)0;
02620   <font class="keywordflow">for</font> (p1=Pol; p1; p1=p1-&gt;next) {
02621     p3 = <a class="code" href="polyhedron_8c.html#a34">AddRays</a>(Ray-&gt;p[0], Ray-&gt;NbRows, p1, NbMaxConstrs);
02622     
02623     <font class="comment">/* Does any component of PolA cover 'p3' ? */</font>
02624     Redundant = 0;
02625     <font class="keywordflow">for</font> (p2=PolA; p2; p2=p2-&gt;next) {
02626       <font class="keywordflow">if</font> (<a class="code" href="polyhedron_8c.html#a29">PolyhedronIncludes</a>(p2, p3))<font class="keyword"> </font>{ <font class="comment">/* If p2 covers p3 */</font>
02627         Redundant = 1;
02628         <font class="keywordflow">break</font>;
02629       }
02630     }
02631     
02632     <font class="comment">/* If the new polyheron is not redundant, add it ('p3') to the list */</font>
02633     <font class="keywordflow">if</font> (!Redundant) { 
02634       <font class="keywordflow">if</font> (!PolEndA)
02635         PolEndA = PolA = p3;
02636       <font class="keywordflow">else</font> {
02637         PolEndA-&gt;next = p3;
02638         PolEndA = PolEndA-&gt;next;
02639       }
02640     }
02641   }
02642   <font class="keywordflow">return</font> PolA;
02643 } <font class="comment">/* DomainAddRays */</font>
02644 
02645 <font class="comment">/*</font>
02646 <font class="comment"> * Create a copy of the polyhedron 'Pol' </font>
02647 <font class="comment"> */</font>
<a name="l02648"></a><a class="code" href="polyhedron_8c.html#a36">02648</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a36">Polyhedron_Copy</a>(Polyhedron *Pol)<font class="keyword"> </font>{
02649   
02650   Polyhedron *Pol1;
02651   
02652   <font class="keywordflow">if</font> (!Pol) <font class="keywordflow">return</font> (Polyhedron *)0;
02653   
02654   <font class="comment">/* Allocate space for the new polyhedron */</font>
02655   Pol1 = <a class="code" href="polyhedron_8c.html#a17">Polyhedron_Alloc</a>(Pol-&gt;Dimension, Pol-&gt;NbConstraints, Pol-&gt;NbRays);
02656   <font class="keywordflow">if</font> (!Pol1) {
02657     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Polyhedron_Copy"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
02658     <font class="keywordflow">return</font> 0;
02659   }
02660   <font class="keywordflow">if</font>( Pol-&gt;NbConstraints )
02661     <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Pol-&gt;Constraint[0], Pol1-&gt;Constraint[0],
02662               Pol-&gt;NbConstraints*(Pol-&gt;Dimension+2));
02663   <font class="keywordflow">if</font>( Pol-&gt;NbRays )
02664     <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Pol-&gt;Ray[0], Pol1-&gt;Ray[0],
02665               Pol-&gt;NbRays*(Pol-&gt;Dimension+2));
02666   Pol1-&gt;NbBid = Pol-&gt;NbBid;
02667   Pol1-&gt;NbEq = Pol-&gt;NbEq;
02668   <font class="keywordflow">return</font> Pol1;
02669 } <font class="comment">/* Polyhedron_Copy */</font>
02670 
02671 <font class="comment">/* </font>
02672 <font class="comment"> * Create a copy of a polyhedral domain. </font>
02673 <font class="comment"> */</font>
<a name="l02674"></a><a class="code" href="polyhedron_8c.html#a37">02674</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a37">Domain_Copy</a>(Polyhedron *Pol)<font class="keyword"> </font>{
02675   
02676   Polyhedron *Pol1;
02677   
02678   <font class="keywordflow">if</font> (!Pol) <font class="keywordflow">return</font> (Polyhedron *) 0;
02679   Pol1 = <a class="code" href="polyhedron_8c.html#a36">Polyhedron_Copy</a>(Pol);
02680   <font class="keywordflow">if</font> (Pol-&gt;next) Pol1-&gt;next = <a class="code" href="polyhedron_8c.html#a37">Domain_Copy</a>(Pol-&gt;next);
02681   <font class="keywordflow">return</font> Pol1;
02682 } <font class="comment">/* Domain_Copy */</font>
02683 
02684 <font class="comment">/*</font>
02685 <font class="comment"> * Given constraint number 'k' of a polyhedron, and an array 'Filter' to store</font>
02686 <font class="comment"> * the non-redundant constraints of the polyhedron in bit-wise notation, and</font>
02687 <font class="comment"> * a Matrix 'Sat', add the constraint 'k' in 'Filter' array. tmpR[i] stores the</font>
02688 <font class="comment"> * number of constraints, other than those in 'Filter', which ray(i) saturates </font>
02689 <font class="comment"> * or verifies. In case, ray(i) does not saturate or verify a constraint in</font>
02690 <font class="comment"> * array 'Filter', it is assigned to -1. Similarly, tmpC[j] stores the number</font>
02691 <font class="comment"> * of rays which constraint(j), if it doesn't belong to Filter, saturates or </font>
02692 <font class="comment"> * verifies. If constraint(j) belongs to 'Filter', then tmpC[j] is assigned to</font>
02693 <font class="comment"> * -1. 'NbConstraints' is the number of constraints in the constraint matrix of</font>
02694 <font class="comment"> * the polyhedron. </font>
02695 <font class="comment"> * NOTE: (1) 'Sat' is not the saturation matrix of the polyhedron. In fact, </font>
02696 <font class="comment"> *           entry in 'Sat' is set to 1 if ray(i) of polyhedron1 verifies or </font>
02697 <font class="comment"> *           saturates the constraint(j) of polyhedron2 and otherwise it is set</font>
02698 <font class="comment"> *           to 0. So here the difference with saturation matrix is in terms </font>
02699 <font class="comment"> *           definition and entries(1&lt;-&gt;0) of the matrix 'Sat'.    </font>
02700 <font class="comment"> *       </font>
02701 <font class="comment"> * ALGORITHM:-&gt;</font>
02702 <font class="comment"> * (1) Include constraint(k) in array 'Filter'. </font>
02703 <font class="comment"> * (2) Set tmpC[k] to -1.</font>
02704 <font class="comment"> * (3) For all ray(i) {</font>
02705 <font class="comment"> *        If ray(i) saturates or verifies constraint(k) then --(tmpR[i])</font>
02706 <font class="comment"> *        Else {</font>
02707 <font class="comment"> *           Discard ray(i) by assigning tmpR[i] = -1</font>
02708 <font class="comment"> *           Decrement tmpC[j] for all constraint(j) not in array 'Filter'.</font>
02709 <font class="comment"> *        }</font>
02710 <font class="comment"> *     }</font>
02711 <font class="comment"> */</font>
<a name="l02712"></a><a class="code" href="polyhedron_8c.html#a38">02712</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="polyhedron_8c.html#a38">addToFilter</a>(<font class="keywordtype">int</font> k, <font class="keywordtype">unsigned</font> *Filter, <a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a6">Sat</a>,Value *tmpR,Value *tmpC,<font class="keywordtype">int</font> NbRays,<font class="keywordtype">int</font> NbConstraints)<font class="keyword"> </font>{
02713   
02714   <font class="keywordtype">int</font> kj, i,j, jx;
02715   <font class="keywordtype">unsigned</font> kb, bx;
02716   
02717   <font class="comment">/* Remove constraint k */</font>
02718   kj =   k/<a class="code" href="polyhedron_8c.html#a0">WSIZE</a>; kb = MSB; kb &gt;&gt;= k%<a class="code" href="polyhedron_8c.html#a0">WSIZE</a>;
02719   Filter[kj]|=kb;
02720   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmpC[k],-1);
02721   
02722   <font class="comment">/* Remove rays excluded by constraint k */</font>
02723   <font class="keywordflow">for</font>(i=0; i&lt;NbRays; i++)
02724     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a65">value_posz_p</a>(tmpR[i]))<font class="keyword"> </font>{
02725       <font class="keywordflow">if</font> (<a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i][kj]&amp;kb)
02726         <a class="code" href="arithmetique_8h.html#a50">value_decrement</a>(tmpR[i],tmpR[i]);  <font class="comment">/* adjust included ray */</font>
02727       <font class="keywordflow">else</font> {
02728         
02729         <font class="comment">/* Constraint k excludes ray i -- delete ray i */</font>
02730         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmpR[i],-1);
02731         
02732         <font class="comment">/* Adjust non-deleted constraints */</font>
02733         jx=0; bx=MSB;
02734         <font class="keywordflow">for</font>(j=0; j&lt;NbConstraints; j++) {
02735           <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a65">value_posz_p</a>(tmpC[j]) &amp;&amp; (Sat-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i][jx]&amp;bx) )
02736             <a class="code" href="arithmetique_8h.html#a50">value_decrement</a>(tmpC[j],tmpC[j]);
02737           NEXT(jx,bx);
02738         }
02739       }
02740     } 
02741 } <font class="comment">/* addToFilter */</font>
02742 
02743 <font class="comment">/*</font>
02744 <font class="comment"> * Given polyhedra 'P1' and 'P2' such that their intersection is an empty</font>
02745 <font class="comment"> * polyhedron, find the minimal set of constraints of 'P1' which contradict</font>
02746 <font class="comment"> * all of the constraints of 'P2'. This is believed to be an NP-hard problem</font>
02747 <font class="comment"> * and so a heuristic is employed to solve it in worst case. The heuristic is </font>
02748 <font class="comment"> * to select in every turn that constraint of 'P1' which excludes most rays of</font>
02749 <font class="comment"> * 'P2'. A bit in the binary format of an element of array 'Filter' is set to</font>
02750 <font class="comment"> * 1 if the corresponding constraint is to be included in the minimal set of </font>
02751 <font class="comment"> * constraints otherwise it is set to 0.</font>
02752 <font class="comment"> */</font>
<a name="l02753"></a><a class="code" href="polyhedron_8c.html#a39">02753</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="polyhedron_8c.html#a39">FindSimple</a>(Polyhedron *P1,Polyhedron *P2,<font class="keywordtype">unsigned</font> *Filter,<font class="keywordtype">unsigned</font> NbMaxRays)<font class="keyword"> </font>{
02754   
02755   Matrix *Mat = NULL;
02756   <a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a6">Sat</a> = NULL;
02757   <font class="keywordtype">int</font> i, j, k, jx, found;
02758   Value *p1, *p2, p3;
02759   <font class="keywordtype">unsigned</font> Dimension, NbRays, NbConstraints, bx, nc;
02760   Value NbConstraintsLeft, tmp;
02761   Value *tmpC = NULL, *tmpR = NULL;
02762   Polyhedron *Pol = NULL, *Pol2 = NULL;
02763   
02764   <font class="comment">/* Initialize all the 'Value' variables */</font>
02765   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(p3); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(NbConstraintsLeft);
02766   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
02767  
02768   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
02769     <font class="keywordflow">if</font> (tmpC) free(tmpC);
02770     <font class="keywordflow">if</font> (tmpR) free(tmpR);
02771     <font class="keywordflow">if</font> (Mat) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat);
02772     <font class="keywordflow">if</font> (Sat) <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;<a class="code" href="polyparam_8c.html#a6">Sat</a>);
02773     <font class="keywordflow">if</font> (Pol2 &amp;&amp; Pol2!=P2) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(Pol2);
02774     <font class="keywordflow">if</font> (Pol &amp;&amp; Pol!=Pol2 &amp;&amp; Pol!=P2) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(Pol);
02775     
02776     <font class="comment">/* Clear all the 'Value' variables */</font>
02777     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p3); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(NbConstraintsLeft);
02778     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
02779     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
02780   }
02781   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
02782     
02783     Dimension = P1-&gt;Dimension+2;       <font class="comment">/* status + homogeneous Dimension */</font>
02784     Mat = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(P1-&gt;NbConstraints, Dimension);
02785     <font class="keywordflow">if</font>(!Mat) {
02786       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"FindSimple"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
02787       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
02788       
02789       <font class="comment">/* Clear all the 'Value' variables */</font>
02790       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p3); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(NbConstraintsLeft); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);  
02791       <font class="keywordflow">return</font>;
02792     }
02793     
02794     <font class="comment">/* Post constraints in P1 already included by Filter */</font>
02795     jx = 0; bx = MSB; Mat-&gt;NbRows=0;
02796     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(NbConstraintsLeft,0);
02797     <font class="keywordflow">for</font> (k=0; k&lt;P1-&gt;NbConstraints; k++) {
02798       <font class="keywordflow">if</font> (Filter[jx]&amp;bx) {
02799         <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(P1-&gt;Constraint[k], Mat-&gt;p[Mat-&gt;NbRows], Dimension);
02800         Mat-&gt;NbRows++;
02801       }
02802       <font class="keywordflow">else</font>
02803         <a class="code" href="arithmetique_8h.html#a45">value_increment</a>(NbConstraintsLeft,NbConstraintsLeft);
02804       NEXT(jx,bx);
02805     }
02806     Pol2 = P2;
02807     
02808     <font class="keywordflow">for</font> (;;) {
02809       <font class="keywordflow">if</font> (Mat-&gt;NbRows==0)
02810         Pol = <a class="code" href="polyhedron_8c.html#a36">Polyhedron_Copy</a>(Pol2);
02811       <font class="keywordflow">else</font> {
02812         Pol = <a class="code" href="polyhedron_8c.html#a28">AddConstraints</a>(Mat-&gt;p_Init, Mat-&gt;NbRows, Pol2, NbMaxRays);
02813         <font class="keywordflow">if</font> (Pol2 != P2) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(Pol2), Pol2 = NULL;
02814       }
02815       <font class="keywordflow">if</font> (emptyQ(Pol))<font class="keyword"> </font>{
02816         <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat), Mat = NULL;
02817         <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(Pol), Pol = NULL;
02818         <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
02819         
02820         <font class="comment">/* Clear all the 'Value' variables */</font>
02821         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p3); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(NbConstraintsLeft); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
02822         <font class="keywordflow">return</font>;
02823       }
02824       Mat-&gt;NbRows = 0;        <font class="comment">/* Reset Mat */</font>
02825       Pol2 = Pol;
02826       
02827       <font class="comment">/* Its not enough-- find some more constraints */</font>
02828       Dimension         = Pol-&gt;Dimension+1;       <font class="comment">/* homogeneous Dimension */</font>
02829       NbRays            = Pol-&gt;NbRays;
02830       NbConstraints     = P1-&gt;NbConstraints;
02831       tmpR = (Value *)malloc(NbRays*<font class="keyword">sizeof</font>(Value));
02832       <font class="keywordflow">if</font>(!tmpR) {
02833         <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"FindSimple"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
02834         <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
02835         
02836         <font class="comment">/* Clear all the 'Value' variables */</font>
02837         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p3); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(NbConstraintsLeft); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);  
02838         <font class="keywordflow">return</font>;
02839       }
02840       <font class="keywordflow">for</font>(i=0;i&lt;NbRays;i++)
02841         <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmpR[i]);
02842       tmpC = (Value *)malloc(NbConstraints*<font class="keyword">sizeof</font>(Value));
02843       <font class="keywordflow">if</font>(!tmpC) {
02844         <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"FindSimple"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
02845         <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
02846         
02847         <font class="comment">/* Clear all the 'Value' variables */</font>
02848         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p3); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(NbConstraintsLeft);
02849         <font class="keywordflow">for</font>(i=0;i&lt;NbRays;i++)
02850           <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmpR[i]);
02851         free(tmpR);
02852         <font class="keywordflow">return</font>;
02853       }
02854       <font class="keywordflow">for</font>(i=0;i&lt;NbConstraints;i++)
02855         <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmpC[i]);
02856       <a class="code" href="vector_8c.html#a9">Vector_Set</a>(tmpR,0,NbRays);
02857       <a class="code" href="vector_8c.html#a9">Vector_Set</a>(tmpC,0,NbConstraints);
02858       
02859       <font class="comment">/* Build the Sat matrix */</font>
02860       nc      = (NbConstraints - 1) / (<font class="keyword">sizeof</font>(int)*8) + 1;
02861       <a class="code" href="polyparam_8c.html#a6">Sat</a>     = <a class="code" href="polyparam_8c.html#a23">SMAlloc</a>(NbRays, nc);
02862       <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m0">NbRows</a> = NbRays;
02863       <a class="code" href="polyhedron_8c.html#a4">SMVector_Init</a>(Sat-&gt;<a class="code" href="structSatMatrix.html#m3">p_init</a>, nc*NbRays);
02864       
02865       jx=0; bx=MSB;
02866       <font class="keywordflow">for</font> (k=0; k&lt;NbConstraints; k++) {
02867         <font class="keywordflow">if</font> (Filter[jx]&amp;bx)
02868           <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmpC[k],-1);
02869         <font class="keywordflow">else</font>
02870           <font class="keywordflow">for</font> (i=0; i&lt;NbRays; i++) {
02871             p1 = Pol-&gt;Ray[i]+1;
02872             p2 = P1-&gt;Constraint[k]+1;
02873             <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(p3,0);
02874             <font class="keywordflow">for</font> (j=0; j&lt;Dimension; j++) {
02875               <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp,*p1,*p2);
02876               <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(p3,p3,tmp);
02877               p1++; p2++;
02878             }
02879             <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(p3) ||
02880                (<a class="code" href="arithmetique_8h.html#a63">value_pos_p</a>(p3) &amp;&amp; <a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(P1-&gt;Constraint[k][0])))<font class="keyword"> </font>{
02881               <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i][jx]|=bx;  <font class="comment">/* constraint includes ray, set flag */</font>
02882               <a class="code" href="arithmetique_8h.html#a45">value_increment</a>(tmpR[i],tmpR[i]);
02883               <a class="code" href="arithmetique_8h.html#a45">value_increment</a>(tmpC[k],tmpC[k]);
02884             }
02885           }
02886         NEXT(jx, bx);
02887       }
02888       
02889       <font class="keywordflow">do</font> { <font class="comment">/* find all of the essential constraints */</font>
02890         found = 0;
02891         <font class="keywordflow">for</font>(i=0; i&lt;NbRays; i++)
02892           <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a65">value_posz_p</a>(tmpR[i]))<font class="keyword"> </font>{
02893             <a class="code" href="arithmetique_8h.html#a44">value_add_int</a>(tmp,tmpR[i],1);
02894             <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a22">value_eq</a>(tmp,NbConstraintsLeft))<font class="keyword"> </font>{
02895               
02896               <font class="comment">/* Ray i is excluded by only one constraint... find it */</font>
02897               jx = 0; bx = MSB;
02898               <font class="keywordflow">for</font>(k=0; k&lt;NbConstraints; k++) {
02899                 <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a65">value_posz_p</a>(tmpC[k]) &amp;&amp; ((Sat-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i][jx]&amp;bx)==0))<font class="keyword"> </font>{
02900                   <a class="code" href="polyhedron_8c.html#a38">addToFilter</a>(k, Filter, <a class="code" href="polyparam_8c.html#a6">Sat</a>, tmpR, tmpC,
02901                               NbRays, NbConstraints);
02902                   <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(P1-&gt;Constraint[k],
02903                               Mat-&gt;p[Mat-&gt;NbRows],Dimension+1);
02904                   Mat-&gt;NbRows++;
02905                   <a class="code" href="arithmetique_8h.html#a50">value_decrement</a>(NbConstraintsLeft,NbConstraintsLeft);
02906                   found=1;
02907                   <font class="keywordflow">break</font>;
02908                 }
02909                 NEXT(jx,bx);
02910               }
02911               <font class="keywordflow">break</font>;
02912             }
02913           }
02914       }
02915       <font class="keywordflow">while</font> (found);
02916      
02917       <font class="keywordflow">if</font> (!Mat-&gt;NbRows) { <font class="comment">/* Well then, just use a stupid heuristic */</font>
02918         <font class="comment">/* find the constraint which excludes the most */</font>
02919         Value cmax;
02920         <a class="code" href="arithmetique_8h.html#a10">value_init</a>(cmax);
02921         
02922 <font class="preprocessor">#ifndef LINEAR_VALUE_IS_CHARS</font>
02923 <font class="preprocessor"></font>        
02924         <font class="comment">/* the typechecking arithmetic lib does (of course) not</font>
02925 <font class="comment">           recognize this one... */</font>
02926         <font class="comment">//value_assign(cmax,~((Value)1&lt;&lt;(sizeof(Value)*8-1)));</font>
02927         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(cmax,(NbRays * NbConstraints+1));
02928 <font class="preprocessor">#else</font>
02929 <font class="preprocessor"></font>        <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(cmax,1);
02930 <font class="preprocessor">#endif</font>
02931 <font class="preprocessor"></font>        
02932         j = -1;
02933         <font class="keywordflow">for</font>(k=0; k&lt;NbConstraints; k++)
02934           <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a65">value_posz_p</a>(tmpC[k]))<font class="keyword"> </font>{
02935             <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a24">value_gt</a>(cmax,tmpC[k]))<font class="keyword"> </font>{
02936               <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(cmax,tmpC[k]);
02937               j = k;
02938             }
02939           }
02940         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(cmax);
02941         <font class="keywordflow">if</font> (j&lt;0) {
02942           <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"DomSimplify"</font>,<font class="stringliteral">"logerror"</font>,<font class="stringliteral">"logic error"</font>);
02943         }
02944         <font class="keywordflow">else</font> {
02945           <a class="code" href="polyhedron_8c.html#a38">addToFilter</a>(j, Filter, <a class="code" href="polyparam_8c.html#a6">Sat</a>, tmpR, tmpC, NbRays, NbConstraints);
02946           <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(P1-&gt;Constraint[j],Mat-&gt;p[Mat-&gt;NbRows],Dimension+1);
02947           Mat-&gt;NbRows++;
02948           <a class="code" href="arithmetique_8h.html#a50">value_decrement</a>(NbConstraintsLeft,NbConstraintsLeft);
02949         }
02950       }
02951       <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;<a class="code" href="polyparam_8c.html#a6">Sat</a>), <a class="code" href="polyparam_8c.html#a6">Sat</a> = NULL;
02952       free(tmpC), tmpC = NULL;
02953       free(tmpR), tmpR = NULL;
02954     }   
02955   } <font class="comment">/* end of TRY */</font>
02956   
02957   <font class="comment">/* Clear all the 'Value' variables */</font>
02958   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p3); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(NbConstraintsLeft);
02959   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
02960   <font class="keywordflow">for</font>(i=0;i&lt;NbRays;i++)
02961     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmpR[i]);
02962   <font class="keywordflow">for</font>(i=0;i&lt;NbRays;i++)
02963     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmpC[i]);
02964   
02965   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
02966 } <font class="comment">/* FindSimple */</font>
02967 
02968 <font class="comment">/* </font>
02969 <font class="comment"> * Return 0 if the intersection of Pol1 and Pol2 is empty, otherwise return 1.</font>
02970 <font class="comment"> * If the intersection is non-empty, store the non-redundant constraints in </font>
02971 <font class="comment"> * 'Filter' array. If the intersection is empty then store the smallest set of</font>
02972 <font class="comment"> * constraints of 'Pol1' which on intersection with 'Pol2' gives empty set, in</font>
02973 <font class="comment"> * 'Filter' array. 'NbMaxRays' is the maximum allowed rays in the intersection</font>
02974 <font class="comment"> *  of 'Pol1' and 'Pol2'.   </font>
02975 <font class="comment"> */</font>
<a name="l02976"></a><a class="code" href="polyhedron_8c.html#a40">02976</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="polyhedron_8c.html#a40">SimplifyConstraints</a>(Polyhedron *Pol1,Polyhedron *Pol2,<font class="keywordtype">unsigned</font> *Filter,<font class="keywordtype">unsigned</font> NbMaxRays)<font class="keyword"> </font>{
02977   
02978   Polyhedron *Pol = NULL;
02979   Matrix   *Mat = NULL, *Ray = NULL;
02980   <a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a6">Sat</a> = NULL;
02981   <font class="keywordtype">unsigned</font> NbRay, NbCon, NbCon1, NbCon2, NbEle1, Dimension, notempty;
02982 
02983   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
02984     <font class="keywordflow">if</font> (Pol) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(Pol);
02985     <font class="keywordflow">if</font> (Mat) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat);
02986     <font class="keywordflow">if</font> (Ray) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Ray);
02987     <font class="keywordflow">if</font> (Sat) <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;<a class="code" href="polyparam_8c.html#a6">Sat</a>);
02988     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
02989   }
02990   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
02991 
02992     NbRay         = Pol1-&gt;NbRays;
02993     NbCon1        = Pol1-&gt;NbConstraints;
02994     NbCon2        = Pol2-&gt;NbConstraints;
02995     NbCon         = NbCon1 + NbCon2;
02996     Dimension     = Pol1-&gt;Dimension+2;    <font class="comment">/* Homogeneous Dimension + Status */</font>
02997     NbEle1        = NbCon1*Dimension;
02998 
02999     <font class="comment">/* Allocate space for constraint matrix 'Mat' */</font>
03000     Mat = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbCon, Dimension);
03001     <font class="keywordflow">if</font>(!Mat) {
03002       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"SimplifyConstraints"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
03003       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03004       <font class="keywordflow">return</font> 0;
03005     }
03006 
03007     <font class="comment">/* Copy constraints of 'Pol1' to matrix 'Mat' */</font>
03008     <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Pol1-&gt;Constraint[0], Mat-&gt;p_Init, NbEle1);
03009     
03010     <font class="comment">/* Add constraints of 'Pol2' to matrix 'Mat'*/</font>
03011     <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Pol2-&gt;Constraint[0], Mat-&gt;p_Init+NbEle1, NbCon2*Dimension);
03012 
03013     <font class="comment">/* Allocate space for ray matrix 'Ray' */</font>
03014     Ray = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbMaxRays, Dimension);
03015     <font class="keywordflow">if</font>(!Ray) {
03016       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"SimplifyConstraints"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
03017       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03018       <font class="keywordflow">return</font> 0;
03019     }
03020     Ray-&gt;NbRows = NbRay;
03021         
03022     <font class="comment">/* Copy rays of polyhedron 'Pol1' to matrix 'Ray' */</font>
03023     <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Pol1-&gt;Ray[0], Ray-&gt;p_Init, NbRay*Dimension);
03024 
03025     <font class="comment">/* Create saturation matrix from constraint matrix 'Mat' and ray matrix */</font>
03026     <font class="comment">/* 'Ray'.                                                               */</font>
03027     <a class="code" href="polyparam_8c.html#a6">Sat</a> = <a class="code" href="polyhedron_8c.html#a27">BuildSat</a>(Mat, Ray, NbCon1, NbMaxRays);
03028 
03029     <font class="comment">/* Create the ray matrix 'Ray' from the constraint matrix 'Mat' */</font>
03030     Pol_status = <a class="code" href="polyhedron_8c.html#a14">Chernikova</a>(Mat, Ray, <a class="code" href="polyparam_8c.html#a6">Sat</a>, Pol1-&gt;NbBid, NbMaxRays, NbCon1,0);
03031 
03032     <font class="comment">/* Remove redundant constraints from the constraint matrix 'Mat' */</font>
03033     Pol = <a class="code" href="polyhedron_8c.html#a16">Remove_Redundants</a>(Mat, Ray, <a class="code" href="polyparam_8c.html#a6">Sat</a>, Filter);
03034     notempty = 1;
03035     <font class="keywordflow">if</font> (Filter &amp;&amp; emptyQ(Pol))<font class="keyword"> </font>{
03036       notempty = 0;
03037       <a class="code" href="polyhedron_8c.html#a39">FindSimple</a>(Pol1, Pol2, Filter, NbMaxRays);
03038     }
03039     <font class="comment">/* Polyhedron_Print(stderr,"%4d",Pol1); */</font>
03040 
03041     <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(Pol), Pol = NULL;
03042     <a class="code" href="polyparam_8c.html#a24">SMFree</a>(&amp;<a class="code" href="polyparam_8c.html#a6">Sat</a>), <a class="code" href="polyparam_8c.html#a6">Sat</a> = NULL;
03043     <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Ray), Ray = NULL;
03044     <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat), Mat = NULL;
03045     
03046   } <font class="comment">/* end of TRY */</font>
03047 
03048   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);  
03049   <font class="keywordflow">return</font> notempty;
03050 } <font class="comment">/* SimplifyConstraints */</font>
03051 
03052 <font class="comment">/* </font>
03053 <font class="comment"> * Eliminate equations of Pol1 using equations of Pol2. Mark as needed, </font>
03054 <font class="comment"> * equations of Pol1 that are not eliminated. Or info into Filter vector. </font>
03055 <font class="comment"> */</font>
<a name="l03056"></a><a class="code" href="polyhedron_8c.html#a41">03056</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="polyhedron_8c.html#a41">SimplifyEqualities</a>(Polyhedron *Pol1, Polyhedron *Pol2, <font class="keywordtype">unsigned</font> *Filter)<font class="keyword"> </font>{
03057 
03058   <font class="keywordtype">int</font> i,j;
03059   <font class="keywordtype">unsigned</font> ix, bx, NbEqn, NbEqn1, NbEqn2, NbEle2, Dimension;
03060   Matrix   *Mat;
03061 
03062   NbEqn1        = Pol1-&gt;NbEq;
03063   NbEqn2        = Pol2-&gt;NbEq;
03064   NbEqn         = NbEqn1 + NbEqn2;
03065   Dimension     = Pol1-&gt;Dimension+2;    <font class="comment">/* Homogeneous Dimension + Status */</font>
03066   NbEle2        = NbEqn2*Dimension;
03067 
03068   Mat = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbEqn, Dimension);
03069   <font class="keywordflow">if</font> (!Mat) {
03070     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"SimplifyEqualities"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
03071     Pol_status = 1;
03072     <font class="keywordflow">return</font>;
03073   }
03074 
03075   <font class="comment">/* Set the equalities of Pol2 */</font>
03076   <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Pol2-&gt;Constraint[0], Mat-&gt;p_Init, NbEle2);
03077 
03078   <font class="comment">/* Add the equalities of Pol1 */</font>
03079   <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(Pol1-&gt;Constraint[0], Mat-&gt;p_Init+NbEle2, NbEqn1*Dimension);
03080 
03081   <a class="code" href="polyhedron_8c.html#a15">Gauss</a>(Mat, NbEqn2, Dimension-1);
03082 
03083   ix = 0;
03084   bx = MSB;
03085   <font class="keywordflow">for</font> (i=NbEqn2; i&lt;NbEqn; i++) {
03086     <font class="keywordflow">for</font> (j=1; j&lt;Dimension; j++) {
03087       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat-&gt;p[i][j]))<font class="keyword"> </font>{ 
03088         <font class="comment">/* If any coefficient of the equation is non-zero */</font>    
03089         <font class="comment">/* Set the filter bit for the equation */</font>
03090         
03091         Filter[ix] |= bx;
03092         <font class="keywordflow">break</font>;
03093       }
03094     }
03095     NEXT(ix,bx);
03096   }
03097   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat);
03098   <font class="keywordflow">return</font>;
03099 } <font class="comment">/* SimplifyEqualities */</font>
03100 
03101  
03102 <font class="comment">/* </font>
03103 <font class="comment"> * Given two polyhedral domains 'Pol1' and 'Pol2', find the largest domain</font>
03104 <font class="comment"> * set (or the smallest list of non-redundant constraints), that when </font>
03105 <font class="comment"> * intersected with polyhedral domain 'Pol2' equals (Pol1)intersect(Pol2).</font>
03106 <font class="comment"> * The output is a polyhedral domain with the "redundant" constraints removed.</font>
03107 <font class="comment"> * 'NbMaxRays' is the maximium allowed rays in the new polyhedra. </font>
03108 <font class="comment"> */</font>
<a name="l03109"></a><a class="code" href="polyhedron_8c.html#a42">03109</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a42">DomainSimplify</a>(Polyhedron *Pol1, Polyhedron *Pol2, <font class="keywordtype">unsigned</font> NbMaxRays)<font class="keyword"> </font>{
03110   
03111   Polyhedron *p1, *p2, *p3, *d;
03112   <font class="keywordtype">unsigned</font> k, jx, bx, nbentries, NbConstraints, Dimension, NbCon, empty;
03113   <font class="keywordtype">unsigned</font> *Filter;
03114   Matrix *Constraints;
03115   
03116 
03117   <font class="keywordflow">if</font> (!Pol1 || !Pol2) <font class="keywordflow">return</font> Pol1;
03118   <font class="keywordflow">if</font> (Pol1-&gt;Dimension != Pol2-&gt;Dimension) {
03119     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"DomSimplify"</font>,<font class="stringliteral">"diffdim"</font>,<font class="stringliteral">"operation on different dimensions"</font>);
03120     Pol_status = 1;
03121     <font class="keywordflow">return</font> 0;
03122   }
03123   <font class="keywordflow">if</font> (emptyQ(Pol1)||emptyQ(Pol2)) 
03124     <font class="keywordflow">return</font> <a class="code" href="polyhedron_8c.html#a22">Empty_Polyhedron</a>(Pol1-&gt;Dimension);
03125 
03126   <font class="comment">/* Find the maximum number of constraints over all polyhedron in the  */</font>
03127   <font class="comment">/* polyhedral domain 'Pol2' and store in 'NbCon'.                     */</font>
03128   NbCon = 0;
03129   <font class="keywordflow">for</font> (p2=Pol2; p2; p2=p2-&gt;next)
03130     <font class="keywordflow">if</font> (p2-&gt;NbConstraints &gt; NbCon) 
03131       NbCon = p2-&gt;NbConstraints;
03132   
03133   Dimension = Pol1-&gt;Dimension+2;     <font class="comment">/* Homogenous Dimension + Status  */</font>
03134   d = (Polyhedron *)0;
03135   <font class="keywordflow">for</font> (p1=Pol1; p1; p1=p1-&gt;next) { 
03136     
03137     <font class="comment">/* Filter is an array of integers, each bit in an element of Filter */</font>
03138     <font class="comment">/* array corresponds to a constraint. The bit is marked 1 if the    */</font>
03139     <font class="comment">/* corresponding constraint is non-redundant and is 0 if it is      */</font>
03140     <font class="comment">/* redundant.                                                       */</font>
03141     
03142     NbConstraints = p1-&gt;NbConstraints;
03143     nbentries = (NbConstraints + NbCon - 1) / (<font class="keyword">sizeof</font>(int)*8) + 1;
03144 
03145     <font class="comment">/* Allocate space for array 'Filter' */</font>
03146     Filter  = (<font class="keywordtype">unsigned</font> *)malloc(nbentries * <font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
03147     <font class="keywordflow">if</font> (!Filter) {
03148       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"DomSimplify"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space\n"</font>);
03149       Pol_status = 1;
03150       <font class="keywordflow">return</font> 0;
03151     } 
03152     
03153     <font class="comment">/* Initialize 'Filter' with zeros */</font>
03154     <a class="code" href="polyhedron_8c.html#a4">SMVector_Init</a>(Filter, nbentries);
03155     
03156     <font class="comment">/* Filter the constraints of p1 in context of polyhedra p2(s) */</font>
03157     empty = 1;
03158     <font class="keywordflow">for</font> (p2=Pol2; p2; p2=p2-&gt;next) {
03159       
03160       <font class="comment">/* Store the non-redundant constraints in array 'Filter'. With    */</font>
03161       <font class="comment">/* successive loops, the array 'Filter' holds the union of all    */</font>
03162       <font class="comment">/* non-redundant constraints. 'empty' is set to zero if the       */</font>
03163       <font class="comment">/* intersection of two polyhedra is non-empty and Filter is !Null */</font>
03164       
03165       <a class="code" href="polyhedron_8c.html#a41">SimplifyEqualities</a>(p1, p2, Filter);
03166       <font class="keywordflow">if</font> (<a class="code" href="polyhedron_8c.html#a40">SimplifyConstraints</a>(p1, p2, Filter, NbMaxRays)) 
03167         empty=0;      
03168             
03169       <font class="comment">/* takes the union of all non redundant constraints */</font>
03170     }
03171 
03172     <font class="keywordflow">if</font> (!empty) {
03173       
03174       <font class="comment">/* Copy all non-redundant constraints to matrix 'Constraints' */</font>
03175       Constraints = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbConstraints, Dimension);
03176       <font class="keywordflow">if</font> (!Constraints) {
03177         <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"DomSimplify"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space\n"</font>);
03178         Pol_status = 1;
03179         <font class="keywordflow">return</font> 0;
03180       }
03181       Constraints-&gt;NbRows = 0;
03182       <font class="keywordflow">for</font> (k=0, jx=0, bx=MSB; k&lt;NbConstraints; k++) {
03183 
03184         <font class="comment">/* If a bit entry in Filter[jx] is marked 1, copy the correspond- */</font>
03185         <font class="comment">/* ing constraint in matrix 'Constraints'.                        */</font>
03186         <font class="keywordflow">if</font> (Filter[jx]&amp;bx) { 
03187           <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(p1-&gt;Constraint[k],
03188                       Constraints-&gt;p[Constraints-&gt;NbRows],
03189                       Dimension);
03190           Constraints-&gt;NbRows++;
03191         }
03192         NEXT(jx,bx);
03193       }
03194       
03195       <font class="comment">/* Create the polyhedron 'p3' corresponding to the constraints in   */</font>
03196       <font class="comment">/* matrix 'Constraints'.                                            */</font>
03197       p3 = <a class="code" href="polyhedron_8c.html#a24">Constraints2Polyhedron</a>(Constraints,NbMaxRays);
03198       <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Constraints);
03199       
03200       <font class="comment">/* Add polyhedron 'p3' in the domain 'd'. */</font>
03201       d = <a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a> (p3, d);
03202       p3 = NULL;
03203     }
03204     free(Filter);
03205   }
03206   <font class="keywordflow">if</font> (!d) 
03207     <font class="keywordflow">return</font> <a class="code" href="polyhedron_8c.html#a22">Empty_Polyhedron</a>(Pol1-&gt;Dimension); 
03208   <font class="keywordflow">else</font> <font class="keywordflow">return</font> d;
03209 
03210 } <font class="comment">/* DomainSimplify */</font>
03211 
03212 <font class="comment">/*</font>
03213 <font class="comment"> * Domain Simplify as defined in Strasborg Polylib version. </font>
03214 <font class="comment"> */</font>
<a name="l03215"></a><a class="code" href="polyhedron_8c.html#a43">03215</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a43">Stras_DomainSimplify</a>(Polyhedron *Pol1,Polyhedron *Pol2,<font class="keywordtype">unsigned</font> NbMaxRays)<font class="keyword"> </font>{
03216 
03217   Polyhedron *p1, *p2, *p3 = NULL, *d = NULL;
03218   <font class="keywordtype">unsigned</font> k, jx, bx, nbentries, NbConstraints, Dimension, NbCon, empty;
03219   <font class="keywordtype">unsigned</font>  *Filter = NULL;
03220   Matrix *Constraints = NULL;
03221   
03222   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
03223     <font class="keywordflow">if</font> (Constraints) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Constraints);
03224     <font class="keywordflow">if</font> (Filter) free(Filter);
03225     <font class="keywordflow">if</font> (d) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(d);
03226     <font class="keywordflow">if</font> (p2) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(p3);
03227     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
03228   }
03229   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
03230     <font class="keywordflow">if</font> (!Pol1 || !Pol2) {
03231       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03232       <font class="keywordflow">return</font> Pol1;
03233     }
03234     <font class="keywordflow">if</font> (Pol1-&gt;Dimension != Pol2-&gt;Dimension) {
03235       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"DomainSimplify"</font>,<font class="stringliteral">"diffdim"</font>,<font class="stringliteral">"operation on different dimensions"</font>);
03236       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03237       <font class="keywordflow">return</font> 0;
03238     }
03239     <font class="keywordflow">if</font> (emptyQ(Pol1)||emptyQ(Pol2))<font class="keyword"> </font>{
03240       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03241       <font class="keywordflow">return</font> <a class="code" href="polyhedron_8c.html#a22">Empty_Polyhedron</a>(Pol1-&gt;Dimension);
03242     }
03243     
03244     <font class="comment">/* Find the maximum number of constraints over all polyhedron in the  */</font>
03245     <font class="comment">/* polyhedral domain 'Pol2' and store in 'NbCon'.                     */</font>
03246     NbCon = 0;
03247     <font class="keywordflow">for</font> (p2=Pol2; p2; p2=p2-&gt;next)
03248       <font class="keywordflow">if</font> (p2-&gt;NbConstraints &gt; NbCon)
03249         NbCon = p2-&gt;NbConstraints;
03250     
03251     Dimension = Pol1-&gt;Dimension+2;      <font class="comment">/* Homogenous Dimension + Status  */</font>
03252     d = (Polyhedron *)0;
03253     <font class="keywordflow">for</font> (p1=Pol1; p1; p1=p1-&gt;next) { 
03254 
03255       <font class="comment">/* Filter is an array of integers, each bit in an element of Filter */</font>
03256       <font class="comment">/* array corresponds to a constraint. The bit is marked 1 if the    */</font>
03257       <font class="comment">/* corresponding constraint is non-redundant and is 0 if it is      */</font>
03258       <font class="comment">/* redundant.                                                       */</font>
03259       
03260       NbConstraints = p1-&gt;NbConstraints;
03261       nbentries = (NbConstraints + NbCon - 1)/(<font class="keyword">sizeof</font>(int)*8) + 1;
03262       
03263       <font class="comment">/* Allocate space for array 'Filter' */</font>
03264       Filter  = (<font class="keywordtype">unsigned</font> *)malloc(nbentries * <font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
03265       <font class="keywordflow">if</font>(!Filter) {
03266         <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"DomainSimplify"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
03267         <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03268         <font class="keywordflow">return</font> 0;
03269       }
03270       
03271       <font class="comment">/* Initialize 'Filter' with zeros */</font>
03272       <a class="code" href="polyhedron_8c.html#a4">SMVector_Init</a>(Filter, nbentries);
03273       
03274       <font class="comment">/* Filter the constraints of p1 in context to the polyhedra p2(s)   */</font>
03275       empty = 1;
03276       <font class="keywordflow">for</font> (p2=Pol2; p2; p2=p2-&gt;next) {
03277         
03278         <font class="comment">/* Store the non-redundant constraints in array 'Filter'. With    */</font>
03279         <font class="comment">/* successive loops, the array 'Filter' holds the union of all    */</font>
03280         <font class="comment">/* non-redundant constraints. 'empty' is set to zero if the       */</font>
03281         <font class="comment">/* intersection of two polyhedra is non-empty and Filter is !Null */</font>
03282    
03283         <font class="keywordflow">if</font> (<a class="code" href="polyhedron_8c.html#a40">SimplifyConstraints</a>(p1, p2, Filter, NbMaxRays))
03284           empty=0;
03285       }
03286       
03287       <font class="keywordflow">if</font> (!empty) {
03288         
03289         <font class="comment">/* Copy all non-redundant constraints to matrix 'Constraints' */</font>
03290         Constraints = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbConstraints,Dimension);
03291         <font class="keywordflow">if</font>(!Constraints) {
03292           <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"DomainSimplify"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
03293           <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03294           <font class="keywordflow">return</font> 0;
03295         }
03296         Constraints-&gt;NbRows = 0;
03297         <font class="keywordflow">for</font> (k=0, jx=0, bx=MSB; k&lt;NbConstraints; k++) {
03298           
03299           <font class="comment">/* If a bit entry in Filter[jx] is marked 1, copy the correspond- */</font>
03300           <font class="comment">/* ing constraint in matrix 'Constraints'.                        */</font>
03301           <font class="keywordflow">if</font> (Filter[jx]&amp;bx) { 
03302             <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(p1-&gt;Constraint[k],
03303                         Constraints-&gt;p[Constraints-&gt;NbRows],
03304                         Dimension);
03305             Constraints-&gt;NbRows++;
03306           }
03307           NEXT(jx,bx);
03308         }
03309         
03310         <font class="comment">/* Create the polyhedron 'p3' corresponding to the constraints in   */</font>
03311         <font class="comment">/* matrix 'Constraints'.                                            */</font>
03312         p3 = <a class="code" href="polyhedron_8c.html#a24">Constraints2Polyhedron</a>(Constraints,NbMaxRays);
03313         <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Constraints), Constraints = NULL;
03314         
03315         <font class="comment">/* Add polyhedron 'p3' in the domain 'd'. */</font>
03316         d = <a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a> (p3, d);
03317         p3 = NULL;
03318       }
03319       free(Filter), Filter = NULL;
03320     }
03321   } <font class="comment">/* end of TRY */</font>
03322         
03323   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);  
03324   <font class="keywordflow">if</font> (!d)
03325     <font class="keywordflow">return</font> <a class="code" href="polyhedron_8c.html#a22">Empty_Polyhedron</a>(Pol1-&gt;Dimension);
03326   <font class="keywordflow">else</font>
03327     <font class="keywordflow">return</font> d;
03328 } <font class="comment">/* DomainSimplify */</font>
03329 
03330 <font class="comment">/*</font>
03331 <font class="comment"> * Return the Union of two polyhedral domains 'Pol1' and Pol2'. The result is</font>
03332 <font class="comment"> * a new polyhedral domain.</font>
03333 <font class="comment"> */</font>
<a name="l03334"></a><a class="code" href="polyhedron_8c.html#a44">03334</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a44">DomainUnion</a>(Polyhedron *Pol1,Polyhedron *Pol2,<font class="keywordtype">unsigned</font> NbMaxRays)<font class="keyword"> </font>{
03335 
03336   Polyhedron *PolA, *PolEndA, *PolB, *PolEndB, *p1, *p2;
03337   <font class="keywordtype">int</font> Redundant;
03338   
03339   <font class="keywordflow">if</font> (!Pol1 || !Pol2) <font class="keywordflow">return</font> (Polyhedron *) 0;
03340   <font class="keywordflow">if</font> (Pol1-&gt;Dimension != Pol2-&gt;Dimension) {
03341     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"DomainUnion"</font>,<font class="stringliteral">"diffdim"</font>,<font class="stringliteral">"operation on different dimensions"</font>);
03342     <font class="keywordflow">return</font> (Polyhedron*) 0;
03343   }
03344 
03345 
03346 
03347 
03348 
03349 
03350   <font class="comment">/* Copy 'Pol1' to 'PolA' */</font>
03351   PolA = PolEndA = (Polyhedron *)0;
03352   <font class="keywordflow">for</font> (p1=Pol1; p1; p1=p1-&gt;next) {
03353     
03354     <font class="comment">/* Does any component of 'Pol2' cover 'p1' ? */</font>
03355     Redundant = 0;
03356     <font class="keywordflow">for</font> (p2=Pol2; p2; p2=p2-&gt;next) {
03357       <font class="keywordflow">if</font> (<a class="code" href="polyhedron_8c.html#a29">PolyhedronIncludes</a>(p2, p1) )<font class="keyword"> </font>{ <font class="comment">/* p2 covers p1 */</font> 
03358         Redundant = 1;
03359         
03360 
03361         <font class="keywordflow">break</font>;
03362 
03363       }
03364     }
03365     <font class="keywordflow">if</font> (!Redundant) {
03366       
03367       <font class="comment">/* Add 'p1' to 'PolA' */</font>
03368       <font class="keywordflow">if</font> (!PolEndA)
03369         PolEndA = PolA = <a class="code" href="polyhedron_8c.html#a36">Polyhedron_Copy</a>(p1);
03370       <font class="keywordflow">else</font> {
03371         PolEndA-&gt;next = <a class="code" href="polyhedron_8c.html#a36">Polyhedron_Copy</a>(p1);
03372         PolEndA = PolEndA-&gt;next;
03373       }
03374 
03375     }
03376   }
03377 
03378   <font class="comment">/* Copy 'Pol2' to PolB */</font>
03379   PolB = PolEndB = (Polyhedron *)0;
03380   <font class="keywordflow">for</font> (p2=Pol2; p2; p2=p2-&gt;next) {
03381 
03382     <font class="comment">/* Does any component of PolA cover 'p2' ? */</font>
03383     Redundant = 0;
03384     <font class="keywordflow">for</font> (p1=PolA; p1; p1=p1-&gt;next) {
03385       <font class="keywordflow">if</font> (<a class="code" href="polyhedron_8c.html#a29">PolyhedronIncludes</a>(p1, p2))<font class="keyword"> </font>{ <font class="comment">/* p1 covers p2 */</font>
03386         Redundant = 1;
03387         <font class="keywordflow">break</font>;
03388       }
03389     }
03390     <font class="keywordflow">if</font> (!Redundant) {
03391       
03392       <font class="comment">/* Add 'p2' to 'PolB' */</font>
03393       <font class="keywordflow">if</font> (!PolEndB)
03394         PolEndB = PolB = <a class="code" href="polyhedron_8c.html#a36">Polyhedron_Copy</a>(p2);
03395       <font class="keywordflow">else</font> {
03396         PolEndB-&gt;next = <a class="code" href="polyhedron_8c.html#a36">Polyhedron_Copy</a>(p2);
03397         PolEndB = PolEndB-&gt;next;
03398       }
03399 
03400 
03401     }
03402   }
03403 
03404   <font class="keywordflow">if</font> (!PolA) <font class="keywordflow">return</font> PolB;
03405   PolEndA-&gt;next = PolB;
03406   <font class="keywordflow">return</font> PolA;
03407 } <font class="comment">/* DomainUnion */</font>
03408 
03409 <font class="comment">/* </font>
03410 <font class="comment"> * Given a polyhedral domain 'Pol', concatenate the lists of rays and lines </font>
03411 <font class="comment"> * of the two (or more) polyhedra in the domain into one combined list, and </font>
03412 <font class="comment"> * find the set of constraints which tightly bound all of those objects. </font>
03413 <font class="comment"> * 'NbMaxConstrs' is the maximum allowed constraints in the new polyhedron. </font>
03414 <font class="comment"> */</font> 
<a name="l03415"></a><a class="code" href="polyhedron_8c.html#a45">03415</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a45">DomainConvex</a>(Polyhedron *Pol,<font class="keywordtype">unsigned</font> NbMaxConstrs)<font class="keyword"> </font>{
03416   
03417   Polyhedron *p, *q, *NewPol = NULL;
03418   
03419   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
03420     <font class="keywordflow">if</font> (NewPol) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(NewPol);
03421     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
03422   }
03423   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
03424     
03425     <font class="keywordflow">if</font> (!Pol) {
03426       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03427       <font class="keywordflow">return</font> (Polyhedron*) 0;
03428     }
03429     
03430     NewPol = <a class="code" href="polyhedron_8c.html#a36">Polyhedron_Copy</a>(Pol);
03431     <font class="keywordflow">for</font> (p=Pol-&gt;next; p; p=p-&gt;next) {
03432       q = <a class="code" href="polyhedron_8c.html#a34">AddRays</a>(p-&gt;Ray[0], p-&gt;NbRays, NewPol, NbMaxConstrs);
03433       <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(NewPol);
03434       NewPol = q;
03435     }
03436   } <font class="comment">/* end of TRY */</font>
03437   
03438   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03439   
03440   <font class="keywordflow">return</font> NewPol;
03441 } <font class="comment">/* DomainConvex */</font>
03442 
03443 <font class="comment">/*</font>
03444 <font class="comment"> * Given polyhedral domains 'Pol1' and 'Pol2', create a new polyhedral </font>
03445 <font class="comment"> * domain which is mathematically the differnce of the two domains. </font>
03446 <font class="comment"> */</font>
<a name="l03447"></a><a class="code" href="polyhedron_8c.html#a46">03447</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a46">DomainDifference</a>(Polyhedron *Pol1,Polyhedron *Pol2,<font class="keywordtype">unsigned</font> NbMaxRays)<font class="keyword"> </font>{
03448 
03449   Polyhedron *p1, *p2, *p3, *d;
03450   <font class="keywordtype">int</font> i;
03451   
03452   <font class="keywordflow">if</font> (!Pol1 || !Pol2) <font class="keywordflow">return</font> (Polyhedron*) 0;
03453   <font class="keywordflow">if</font> (Pol1-&gt;Dimension != Pol2-&gt;Dimension) {
03454     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"DomainDifference"</font>, 
03455               <font class="stringliteral">"diffdim"</font>, <font class="stringliteral">"operation on different dimensions"</font>);
03456     <font class="keywordflow">return</font> (Polyhedron*) 0;
03457   }
03458   <font class="keywordflow">if</font> (emptyQ(Pol2))
03459     <font class="keywordflow">return</font> (<a class="code" href="polyhedron_8c.html#a37">Domain_Copy</a>(Pol1));
03460   d = (Polyhedron *)0;
03461   <font class="keywordflow">for</font> (p2=Pol2; p2; p2=p2-&gt;next) {
03462     <font class="keywordflow">for</font> (p1=Pol1; p1; p1=p1-&gt;next) {
03463       <font class="keywordflow">for</font> (i=0; i&lt;p2-&gt;NbConstraints; i++) {
03464         
03465         <font class="comment">/* Add the constraint ( -p2-&gt;constraint[i] -1) &gt;= 0 in 'p1' */</font>
03466         <font class="comment">/* and create the new polyhedron 'p3'.                      */</font>
03467         p3 = <a class="code" href="polyhedron_8c.html#a31">SubConstraint</a>(p2-&gt;Constraint[i], p1, NbMaxRays,0);
03468         
03469         <font class="comment">/* Add 'p3' in the new domain 'd' */</font>
03470         d = <a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a> (p3, d);
03471         
03472         <font class="comment">/* If the constraint p2-&gt;constraint[i][0] is an equality, then  */</font>
03473         <font class="comment">/* add the constraint ( +p2-&gt;constraint[i] -1) &gt;= 0  in 'p1' and*/</font>
03474         <font class="comment">/* create the new polyhedron 'p3'.                              */</font>
03475         
03476         <font class="keywordflow">if</font>( <a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(p2-&gt;Constraint[i][0]) ) <font class="comment">/* Inequality */</font>
03477           <font class="keywordflow">continue</font>;  
03478         p3 = <a class="code" href="polyhedron_8c.html#a31">SubConstraint</a>(p2-&gt;Constraint[i], p1, NbMaxRays,1);
03479         
03480         <font class="comment">/* Add 'p3' in the new domain 'd' */</font>
03481         d = <a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a> (p3, d);
03482       }
03483     }
03484     Pol1 = d;
03485     d = (Polyhedron *)0;
03486   }
03487   <font class="keywordflow">if</font> (!Pol1)
03488     <font class="keywordflow">return</font> <a class="code" href="polyhedron_8c.html#a22">Empty_Polyhedron</a>(Pol2-&gt;Dimension);
03489   <font class="keywordflow">else</font>
03490     <font class="keywordflow">return</font> Pol1;
03491 } <font class="comment">/* DomainDifference */</font>
03492 
03493 <font class="comment">/*</font>
03494 <font class="comment"> * Given a polyhedral domain 'Pol', convert it to a new polyhedral domain </font>
03495 <font class="comment"> * with dimension expanded to 'align_dimension'. 'NbMaxRays' is the maximum</font>
03496 <font class="comment"> * allowed rays in the new polyhedra.</font>
03497 <font class="comment"> */</font>
<a name="l03498"></a><a class="code" href="polyhedron_8c.html#a47">03498</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a47">align_context</a>(Polyhedron *Pol,<font class="keywordtype">int</font> align_dimension,<font class="keywordtype">int</font> NbMaxRays)<font class="keyword"> </font>{
03499   
03500   <font class="keywordtype">int</font> i, j, k;
03501   Polyhedron *p = NULL, *q, *result = NULL;
03502   Matrix *Mat = NULL;
03503 
03504   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
03505     <font class="keywordflow">if</font> (Mat) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat);
03506     <font class="keywordflow">if</font> (result) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(result);
03507     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
03508   }
03509   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
03510     
03511     <font class="keywordflow">if</font> (!Pol) <font class="keywordflow">return</font> Pol;
03512     <font class="keywordflow">if</font> (align_dimension &lt; Pol-&gt;Dimension) {
03513       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"align_context"</font>, <font class="stringliteral">"diffdim"</font>, <font class="stringliteral">"context dimension exceeds data"</font>);
03514       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03515       <font class="keywordflow">return</font> Pol;
03516     }
03517     <font class="keywordflow">if</font> (align_dimension == Pol-&gt;Dimension) {
03518       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03519       <font class="keywordflow">return</font> Pol;
03520     }
03521 
03522     <font class="comment">/* 'k' is the dimension increment */</font>
03523     k = align_dimension - Pol-&gt;Dimension;
03524     result = NULL;
03525     p = NULL;
03526 
03527     <font class="comment">/* Expand the dimension of all polyhedron in the polyhedral domain 'Pol' */</font>
03528     <font class="keywordflow">for</font> (; Pol; Pol=Pol-&gt;next) {
03529       q = p;
03530       
03531       <font class="comment">/* Allocate space for the new constraint matrix with dimension expanded*/</font>
03532       <font class="comment">/* to align_dimension.                                                 */</font>
03533       Mat = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(Pol-&gt;NbConstraints, align_dimension + 2);
03534       <font class="keywordflow">if</font>(!Mat) {
03535         <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"align_context"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
03536         <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03537         <font class="keywordflow">return</font> 0;
03538       }
03539       
03540       <font class="comment">/* Initialize the constraint matrix 'Mat' with zeros. */</font>         
03541       <a class="code" href="vector_8c.html#a9">Vector_Set</a>(Mat-&gt;p[0],0,(Pol-&gt;NbConstraints) * (align_dimension + 2));
03542       
03543       <font class="comment">/* Each constraint in 'Pol' is mapped to k-zeros followed by the */</font>
03544       <font class="comment">/* constraint and is stored in constraint matrix 'Mat'.          */</font> 
03545       <font class="keywordflow">for</font> (i=0; i&lt;Pol-&gt;NbConstraints; i++) {
03546         <font class="keywordflow">for</font> (j=1; j&lt;=Pol-&gt;Dimension+1;j++) {
03547           <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Mat-&gt;p[i][k+j], Pol-&gt;Constraint[i][j]);
03548         }
03549         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Mat-&gt;p[i][0], Pol-&gt;Constraint[i][0]);  <font class="comment">/* Status bit */</font>
03550       }
03551       
03552       <font class="comment">/* Convert the constraint matrix 'Mat' into an equivalent polyhedron. */</font>
03553       p = <a class="code" href="polyhedron_8c.html#a24">Constraints2Polyhedron</a>(Mat, NbMaxRays);
03554       <font class="keywordflow">if</font> (q) q-&gt;next = p; <font class="keywordflow">else</font> result = p;
03555       <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat), Mat = NULL;
03556     }
03557   } <font class="comment">/* end of TRY */</font>
03558   
03559   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error); 
03560   <font class="keywordflow">return</font> result;
03561 } <font class="comment">/* align_context */</font>
03562 
03563 <font class="comment">/*----------------------------------------------------------------------*/</font>
03564 <font class="comment">/* Polyhedron *Polyhedron_Scan(D, C, NbMaxRays)                         */</font>
03565 <font class="comment">/*       D : Domain to be scanned (single polyhedron only)              */</font>
03566 <font class="comment">/*       C : Context domain                                             */</font>
03567 <font class="comment">/*       NbMaxRays : Workspace size                                     */</font>
03568 <font class="comment">/* Returns a linked list of scan domains, outer loop first              */</font>
03569 <font class="comment">/*----------------------------------------------------------------------*/</font>
<a name="l03570"></a><a class="code" href="polyhedron_8c.html#a48">03570</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a48">Polyhedron_Scan</a>(Polyhedron *D, Polyhedron *C,<font class="keywordtype">unsigned</font> NbMaxRays)<font class="keyword"> </font>{
03571   
03572   <font class="keywordtype">int</font> i, j, dim ;
03573   Matrix *Mat;
03574   Polyhedron *C1, *C2, *D1, *D2;
03575   Polyhedron *res, *last, *tmp;
03576   
03577   dim = D-&gt;Dimension - C-&gt;Dimension;
03578   res = last = (Polyhedron *) 0;
03579   <font class="keywordflow">if</font> (dim==0) <font class="keywordflow">return</font> (Polyhedron *)0;
03580   
03581   <font class="comment">/* Allocate space for constraint matrix. */</font>
03582   Mat   = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(D-&gt;Dimension, D-&gt;Dimension+2);
03583   <font class="keywordflow">if</font>(!Mat) {
03584     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Polyhedron_Scan"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space"</font>);
03585     <font class="keywordflow">return</font> 0;
03586   }
03587   C1  = <a class="code" href="polyhedron_8c.html#a47">align_context</a>(C,D-&gt;Dimension,NbMaxRays);
03588   <font class="keywordflow">if</font>(!C1) {
03589     <font class="keywordflow">return</font> 0;
03590   }
03591   <font class="comment">/* Vin100, aug 16, 2001:  The context is intersected with D */</font>
03592   D2 = <a class="code" href="polyhedron_8c.html#a32">DomainIntersection</a>( C1, D, NbMaxRays);
03593 
03594   <font class="keywordflow">for</font> (i=0; i&lt;dim; i++)
03595   {
03596     <a class="code" href="vector_8c.html#a9">Vector_Set</a>(Mat-&gt;p_Init,0,D2-&gt;Dimension*(D2-&gt;Dimension + 2));
03597     <font class="keywordflow">for</font> (j=i+1; j&lt;dim; j++) {
03598       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[j-i-1][j+1],1);
03599     }
03600     Mat-&gt;NbRows = dim-i-1;
03601     D1 = Mat-&gt;NbRows ? <a class="code" href="polyhedron_8c.html#a35">DomainAddRays</a>(D2, Mat, NbMaxRays) : D2;
03602     tmp = <a class="code" href="polyhedron_8c.html#a42">DomainSimplify</a>(D1, C1, NbMaxRays);
03603     <font class="keywordflow">if</font> (!last) res = last = tmp;
03604     <font class="keywordflow">else</font> { last-&gt;next = tmp; last = tmp; }
03605     C2 = <a class="code" href="polyhedron_8c.html#a32">DomainIntersection</a>(C1, D1, NbMaxRays);
03606     <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(C1);
03607     C1 = C2;
03608     <font class="keywordflow">if</font> (Mat-&gt;NbRows) <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(D1);
03609   }
03610   <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(D2);
03611   <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(C1);
03612   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat);
03613   <font class="keywordflow">return</font> res;
03614 } <font class="comment">/* Polyhedron_Scan */</font>
03615 
03616 <font class="comment">/*---------------------------------------------------------------------*/</font>
03617 <font class="comment">/* int lower_upper_bounds(pos,P,context,LBp,UBp)                       */</font>
03618 <font class="comment">/*    pos : index position of current loop index (1..hdim-1)           */</font>
03619 <font class="comment">/*    P: loop domain                                                   */</font>
03620 <font class="comment">/*    context : context values for fixed indices                       */</font>
03621 <font class="comment">/*              notice that context[hdim] must be 1                    */</font>
03622 <font class="comment">/*    LBp, UBp : pointers to resulting bounds                          */</font>
03623 <font class="comment">/* returns the flag = (UB_INFINITY, LB_INFINITY)                       */</font>
03624 <font class="comment">/*---------------------------------------------------------------------*/</font>
<a name="l03625"></a><a class="code" href="polyhedron_8c.html#a49">03625</a> <font class="keywordtype">int</font> <a class="code" href="polyhedron_8c.html#a49">lower_upper_bounds</a>(<font class="keywordtype">int</font> pos,Polyhedron *P,Value *context,Value *LBp,Value *UBp)<font class="keyword"> </font>{
03626   
03627   Value LB, UB;
03628   <font class="keywordtype">int</font> flag, i;
03629   Value <a class="code" href="polyparam_8c.html#a2">n</a>, n1, d, tmp;
03630   
03631   <font class="comment">/* Initialize all the 'Value' variables */</font>
03632   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(LB); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(UB); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
03633   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(<a class="code" href="polyparam_8c.html#a2">n</a>); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(n1); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(d);
03634   
03635   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(LB,0);
03636   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(UB,0);
03637   
03638   <font class="comment">/* Compute Upper Bound and Lower Bound for current loop */</font>
03639   flag = LB_INFINITY | UB_INFINITY;
03640   <font class="keywordflow">for</font> (i=0; i&lt;P-&gt;NbConstraints; i++) {
03641     <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(d,P-&gt;Constraint[i][pos]);
03642     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(d)) <font class="keywordflow">continue</font>;    
03643     <a class="code" href="vector_8c.html#a17">Inner_Product</a>(&amp;context[1],&amp;(P-&gt;Constraint[i][1]),P-&gt;Dimension+1,&amp;<a class="code" href="polyparam_8c.html#a2">n</a>);
03644     <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(<a class="code" href="polyparam_8c.html#a2">n</a>,<a class="code" href="polyparam_8c.html#a2">n</a>);
03645     
03646     <font class="comment">/*---------------------------------------------------*/</font>
03647     <font class="comment">/* Compute n/d        n/d&lt;0              n/d&gt;0       */</font>
03648     <font class="comment">/*---------------------------------------------------*/</font>
03649     <font class="comment">/*  n%d == 0    floor   = n/d      floor   = n/d     */</font>
03650     <font class="comment">/*              ceiling = n/d      ceiling = n/d     */</font>
03651     <font class="comment">/*---------------------------------------------------*/</font>
03652     <font class="comment">/*  n%d != 0    floor   = n/d - 1  floor   = n/d     */</font>
03653     <font class="comment">/*              ceiling = n/d      ceiling = n/d + 1 */</font>
03654     <font class="comment">/*---------------------------------------------------*/</font>
03655 
03656     <font class="comment">/* Check to see if constraint is inequality */</font>
03657     <font class="comment">/* if constraint is equality, both upper and lower bounds are fixed */</font>
03658     <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(P-&gt;Constraint[i][0]))<font class="keyword"> </font>{     <font class="comment">/* Equality */</font>
03659       <a class="code" href="arithmetique_8h.html#a52">value_modulus</a>(tmp,<a class="code" href="polyparam_8c.html#a2">n</a>,d);
03660       
03661       <font class="comment">/* if not integer, return 0; */</font>
03662       <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(tmp))<font class="keyword"> </font>{
03663         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(*LBp,1);
03664         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(*UBp,0);   <font class="comment">/* empty loop */</font>
03665         
03666         <font class="comment">/* Clear all the 'Value' variables */</font>
03667         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(LB); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(UB); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
03668         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(<a class="code" href="polyparam_8c.html#a2">n</a>); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(n1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(d);
03669         <font class="keywordflow">return</font> 0;
03670       }
03671       <a class="code" href="arithmetique_8h.html#a51">value_division</a>(n1,<a class="code" href="polyparam_8c.html#a2">n</a>,d);
03672       
03673       <font class="comment">/* Upper and Lower bounds found */</font>
03674       <font class="keywordflow">if</font>((flag&amp;LB_INFINITY) || <a class="code" href="arithmetique_8h.html#a24">value_gt</a>(n1,LB))
03675         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(LB,n1);
03676       <font class="keywordflow">if</font>((flag&amp;UB_INFINITY) || <a class="code" href="arithmetique_8h.html#a26">value_lt</a>(n1,UB))
03677         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(UB,n1);
03678       flag = 0;
03679     }
03680     
03681     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a63">value_pos_p</a>(d))<font class="keyword"> </font>{  <font class="comment">/* Lower Bound */</font>
03682       <a class="code" href="arithmetique_8h.html#a52">value_modulus</a>(tmp,<a class="code" href="polyparam_8c.html#a2">n</a>,d);
03683       
03684       <font class="comment">/* n1 = ceiling(n/d) */</font>
03685       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a63">value_pos_p</a>(<a class="code" href="polyparam_8c.html#a2">n</a>) &amp;&amp; <a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(tmp))<font class="keyword"> </font>{
03686         <a class="code" href="arithmetique_8h.html#a51">value_division</a>(n1,<a class="code" href="polyparam_8c.html#a2">n</a>,d);
03687         <a class="code" href="arithmetique_8h.html#a44">value_add_int</a>(n1,n1,1);
03688       }
03689       <font class="keywordflow">else</font>
03690         <a class="code" href="arithmetique_8h.html#a51">value_division</a>(n1,<a class="code" href="polyparam_8c.html#a2">n</a>,d);
03691       <font class="keywordflow">if</font> (flag&amp;LB_INFINITY) {
03692         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(LB,n1); 
03693         flag^=LB_INFINITY; 
03694       }
03695       <font class="keywordflow">else</font> <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a24">value_gt</a>(n1,LB))
03696         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(LB,n1);
03697     }
03698     
03699     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a64">value_neg_p</a>(d))<font class="keyword"> </font>{   <font class="comment">/* Upper Bound */</font>
03700       <a class="code" href="arithmetique_8h.html#a52">value_modulus</a>(tmp,<a class="code" href="polyparam_8c.html#a2">n</a>,d);
03701       
03702       <font class="comment">/* n1 = floor(n/d) */</font>
03703       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a63">value_pos_p</a>(<a class="code" href="polyparam_8c.html#a2">n</a>) &amp;&amp; <a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(tmp))<font class="keyword"> </font>{
03704         <a class="code" href="arithmetique_8h.html#a51">value_division</a>(n1,<a class="code" href="polyparam_8c.html#a2">n</a>,d);
03705         <a class="code" href="arithmetique_8h.html#a49">value_sub_int</a>(n1,n1,1);
03706       }
03707       <font class="keywordflow">else</font>
03708         <a class="code" href="arithmetique_8h.html#a51">value_division</a>(n1,<a class="code" href="polyparam_8c.html#a2">n</a>,d);
03709       
03710       <font class="keywordflow">if</font> (flag&amp;UB_INFINITY) {
03711         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(UB,n1); 
03712         flag^=UB_INFINITY; 
03713       }
03714       <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a26">value_lt</a>(n1,UB))
03715         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(UB, n1);
03716     }
03717   }
03718   <font class="keywordflow">if</font> ((flag &amp; LB_INFINITY)==0) <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(*LBp,LB);
03719   <font class="keywordflow">if</font> ((flag &amp; UB_INFINITY)==0) <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(*UBp,UB);
03720   
03721   <font class="comment">/* Clear all the 'Value' variables */</font>
03722   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(LB); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(UB); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
03723   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(<a class="code" href="polyparam_8c.html#a2">n</a>); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(n1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(d);
03724   <font class="keywordflow">return</font> flag;
03725 } <font class="comment">/* lower_upper_bounds */</font>
03726 
03727 <font class="comment">/*</font>
03728 <font class="comment"> * Given a polyhedron 'Pol' and a transformation matrix 'Func', return the </font>
03729 <font class="comment"> * polyhedron which when transformed by mapping function 'Func' gives 'Pol'. </font>
03730 <font class="comment"> * 'NbMaxRays' is the maximum number of rays that can be in the ray matrix </font>
03731 <font class="comment"> * of the resulting polyhedron.</font>
03732 <font class="comment"> */</font>
<a name="l03733"></a><a class="code" href="polyhedron_8c.html#a50">03733</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a50">Polyhedron_Preimage</a>(Polyhedron *Pol,Matrix *Func,<font class="keywordtype">unsigned</font> NbMaxRays)<font class="keyword"> </font>{
03734 
03735   Matrix *Constraints = NULL;
03736   Polyhedron *NewPol = NULL;
03737   <font class="keywordtype">unsigned</font> NbConstraints, Dimension1, Dimension2;
03738   <font class="keywordtype">int</font> i, j, k;
03739   Value Sum,tmp;
03740   
03741   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(Sum); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
03742   
03743   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
03744     <font class="keywordflow">if</font> (Constraints) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Constraints);
03745     <font class="keywordflow">if</font> (NewPol) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(NewPol);
03746     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Sum); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
03747     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
03748   }
03749   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
03750     
03751     NbConstraints = Pol-&gt;NbConstraints;
03752     Dimension1    = Pol-&gt;Dimension+1;   <font class="comment">/* Homogeneous Dimension */</font>
03753     Dimension2    = Func-&gt;NbColumns;    <font class="comment">/* Homogeneous Dimension */</font>
03754     <font class="keywordflow">if</font> (Dimension1!=(Func-&gt;NbRows)) {
03755       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Polyhedron_Preimage"</font>, <font class="stringliteral">"dimincomp"</font>, <font class="stringliteral">"incompatable dimensions"</font>);
03756       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03757       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Sum); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
03758       <font class="keywordflow">return</font> <a class="code" href="polyhedron_8c.html#a22">Empty_Polyhedron</a>(Dimension2-1);
03759     }
03760     
03761     <font class="comment">/*            Dim1           Dim2            Dim2</font>
03762 <font class="comment">                  __k__          __j__           __j__  </font>
03763 <font class="comment">            NbCon |   |  X   Dim1|   |  =  NbCon |   |</font>
03764 <font class="comment">              i   |___|       k  |___|       i   |___|</font>
03765 <font class="comment">            Pol-&gt;Constraints Function        Constraints</font>
03766 <font class="comment">    */</font>
03767   
03768     <font class="comment">/* Allocate space for the resultant constraint matrix */</font>
03769     Constraints = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbConstraints, Dimension2+1);
03770     <font class="keywordflow">if</font> (!Constraints) { 
03771       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Polyhedron_Preimage"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space\n"</font>);
03772       Pol_status = 1;
03773       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03774       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Sum); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
03775       <font class="keywordflow">return</font> 0;
03776     }
03777     
03778     <font class="comment">/* The new constraint matrix is the product of constraint matrix of the */</font>
03779     <font class="comment">/* polyhedron and the function matrix.                                  */</font>
03780     <font class="keywordflow">for</font> (i=0; i&lt;NbConstraints; i++) {
03781       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Constraints-&gt;p[i][0],Pol-&gt;Constraint[i][0]);
03782       <font class="keywordflow">for</font> (j=0; j&lt;Dimension2; j++) {
03783         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Sum,0);
03784         <font class="keywordflow">for</font> (k=0; k&lt;Dimension1; k++) {
03785           
03786           <font class="comment">/* Sum+=Pol-&gt;Constraint[i][k+1] * Func-&gt;p[k][j]; */</font>
03787           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp,Pol-&gt;Constraint[i][k+1],Func-&gt;p[k][j]);
03788           <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(Sum,Sum,tmp);
03789         }
03790         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Constraints-&gt;p[i][j+1],Sum);
03791       }
03792     }
03793     NewPol = <a class="code" href="polyhedron_8c.html#a24">Constraints2Polyhedron</a>(Constraints, NbMaxRays);
03794     <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Constraints), Constraints = NULL;
03795     
03796   } <font class="comment">/* end of TRY */</font>
03797   
03798   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Sum); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
03799   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03800   
03801   <font class="keywordflow">return</font> NewPol;
03802 } <font class="comment">/* Polyhedron_Preimage */</font>
03803 
03804 <font class="comment">/*</font>
03805 <font class="comment"> * Given a polyhedral domain 'Pol' and a transformation matrix 'Func', return </font>
03806 <font class="comment"> * the polyhedral domain which when transformed by mapping function 'Func' </font>
03807 <font class="comment"> * gives 'Pol'. 'NbMaxRays' is the maximum number of rays that can be in the </font>
03808 <font class="comment"> * ray matrix of the resulting domain.</font>
03809 <font class="comment"> */</font>
<a name="l03810"></a><a class="code" href="polyhedron_8c.html#a51">03810</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a51">DomainPreimage</a>(Polyhedron *Pol,Matrix *Func,<font class="keywordtype">unsigned</font> NbMaxRays)<font class="keyword"> </font>{
03811   
03812   Polyhedron *p, *q, *d = NULL;
03813   
03814   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
03815     <font class="keywordflow">if</font> (d) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(d);
03816     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
03817   }
03818   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
03819     <font class="keywordflow">if</font> (!Pol || !Func) {
03820       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03821       <font class="keywordflow">return</font> (Polyhedron *) 0;
03822     }
03823     d = (Polyhedron *) 0;
03824     <font class="keywordflow">for</font> (p=Pol; p; p=p-&gt;next) {
03825       q = <a class="code" href="polyhedron_8c.html#a50">Polyhedron_Preimage</a>(p, Func, NbMaxRays);
03826       d = <a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a> (q, d);
03827     } 
03828   } <font class="comment">/* end of TRY */</font>
03829   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03830   <font class="keywordflow">return</font> d;
03831 } <font class="comment">/* DomainPreimage */</font>
03832 
03833 <font class="comment">/*</font>
03834 <font class="comment"> * Transform a polyhedron 'Pol' into another polyhedron according to a given</font>
03835 <font class="comment"> * affine mapping function 'Func'. 'NbMaxConstrs' is the maximum number of </font>
03836 <font class="comment"> * constraints that can be in the constraint matrix of the new polyhedron. </font>
03837 <font class="comment"> */</font>
<a name="l03838"></a><a class="code" href="polyhedron_8c.html#a52">03838</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a52">Polyhedron_Image</a>(Polyhedron *Pol, Matrix *Func,<font class="keywordtype">unsigned</font> NbMaxConstrs)<font class="keyword"> </font>{
03839   
03840   Matrix *Rays = NULL;
03841   Polyhedron *NewPol = NULL;
03842   <font class="keywordtype">unsigned</font> NbRays, Dimension1, Dimension2;
03843   <font class="keywordtype">int</font> i, j, k;
03844   Value Sum, tmp;
03845   
03846   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(Sum); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
03847 
03848   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
03849     <font class="keywordflow">if</font> (Rays) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Rays);
03850     <font class="keywordflow">if</font> (NewPol) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(NewPol);
03851     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Sum); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
03852     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
03853   }
03854   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
03855   
03856     NbRays     = Pol-&gt;NbRays;
03857     Dimension1 = Pol-&gt;Dimension+1;      <font class="comment">/* Homogeneous Dimension */</font>
03858     Dimension2 = Func-&gt;NbRows;          <font class="comment">/* Homogeneous Dimension */</font>
03859     <font class="keywordflow">if</font> (Dimension1!=Func-&gt;NbColumns) {
03860       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Polyhedron_Image"</font>, <font class="stringliteral">"dimincomp"</font>, <font class="stringliteral">"incompatable dimensions"</font>);
03861       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03862       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Sum); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
03863       <font class="keywordflow">return</font> <a class="code" href="polyhedron_8c.html#a22">Empty_Polyhedron</a>(Dimension2-1);
03864     }
03865     
03866     <font class="comment">/*   </font>
03867 <font class="comment">        Dim1     /      Dim1  \Transpose      Dim2</font>
03868 <font class="comment">        __k__    |      __k__ |              __j__</font>
03869 <font class="comment">  NbRays|   |  X | Dim2 |   | |     =  NbRays|   |</font>
03870 <font class="comment">    i   |___|    |   j  |___| |          i   |___|</font>
03871 <font class="comment">     Pol-&gt;Rays  \       Func /               Rays</font>
03872 <font class="comment"></font>
03873 <font class="comment">    */</font>
03874     
03875     
03876     <font class="comment">/* Allocate space for the resultant ray matrix */</font>
03877     Rays = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(NbRays, Dimension2+1);
03878     <font class="keywordflow">if</font> (!Rays) {
03879       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Polyhedron_Image"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space\n"</font>);
03880       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03881       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Sum); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
03882       <font class="keywordflow">return</font> 0;
03883     }
03884     
03885     <font class="comment">/* The new ray space is the product of ray matrix of the polyhedron and */</font>
03886     <font class="comment">/* the transpose matrix of the mapping function.                        */</font>
03887     <font class="keywordflow">for</font> (i=0; i&lt;NbRays; i++) {
03888       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Rays-&gt;p[i][0],Pol-&gt;Ray[i][0]);
03889       <font class="keywordflow">for</font> (j=0; j&lt;Dimension2; j++) {
03890         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Sum,0);
03891         <font class="keywordflow">for</font> (k=0; k&lt;Dimension1; k++) {
03892           
03893           <font class="comment">/* Sum+=Pol-&gt;Ray[i][k+1] * Func-&gt;p[j][k]; */</font>
03894           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp,Pol-&gt;Ray[i][k+1],Func-&gt;p[j][k]);
03895           <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(Sum,Sum,tmp);
03896         }
03897         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Rays-&gt;p[i][j+1],Sum);
03898       }
03899     }
03900     NewPol = <a class="code" href="polyhedron_8c.html#a26">Rays2Polyhedron</a>(Rays, NbMaxConstrs);
03901     <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Rays), Rays = NULL;
03902     
03903   } <font class="comment">/* end of TRY */</font>
03904   
03905   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03906   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(Sum); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
03907   <font class="keywordflow">return</font> NewPol;
03908 } <font class="comment">/* Polyhedron_Image */</font>
03909 
03910 <font class="comment">/* </font>
03911 <font class="comment"> *Transform a polyhedral domain 'Pol' into another domain according to a given</font>
03912 <font class="comment"> * affine mapping function 'Func'. 'NbMaxConstrs' is the maximum number of </font>
03913 <font class="comment"> * constraints that can be in the constraint matrix of the resulting domain. </font>
03914 <font class="comment"> */</font>
<a name="l03915"></a><a class="code" href="polyhedron_8c.html#a53">03915</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a53">DomainImage</a>(Polyhedron *Pol,Matrix *Func,<font class="keywordtype">unsigned</font> NbMaxConstrs)<font class="keyword"> </font>{
03916 
03917   Polyhedron *p, *q, *d = NULL;
03918 
03919   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
03920     <font class="keywordflow">if</font> (d) <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(d);
03921     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
03922   }
03923   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
03924     
03925     <font class="keywordflow">if</font> (!Pol || !Func) {
03926       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03927       <font class="keywordflow">return</font> (Polyhedron *) 0;
03928     }
03929     d = (Polyhedron *) 0;
03930     <font class="keywordflow">for</font> (p=Pol; p; p=p-&gt;next) { 
03931       q = <a class="code" href="polyhedron_8c.html#a52">Polyhedron_Image</a>(p, Func, NbMaxConstrs);
03932       d = <a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a> (q, d);
03933     }
03934   } <font class="comment">/* end of TRY */</font>
03935   
03936   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03937   
03938   <font class="keywordflow">return</font> d;
03939 } <font class="comment">/* DomainImage */</font>
03940 
03941 <font class="comment">/* </font>
03942 <font class="comment"> * Given a polyhedron 'Pol' and an affine cost function 'Cost', compute the </font>
03943 <font class="comment"> * maximum and minimum value of the function over set of points representing</font>
03944 <font class="comment"> * polyhedron. </font>
03945 <font class="comment"> * Note: If Polyhedron 'Pol' is empty, then there is no feasible solution. </font>
03946 <font class="comment"> * Otherwise, if there is a bidirectional ray with Sum[cost(i)*ray(i)] != 0 or</font>
03947 <font class="comment"> * a unidirectional ray with Sum[cost(i)*ray(i)] &gt;0, then the maximum is un-</font>
03948 <font class="comment"> * bounded else the finite optimal solution occurs at one of the vertices of</font>
03949 <font class="comment"> * the polyhderon. </font>
03950 <font class="comment"> */</font>
<a name="l03951"></a><a class="code" href="polyhedron_8c.html#a54">03951</a> Interval *<a class="code" href="polyhedron_8c.html#a54">DomainCost</a>(Polyhedron *Pol,Value *Cost)<font class="keyword"> </font>{
03952   
03953   <font class="keywordtype">int</font> i, j, NbRay, Dim;
03954   Value *p1, *p2, p3, d, status;
03955   Value tmp1, tmp2, tmp3;
03956   Value **Ray;
03957   Interval *I = NULL;
03958 
03959   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(p3); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(d); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(status);
03960   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp1); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp2); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp3);
03961 
03962   <a class="code" href="arithmetic__errors_8h.html#a4">CATCH</a>(any_exception_error)<font class="keyword"> </font>{
03963     <font class="keywordflow">if</font> (I) free(I);
03964     <a class="code" href="arithmetic__errors_8h.html#a7">RETHROW</a>();
03965     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p3); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(d); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(status);
03966     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp3);
03967   }
03968   <a class="code" href="arithmetic__errors_8h.html#a6">TRY</a> {
03969     
03970     Ray = Pol-&gt;Ray;
03971     NbRay = Pol-&gt;NbRays;
03972     Dim = Pol-&gt;Dimension+1;             <font class="comment">/* Homogenous Dimension */</font>
03973     I = (Interval *) malloc (<font class="keyword">sizeof</font>(Interval));
03974     <font class="keywordflow">if</font> (!I) {
03975       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"DomainCost"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space\n"</font>);
03976       <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
03977       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p3); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(d); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(status);
03978       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp3);
03979       <font class="keywordflow">return</font> 0;
03980     }
03981     
03982     <font class="comment">/* The maximum and minimum values of the cost function over polyhedral  */</font>
03983     <font class="comment">/* domain is stored in 'I'. I-&gt;MaxN and I-&gt;MaxD store the numerator and */</font>
03984     <font class="comment">/* denominator of the maximum value. Likewise,I-&gt;MinN and I-&gt;MinD store */</font>
03985     <font class="comment">/* the numerator and denominator of the minimum value. I-&gt;MaxI and      */</font>
03986     <font class="comment">/* I-&gt;MinI store the ray indices corresponding to the max and min values*/</font>
03987     <font class="comment">/* of the function.                                                     */</font>
03988     
03989     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(I-&gt;MaxN,-1);
03990     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(I-&gt;MaxD,0);          <font class="comment">/* Actual cost is MaxN/MaxD */</font>
03991     I-&gt;MaxI = -1;
03992     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(I-&gt;MinN,1);
03993     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(I-&gt;MinD,0);
03994     I-&gt;MinI = -1;
03995     
03996     <font class="comment">/* Compute the cost of each ray[i] */</font>
03997     <font class="keywordflow">for</font> (i=0; i&lt;NbRay; i++) {
03998       p1 = Ray[i];
03999       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(status, *p1);
04000       p1++;
04001       p2 = Cost;
04002       
04003       <font class="comment">/* p3 = *p1++ * *p2++; */</font>
04004       <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(p3,*p1,*p2);
04005       p1++; p2++;
04006       <font class="keywordflow">for</font> (j=1; j&lt;Dim; j++) {
04007         <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp1,*p1,*p2);
04008         
04009         <font class="comment">/* p3 += *p1++ * *p2++; */</font>
04010         <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(p3,p3,tmp1);
04011         p1++; p2++;
04012       }
04013       
04014       <font class="comment">/* d = *--p1; */</font>
04015       p1--;
04016       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(d,*p1); <font class="comment">/* d == 0 for lines and ray, non-zero for vertex */</font>
04017       <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp1,p3,I-&gt;MaxD); 
04018       <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp2,I-&gt;MaxN,d);
04019       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp3,1);
04020       
04021       <font class="comment">/* Compare p3/d with MaxN/MaxD to assign new maximum cost value */</font>
04022       <font class="keywordflow">if</font> (I-&gt;MaxI==-1 ||
04023           <a class="code" href="arithmetique_8h.html#a24">value_gt</a>(tmp1,tmp2) ||
04024           (<a class="code" href="arithmetique_8h.html#a22">value_eq</a>(tmp1,tmp2) &amp;&amp;
04025            <a class="code" href="arithmetique_8h.html#a22">value_eq</a>(d,tmp3) &amp;&amp; <a class="code" href="arithmetique_8h.html#a23">value_ne</a>(I-&gt;MaxD,tmp3)))<font class="keyword"> </font>{
04026         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(I-&gt;MaxN,p3);
04027         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(I-&gt;MaxD,d);
04028         I-&gt;MaxI = i;
04029       }
04030       <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp1,p3,I-&gt;MinD);
04031       <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp2,I-&gt;MinN,d);
04032       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp3,1);
04033       
04034       <font class="comment">/* Compare p3/d with MinN/MinD to assign new minimum cost value */</font>
04035       <font class="keywordflow">if</font> (I-&gt;MinI==-1 ||
04036           <a class="code" href="arithmetique_8h.html#a26">value_lt</a>(tmp1,tmp2) ||
04037           (<a class="code" href="arithmetique_8h.html#a22">value_eq</a>(tmp1,tmp2) &amp;&amp;
04038            <a class="code" href="arithmetique_8h.html#a22">value_eq</a>(d,tmp3) &amp;&amp; <a class="code" href="arithmetique_8h.html#a23">value_ne</a>(I-&gt;MinD,tmp3)))<font class="keyword"> </font>{
04039         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(I-&gt;MinN, p3);
04040         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(I-&gt;MinD, d);
04041         I-&gt;MinI = i;
04042       }
04043       <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp1,p3,I-&gt;MaxD);
04044       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp2,0);
04045       
04046       <font class="comment">/* If there is a line, assign max to +infinity and min to -infinity */</font>
04047       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(status))<font class="keyword"> </font>{ <font class="comment">/* line , d is 0 */</font>
04048         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a26">value_lt</a>(tmp1,tmp2))<font class="keyword"> </font>{
04049           <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(I-&gt;MaxN,p3);
04050           <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(I-&gt;MaxD,0);
04051           I-&gt;MaxI = i;
04052         }
04053         <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp1,p3,I-&gt;MinD);
04054         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp2,0);
04055 
04056         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a24">value_gt</a>(tmp1,tmp2))<font class="keyword"> </font>{
04057           <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(I-&gt;MinN,p3);
04058           <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(I-&gt;MinD,0);
04059           I-&gt;MinI = i;
04060         }
04061       }
04062     }
04063   } <font class="comment">/* end of TRY */</font>
04064   
04065   <a class="code" href="arithmetic__errors_8h.html#a5">UNCATCH</a>(any_exception_error);
04066   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p3); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(d); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(status);
04067   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp3);
04068   <font class="keywordflow">return</font> I;
04069 } <font class="comment">/* DomainCost */</font>
04070 
04071 <font class="comment">/* </font>
04072 <font class="comment"> * Add constraints pointed by 'Mat' to each and every polyhedron in the </font>
04073 <font class="comment"> * polyhedral domain 'Pol'. 'NbMaxRays' is maximum allowed rays in the ray </font>
04074 <font class="comment"> * matrix of a polyhedron.</font>
04075 <font class="comment"> */</font>
<a name="l04076"></a><a class="code" href="polyhedron_8c.html#a55">04076</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a55">DomainAddConstraints</a>(Polyhedron *Pol,Matrix *Mat,<font class="keywordtype">unsigned</font> NbMaxRays)<font class="keyword"> </font>{
04077 
04078   Polyhedron *PolA, *PolEndA, *p1, *p2, *p3;
04079   <font class="keywordtype">int</font> Redundant;
04080   
04081   <font class="keywordflow">if</font> (!Pol) <font class="keywordflow">return</font> (Polyhedron*) 0;
04082   <font class="keywordflow">if</font> (!Mat) <font class="keywordflow">return</font> Pol;
04083   <font class="keywordflow">if</font> (Pol-&gt;Dimension != Mat-&gt;NbColumns-2) {
04084     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"DomainAddConstraints"</font>,
04085               <font class="stringliteral">"diffdim"</font>, <font class="stringliteral">"operation on different dimensions"</font>);
04086     <font class="keywordflow">return</font> (Polyhedron*) 0;
04087   }
04088   
04089   <font class="comment">/* Copy 'Pol' to 'PolA' */</font>
04090   PolA = PolEndA = (Polyhedron *)0;
04091   <font class="keywordflow">for</font> (p1=Pol; p1; p1=p1-&gt;next) {
04092     p3 = <a class="code" href="polyhedron_8c.html#a28">AddConstraints</a>(Mat-&gt;p_Init, Mat-&gt;NbRows, p1, NbMaxRays);
04093     
04094     <font class="comment">/* Does any component of 'PolA' cover 'p3' */</font>
04095     Redundant = 0;
04096     <font class="keywordflow">for</font> (p2=PolA; p2; p2=p2-&gt;next) {
04097       <font class="keywordflow">if</font> (<a class="code" href="polyhedron_8c.html#a29">PolyhedronIncludes</a>(p2, p3))<font class="keyword"> </font>{ <font class="comment">/* 'p2' covers 'p3' */</font>
04098         Redundant = 1;
04099         <font class="keywordflow">break</font>;
04100       }
04101     }
04102     
04103     <font class="comment">/* If the new polyhedron 'p3' is not redundant, add it to the domain */</font>
04104     <font class="keywordflow">if</font> (!Redundant) { 
04105       
04106       <font class="comment">/* Add 'p3' to 'PolA' */</font>
04107       <font class="keywordflow">if</font> (!PolEndA)
04108         PolEndA = PolA = p3;
04109       <font class="keywordflow">else</font> {
04110         PolEndA-&gt;next = p3;
04111         PolEndA = PolEndA-&gt;next;
04112       }
04113     }
04114   }
04115   <font class="keywordflow">return</font> PolA;
04116 } <font class="comment">/* DomainAddConstraints */</font>
04117 
04118 
04119 <font class="comment">/* </font>
04120 <font class="comment"> * Computes the disjoint union of a union of polyhedra.</font>
04121 <font class="comment"> * If flag = 0 the result is such that there are no intersections</font>
04122 <font class="comment"> *                   between the resulting polyhedra,</font>
04123 <font class="comment"> * if flag = 1 it computes a joint union, the resulting polyhedra are</font>
04124 <font class="comment"> *                   adjacent (they have their facets in common).</font>
04125 <font class="comment"> *</font>
04126 <font class="comment"> * WARNING: if all polyhedra are not of same geometrical dimension</font>
04127 <font class="comment"> *          duplicates may appear.</font>
04128 <font class="comment"> */</font>
<a name="l04129"></a><a class="code" href="polyhedron_8c.html#a56">04129</a> Polyhedron *<a class="code" href="polyhedron_8c.html#a56">Disjoint_Domain</a>( Polyhedron *P, <font class="keywordtype">int</font> flag, <font class="keywordtype">unsigned</font> NbMaxRays )<font class="keyword"></font>
04130 <font class="keyword"></font>{
04131         Polyhedron *lP, *tmp, *Result, *lR, *prec, *reste;
04132         Polyhedron *p1, *p2, *p3, *Pol1, *dx, *d1, *d2, *pi, *newpi;
04133         <font class="keywordtype">int</font> i;
04134 
04135         <font class="keywordflow">if</font>( flag!=0 &amp;&amp; flag!=1 )
04136         {
04137                 <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"Disjoint_Domain"</font>,
04138                         <font class="stringliteral">"invalidarg"</font>, <font class="stringliteral">"flag should be equal to 0 or 1"</font>);
04139                 <font class="keywordflow">return</font> (Polyhedron*) 0;
04140         }
04141         <font class="keywordflow">if</font>(!P) <font class="keywordflow">return</font> (Polyhedron*) 0;
04142         <font class="keywordflow">if</font>(!P-&gt;next) <font class="keywordflow">return</font> <a class="code" href="polyhedron_8c.html#a36">Polyhedron_Copy</a>(P);
04143 
04144         Result = (Polyhedron *)0;
04145 
04146         <font class="keywordflow">for</font>(lP=P;lP;lP=lP-&gt;next)
04147         {
04148                 reste = <a class="code" href="polyhedron_8c.html#a36">Polyhedron_Copy</a>(lP);
04149                 prec = (Polyhedron *)0; <font class="comment">/* preceeding lR */</font>
04150                 <font class="comment">/* Intersection with each polyhedron of the current Result */</font>
04151                 lR=Result;
04152                 <font class="keywordflow">while</font>( lR &amp;&amp; reste )
04153                 {
04154                         <font class="comment">/* dx = DomainIntersection(reste,lR-&gt;P,WS); */</font>
04155                         dx = (Polyhedron *)0;
04156                         <font class="keywordflow">for</font>( p1=reste; p1; p1=p1-&gt;next )
04157                         {
04158                                 p3 = <a class="code" href="polyhedron_8c.html#a28">AddConstraints</a>(lR-&gt;Constraint[0], lR-&gt;NbConstraints, p1,
04159                                                 NbMaxRays);
04160                                 dx = <a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a>(p3,dx);
04161                         }
04162 
04163                         <font class="comment">/* if empty intersection, continue */</font>
04164                         <font class="keywordflow">if</font>(!dx)
04165                         {       prec = lR;
04166                                 lR=lR-&gt;next;
04167                                 <font class="keywordflow">continue</font>;
04168                         }
04169                         <font class="keywordflow">if</font> (emptyQ(dx))<font class="keyword"> </font>{       
04170                                 <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(dx);
04171                                 prec = lR;
04172                                 lR=lR-&gt;next;
04173                                 <font class="keywordflow">continue</font>;
04174                 }
04175 
04176                         <font class="comment">/* intersection is not empty, we need to compute the differences */</font>
04177                         <font class="comment">/* between the intersection and the two polyhedra, such that the */</font>
04178                         <font class="comment">/* results are disjoint unions (according to flag)               */</font>
04179                         <font class="comment">/* d1 = reste \ P = DomainDifference(reste,lR-&gt;P,WS);   */</font>
04180                         <font class="comment">/* d2 = P \ reste = DomainDifference(lR-&gt;P,reste,WS); */</font>
04181 
04182                         <font class="comment">/* compute d1 */</font>
04183                         d1 = (Polyhedron *)0;
04184                         <font class="keywordflow">for</font> (p1=reste; p1; p1=p1-&gt;next)
04185                         {
04186                                 pi = p1;
04187                                 <font class="keywordflow">for</font> (i=0; i&lt;P-&gt;NbConstraints &amp;&amp; pi ; i++)
04188                                 {
04189 
04190                                         <font class="comment">/* Add the constraint ( -P-&gt;constraint[i] [-1 if flag=0]) &gt;= 0 in 'p1' */</font>
04191                                         <font class="comment">/* and create the new polyhedron 'p3'.                      */</font>
04192                                         p3 = <a class="code" href="polyhedron_8c.html#a31">SubConstraint</a>(P-&gt;Constraint[i], pi, NbMaxRays,2*flag);
04193                                         <font class="comment">/* Add 'p3' in the new domain 'd1' */</font>
04194                                         d1 = <a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a> (p3, d1);
04195 
04196                                         <font class="comment">/* If the constraint P-&gt;constraint[i][0] is an equality, then add   */</font>
04197                                         <font class="comment">/* the constraint ( +P-&gt;constraint[i] [-1 if flag=0]) &gt;= 0  in 'pi' */</font>
04198                                         <font class="comment">/* and create the new polyhedron 'p3'.                              */</font>
04199                                         <font class="keywordflow">if</font>( <a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(P-&gt;Constraint[i][0]) ) <font class="comment">/* Inequality */</font>
04200                                         {
04201                                                 p3 = <a class="code" href="polyhedron_8c.html#a31">SubConstraint</a>(P-&gt;Constraint[i], pi, NbMaxRays,1+2*flag);
04202                                                 <font class="comment">/* Add 'p3' in the new domain 'd1' */</font>
04203                                                 d1 = <a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a> (p3, d1);
04204 
04205                                                 <font class="comment">/* newpi : add constraint P-&gt;constraint[i]==0 to pi */</font>
04206                                                 newpi = <a class="code" href="polyhedron_8c.html#a28">AddConstraints</a>( P-&gt;Constraint[i], 1, pi, NbMaxRays);
04207                                         }
04208                                         <font class="keywordflow">else</font>
04209                                         {
04210                                                 <font class="comment">/* newpi : add constraint +P-&gt;constraint[i] &gt;= 0 in pi */</font>
04211                                                 newpi = <a class="code" href="polyhedron_8c.html#a31">SubConstraint</a>(P-&gt;Constraint[i], pi, NbMaxRays,3);
04212                                         }
04213                                         <font class="keywordflow">if</font>( newpi &amp;&amp; emptyQ( newpi ) )<font class="keyword"></font>
04214 <font class="keyword">                                        </font>{
04215                                                 <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>( newpi );
04216                                                 newpi = (Polyhedron *)0;
04217                                         }
04218                                         <font class="keywordflow">if</font>( pi != p1 )
04219                                                 <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>( pi );
04220                                         pi = newpi;
04221                                 }
04222                                 <font class="keywordflow">if</font>( pi != p1 )
04223                                         <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>( pi );
04224                         }
04225 
04226                         <font class="comment">/* and now d2 */</font>
04227                         Pol1 = <a class="code" href="polyhedron_8c.html#a36">Polyhedron_Copy</a>( lR );
04228                         <font class="keywordflow">for</font> (p2=reste; p2; p2=p2-&gt;next)
04229                         {
04230                                 d2 = (Polyhedron *)0;
04231                                 <font class="keywordflow">for</font> (p1=Pol1; p1; p1=p1-&gt;next)
04232                                 {
04233                                         pi = p1;
04234                                         <font class="keywordflow">for</font> (i=0; i&lt;p2-&gt;NbConstraints &amp;&amp; pi ; i++)
04235                                         {
04236 
04237                                                 <font class="comment">/* Add the constraint ( -p2-&gt;constraint[i] [-1 if flag=0]) &gt;= 0 in 'pi' */</font>
04238                                                 <font class="comment">/* and create the new polyhedron 'p3'.                      */</font>
04239                                                 p3 = <a class="code" href="polyhedron_8c.html#a31">SubConstraint</a>(p2-&gt;Constraint[i], pi, NbMaxRays,2*flag);
04240                                                 <font class="comment">/* Add 'p3' in the new domain 'd2' */</font>
04241                                                 d2 = <a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a> (p3, d2);
04242 
04243                                                 <font class="comment">/* If the constraint p2-&gt;constraint[i][0] is an equality, then add   */</font>
04244                                                 <font class="comment">/* the constraint ( +p2-&gt;constraint[i] [-1 if flag=0]) &gt;= 0  in 'pi' */</font>
04245                                                 <font class="comment">/* and create the new polyhedron 'p3'.                              */</font>
04246                                                 <font class="keywordflow">if</font>( <a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(p2-&gt;Constraint[i][0]) ) <font class="comment">/* Inequality */</font>
04247                                                 {
04248                                                         p3 = <a class="code" href="polyhedron_8c.html#a31">SubConstraint</a>(p2-&gt;Constraint[i], pi, NbMaxRays,1+2*flag);
04249                                                         <font class="comment">/* Add 'p3' in the new domain 'd2' */</font>
04250                                                         d2 = <a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a> (p3, d2);
04251 
04252                                                         <font class="comment">/* newpi : add constraint p2-&gt;constraint[i]==0 to pi */</font>
04253                                                         newpi = <a class="code" href="polyhedron_8c.html#a28">AddConstraints</a>( p2-&gt;Constraint[i], 1, pi, NbMaxRays);
04254                                                 }
04255                                                 <font class="keywordflow">else</font>
04256                                                 {
04257                                                         <font class="comment">/* newpi : add constraint +p2-&gt;constraint[i] &gt;= 0 in pi */</font>
04258                                                         newpi = <a class="code" href="polyhedron_8c.html#a31">SubConstraint</a>(p2-&gt;Constraint[i], pi, NbMaxRays,3);
04259                                                 }
04260                                                 <font class="keywordflow">if</font>( newpi &amp;&amp; emptyQ( newpi ) )<font class="keyword"></font>
04261 <font class="keyword">                                                </font>{
04262                                                         <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>( newpi );
04263                                                         newpi = (Polyhedron *)0;
04264                                                 }
04265                                                 <font class="keywordflow">if</font>( pi != p1 )
04266                                                         <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>( pi );
04267                                                 pi = newpi;
04268                                         }
04269                                         <font class="keywordflow">if</font>( pi &amp;&amp; pi!=p1 )
04270                                                 <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>( pi );
04271                                 }
04272                                 <font class="keywordflow">if</font>( Pol1 )
04273                                         <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>( Pol1 );
04274                                 Pol1 = d2;
04275                         }
04276                         <font class="comment">/* ok, d1 and d2 are computed */</font>
04277 
04278                         <font class="comment">/* now, replace lR by d2+dx (at least dx is nonempty) and set reste to d1 */</font>
04279                         <font class="keywordflow">if</font>( d1 &amp;&amp; emptyQ(d1) )<font class="keyword"></font>
04280 <font class="keyword">                        </font>{
04281                                 <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>( d1 );
04282                                 d1 = NULL;
04283                         }
04284                         <font class="keywordflow">if</font>( d2 &amp;&amp; emptyQ(d2) )<font class="keyword"></font>
04285 <font class="keyword">                        </font>{
04286                                 <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>( d2 );
04287                                 d2 = NULL;
04288                         }
04289 
04290                         <font class="comment">/* set reste */</font>
04291                         <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>( reste );
04292                         reste = d1;
04293 
04294                         <font class="comment">/* add d2 at beginning of Result */</font>
04295                         <font class="keywordflow">if</font>( d2 )
04296                         {
04297                                 <font class="keywordflow">for</font>( tmp=d2 ; tmp-&gt;next ; tmp=tmp-&gt;next )
04298                                                 ;
04299                                 tmp-&gt;next = Result;
04300                                 Result = d2;
04301                                 <font class="keywordflow">if</font>( !prec )
04302                                         prec = tmp;
04303                         }
04304 
04305                         <font class="comment">/* add dx at beginning of Result */</font>
04306 <font class="comment">//                      if( dx )</font>
04307                         {
04308                                 <font class="keywordflow">for</font>( tmp=dx ; tmp-&gt;next ; tmp=tmp-&gt;next )
04309                                         ;
04310                                 tmp-&gt;next = Result;
04311                                 Result = dx;
04312                                 <font class="keywordflow">if</font>( !prec )
04313                                         prec = tmp;
04314                         }
04315 
04316                         <font class="comment">/* suppress current lR */</font>
04317                         <font class="keywordflow">if</font>( !prec )
04318                                 <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>( <font class="stringliteral">"Disjoint_Domain"</font>,<font class="stringliteral">"internalerror"</font>,<font class="stringliteral">"internal error"</font>);
04319                         prec-&gt;next = lR-&gt;next;
04320                         <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>( lR );
04321                         lR = prec-&gt;next;
04322                 } <font class="comment">/* end for result */</font>
04323 
04324                   <font class="comment">/* if there is something left, add it to Result : */</font>
04325                 <font class="keywordflow">if</font>(reste)
04326                 {
04327                         <font class="keywordflow">if</font>(emptyQ(reste))<font class="keyword"></font>
04328 <font class="keyword">                        </font>{
04329                                 <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>( reste );
04330                                 reste = NULL;
04331                         }
04332                         <font class="keywordflow">else</font>
04333                         {
04334                                 Polyhedron *tnext;
04335                                 <font class="keywordflow">for</font>( tmp=reste ; tmp ; tmp=tnext )
04336                                 {
04337                                         tnext = tmp-&gt;next;
04338                                         tmp-&gt;next = NULL;
04339                                         Result = <a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a>(tmp, Result);
04340                                 }
04341                 }
04342                 }
04343         }
04344 
04345         <font class="keywordflow">return</font>( Result );
04346 }
04347 
04348 
04349 
04350 <font class="comment">/* Procedure to print constraint matrix of a polyhedron */</font>
<a name="l04351"></a><a class="code" href="polyhedron_8c.html#a57">04351</a> <font class="keywordtype">void</font> <a class="code" href="polyhedron_8c.html#a57">Polyhedron_PrintConstraints</a>(FILE *Dst,<font class="keywordtype">char</font> *Format,Polyhedron *Pol)<font class="keyword"></font>
04352 <font class="keyword"></font>{
04353         <font class="keywordtype">int</font> i,j;
04354 
04355         fprintf( Dst, <font class="stringliteral">"%d %d\n"</font>, Pol-&gt;NbConstraints, Pol-&gt;Dimension+2 );
04356         <font class="keywordflow">for</font>( i=0 ; i&lt;Pol-&gt;NbConstraints ; i++ )
04357         {
04358                 <font class="keywordflow">for</font>( j=0 ; j&lt;Pol-&gt;Dimension+2 ; j++ )
04359                         <a class="code" href="arithmetique_8h.html#a16">value_print</a>( stdout, Format, Pol-&gt;Constraint[i][j] );
04360                 fprintf( Dst, <font class="stringliteral">"\n"</font> );
04361         }
04362 
04363 }
04364 
04365 
</pre></div><hr><address><small>Generated on Fri Oct 4 16:14:26 2002 for Polylib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.11.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
