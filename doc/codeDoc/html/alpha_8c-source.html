<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>alpha.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11.1 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>alpha.c</h1><a href="alpha_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/* polytest.c */</font>
00002 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00003 <font class="preprocessor">#include &lt;polylib/polylib.h&gt;</font>
00004 
00005 <font class="comment">/* alpha.c</font>
00006 <font class="comment">     COPYRIGHT</font>
00007 <font class="comment">          Both this software and its documentation are</font>
00008 <font class="comment"></font>
00009 <font class="comment">              Copyright 1993 by IRISA /Universite de Rennes I - France,</font>
00010 <font class="comment">              Copyright 1995,1996 by BYU, Provo, Utah</font>
00011 <font class="comment">                         all rights reserved.</font>
00012 <font class="comment"></font>
00013 <font class="comment">          Permission is granted to copy, use, and distribute</font>
00014 <font class="comment">          for any commercial or noncommercial purpose under the terms</font>
00015 <font class="comment">          of the GNU General Public license, version 2, June 1991</font>
00016 <font class="comment">          (see file : LICENSING).</font>
00017 <font class="comment">*/</font>
00018 
00019 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00020 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00021 <font class="preprocessor">#include &lt;string.h&gt;</font>
00022 
00023 <font class="comment">/*---------------------------------------------------------------------*/</font>
00024 <font class="comment">/* int exist_points(pos,P,context)                                     */</font>
00025 <font class="comment">/*    pos : index position of current loop index (0..hdim-1)           */</font>
00026 <font class="comment">/*    P: loop domain                                                   */</font>
00027 <font class="comment">/*    context : context values for fixed indices                       */</font>
00028 <font class="comment">/* recursive procedure, recurs for each imbriquation                   */</font>
00029 <font class="comment">/* returns 1 if there exists any integer points in this polyhedron     */</font>
00030 <font class="comment">/* returns 0 if there are none                                         */</font>
00031 <font class="comment">/*---------------------------------------------------------------------*/</font>
<a name="l00032"></a><a class="code" href="alpha_8c.html#a0">00032</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="alpha_8c.html#a0">exist_points</a>(<font class="keywordtype">int</font> pos,Polyhedron *Pol,Value *context)<font class="keyword"> </font>{
00033   
00034   Value LB, UB, k,tmp;
00035   
00036   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(LB); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(UB); 
00037   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(k);  <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
00038   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(LB,0);
00039   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(UB,0);
00040   
00041   <font class="comment">/* Problem if UB or LB is INFINITY */</font>
00042   <font class="keywordflow">if</font> (<a class="code" href="polyhedron_8c.html#a49">lower_upper_bounds</a>(pos,Pol,context,&amp;LB,&amp;UB) !=0)<font class="keyword"> </font>{
00043     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"exist_points"</font>, <font class="stringliteral">"infdom"</font>, <font class="stringliteral">"infinite domain"</font>);
00044     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(LB);
00045     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(UB);
00046     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(k);
00047     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00048     <font class="keywordflow">return</font> -1;
00049   }
00050   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(context[pos],0);
00051   <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a26">value_lt</a>(UB,LB))<font class="keyword"> </font>{
00052     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(LB); 
00053     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(UB);
00054     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(k);
00055     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00056     <font class="keywordflow">return</font> 0;
00057   }  
00058   <font class="keywordflow">if</font> (!Pol-&gt;next) {
00059     <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(tmp,UB,LB);
00060     <a class="code" href="arithmetique_8h.html#a45">value_increment</a>(tmp,tmp);
00061     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(UB);
00062     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(LB);
00063     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(k);
00064     <font class="keywordflow">return</font> (<a class="code" href="arithmetique_8h.html#a63">value_pos_p</a>(tmp));
00065   }
00066   
00067   <font class="keywordflow">for</font> (<a class="code" href="arithmetique_8h.html#a11">value_assign</a>(k,LB);<a class="code" href="arithmetique_8h.html#a27">value_le</a>(k,UB);<a class="code" href="arithmetique_8h.html#a45">value_increment</a>(k,k))<font class="keyword"> </font>{
00068     
00069     <font class="comment">/* insert k in context */</font>
00070     <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(context[pos],k);    
00071     <font class="keywordflow">if</font> (<a class="code" href="alpha_8c.html#a0">exist_points</a>(pos+1,Pol-&gt;next,context) &gt; 0 )<font class="keyword"> </font>{
00072       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(LB); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(UB);
00073       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(k); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00074       <font class="keywordflow">return</font> 1;
00075     }
00076   }   
00077   <font class="comment">/* Reset context */</font>
00078   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(context[pos],0);
00079   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(UB); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(LB);
00080   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(k); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00081   <font class="keywordflow">return</font> 0;
00082 }
00083     
00084 <font class="comment">/*--------------------------------------------------------------*/</font>
00085 <font class="comment">/* Test to see if there are any integral points in a polyhedron */</font>
00086 <font class="comment">/*--------------------------------------------------------------*/</font>
<a name="l00087"></a><a class="code" href="alpha_8c.html#a1">00087</a> <font class="keywordtype">int</font> <a class="code" href="alpha_8c.html#a1">Polyhedron_Not_Empty</a>(Polyhedron *P,Polyhedron *C,<font class="keywordtype">int</font> <a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>)<font class="keyword"> </font>{
00088 
00089   <font class="keywordtype">int</font> res,i;
00090   Value *context;
00091   Polyhedron *L;
00092   
00093   <font class="comment">/* Create a context vector size dim+2 and set it to all zeros */</font>
00094   context = (Value *) malloc((P-&gt;Dimension+2)*<font class="keyword">sizeof</font>(Value));
00095   
00096   <font class="comment">/* Initialize array 'context' */</font>
00097   <font class="keywordflow">for</font> (i=0;i&lt;(P-&gt;Dimension+2);i++) 
00098     <a class="code" href="arithmetique_8h.html#a10">value_init</a>(context[i]);
00099   
00100   <a class="code" href="vector_8c.html#a9">Vector_Set</a>(context,0,(P-&gt;Dimension+2));
00101   
00102   <font class="comment">/* Set context[P-&gt;Dimension+1] = 1  (the constant) */</font>
00103   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(context[P-&gt;Dimension+1],1);
00104   
00105   L = <a class="code" href="polyhedron_8c.html#a48">Polyhedron_Scan</a>(P,C,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00106   res = <a class="code" href="alpha_8c.html#a0">exist_points</a>(1,L,context);
00107   <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(L);
00108   
00109   <font class="comment">/* Clear array 'context' */</font>
00110   <font class="keywordflow">for</font> (i=0;i&lt;(P-&gt;Dimension+2);i++) 
00111     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(context[i]);
00112   free(context);
00113   <font class="keywordflow">return</font> res;
00114 }
00115 
00116 <font class="comment">/* PolyhedronLTQ ( P1, P2 ) */</font>
00117 <font class="comment">/* P1 and P2 must be simple polyhedra */</font>
00118 <font class="comment">/* result =  0 --&gt; not comparable */</font>
00119 <font class="comment">/* result = -1 --&gt; P1 &lt; P2        */</font>
00120 <font class="comment">/* result =  1 --&gt; P1 &gt; P2        */</font>
00121 <font class="comment">/* INDEX  = 1 .... Dimension      */</font>
<a name="l00122"></a><a class="code" href="alpha_8c.html#a2">00122</a> <font class="keywordtype">int</font> <a class="code" href="alpha_8c.html#a2">PolyhedronLTQ</a> (Polyhedron *Pol1,Polyhedron *Pol2,<font class="keywordtype">int</font> INDEX, <font class="keywordtype">int</font> PDIM, <font class="keywordtype">int</font> NbMaxConstrs)<font class="keyword"> </font>{ 
00123   
00124   <font class="keywordtype">int</font> res, dim, i, j, k;
00125   Polyhedron *Q1, *Q2, *Q3, *Q4, *Q;
00126   Matrix *Mat;
00127 
00128   <font class="keywordflow">if</font> (Pol1-&gt;next || Pol2-&gt;next) {
00129     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"PolyhedronLTQ"</font>, <font class="stringliteral">"compoly"</font>, <font class="stringliteral">"Can only compare polyhedra"</font>);
00130     <font class="keywordflow">return</font> 0;
00131   }
00132   <font class="keywordflow">if</font> (Pol1-&gt;Dimension != Pol2-&gt;Dimension) {
00133     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"PolyhedronLTQ"</font>,<font class="stringliteral">"diffdim"</font>,<font class="stringliteral">"Polyhedra are not same dimension"</font>);
00134     <font class="keywordflow">return</font> 0;
00135   }
00136   dim = Pol1-&gt;Dimension+2;
00137   
00138 <font class="preprocessor">#ifdef DEBUG</font>
00139 <font class="preprocessor"></font>  fprintf(stdout, <font class="stringliteral">"P1\n"</font>);
00140   <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stdout,P_VALUE_FMT,Pol1);
00141   fprintf(stdout, <font class="stringliteral">"P2\n"</font>);
00142   <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stdout,P_VALUE_FMT,Pol2);
00143 <font class="preprocessor">#endif</font>
00144 <font class="preprocessor"></font>  
00145   <font class="comment">/* Create the Line to add */</font>
00146   k = Pol1-&gt;Dimension-INDEX+1-PDIM;
00147   Mat = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(k,dim);
00148   <a class="code" href="vector_8c.html#a9">Vector_Set</a>(Mat-&gt;p_Init,0,dim*k);
00149   <font class="keywordflow">for</font>(j=0,i=INDEX;j&lt;k;i++,j++)
00150     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[j][i],1);
00151   
00152   Q1 = <a class="code" href="polyhedron_8c.html#a34">AddRays</a>(Mat-&gt;p[0],k,Pol1,NbMaxConstrs);
00153   Q2 = <a class="code" href="polyhedron_8c.html#a34">AddRays</a>(Mat-&gt;p[0],k,Pol2,NbMaxConstrs);
00154 
00155 <font class="preprocessor">#ifdef DEBUG</font>
00156 <font class="preprocessor"></font>  fprintf(stdout, <font class="stringliteral">"Q1\n"</font>);
00157   <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stdout,P_VALUE_FMT,Q1);
00158   fprintf(stdout, <font class="stringliteral">"Q2\n"</font>);
00159   <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stdout,P_VALUE_FMT,Q2);
00160 <font class="preprocessor">#endif</font>
00161 <font class="preprocessor"></font>  
00162   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat);
00163   Q  = <a class="code" href="polyhedron_8c.html#a32">DomainIntersection</a>(Q1,Q2,NbMaxConstrs);
00164   
00165 <font class="preprocessor">#ifdef DEBUG</font>
00166 <font class="preprocessor"></font>  fprintf(stdout, <font class="stringliteral">"Q\n"</font>);
00167   <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stdout,P_VALUE_FMT,Q);
00168 <font class="preprocessor">#endif</font>
00169 <font class="preprocessor"></font>  
00170   <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(Q1);
00171   <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(Q2);
00172   
00173   <font class="keywordflow">if</font> (emptyQ(Q)) res = 0;       <font class="comment">/* not comparable */</font>
00174   <font class="keywordflow">else</font> {
00175     Q1 = <a class="code" href="polyhedron_8c.html#a32">DomainIntersection</a>(Pol1,Q,NbMaxConstrs);
00176     Q2 = <a class="code" href="polyhedron_8c.html#a32">DomainIntersection</a>(Pol2,Q,NbMaxConstrs);
00177     
00178 <font class="preprocessor">#ifdef DEBUG</font>
00179 <font class="preprocessor"></font>    fprintf(stdout, <font class="stringliteral">"Q1\n"</font>);
00180     <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stdout,P_VALUE_FMT,Q1);
00181     fprintf(stdout, <font class="stringliteral">"Q2\n"</font>);
00182     <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stdout,P_VALUE_FMT,Q2);
00183 <font class="preprocessor">#endif</font>
00184 <font class="preprocessor"></font>
00185     k = Q1-&gt;NbConstraints + Q2-&gt;NbConstraints;
00186     Mat = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(k, dim);
00187     <a class="code" href="vector_8c.html#a9">Vector_Set</a>(Mat-&gt;p_Init,0,k*dim);
00188     
00189     <font class="comment">/* First compute surrounding polyhedron */</font>    
00190     j=0;
00191     <font class="keywordflow">for</font> (i=0; i&lt;Q1-&gt;NbConstraints; i++) {
00192       <font class="keywordflow">if</font> ((<a class="code" href="arithmetique_8h.html#a69">value_one_p</a>(Q1-&gt;Constraint[i][0])) &amp;&amp; (<a class="code" href="arithmetique_8h.html#a63">value_pos_p</a>(Q1-&gt;Constraint[i][INDEX]))) {
00193         
00194         <font class="comment">/* keep Q1's lower bounds */</font>
00195         <font class="keywordflow">for</font> (k=0; k&lt;dim; k++) 
00196           <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Mat-&gt;p[j][k],Q1-&gt;Constraint[i][k]);
00197         j++;
00198       }
00199     }
00200     <font class="keywordflow">for</font> (i=0; i&lt;Q2-&gt;NbConstraints; i++) {
00201       <font class="keywordflow">if</font> ((<a class="code" href="arithmetique_8h.html#a69">value_one_p</a>(Q2-&gt;Constraint[i][0])) &amp;&amp; (<a class="code" href="arithmetique_8h.html#a64">value_neg_p</a>(Q2-&gt;Constraint[i][INDEX]))) {
00202         
00203         <font class="comment">/* and keep Q2's upper bounds */</font>
00204         <font class="keywordflow">for</font> (k=0; k&lt;dim; k++) 
00205           <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Mat-&gt;p[j][k],Q2-&gt;Constraint[i][k]);
00206         j++;
00207       }
00208     }
00209     Q4 = <a class="code" href="polyhedron_8c.html#a28">AddConstraints</a>(Mat-&gt;p[0], j, Q, NbMaxConstrs);
00210     <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat);
00211     
00212 <font class="preprocessor">#ifdef debug</font>
00213 <font class="preprocessor"></font>    fprintf(stderr, <font class="stringliteral">"Q4 surrounding polyhedron\n"</font>);
00214     Polyhderon_Print(stderr,P_VALUE_FMT, Q4);
00215 <font class="preprocessor">#endif</font>
00216 <font class="preprocessor"></font>
00217     <font class="comment">/* if surrounding polyhedron is empty, D1&gt;D2 */</font>
00218     <font class="keywordflow">if</font> (emptyQ(Q4))<font class="keyword"> </font>{
00219       res = 1;
00220       
00221 <font class="preprocessor">#ifdef debug</font>
00222 <font class="preprocessor"></font>      fprintf(stderr, <font class="stringliteral">"Surrounding polyhedron is empty\n"</font>);
00223 <font class="preprocessor">#endif</font>
00224 <font class="preprocessor"></font>      <font class="keywordflow">goto</font> LTQdone2; 
00225     }
00226     
00227     <font class="comment">/* Test if Q1 &lt; Q2 */</font>      
00228     <font class="comment">/* Build a constraint array for &gt;= Q1 and &lt;= Q2 */</font>
00229     Mat = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(2,dim);
00230     <a class="code" href="vector_8c.html#a9">Vector_Set</a>(Mat-&gt;p_Init,0,2*dim);
00231     
00232     <font class="comment">/* Choose a contraint from Q1 */</font>
00233     <font class="keywordflow">for</font> (i=0; i&lt;Q1-&gt;NbConstraints; i++) {
00234       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(Q1-&gt;Constraint[i][0]))<font class="keyword"> </font>{
00235         
00236         <font class="comment">/* Equality */</font>
00237         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(Q1-&gt;Constraint[i][INDEX]))<font class="keyword"> </font>{
00238           
00239           <font class="comment">/* Ignore side constraint (they are in Q) */</font>
00240           <font class="keywordflow">continue</font>;
00241         }
00242         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a64">value_neg_p</a>(Q1-&gt;Constraint[i][INDEX]))<font class="keyword"> </font>{
00243           
00244           <font class="comment">/* copy -constraint to Mat */</font>
00245           <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[0][0],1);
00246           <font class="keywordflow">for</font> (k=1; k&lt;dim; k++)
00247             <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(Mat-&gt;p[0][k],Q1-&gt;Constraint[i][k]);
00248         }
00249         <font class="keywordflow">else</font> {
00250           
00251           <font class="comment">/* Copy constraint to Mat */</font>
00252           
00253           <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[0][0],1);
00254           <font class="keywordflow">for</font> (k=1; k&lt;dim; k++)
00255             <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Mat-&gt;p[0][k],Q1-&gt;Constraint[i][k]);
00256         }
00257       }
00258       <font class="keywordflow">else</font> <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a64">value_neg_p</a>(Q1-&gt;Constraint[i][INDEX]))<font class="keyword"> </font>{
00259         
00260         <font class="comment">/* Upper bound -- make a lower bound from it */</font>
00261         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[0][0],1);
00262         <font class="keywordflow">for</font> (k=1; k&lt;dim; k++)
00263           <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(Mat-&gt;p[0][k],Q1-&gt;Constraint[i][k]);
00264       }
00265       <font class="keywordflow">else</font> {    
00266         
00267         <font class="comment">/* Lower or side bound -- ignore it */</font>
00268         <font class="keywordflow">continue</font>;
00269       }
00270       
00271       <font class="comment">/* Choose a constraint from Q2 */</font>
00272       <font class="keywordflow">for</font> (j=0; j&lt;Q2-&gt;NbConstraints; j++) {
00273         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(Q2-&gt;Constraint[j][0]))<font class="keyword"> </font>{   <font class="comment">/* equality */</font>
00274           <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(Q2-&gt;Constraint[j][INDEX]))<font class="keyword"> </font>{
00275             
00276             <font class="comment">/* Ignore side constraint (they are in Q) */</font>
00277             <font class="keywordflow">continue</font>;
00278           }
00279           <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a63">value_pos_p</a>(Q2-&gt;Constraint[j][INDEX]))<font class="keyword"> </font>{
00280             
00281             <font class="comment">/* Copy -constraint to Mat */</font>
00282             <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[1][0],1);
00283             <font class="keywordflow">for</font> (k=1; k&lt;dim; k++)
00284               <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(Mat-&gt;p[1][k],Q2-&gt;Constraint[j][k]);
00285           }
00286           <font class="keywordflow">else</font> {
00287             
00288             <font class="comment">/* Copy constraint to Mat */</font>
00289             <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[1][0],1);
00290             <font class="keywordflow">for</font> (k=1; k&lt;dim; k++)
00291               <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Mat-&gt;p[1][k],Q2-&gt;Constraint[j][k]);
00292           };
00293         }
00294         <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a63">value_pos_p</a>(Q2-&gt;Constraint[j][INDEX]))<font class="keyword"> </font>{
00295           
00296           <font class="comment">/* Lower bound -- make an upper bound from it */</font>
00297           <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Mat-&gt;p[1][0],1);
00298           <font class="keywordflow">for</font>(k=1;k&lt;dim;k++)
00299             <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(Mat-&gt;p[1][k],Q2-&gt;Constraint[j][k]);
00300         }
00301         <font class="keywordflow">else</font> {
00302           
00303           <font class="comment">/* Upper or side bound -- ignore it */</font>
00304           <font class="keywordflow">continue</font>;
00305         };
00306         
00307 <font class="preprocessor">#ifdef DEBUG</font>
00308 <font class="preprocessor"></font>        fprintf(stdout, <font class="stringliteral">"i=%d j=%d M=\n"</font>, i+1, j+1);
00309         <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stdout,P_VALUE_FMT,Mat);
00310 <font class="preprocessor">#endif</font>
00311 <font class="preprocessor"></font>        
00312         <font class="comment">/* Add Mat to Q and see if anything is made */</font>
00313         Q3 = <a class="code" href="polyhedron_8c.html#a28">AddConstraints</a>(Mat-&gt;p[0],2,Q,NbMaxConstrs);
00314 
00315 <font class="preprocessor">#ifdef DEBUG</font>
00316 <font class="preprocessor"></font>        fprintf(stdout, <font class="stringliteral">"Q3\n"</font>);
00317         <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stdout,P_VALUE_FMT,Q3);
00318 <font class="preprocessor">#endif</font>
00319 <font class="preprocessor"></font>        
00320         <font class="keywordflow">if</font> (!emptyQ(Q3))<font class="keyword"> </font>{ 
00321           <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(Q3);
00322           
00323 <font class="preprocessor">#ifdef DEBUG</font>
00324 <font class="preprocessor"></font>          fprintf(stdout, <font class="stringliteral">"not empty\n"</font>);
00325 <font class="preprocessor">#endif</font>
00326 <font class="preprocessor"></font>          res = -1;
00327           <font class="keywordflow">goto</font> LTQdone;
00328         }
00329 <font class="preprocessor">#ifdef DEBUG</font>
00330 <font class="preprocessor"></font>        fprintf(stdout,<font class="stringliteral">"empty\n"</font>);      
00331 <font class="preprocessor">#endif</font>
00332 <font class="preprocessor"></font>        <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(Q3);
00333       } <font class="comment">/* end for j */</font>
00334     } <font class="comment">/* end for i */</font>
00335     res = 1;
00336 LTQdone:
00337     <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Mat);
00338 LTQdone2: 
00339     <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(Q4);
00340     <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(Q1);
00341     <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(Q2);
00342   }
00343   <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(Q);
00344   
00345 <font class="preprocessor">#ifdef DEBUG</font>
00346 <font class="preprocessor"></font>  fprintf(stdout, <font class="stringliteral">"res = %d\n"</font>, res);
00347 <font class="preprocessor">#endif</font>
00348 <font class="preprocessor"></font>  
00349   <font class="keywordflow">return</font> res;
00350 } <font class="comment">/* PolyhedronLTQ */</font>
00351 
00352 <font class="comment">/* GaussSimplify --</font>
00353 <font class="comment">   Given Mat1, a matrix of equalities, performs Gaussian elimination.</font>
00354 <font class="comment">   Find a minimum basis, Returns the rank.</font>
00355 <font class="comment">   Mat1 is context, Mat2 is reduced in context of Mat1</font>
00356 <font class="comment">*/</font>
<a name="l00357"></a><a class="code" href="alpha_8c.html#a3">00357</a> <font class="keywordtype">int</font> <a class="code" href="alpha_8c.html#a3">GaussSimplify</a>(Matrix *Mat1,Matrix *Mat2)<font class="keyword"> </font>{
00358   
00359   <font class="keywordtype">int</font> NbRows = Mat1-&gt;NbRows;
00360   <font class="keywordtype">int</font> NbCols = Mat1-&gt;NbColumns;
00361   <font class="keywordtype">int</font> *column_index;
00362   <font class="keywordtype">int</font> i, j, k, <a class="code" href="polyparam_8c.html#a2">n</a>, t, pivot, Rank; 
00363   Value gcd, tmp, *cp; 
00364   
00365   column_index=(<font class="keywordtype">int</font> *)malloc(NbCols * <font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
00366   <font class="keywordflow">if</font> (!column_index) {
00367     <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"GaussSimplify"</font>, <font class="stringliteral">"outofmem"</font>, <font class="stringliteral">"out of memory space\n"</font>);
00368     Pol_status = 1;
00369     <font class="keywordflow">return</font> 0;
00370   }
00371   
00372   <font class="comment">/* Initialize all the 'Value' variables */</font>
00373   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(gcd); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
00374   
00375   Rank=0;
00376   <font class="keywordflow">for</font> (j=0; j&lt;NbCols; j++) {              <font class="comment">/* for each column starting at */</font> 
00377     <font class="keywordflow">for</font> (i=Rank; i&lt;NbRows; i++)           <font class="comment">/* diagonal, look down to find */</font>
00378       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat1-&gt;p[i][j])) <font class="comment">/* the first non-zero entry    */</font>
00379         <font class="keywordflow">break</font>;                           
00380     <font class="keywordflow">if</font> (i!=NbRows) {                      <font class="comment">/* was one found ? */</font>
00381       <font class="keywordflow">if</font> (i!=Rank)                        <font class="comment">/* was it found below the diagonal?*/</font>
00382         <a class="code" href="vector_8c.html#a10">Vector_Exchange</a>(Mat1-&gt;p[Rank],Mat1-&gt;p[i],NbCols);
00383       
00384       <font class="comment">/* Normalize the pivot row */</font>
00385       <a class="code" href="vector_8c.html#a23">Vector_Gcd</a>(Mat1-&gt;p[Rank],NbCols,&amp;gcd);
00386       
00387       <font class="comment">/* If (gcd &gt;= 2) */</font>
00388       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp,2);
00389       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a25">value_ge</a>(gcd,tmp))<font class="keyword"> </font>{
00390         cp = Mat1-&gt;p[Rank];
00391         <font class="keywordflow">for</font> (k=0; k&lt;NbCols; k++,cp++)
00392           <a class="code" href="arithmetique_8h.html#a51">value_division</a>(*cp,*cp,gcd);          
00393       }
00394       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a64">value_neg_p</a>(Mat1-&gt;p[Rank][j]))<font class="keyword"> </font>{
00395         cp = Mat1-&gt;p[Rank];
00396         <font class="keywordflow">for</font> (k=0; k&lt;NbCols; k++,cp++)
00397           <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(*cp,*cp);
00398       }
00399       <font class="comment">/* End of normalize */</font>
00400       pivot=i;
00401       <font class="keywordflow">for</font> (i=0;i&lt;NbRows;i++)    <font class="comment">/* Zero out the rest of the column */</font>
00402         <font class="keywordflow">if</font> (i!=Rank) {
00403           <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat1-&gt;p[i][j]))<font class="keyword"> </font>{
00404             Value a, a1, a2, a1abs, a2abs;
00405             <a class="code" href="arithmetique_8h.html#a10">value_init</a>(a); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(a1); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(a2);
00406             <a class="code" href="arithmetique_8h.html#a10">value_init</a>(a1abs); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(a2abs);
00407             <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(a1,Mat1-&gt;p[i][j]);
00408             <a class="code" href="arithmetique_8h.html#a55">value_absolute</a>(a1abs,a1);
00409             <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(a2,Mat1-&gt;p[Rank][j]); 
00410             <a class="code" href="arithmetique_8h.html#a55">value_absolute</a>(a2abs,a2);
00411             <a class="code" href="vector_8c.html#a3">Gcd</a>(a1abs,a2abs,&amp;a);
00412             <a class="code" href="arithmetique_8h.html#a51">value_division</a>(a1,a1,a);
00413             <a class="code" href="arithmetique_8h.html#a51">value_division</a>(a2,a2,a);
00414             <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(a1,a1);
00415             <a class="code" href="vector_8c.html#a20">Vector_Combine</a>(Mat1-&gt;p[i],Mat1-&gt;p[Rank],Mat1-&gt;p[i],a2, 
00416                            a1,NbCols);
00417             <a class="code" href="vector_8c.html#a25">Vector_Normalize</a>(Mat1-&gt;p[i],NbCols);
00418             <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(a); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(a1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(a2);
00419             <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(a1abs); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(a2abs);
00420           }
00421         }
00422       column_index[Rank]=j;
00423       Rank++;
00424     }
00425   } <font class="comment">/* end of Gauss elimination */</font>
00426 
00427 
00428   <font class="keywordflow">if</font> (Mat2) {  <font class="comment">/* Mat2 is a transformation matrix  (i,j-&gt;f(i,j))....</font>
00429 <font class="comment">                  can't scale it because can't scale both sides of -&gt; */</font>
00430     <font class="comment">/* normalizes an affine transformation        */</font>
00431     <font class="comment">/* priority of forms                          */</font>
00432     <font class="comment">/*    1. i' -&gt; i                (identity)    */</font>
00433     <font class="comment">/*    2. i' -&gt; i + constant     (uniform)     */</font>
00434     <font class="comment">/*    3. i' -&gt; constant         (broadcast)   */</font>
00435     <font class="comment">/*    4. i' -&gt; j                (permutation) */</font>
00436     <font class="comment">/*    5. i' -&gt; j + constant     (      )      */</font>
00437     <font class="comment">/*    6. i' -&gt; i + j + constant (non-uniform) */</font>
00438     <font class="keywordflow">for</font> (k=0; k&lt;Rank; k++) {
00439       j = column_index[k];
00440       <font class="keywordflow">for</font> (i=0; i&lt;(Mat2-&gt;NbRows-1);i++) {   <font class="comment">/* all but the last row 0...0 1 */</font>
00441         <font class="keywordflow">if</font> ((i!=j) &amp;&amp; <a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat2-&gt;p[i][j]))<font class="keyword"> </font>{
00442           
00443           <font class="comment">/* Remove dependency of i' on j */</font>
00444           Value a, a1, a1abs, a2, a2abs;
00445           <a class="code" href="arithmetique_8h.html#a10">value_init</a>(a); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(a1); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(a2);
00446           <a class="code" href="arithmetique_8h.html#a10">value_init</a>(a1abs); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(a2abs);
00447           <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(a1,Mat2-&gt;p[i][j]);
00448           <a class="code" href="arithmetique_8h.html#a55">value_absolute</a>(a1abs,a1);
00449           <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(a2,Mat1-&gt;p[k][j]);
00450           <a class="code" href="arithmetique_8h.html#a55">value_absolute</a>(a2abs,a2);
00451           <a class="code" href="vector_8c.html#a3">Gcd</a>(a1abs,a2abs,&amp;a);
00452           <a class="code" href="arithmetique_8h.html#a51">value_division</a>(a1,a1,a);
00453           <a class="code" href="arithmetique_8h.html#a51">value_division</a>(a2,a2,a);
00454           <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(a1,a1);
00455           <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a69">value_one_p</a>(a2))<font class="keyword"> </font>{
00456             <a class="code" href="vector_8c.html#a20">Vector_Combine</a>(Mat2-&gt;p[i],Mat1-&gt;p[k],Mat2-&gt;p[i],a2,
00457                            a1,NbCols);
00458             
00459             <font class="comment">/* Vector_Normalize(Mat2-&gt;p[i],NbCols); -- can't do T        */</font>
00460           } <font class="comment">/* otherwise, can't do it without mult lhs prod (2i,3j-&gt;...) */</font>
00461           <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(a); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(a1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(a2);
00462           <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(a1abs); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(a2abs);
00463                 
00464         }
00465         <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((i==j) &amp;&amp; <a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(Mat2-&gt;p[i][j]))<font class="keyword"> </font>{
00466           
00467           <font class="comment">/* 'i' does not depend on j */</font>
00468           <font class="keywordflow">for</font> (<a class="code" href="polyparam_8c.html#a2">n</a>=j+1; <a class="code" href="polyparam_8c.html#a2">n</a> &lt; (NbCols-1); <a class="code" href="polyparam_8c.html#a2">n</a>++) {
00469             <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat2-&gt;p[i][<a class="code" href="polyparam_8c.html#a2">n</a>]))<font class="keyword"> </font>{ <font class="comment">/* i' depends on some n */</font>
00470               <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(tmp,1);
00471               <a class="code" href="vector_8c.html#a20">Vector_Combine</a>(Mat2-&gt;p[i],Mat1-&gt;p[k],Mat2-&gt;p[i],tmp,
00472                              tmp,NbCols);
00473               <font class="keywordflow">break</font>;
00474             }  <font class="comment">/* if 'i' depends on just a constant, then leave it alone.*/</font>
00475           }
00476         }
00477       }
00478     }
00479     
00480     <font class="comment">/* Check last row of transformation Mat2 */</font>
00481     <font class="keywordflow">for</font> (j=0; j&lt;(NbCols-1); j++)
00482       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat2-&gt;p[Mat2-&gt;NbRows-1][j]))<font class="keyword"> </font>{
00483         <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"GaussSimplify"</font>, <font class="stringliteral">"corrtrans"</font>, <font class="stringliteral">"Corrupted transformation\n"</font>);
00484         <font class="keywordflow">break</font>;
00485       }
00486     
00487     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a70">value_notone_p</a>(Mat2-&gt;p[Mat2-&gt;NbRows-1][NbCols-1]))<font class="keyword"> </font>{
00488       <a class="code" href="polyhedron_8c.html#a6">errormsg1</a>(<font class="stringliteral">"GaussSimplify"</font>, <font class="stringliteral">"corrtrans"</font>, <font class="stringliteral">"Corrupted transformation\n"</font>);
00489     }
00490   }
00491   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(gcd); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00492   free(column_index);
00493   <font class="keywordflow">return</font> Rank;
00494 } <font class="comment">/* GaussSimplify */</font>
00495 
00496 <font class="comment">/* </font>
00497 <font class="comment"> * Topologically sort 'n' polyhdera and return 0 on failure, otherwise return </font>
00498 <font class="comment"> * 1 on success. Here 'L' is a an array of pointers to polyhedra, 'n' is the </font>
00499 <font class="comment"> * number of polyhedra, 'index' is the level to consider for partial ordering</font>
00500 <font class="comment"> * 'pdim' is the parameter space dimension, 'time' is an array of 'n' integers</font>
00501 <font class="comment"> * to store logical time values, 'pvect', if not NULL, is an array of 'n' </font>
00502 <font class="comment"> * integers that contains a permutation specification after call and MAXRAYS is</font>
00503 <font class="comment"> * the workspace size for polyhedra operations. </font>
00504 <font class="comment"> */</font>
<a name="l00505"></a><a class="code" href="alpha_8c.html#a4">00505</a> <font class="keywordtype">int</font> <a class="code" href="alpha_8c.html#a4">PolyhedronTSort</a> (Polyhedron **L,<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> <a class="code" href="polyparam_8c.html#a2">n</a>,<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> index,<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> pdim,<font class="keywordtype">int</font> *time,<font class="keywordtype">int</font> *pvect,<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> <a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>)<font class="keyword"> </font>{
00506  
00507   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> <font class="keyword">const</font> nbcells = ((<a class="code" href="polyparam_8c.html#a2">n</a>*(<a class="code" href="polyparam_8c.html#a2">n</a>-1))&gt;&gt;1);    <font class="comment">/* Number of memory cells </font>
00508 <font class="comment">                                                     to allocate, see below */</font>
00509   <font class="keywordtype">int</font> *dag;  <font class="comment">/* The upper triangular matrix */</font>
00510   <font class="keywordtype">int</font> **p;   <font class="comment">/* Array of matrix row addresses */</font>
00511   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> i, j, k;
00512   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> t, nb, isroot;
00513 
00514   <font class="keywordflow">if</font> (<a class="code" href="polyparam_8c.html#a2">n</a>&lt;2) <font class="keywordflow">return</font> 0;
00515 
00516   <font class="comment">/* we need an upper triangular matrix (example with n=4):</font>
00517 <font class="comment"></font>
00518 <font class="comment">     . o o o</font>
00519 <font class="comment">     . . o o     . are unuseful cells, o are useful cells</font>
00520 <font class="comment">     . . . o</font>
00521 <font class="comment">     . . . .</font>
00522 <font class="comment">     </font>
00523 <font class="comment">     so we need to allocate (n)(n-1)/2 cells</font>
00524 <font class="comment">     - dag will point to this memory.</font>
00525 <font class="comment">     - p[i] will point to row i of the matrix</font>
00526 <font class="comment">     p[0] = dag - 1 (such that p[0][1] == dag[0])</font>
00527 <font class="comment">     p[1] = dag - 1 + (n-1)</font>
00528 <font class="comment">     p[2] = dag - 1 + (n-1) + (n-2)</font>
00529 <font class="comment">     ...</font>
00530 <font class="comment">     p[i] = p[i-1] + (n-1-i)</font>
00531 <font class="comment">  */</font>
00532 
00533   <font class="comment">/* malloc n(n-1)/2 for dag and n-1 for p (node n does not have any row) */</font>
00534   dag = (<font class="keywordtype">int</font> *) malloc(nbcells*<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
00535   <font class="keywordflow">if</font> (!dag) <font class="keywordflow">return</font> 0;
00536   p = (<font class="keywordtype">int</font> **) malloc ((<a class="code" href="polyparam_8c.html#a2">n</a>-1) * <font class="keyword">sizeof</font>(<font class="keywordtype">int</font> *));
00537   <font class="keywordflow">if</font> (!p) { 
00538     free(dag); <font class="keywordflow">return</font> 0; 
00539   }
00540 
00541   <font class="comment">/* Initialize 'p' and 'dag' */</font>
00542   p[0] = dag-1;
00543   <font class="keywordflow">for</font> (i=1; i&lt;<a class="code" href="polyparam_8c.html#a2">n</a>-1; i++)
00544     p[i] = p[i-1] + (<a class="code" href="polyparam_8c.html#a2">n</a>-1)-i;
00545   <font class="keywordflow">for</font> (i=0; i&lt;nbcells; i++)
00546     dag[i] = -2;      <font class="comment">/* -2 means 'not computed yet' */</font>
00547   <font class="keywordflow">for</font> (i=0; i&lt;<a class="code" href="polyparam_8c.html#a2">n</a>; i++) time[i] = -1;
00548 
00549   <font class="comment">/* Compute the dag using transitivity to reduce the number of */</font>
00550   <font class="comment">/*   PolyhedronLTQ calls.                                     */</font>
00551   <font class="keywordflow">for</font> (i=0; i&lt;<a class="code" href="polyparam_8c.html#a2">n</a>-1; i++) {
00552     <font class="keywordflow">for</font> (j=i+1; j&lt;<a class="code" href="polyparam_8c.html#a2">n</a>; j++) {
00553       <font class="keywordflow">if</font> (p[i][j] == -2) <font class="comment">/* not computed yes */</font>
00554         p[i][j] = <a class="code" href="alpha_8c.html#a2">PolyhedronLTQ</a>(L[i], L[j], index, pdim, <a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00555       <font class="keywordflow">if</font> (p[i][j] != 0) {
00556         
00557         <font class="comment">/* if p[i][j] is 1 or -1, look for -p[i][j] on the same row:</font>
00558 <font class="comment">           p[i][j] == -p[i][k] ==&gt; p[j][k] = p[i][k] (transitivity)</font>
00559 <font class="comment">           note: p[r][c] == -p[c][r], use this to avoid reading or writing</font>
00560 <font class="comment">           under the matrix diagonal</font>
00561 <font class="comment">        */</font>  
00562            
00563         <font class="comment">/* first, k&lt;i so look for p[i][j] == p[k][i] (i.e. -p[i][k]) */</font>
00564         <font class="keywordflow">for</font> (k=0; k&lt;i; k++)
00565           <font class="keywordflow">if</font> (p[k][i] == p[i][j]) p[k][j] = p[k][i];
00566         
00567         <font class="comment">/* then, i&lt;k&lt;j so look for p[i][j] == -p[i][k] */</font>
00568         <font class="keywordflow">for</font> (k=i+1; k&lt;j; k++)
00569           <font class="keywordflow">if</font> (p[i][k] == -p[i][j]) p[k][j] = -p[i][k];
00570         
00571         <font class="comment">/* last, k&gt;j same search but */</font>
00572         <font class="keywordflow">for</font> (k=j+1; k&lt;<a class="code" href="polyparam_8c.html#a2">n</a>; k++)
00573           <font class="keywordflow">if</font> (p[i][k] == -p[i][j]) p[j][k] = p[i][k];
00574       }
00575     }
00576   }
00577   
00578   <font class="comment">/* walk thru the dag to compute the partial order (and optionally</font>
00579 <font class="comment">     the permutation)</font>
00580 <font class="comment">     Note: this is not the fastest way to do it but it takes</font>
00581 <font class="comment">     negligible time compared to a single call of PolyhedronLTQ !</font>
00582 <font class="comment">     Each macro-step (while loop) gives the same logical time to all</font>
00583 <font class="comment">     found roots and optionally add these nodes in the permutation vector</font>
00584 <font class="comment">  */</font> 
00585   
00586   t = 0; <font class="comment">/* current logical time, assigned to current roots and</font>
00587 <font class="comment">            increased by 1 at the end of each step */</font>
00588   nb = 0; <font class="comment">/* number of processed nodes (have been given a time) */</font>
00589   <font class="keywordflow">while</font> (nb&lt;<a class="code" href="polyparam_8c.html#a2">n</a>) {
00590     <font class="keywordflow">for</font> (i=0; i&lt;<a class="code" href="polyparam_8c.html#a2">n</a>; i++) { <font class="comment">/* search for roots */</font>
00591       <font class="comment">/* for any node, if it's not already been given a logical time</font>
00592 <font class="comment">         then walk thru the node row; if we find a 1 at some column j,</font>
00593 <font class="comment">         it means that node j preceeds the current node, so it is not</font>
00594 <font class="comment">         a root */</font>
00595       <font class="keywordflow">if</font> (time[i]&lt;0) {
00596         isroot = 1; <font class="comment">/* assume that it is until it is definitely not */</font>
00597         <font class="comment">/* first search on a column */</font>
00598         <font class="keywordflow">for</font> (j=0; j&lt;i; j++) {
00599           <font class="keywordflow">if</font> (p[j][i]==-1) { <font class="comment">/* found a node lower than it */</font>
00600             isroot = 0; <font class="keywordflow">break</font>;
00601           }
00602         }
00603         <font class="keywordflow">if</font> <font class="comment">/*still*/</font> (isroot)
00604           <font class="keywordflow">for</font> (j=i+1; j&lt;<a class="code" href="polyparam_8c.html#a2">n</a>; j++) {
00605             <font class="keywordflow">if</font> (p[i][j]==1) { <font class="comment">/* greater than this node */</font>
00606               isroot = 0; <font class="keywordflow">break</font>;
00607             }
00608           }
00609         <font class="keywordflow">if</font> (isroot) { <font class="comment">/* then it definitely is */</font>
00610           time[i] = t; <font class="comment">/* this node gets current logical time */</font>
00611           <font class="keywordflow">if</font> (pvect)
00612             pvect[nb] = i+1; <font class="comment">/* nodes will be numbered from 1 to n */</font>
00613           nb++; <font class="comment">/* one more node processed */</font>
00614         }
00615       }
00616     }
00617     <font class="comment">/* now make roots become neutral, i.e. non comparable with all other nodes */</font>
00618     <font class="keywordflow">for</font> (i=0; i&lt;<a class="code" href="polyparam_8c.html#a2">n</a>; i++) {
00619       <font class="keywordflow">if</font> (time[i]==t) {
00620         <font class="keywordflow">for</font> (j=0; j&lt;i; j++)
00621           p[j][i] = 0;
00622         <font class="keywordflow">for</font> (j=i+1; j&lt;<a class="code" href="polyparam_8c.html#a2">n</a>; j++)
00623           p[i][j] = 0;
00624       }
00625     }
00626     t++; <font class="comment">/* ready for next set of root nodes */</font>
00627   }
00628   
00629   free (p);   <font class="comment">/* let's be clean, collect the garbage */</font>
00630   free (dag);
00631   <font class="keywordflow">return</font> 1;
00632 } <font class="comment">/* PolyhedronTSort */</font>
00633 
00634 
00635 
00636 
</pre></div><hr><address><small>Generated on Fri Oct 4 16:14:25 2002 for Polylib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.11.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
