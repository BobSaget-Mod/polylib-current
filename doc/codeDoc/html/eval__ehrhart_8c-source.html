<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>eval_ehrhart.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11.1 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>eval_ehrhart.c</h1><a href="eval__ehrhart_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/************************************************/</font>
00002 <font class="comment">/*  eval_ehrhart.c                              */</font>
00003 <font class="comment">/* functions to evaluate an Ehrhart polynomial. */</font>
00004 <font class="comment">/* written by Emmanuel Jeannot (c) 1997.        */</font>
00005 <font class="comment">/*  Emmanuel.Jeannot@ens-lyon.fr                */</font>
00006 <font class="comment">/*  http://www.ens-lyon.fr/~ejeannot            */</font>
00007 <font class="comment">/*                                              */</font>
00008 <font class="comment">/* modified 1998, 2000, Vincent Loechner        */</font>
00009 <font class="comment">/* (ArithmetiqueLib, Param_Names)               */</font>
00010 <font class="comment">/************************************************/</font>
00011 
00012 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00013 <font class="preprocessor">#include &lt;math.h&gt;</font>
00014 <font class="preprocessor">#include &lt;<a class="code" href="assert_8h.html">assert.h</a>&gt;</font>
00015 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00016 
00017 <font class="preprocessor">#include &lt;polylib/polylib.h&gt;</font>
00018 
00019 <font class="comment">/* #define EVAL_EHRHART_DEBUG */</font>
00020 
00021 <font class="comment">/********************************************************/</font>
00022 <font class="comment">/* function in domain                                   */</font>
00023 <font class="comment">/*    check if the parameters in list_args              */</font>
00024 <font class="comment">/*    verifies the constraints of Polyhedron P          */</font>
00025 <font class="comment">/********************************************************/</font>
<a name="l00026"></a><a class="code" href="eval__ehrhart_8c.html#a0">00026</a> <font class="keywordtype">int</font> <a class="code" href="eval__ehrhart_8c.html#a0">in_domain</a>(Polyhedron *P, Value *list_args)<font class="keyword"> </font>{
00027   
00028   <font class="keywordtype">int</font> col,row;
00029   Value v; <font class="comment">/* value of the constraint of a row when</font>
00030 <font class="comment">               parameters are instanciated*/</font>
00031   Value tmp;
00032 
00033   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(v); 
00034   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
00035   
00036   <font class="comment">/*P-&gt;Constraint constraint matrice of polyhedron P*/</font>  
00037   <font class="keywordflow">for</font>(row=0;row&lt;P-&gt;NbConstraints;row++) {
00038     <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(v,P-&gt;Constraint[row][P-&gt;Dimension+1]); <font class="comment">/*constant part*/</font>
00039     <font class="keywordflow">for</font>(col=1;col&lt;P-&gt;Dimension+1;col++) {
00040       <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp,P-&gt;Constraint[row][col],list_args[col-1]);
00041       <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(v,v,tmp);
00042     }  
00043     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(P-&gt;Constraint[row][0]))<font class="keyword"> </font>{
00044         
00045       <font class="comment">/*if v is not &gt;=0 then this constraint is not respected */</font>
00046       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a64">value_neg_p</a>(v))<font class="keyword"> </font>{
00047         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(v);
00048         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00049         <font class="keywordflow">return</font> 0;
00050       } 
00051     }
00052     <font class="keywordflow">else</font> {
00053       
00054       <font class="comment">/*if v is not = 0 then this constraint is not respected */</font>
00055       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(v))<font class="keyword"> </font>{
00056         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(v);
00057         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00058         <font class="keywordflow">return</font> 0;
00059       }
00060     }
00061   }
00062   
00063   <font class="comment">/*if not return before this point =&gt; all </font>
00064 <font class="comment">    the constraints are respected */</font>
00065   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(v);
00066   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00067   <font class="keywordflow">return</font> 1;
00068 } <font class="comment">/* in_domain */</font>
00069 
00070 <font class="comment">/****************************************************/</font>
00071 <font class="comment">/* function compute enode                           */</font>
00072 <font class="comment">/*     compute the value of enode p with parameters */</font>
00073 <font class="comment">/*     list "list_args                              */</font>
00074 <font class="comment">/*     compute the polynomial or the periodic       */</font>
00075 <font class="comment">/****************************************************/</font>
00076 
<a name="l00077"></a><a class="code" href="eval__ehrhart_8c.html#a1">00077</a> <font class="keyword">static</font> <font class="keywordtype">double</font> <a class="code" href="eval__ehrhart_8c.html#a1">compute_enode</a>(enode *p, Value *list_args)<font class="keyword"> </font>{
00078   
00079   <font class="keywordtype">int</font> i;
00080   Value <a class="code" href="polyparam_8c.html#a0">m</a>, param;
00081   <font class="keywordtype">double</font> res=0.0;
00082     
00083   <font class="keywordflow">if</font> (!p)
00084     <font class="keywordflow">return</font>(0.);
00085 
00086   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(<a class="code" href="polyparam_8c.html#a0">m</a>);
00087   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(param);
00088 
00089   <font class="keywordflow">if</font> (p-&gt;type == polynomial) {
00090     <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(param,list_args[p-&gt;pos-1]);
00091     
00092     <font class="comment">/* Compute the polynomial using Horner's rule */</font>
00093     <font class="keywordflow">for</font> (i=p-&gt;size-1;i&gt;0;i--) {
00094       res +=<a class="code" href="eval__ehrhart_8c.html#a2">compute_evalue</a>(&amp;p-&gt;arr[i],list_args);
00095       res *=<a class="code" href="arithmetique_8h.html#a9">VALUE_TO_DOUBLE</a>(param);
00096     }
00097     res +=<a class="code" href="eval__ehrhart_8c.html#a2">compute_evalue</a>(&amp;p-&gt;arr[0],list_args);
00098   }
00099   <font class="keywordflow">else</font> <font class="keywordflow">if</font> (p-&gt;type == periodic) {
00100     <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(param,list_args[p-&gt;pos-1]);
00101     
00102     <font class="comment">/* Choose the right element of the periodic */</font>
00103     <a class="code" href="arithmetique_8h.html#a55">value_absolute</a>(<a class="code" href="polyparam_8c.html#a0">m</a>,param);
00104     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(param,p-&gt;size);
00105     <a class="code" href="arithmetique_8h.html#a52">value_modulus</a>(<a class="code" href="polyparam_8c.html#a0">m</a>,<a class="code" href="polyparam_8c.html#a0">m</a>,param);
00106     res = <a class="code" href="eval__ehrhart_8c.html#a2">compute_evalue</a>(&amp;p-&gt;arr[VALUE_TO_INT(<a class="code" href="polyparam_8c.html#a0">m</a>)],list_args);
00107   }
00108   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(<a class="code" href="polyparam_8c.html#a0">m</a>);
00109   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(param);
00110   <font class="keywordflow">return</font> res;
00111 } <font class="comment">/* compute_enode */</font>
00112 
00113 <font class="comment">/*************************************************/</font>
00114 <font class="comment">/* return the value of Ehrhart Polynomial        */</font>
00115 <font class="comment">/* It returns a double, because since it is      */</font>
00116 <font class="comment">/* a recursive function, some intermediate value */</font>
00117 <font class="comment">/* might not be integral                         */</font>
00118 <font class="comment">/*************************************************/</font>
00119 
<a name="l00120"></a><a class="code" href="eval__ehrhart_8c.html#a2">00120</a> <font class="keywordtype">double</font> <a class="code" href="eval__ehrhart_8c.html#a2">compute_evalue</a>(evalue *e,Value *list_args)<font class="keyword"> </font>{
00121   
00122   <font class="keywordtype">double</font> res;
00123   
00124   <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(e-&gt;d))<font class="keyword"> </font>{
00125     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a70">value_notone_p</a>(e-&gt;d)) 
00126       res = <a class="code" href="arithmetique_8h.html#a9">VALUE_TO_DOUBLE</a>(e-&gt;x.n) / VALUE_TO_DOUBLE(e-&gt;d);
00127     <font class="keywordflow">else</font> 
00128       res = <a class="code" href="arithmetique_8h.html#a9">VALUE_TO_DOUBLE</a>(e-&gt;x.n);
00129   }
00130   <font class="keywordflow">else</font> 
00131     res = <a class="code" href="eval__ehrhart_8c.html#a1">compute_enode</a>(e-&gt;x.p,list_args);
00132   <font class="keywordflow">return</font> res;
00133 } <font class="comment">/* compute_evalue */</font>
00134 
00135 
00136 <font class="comment">/****************************************************/</font>
00137 <font class="comment">/* function compute_poly :                          */</font>
00138 <font class="comment">/* Check for the good validity domain               */</font>
00139 <font class="comment">/* return the number of point in the Polyhedron     */</font>
00140 <font class="comment">/* in allocated memory                              */</font>
00141 <font class="comment">/* Using the Ehrhart pseudo-polynomial              */</font>
00142 <font class="comment">/****************************************************/</font>
<a name="l00143"></a><a class="code" href="eval__ehrhart_8c.html#a3">00143</a> Value *<a class="code" href="eval__ehrhart_8c.html#a3">compute_poly</a>(Enumeration *en,Value *list_args)<font class="keyword"> </font>{
00144 
00145   Value *tmp;
00146   <font class="comment">/*    double d; int i; */</font>
00147 
00148   tmp = (Value *) malloc (<font class="keyword">sizeof</font>(Value));
00149   <a class="code" href="assert_8h.html#a1">assert</a>(tmp != NULL);
00150   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(*tmp);
00151   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(*tmp,0);
00152   
00153   <font class="keywordflow">if</font>(!en)
00154     <font class="keywordflow">return</font>(tmp);        <font class="comment">/* no ehrhart polynomial */</font>
00155   <font class="keywordflow">if</font>(en-&gt;ValidityDomain) {
00156     <font class="keywordflow">if</font>(!en-&gt;ValidityDomain-&gt;Dimension) { <font class="comment">/* no parameters */</font>
00157       <a class="code" href="arithmetique_8h.html#a13">value_set_double</a>(*tmp,<a class="code" href="eval__ehrhart_8c.html#a2">compute_evalue</a>(&amp;en-&gt;EP,list_args)+.25);
00158       <font class="keywordflow">return</font>(tmp);
00159     }
00160   }  
00161   <font class="keywordflow">else</font> 
00162     <font class="keywordflow">return</font>(tmp);  <font class="comment">/* no Validity Domain */</font>    
00163   <font class="keywordflow">while</font>(en) {
00164     <font class="keywordflow">if</font>(<a class="code" href="eval__ehrhart_8c.html#a0">in_domain</a>(en-&gt;ValidityDomain,list_args))<font class="keyword"> </font>{
00165       
00166 <font class="preprocessor">#ifdef EVAL_EHRHART_DEBUG</font>
00167 <font class="preprocessor"></font>      <a class="code" href="polyparam_8c.html#a39">Print_Domain</a>(stdout,en-&gt;ValidityDomain);
00168       <a class="code" href="ehrhart_8c~.html#a10">print_evalue</a>(stdout,&amp;en-&gt;EP);
00169 <font class="preprocessor">#endif</font>
00170 <font class="preprocessor"></font>      
00171       <font class="comment">/*                        d = compute_evalue(&amp;en-&gt;EP,list_args);</font>
00172 <font class="comment">                                i = d;</font>
00173 <font class="comment">                                printf("(double)%lf = %d\n", d, i ); */</font>
00174       <a class="code" href="arithmetique_8h.html#a13">value_set_double</a>(*tmp,<a class="code" href="eval__ehrhart_8c.html#a2">compute_evalue</a>(&amp;en-&gt;EP,list_args)+.25);
00175       <font class="keywordflow">return</font>(tmp);
00176     }
00177     <font class="keywordflow">else</font>
00178       en=en-&gt;next;
00179   }
00180   <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(*tmp,0);
00181   <font class="keywordflow">return</font>(tmp); <font class="comment">/* no compatible domain with the arguments */</font>
00182 } <font class="comment">/* compute_poly */</font> 
00183 
00184 
00185 
00186 
</pre></div><hr><address><small>Generated on Fri Oct 4 15:05:56 2002 for Polylib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.11.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
