<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>polyparam.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11.1 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>polyparam.c</h1><a href="polyparam_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/***********************************************************************/</font>
00002 <font class="comment">/*                Parametrized polyhedra V4.20                         */</font>
00003 <font class="comment">/*                copyright 1995-2000 Vincent Loechner                 */</font>
00004 <font class="comment">/*                copyright 1996-1997, Doran Wilde                     */</font>
00005 <font class="comment">/*       Permission is granted to copy, use, and distribute            */</font>
00006 <font class="comment">/*       for any commercial or noncommercial purpose under the terms   */</font>
00007 <font class="comment">/*       of the GNU General Public license, version 2, June 1991       */</font>
00008 <font class="comment">/*       (see file : LICENSING).                                       */</font>
00009 <font class="comment">/***********************************************************************/</font>
00010 
00011 <font class="comment">/********************* -----------USER #DEFS-------- ***********************/</font>
00012 <font class="comment">/* These are mainly for debug purposes. You shouldn't need to change       */</font>
00013 <font class="comment">/* anything for daily usage...                                             */</font>
00014 <font class="comment">/***************************************************************************/</font>
00015 
00016 <font class="comment">/* you may define each macro independently */</font>
00017 <font class="comment">/* #define DEBUGPP      */</font>
00018 <font class="comment">/* #define DEBUGPP3     */</font>              <font class="comment">/* initialization of domain, context, ... */</font>
00019 <font class="comment">/* #define DEBUGPP31    */</font>              <font class="comment">/* even more init-domains */</font>
00020 <font class="comment">/* #define DEBUGPP32    */</font>              <font class="comment">/* even even more... (Elim_Columns) */</font>
00021 <font class="comment">/* #define DEBUGPP4     */</font>              <font class="comment">/* m-faces scan */</font>
00022 <font class="comment">/* #define DEBUGPP41    */</font>              <font class="comment">/* inverse Di in scan */</font>
00023 <font class="comment">/* #define DEBUGPP5     */</font>              <font class="comment">/* Compute_PDomains */</font>
00024 <font class="comment">/********************* ---------END USER #DEFS------ ***********************/</font>
00025 
00026 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00027 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00028 <font class="preprocessor">#include &lt;string.h&gt;</font>
00029 <font class="preprocessor">#include &lt;<a class="code" href="assert_8h.html">assert.h</a>&gt;</font>
00030 <font class="preprocessor">#ifdef DEBUGPP</font>
00031 <font class="preprocessor"></font><font class="preprocessor">#include &lt;time.h&gt;</font>
00032 <font class="preprocessor">#endif</font>
00033 <font class="preprocessor"></font>
00034 <font class="preprocessor">#include &lt;polylib/polylib.h&gt;</font>
00035 
00036 <font class="preprocessor">#ifdef __STDC__</font>
00037 <font class="preprocessor"></font><font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="polyparam_8c.html#a18">traite_m_face</a>(Polyhedron *, <font class="keywordtype">int</font> *);
00038 <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="polyparam_8c.html#a19">scan_m_face</a>(<font class="keywordtype">int</font>,<font class="keywordtype">int</font>,Polyhedron *,<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> *);
00039 <font class="preprocessor">#else</font>
00040 <font class="preprocessor"></font><font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="polyparam_8c.html#a18">traite_m_face</a>();
00041 <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="polyparam_8c.html#a19">scan_m_face</a>();
00042 <font class="preprocessor">#endif </font><font class="comment">/* __STDC__ */</font>
00043 
00044 <font class="comment">/*</font>
00045 <font class="comment"> * Return the intersection of two polyhedral domains 'Pol1' and 'Pol2' such </font>
00046 <font class="comment"> * that if the intersection is a polyhedron of lower dimension (a degenerate</font>
00047 <font class="comment"> * polyhedron) than the operands, it is discarded from the resulting polyhedra</font>
00048 <font class="comment"> * list. </font>
00049 <font class="comment"> */</font>
<a name="l00050"></a><a class="code" href="polyparam_8c.html#a20">00050</a> Polyhedron *<a class="code" href="polyparam_8c.html#a20">PDomainIntersection</a>(Polyhedron *Pol1,Polyhedron *Pol2,<font class="keywordtype">unsigned</font> NbMaxRays)<font class="keyword"> </font>{
00051         
00052   Polyhedron *p1, *p2, *p3, *d;
00053   
00054   <font class="keywordflow">if</font> (!Pol1 || !Pol2) <font class="keywordflow">return</font> (Polyhedron*) 0;
00055   <font class="keywordflow">if</font>((Pol1-&gt;Dimension != Pol2-&gt;Dimension) || (Pol1-&gt;NbEq != Pol2-&gt;NbEq)) {
00056     fprintf(stderr,
00057             <font class="stringliteral">"? PDomainIntersection: operation on different dimensions\n"</font>);
00058     <font class="keywordflow">return</font> (Polyhedron*) 0;
00059   }
00060   
00061   d = (Polyhedron *)0;
00062   <font class="keywordflow">for</font> (p1=Pol1; p1; p1=p1-&gt;next) {
00063     <font class="keywordflow">for</font> (p2=Pol2; p2; p2=p2-&gt;next) {
00064       p3 = <a class="code" href="polyhedron_8c.html#a28">AddConstraints</a>(p2-&gt;Constraint[0],
00065                           p2-&gt;NbConstraints,p1,NbMaxRays);
00066       <font class="keywordflow">if</font> (!p3) <font class="keywordflow">continue</font>;
00067       
00068       <font class="comment">/* If the new polyhedron 'p3' has lower dimension, discard it */</font>
00069       <font class="keywordflow">if</font> (p3-&gt;NbEq!=Pol1-&gt;NbEq)
00070         <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(p3) ;
00071       
00072       <font class="comment">/* Otherwise add it to the new polyhderal domain 'd'. */</font>
00073       <font class="keywordflow">else</font>
00074         d = <a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a>(p3,d);
00075     }
00076   }
00077   <font class="keywordflow">return</font> d;
00078 } <font class="comment">/* PDomainIntersection */</font>
00079 
00080 <font class="comment">/* </font>
00081 <font class="comment"> * Given polyhderal domains 'Pol1' and 'Pol2', return the difference of the </font>
00082 <font class="comment"> * two domains with a modification that the resulting polyhedra in the new </font>
00083 <font class="comment"> * domain don't have a 1 unit space around cut and the degenrate results are </font>
00084 <font class="comment"> * discarded. </font>
00085 <font class="comment"> */</font>
<a name="l00086"></a><a class="code" href="polyparam_8c.html#a21">00086</a> Polyhedron *<a class="code" href="polyparam_8c.html#a21">PDomainDifference</a>(Polyhedron *Pol1,Polyhedron *Pol2,<font class="keywordtype">unsigned</font> NbMaxRays)<font class="keyword"> </font>{
00087   
00088   Polyhedron *p1, *p2, *p3, *d;
00089   <font class="keywordtype">int</font> i;
00090   
00091   <font class="keywordflow">if</font> (!Pol1 || !Pol2)
00092     <font class="keywordflow">return</font> (Polyhedron*) 0;
00093   <font class="keywordflow">if</font>((Pol1-&gt;Dimension != Pol2-&gt;Dimension) || (Pol1-&gt;NbEq != Pol2-&gt;NbEq)) {
00094     fprintf(stderr,
00095             <font class="stringliteral">"? PDomainDifference: operation on different dimensions\n"</font>);
00096     <font class="keywordflow">return</font> (Polyhedron*) 0;
00097   }
00098  
00099   d = (Polyhedron *)0;
00100   <font class="keywordflow">for</font> (p2=Pol2; p2; p2=p2-&gt;next) {
00101     <font class="keywordflow">for</font> (p1=Pol1; p1; p1=p1-&gt;next) {
00102       <font class="keywordflow">for</font> (i=0; i&lt;p2-&gt;NbConstraints; i++) {
00103         
00104         <font class="comment">/* Add the constraint (-p2-&gt;Constraint[i]) &gt;= 0 in 'p1' */</font>
00105         p3 = <a class="code" href="polyhedron_8c.html#a31">SubConstraint</a>(p2-&gt;Constraint[i],p1,NbMaxRays,2);
00106         <font class="keywordflow">if</font> (!p3) <font class="keywordflow">continue</font>;
00107         
00108         <font class="comment">/* If the new polyhedron 'p3' is empty or is a polyhedron of lower */</font>
00109         <font class="comment">/* dimension, discard it.                                          */</font>
00110         <font class="keywordflow">if</font> (emptyQ(p3) || p3-&gt;NbEq!=Pol1-&gt;NbEq)
00111           <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(p3);
00112         
00113         <font class="comment">/* Otherwise add 'p3' to the new polyhderal domain 'd' */</font>
00114         <font class="keywordflow">else</font>
00115           d = <a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a>(p3,d);
00116       }
00117     }
00118     Pol1 = d;
00119     d = (Polyhedron *)0;
00120   }
00121   <font class="keywordflow">return</font> Pol1;
00122 } <font class="comment">/* PDomainDifference */</font>
00123 
00124 <font class="comment">/* </font>
00125 <font class="comment"> * Return 1 if matrix 'Mat' is full ranked, otherwise return 0. </font>
00126 <font class="comment"> */</font>  
<a name="l00127"></a><a class="code" href="polyparam_8c.html#a22">00127</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="polyparam_8c.html#a22">TestRank</a>(Matrix *Mat)<font class="keyword"> </font>{
00128   
00129   <font class="keywordtype">int</font> i,j,k;
00130   Value m1,m2,m3,gcd,tmp;
00131 
00132   <font class="comment">/* Initialize all the 'Value' variables */</font>
00133   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(m1); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(m2); 
00134   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(m3); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(gcd); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
00135   
00136   <font class="keywordflow">for</font>(k=0;k&lt;Mat-&gt;NbColumns;++k) {
00137     
00138     <font class="comment">/* If the digonal entry (k,k) is zero, search down the column(k) */</font>
00139     <font class="comment">/* starting from row(k) to find a non-zero entry                 */</font>
00140     <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(Mat-&gt;p[k][k]))<font class="keyword"> </font>{
00141       <font class="keywordflow">for</font>(j=k+1;j&lt;Mat-&gt;NbRows;++j) {
00142         
00143         <font class="comment">/* If a non-zero entry (j,k) is found */</font>
00144         <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(Mat-&gt;p[j][k]))<font class="keyword"> </font>{
00145           
00146           <font class="comment">/* Exchange row(k) and row(j) */</font>
00147           <font class="keywordflow">for</font>(i=k;i&lt;Mat-&gt;NbColumns;++i) {
00148             <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(tmp,Mat-&gt;p[j][i]);
00149             <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Mat-&gt;p[j][i],Mat-&gt;p[k][i]);
00150             <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Mat-&gt;p[k][i],tmp);
00151           }
00152           <font class="keywordflow">break</font>;
00153         }
00154       }
00155       
00156       <font class="comment">/* If no non-zero entry is found then the matrix 'Mat' is not full */</font>
00157       <font class="comment">/* ranked. Return zero.                                            */</font>
00158       <font class="keywordflow">if</font>(j&gt;=Mat-&gt;NbRows) {
00159         
00160         <font class="comment">/* Clear all the 'Value' variables */</font>
00161         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2); 
00162         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m3); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(gcd); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00163         <font class="keywordflow">return</font> 0;
00164       } 
00165     }
00166     
00167     <font class="comment">/* Now Mat[k][k] is the pivot element */</font>
00168     <font class="keywordflow">for</font>(j=k+1;j&lt;Mat-&gt;NbRows;++j) {
00169       
00170       <font class="comment">/* Make every other entry (below row(k)) in column(k) zero */</font>
00171       <a class="code" href="vector_8c.html#a3">Gcd</a>(Mat-&gt;p[j][k],Mat-&gt;p[k][k],&amp;gcd);
00172       <font class="keywordflow">for</font>(i=k+1;i&lt;Mat-&gt;NbColumns;++i) {
00173         
00174         <font class="comment">/* pour tous les indices i &gt; k */</font>
00175         <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(m1,Mat-&gt;p[j][i],Mat-&gt;p[k][k]);
00176         <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(m2,Mat-&gt;p[j][k],Mat-&gt;p[k][i]);
00177         <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(m3,m1,m2);
00178         <a class="code" href="arithmetique_8h.html#a51">value_division</a>(Mat-&gt;p[j][i],m3,gcd);
00179       }
00180     }   
00181   }
00182 
00183   <font class="comment">/* Clear all the 'Value' variables */</font>
00184   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2); 
00185   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m3); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(gcd); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00186   
00187   <font class="comment">/* The matrix 'Mat' is full ranked, return 1 */</font>
00188   <font class="keywordflow">return</font> 1;
00189 } <font class="comment">/* TestRank */</font>
00190 
00191 <font class="comment">/*</font>
00192 <font class="comment"> * The Saturation matrix is defined to be an integer (int type) matrix. It is</font>
00193 <font class="comment"> * a boolean matrix which has a row for every constraint and a column for </font>
00194 <font class="comment"> * every line or ray. The bits in the binary format of each integer in the </font>
00195 <font class="comment"> * saturation matrix stores the information whether the corresponding constr-</font>
00196 <font class="comment"> * aint is saturated by ray(line) or not. </font>
00197 <font class="comment"> */</font>
00198 <font class="keyword">typedef</font> <font class="keyword">struct </font>{
<a name="l00199"></a><a class="code" href="structSatMatrix.html#m0">00199</a>   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> NbRows;
<a name="l00200"></a><a class="code" href="structSatMatrix.html#m1">00200</a>   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> NbColumns;
<a name="l00201"></a><a class="code" href="structSatMatrix.html#m4">00201</a>   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> **p;
<a name="l00202"></a><a class="code" href="structSatMatrix.html#m5">00202</a>   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> *p_init;
00203 } <a class="code" href="structSatMatrix.html">SatMatrix</a>; 
00204 
<a name="l00205"></a><a class="code" href="polyparam_8c.html#a23">00205</a> <font class="keyword">static</font> <a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a23">SMAlloc</a>(<font class="keywordtype">int</font> rows,<font class="keywordtype">int</font> cols)<font class="keyword"> </font>{
00206 
00207   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> **q, *p;
00208   <font class="keywordtype">int</font> i;
00209 
00210   <a class="code" href="structSatMatrix.html">SatMatrix</a> *result = (<a class="code" href="structSatMatrix.html">SatMatrix</a> *)malloc(<font class="keyword">sizeof</font>(<a class="code" href="structSatMatrix.html">SatMatrix</a>));
00211   <a class="code" href="assert_8h.html#a1">assert</a> (result != NULL);
00212 
00213   result-&gt;<a class="code" href="structSatMatrix.html#m0">NbRows</a> = rows;
00214   result-&gt;<a class="code" href="structSatMatrix.html#m1">NbColumns</a> = cols;
00215   result-&gt;<a class="code" href="structSatMatrix.html#m2">p</a> = q = (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> **)malloc(rows * <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> *));
00216   <a class="code" href="assert_8h.html#a1">assert</a> (result-&gt;<a class="code" href="structSatMatrix.html#m2">p</a> != NULL);  
00217   result-&gt;<a class="code" href="structSatMatrix.html#m3">p_init</a> = p = (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> *)malloc(rows * cols * <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>));
00218   <a class="code" href="assert_8h.html#a1">assert</a> (result-&gt;<a class="code" href="structSatMatrix.html#m3">p_init</a> != NULL);  
00219   
00220   <font class="keywordflow">for</font> (i=0;i&lt;rows;i++) {
00221     *q++ = p;
00222     p += cols;
00223   }
00224   
00225   <font class="keywordflow">return</font> result;
00226 } <font class="comment">/* SMAlloc */</font>
00227 
00228 
<a name="l00229"></a><a class="code" href="polyparam_8c.html#a24">00229</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="polyparam_8c.html#a24">SMFree</a> (<a class="code" href="structSatMatrix.html">SatMatrix</a> *matrix)<font class="keyword"> </font>{
00230   
00231   free ((<font class="keywordtype">char</font> *) matrix-&gt;<a class="code" href="structSatMatrix.html#m3">p_init</a>);
00232   free ((<font class="keywordtype">char</font> *) matrix-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>);
00233   free ((<font class="keywordtype">char</font> *) matrix);
00234   <font class="keywordflow">return</font>;
00235 } <font class="comment">/* SMFree */</font>
00236 
00237 <font class="comment">/* -------------------------------------------------------------------------</font>
00238 <font class="comment"> * Shared Global Variables:</font>
00239 <font class="comment"> * Used by procedures: Find_m_face, scan_m_face, Poly2Sat, traite_m_face,</font>
00240 <font class="comment"> *                     count_sat </font>
00241 <font class="comment"> * -------------------------------------------------------------------------</font>
00242 <font class="comment"> */</font>
<a name="l00243"></a><a class="code" href="polyparam_8c.html#a0">00243</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="polyparam_8c.html#a0">m</a>;                   <font class="comment">/* number of parameters */</font>
<a name="l00244"></a><a class="code" href="polyparam_8c.html#a1">00244</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="polyparam_8c.html#a1">m_dim</a>;               <font class="comment">/* dimension of m-face */</font>
<a name="l00245"></a><a class="code" href="polyparam_8c.html#a2">00245</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="polyparam_8c.html#a2">n</a>;                   <font class="comment">/* dimension (not including parameters) */</font>
<a name="l00246"></a><a class="code" href="polyparam_8c.html#a3">00246</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="polyparam_8c.html#a3">ws</a>;                  <font class="comment">/* Working Space size */</font>
<a name="l00247"></a><a class="code" href="polyparam_8c.html#a4">00247</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="polyparam_8c.html#a4">nr</a>;                  <font class="comment">/* (NbRays-1)/32 + 1 */</font>
00248 
<a name="l00249"></a><a class="code" href="polyparam_8c.html#a5">00249</a> <font class="keyword">static</font> Polyhedron *<a class="code" href="polyparam_8c.html#a5">CEqualities</a>;<font class="comment">/* Equalities in the context */</font>
<a name="l00250"></a><a class="code" href="polyparam_8c.html#a6">00250</a> <font class="keyword">static</font> <a class="code" href="structSatMatrix.html">SatMatrix</a>   *<a class="code" href="polyparam_8c.html#a6">Sat</a>;       <font class="comment">/* Saturation Matrix (row=constraint, col=ray)*/</font>
<a name="l00251"></a><a class="code" href="polyparam_8c.html#a7">00251</a> <font class="keyword">static</font> <font class="keywordtype">int</font> *<a class="code" href="polyparam_8c.html#a7">egalite</a>;           <font class="comment">/* Bool vector marking constraints in m-face  */</font>
<a name="l00252"></a><a class="code" href="polyparam_8c.html#a8">00252</a> <font class="keyword">static</font> Matrix *<a class="code" href="polyparam_8c.html#a8">Xi</a>, *<a class="code" href="polyparam_8c.html#a9">Pi</a>;        <font class="comment">/* Xi and Pi */</font>
<a name="l00253"></a><a class="code" href="polyparam_8c.html#a10">00253</a> <font class="keyword">static</font> Matrix *<a class="code" href="polyparam_8c.html#a10">PiTest</a>;         <font class="comment">/* Matrix used to test if Pi is full ranked? */</font>
<a name="l00254"></a><a class="code" href="polyparam_8c.html#a11">00254</a> <font class="keyword">static</font> Matrix *<a class="code" href="polyparam_8c.html#a11">PiInv</a>;          <font class="comment">/* Matrix inverse Pi, with the last col of   */</font>
00255                                <font class="comment">/* each line = denominator of the line       */</font>
<a name="l00256"></a><a class="code" href="polyparam_8c.html#a12">00256</a> <font class="keyword">static</font> Matrix *<a class="code" href="polyparam_8c.html#a12">RaysDi</a>;         <font class="comment">/* Constraint matrix for computing Di */</font>
00257 
<a name="l00258"></a><a class="code" href="polyparam_8c.html#a13">00258</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="polyparam_8c.html#a13">KD</a>;                   <font class="comment">/* Flag : keep the full domains in memory ? */</font>
00259                                  <font class="comment">/* 1 = yes; 0 = no, keep constraints only   */</font>
00260 
<a name="l00261"></a><a class="code" href="polyparam_8c.html#a14">00261</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="polyparam_8c.html#a14">nbPV</a>;                  <font class="comment">/* The number of parameterized vertices */</font>
<a name="l00262"></a><a class="code" href="polyparam_8c.html#a15">00262</a> <font class="keyword">static</font> Param_Vertices *<a class="code" href="polyparam_8c.html#a15">PV_Result</a>; <font class="comment">/* List of parameterized vertices */</font>
<a name="l00263"></a><a class="code" href="polyparam_8c.html#a16">00263</a> <font class="keyword">static</font> Param_Domain *<a class="code" href="polyparam_8c.html#a16">PDomains</a>;    <font class="comment">/* List of domains. */</font>
00264 
00265 <font class="preprocessor">#ifdef DEBUGPP</font>
00266 <font class="preprocessor"></font><font class="keyword">static</font> <font class="keywordtype">int</font> nbfaces;
00267 <font class="preprocessor">#endif</font>
00268 <font class="preprocessor"></font>
00269 <font class="comment">/*</font>
00270 <font class="comment"> * Add the constraints from the context polyhedron 'CEqualities' to the </font>
00271 <font class="comment"> * constraints of polyhedra in the polyhedral domain 'D' and return the new</font>
00272 <font class="comment"> * polyhedral domain. Polyhedral domain 'D' is subsequently deleted from memory</font>
00273 <font class="comment"> */</font>
<a name="l00274"></a><a class="code" href="polyparam_8c.html#a25">00274</a> <font class="keyword">static</font> Polyhedron *<a class="code" href="polyparam_8c.html#a25">Add_CEqualities</a>(Polyhedron *D)<font class="keyword"> </font>{
00275   
00276   Polyhedron *d,*r,*tmp;
00277 
00278   <font class="keywordflow">if</font>(!<a class="code" href="polyparam_8c.html#a5">CEqualities</a>)
00279     <font class="keywordflow">return</font> D;
00280   <font class="keywordflow">else</font> {
00281     <font class="keywordflow">if</font>(!D || emptyQ(D))<font class="keyword"> </font>{
00282       <font class="keywordflow">if</font>(D)
00283         <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(D);
00284       <font class="keywordflow">return</font>(<a class="code" href="polyhedron_8c.html#a36">Polyhedron_Copy</a>(<a class="code" href="polyparam_8c.html#a5">CEqualities</a>));
00285     }
00286     r = <a class="code" href="polyhedron_8c.html#a28">AddConstraints</a>(D-&gt;Constraint[0],D-&gt;NbConstraints,
00287                        <a class="code" href="polyparam_8c.html#a5">CEqualities</a>,<a class="code" href="polyparam_8c.html#a3">ws</a>);
00288     tmp = r;
00289     <font class="keywordflow">for</font>(d=D-&gt;next;d;d=d-&gt;next) {
00290       tmp-&gt;next = <a class="code" href="polyhedron_8c.html#a28">AddConstraints</a>(d-&gt;Constraint[0],d-&gt;NbConstraints,
00291                                  <a class="code" href="polyparam_8c.html#a5">CEqualities</a>,<a class="code" href="polyparam_8c.html#a3">ws</a>);
00292       tmp = tmp-&gt;next;
00293     }
00294     <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(D);
00295     <font class="keywordflow">return</font>(r);
00296   }
00297 } <font class="comment">/* Add_CEqualities */</font>
00298 
00299 <font class="comment">/*----------------------------------------------------------------------*/</font>
00300 <font class="comment">/* traite_m_face                                                        */</font>
00301 <font class="comment">/*       Given an m-face, compute the parameterized vertex              */</font>
00302 <font class="comment">/*----------------------------------------------------------------------*/</font>
<a name="l00303"></a><a class="code" href="polyparam_8c.html#a26">00303</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="polyparam_8c.html#a18">traite_m_face</a>(Polyhedron *D,<font class="keywordtype">int</font> *mf)<font class="keyword"> </font>{
00304      <font class="comment">/* D  - The entire domain */</font>
00305      <font class="comment">/* mf - Bit vector marking the lines/rays in the m-face */</font>
00306 
00307   Matrix *Si;                           <font class="comment">/* Solution */</font>
00308   Polyhedron *PDi;                      <font class="comment">/* polyhedron Di */</font>
00309   Param_Vertices *PV;
00310   <font class="keywordtype">int</font> j,k,c,r;
00311   <font class="keywordtype">unsigned</font> kx, bx;
00312 
00313 <font class="preprocessor">#ifdef DEBUGPP</font>
00314 <font class="preprocessor"></font>  ++nbfaces;
00315 <font class="preprocessor">#endif</font>
00316 <font class="preprocessor"></font>  
00317   <font class="comment">/* Extract  Xi, Pi, and RaysDi from D */</font>
00318   <a class="code" href="polyparam_8c.html#a12">RaysDi</a>-&gt;NbRows = 0;
00319   <font class="keywordflow">for</font>(k=0,c=0,kx=0,bx=MSB;k&lt;D-&gt;NbRays;++k) {
00320     <font class="keywordflow">if</font>(mf[kx]&amp;bx) {      <font class="comment">/* this ray is in the current m-face */</font>      
00321       <font class="keywordflow">if</font>(c&lt;<a class="code" href="polyparam_8c.html#a0">m</a>+1) {       
00322         <font class="keywordtype">int</font> i;
00323         
00324         <font class="comment">/* tester si cette nouvelle colonne est lin. indep. des autres */</font>
00325         <font class="comment">/* i.e. si gauss ne donne pas de '0' sur la colonne Pi */</font>
00326         <font class="comment">/* jusqu'a l'indice 'c'                                */</font>
00327         
00328         <font class="comment">/* construit PiTest */</font>
00329         <font class="keywordflow">for</font>(j=0;j&lt;<a class="code" href="polyparam_8c.html#a0">m</a>+1;++j) {
00330           <font class="keywordflow">for</font>(i=0;i&lt;c;++i)
00331             
00332             <font class="comment">/* les c premieres colonnes */</font>
00333             <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(PiTest-&gt;p[j][i],Pi-&gt;p[j][i]);
00334           
00335           <font class="comment">/* la nouvelle */</font>
00336           <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(PiTest-&gt;p[j][c],D-&gt;Ray[k][j+1+<a class="code" href="polyparam_8c.html#a2">n</a>]);
00337         }
00338         <a class="code" href="polyparam_8c.html#a10">PiTest</a>-&gt;NbColumns = c+1;
00339         r = <a class="code" href="polyparam_8c.html#a22">TestRank</a>(<a class="code" href="polyparam_8c.html#a10">PiTest</a>);
00340         <font class="keywordflow">if</font>(r <font class="comment">/* TestRank(PiTest) */</font>) {
00341                                 
00342           <font class="comment">/* Ok, c'est lin. indep. */</font>
00343           <font class="keywordflow">for</font> (j=0;j&lt;<a class="code" href="polyparam_8c.html#a2">n</a>;j++)
00344             <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Xi-&gt;p[j][c],D-&gt;Ray[k][j+1]);   <font class="comment">/* Xi */</font>
00345           <font class="keywordflow">for</font> (j=0;j&lt;<a class="code" href="polyparam_8c.html#a0">m</a>;j++)
00346             <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Pi-&gt;p[j][c],D-&gt;Ray[k][j+1+<a class="code" href="polyparam_8c.html#a2">n</a>]); <font class="comment">/* Pi */</font>
00347           <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Xi-&gt;p[<a class="code" href="polyparam_8c.html#a2">n</a>][c],D-&gt;Ray[k][<a class="code" href="polyparam_8c.html#a2">n</a>+<a class="code" href="polyparam_8c.html#a0">m</a>+1]);   <font class="comment">/* const */</font>
00348           <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Pi-&gt;p[<a class="code" href="polyparam_8c.html#a0">m</a>][c],D-&gt;Ray[k][<a class="code" href="polyparam_8c.html#a2">n</a>+<a class="code" href="polyparam_8c.html#a0">m</a>+1]);   <font class="comment">/* const */</font>
00349           c++;
00350         }
00351       }
00352       
00353       <font class="comment">/* Status bit */</font>
00354       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(RaysDi-&gt;p[RaysDi-&gt;NbRows][0],D-&gt;Ray[k][0]);     
00355       <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(&amp;D-&gt;Ray[k][<a class="code" href="polyparam_8c.html#a2">n</a>+1],&amp;RaysDi-&gt;p[RaysDi-&gt;NbRows][1],(<a class="code" href="polyparam_8c.html#a0">m</a>+1));
00356       ++<a class="code" href="polyparam_8c.html#a12">RaysDi</a>-&gt;NbRows;
00357     }
00358     NEXT(kx,bx);
00359   }
00360   
00361 <font class="preprocessor">#ifdef DEBUGPP41</font>
00362 <font class="preprocessor"></font>  printf(<font class="stringliteral">"\nRaysDi=\n"</font>);
00363   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stdout,P_VALUE_FMT,<a class="code" href="polyparam_8c.html#a12">RaysDi</a>);
00364   <font class="keywordflow">if</font>(c &lt; <a class="code" href="polyparam_8c.html#a0">m</a>+1)
00365     printf(<font class="stringliteral">"Invalid "</font>);
00366   printf(<font class="stringliteral">"Pi=\n"</font>);
00367   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stdout,P_VALUE_FMT,<a class="code" href="polyparam_8c.html#a9">Pi</a>);
00368 <font class="preprocessor">#endif</font>
00369 <font class="preprocessor"></font>  
00370 <font class="preprocessor">#ifdef DEBUGPP4</font>
00371 <font class="preprocessor"></font>  <font class="keywordflow">if</font>(c &lt; <a class="code" href="polyparam_8c.html#a0">m</a>+1)
00372     fprintf(stderr,<font class="stringliteral">"Eliminated because of no vertex\n"</font>);
00373 <font class="preprocessor">#endif</font>
00374 <font class="preprocessor"></font>
00375   <font class="keywordflow">if</font>(c &lt; <a class="code" href="polyparam_8c.html#a0">m</a>+1)   
00376     <font class="keywordflow">return</font>;
00377 
00378   <font class="comment">/* RaysDi-&gt;numColumns = m+2; */</font>  <font class="comment">/* stays the same */</font>
00379 
00380   <font class="comment">/*    Xi-&gt;NbColumns = m+1;*/</font>  <font class="comment">/* VIN100: stays the same. was 'c'! */</font>
00381   <font class="comment">/*    Xi-&gt;NbRows = n+1; */</font>    <font class="comment">/* stays the same */</font>
00382   <font class="comment">/*    Pi-&gt;NbColumns = m+1;*/</font>  <font class="comment">/* VIN100: stays the same. was 'c'! */</font>
00383   <font class="comment">/*    Pi-&gt;NbRows = m+1; */</font>            <font class="comment">/* stays the same */</font>
00384   
00385 <font class="preprocessor">#ifdef DEBUGPP4</font>
00386 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"Xi = "</font>);
00387   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,P_VALUE_FMT,<a class="code" href="polyparam_8c.html#a8">Xi</a>);
00388   fprintf(stderr,<font class="stringliteral">"Pi = "</font>);
00389   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,P_VALUE_FMT,<a class="code" href="polyparam_8c.html#a9">Pi</a>);
00390 <font class="preprocessor">#endif</font>
00391 <font class="preprocessor"></font>  
00392   <font class="comment">/* (Right) invert Pi if POSSIBLE, if not then next m-face */</font>
00393   <font class="comment">/* Pi is destroyed                                        */</font>
00394   <font class="keywordflow">if</font>(!<a class="code" href="matrix_8c.html#a8">MatInverse</a>(<a class="code" href="polyparam_8c.html#a9">Pi</a>,<a class="code" href="polyparam_8c.html#a11">PiInv</a>))<font class="keyword"> </font>{
00395     
00396 <font class="preprocessor">#ifdef DEBUGPP4</font>
00397 <font class="preprocessor"></font>    fprintf(stderr, <font class="stringliteral">"Eliminated because of no inverse Pi\n"</font>);
00398 <font class="preprocessor">#endif</font>
00399 <font class="preprocessor"></font>    
00400     <font class="keywordflow">return</font>;
00401   }
00402   
00403 <font class="preprocessor">#ifdef DEBUGPP4</font>
00404 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"FACE GENERATED!\n"</font>);
00405   fprintf(stderr,<font class="stringliteral">"PiInv = "</font>);
00406   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,P_VALUE_FMT,<a class="code" href="polyparam_8c.html#a11">PiInv</a>);
00407 <font class="preprocessor">#endif</font>
00408 <font class="preprocessor"></font>  
00409   <font class="comment">/* Compute  Si (now called Ti in the paper) */</font>
00410   Si = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(Xi-&gt;NbRows,PiInv-&gt;NbColumns);
00411   <a class="code" href="matrix_8c.html#a9">rat_prodmat</a>(Si,<a class="code" href="polyparam_8c.html#a8">Xi</a>,<a class="code" href="polyparam_8c.html#a11">PiInv</a>);
00412   
00413 <font class="preprocessor">#ifdef DEBUGPP4</font>
00414 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"Si = "</font>);
00415   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,P_VALUE_FMT,Si);
00416 <font class="preprocessor">#endif</font>
00417 <font class="preprocessor"></font>  
00418   Si-&gt;NbRows--;      <font class="comment">/* throw out the last row = 0 ... 0 1 */</font>
00419   
00420   <font class="comment">/* Copy all of that into the PV structure */</font>
00421   PV = (Param_Vertices *) malloc(<font class="keyword">sizeof</font>(Param_Vertices));
00422   PV-&gt;next = <a class="code" href="polyparam_8c.html#a15">PV_Result</a>;
00423   PV-&gt;Vertex = Si;
00424   PV-&gt;Domain = NULL;
00425   <a class="code" href="polyparam_8c.html#a15">PV_Result</a> = PV;
00426   <a class="code" href="polyparam_8c.html#a14">nbPV</a>++;         <font class="comment">/* increment vertex count */</font>
00427   
00428   <font class="comment">/* Ok... now compute the parameter domain */</font>
00429   PDi = <a class="code" href="polyhedron_8c.html#a26">Rays2Polyhedron</a>(<a class="code" href="polyparam_8c.html#a12">RaysDi</a>,<a class="code" href="polyparam_8c.html#a3">ws</a>);
00430   
00431 <font class="preprocessor">#ifdef DEBUGPP3</font>
00432 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"RaysDi = "</font>);
00433   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,P_VALUE_FMT,<a class="code" href="polyparam_8c.html#a12">RaysDi</a>);
00434   fprintf(stderr,<font class="stringliteral">"PDi = "</font>);
00435   <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,P_VALUE_FMT,PDi);
00436 <font class="preprocessor">#endif</font>
00437 <font class="preprocessor"></font>  
00438   <font class="keywordflow">if</font>(<a class="code" href="polyparam_8c.html#a13">KD</a>==0) {
00439     
00440     <font class="comment">/* Add the equalities again to the domain */</font>
00441     PDi = <a class="code" href="polyparam_8c.html#a25">Add_CEqualities</a>(PDi);
00442     PV-&gt;Domain = <a class="code" href="polyhedron_8c.html#a25">Polyhedron2Constraints</a>(PDi);
00443     <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(PDi);
00444   }
00445   <font class="keywordflow">else</font> {
00446     Param_Domain *PD;
00447     PD = (Param_Domain *) malloc(<font class="keyword">sizeof</font>(Param_Domain));
00448     PD-&gt;Domain = PDi;
00449     PD-&gt;F = NULL;
00450     PD-&gt;next = <a class="code" href="polyparam_8c.html#a16">PDomains</a>;
00451     <a class="code" href="polyparam_8c.html#a16">PDomains</a> = PD;
00452   }
00453   <font class="keywordflow">return</font>;
00454 } <font class="comment">/* traite_m_face */</font>
00455 
00456 <font class="comment">/*----------------------------------------------------------------------*/</font>
00457 <font class="comment">/* count_sat                                                            */</font>
00458 <font class="comment">/*      count the number of saturated rays in the bit vector mf         */</font>
00459 <font class="comment">/*      Uses nr from global area                                        */</font>
00460 <font class="comment">/*----------------------------------------------------------------------*/</font>
<a name="l00461"></a><a class="code" href="polyparam_8c.html#a17">00461</a> <font class="keywordtype">int</font> <a class="code" href="polyparam_8c.html#a17">cntbit</a>[256] = {                             <font class="comment">/* counts for 8 bits */</font>
00462 0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4,
00463 1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5,
00464 1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5,
00465 2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
00466 
00467 1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5,
00468 2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
00469 2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
00470 3, 4, 4, 5, 4, 5, 5, 6, 4, 5, 5, 6, 5, 6, 6, 7,
00471 
00472 1, 2, 2, 3, 2, 3, 3, 4, 2, 3, 3, 4, 3, 4, 4, 5,
00473 2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
00474 2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
00475 3, 4, 4, 5, 4, 5, 5, 6, 4, 5, 5, 6, 5, 6, 6, 7,
00476 
00477 2, 3, 3, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 5, 5, 6,
00478 3, 4, 4, 5, 4, 5, 5, 6, 4, 5, 5, 6, 5, 6, 6, 7,
00479 3, 4, 4, 5, 4, 5, 5, 6, 4, 5, 5, 6, 5, 6, 6, 7,
00480 4, 5, 5, 6, 5, 6, 6, 7, 5, 6, 6, 7, 6, 7, 7, 8 };
00481 
<a name="l00482"></a><a class="code" href="polyparam_8c.html#a27">00482</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="polyparam_8c.html#a27">count_sat</a> (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> *mf)<font class="keyword"> </font>{
00483   
00484   <font class="keyword">register</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> i, tmp, cnt=0;
00485   
00486   <font class="keywordflow">for</font> (i=0; i&lt;<a class="code" href="polyparam_8c.html#a4">nr</a>; i++) {
00487     tmp = mf[i];
00488     cnt = cnt
00489       + <a class="code" href="polyparam_8c.html#a17">cntbit</a>[ tmp &amp; 0xff ]
00490       + <a class="code" href="polyparam_8c.html#a17">cntbit</a>[ (tmp&gt;&gt;8) &amp; 0xff ]
00491       + <a class="code" href="polyparam_8c.html#a17">cntbit</a>[ (tmp&gt;&gt;16) &amp; 0xff ]
00492       + <a class="code" href="polyparam_8c.html#a17">cntbit</a>[ (tmp&gt;&gt;24) &amp; 0xff ]
00493       ;
00494   }
00495   <font class="keywordflow">return</font> cnt;
00496 } <font class="comment">/* count_sat */</font>
00497 
00498 <font class="comment">/*----------------------------------------------------------------------*/</font>
00499 <font class="comment">/* let D + E + L be the dimension of the polyhedron                     */</font>
00500 <font class="comment">/* D = Dimension of polytope (ray space)                                */</font>
00501 <font class="comment">/* L = Dimension of Lineality space (number of lines, bid)              */</font>
00502 <font class="comment">/* E = Dimension of Affine hull (number of equations)                   */</font>
00503 <font class="comment">/* n = number of data indices                                           */</font>
00504 <font class="comment">/* m = number of parameters                                             */</font>
00505 <font class="comment">/* full domain:                                                         */</font>
00506 <font class="comment">/*     n + m = D + E + L                                                */</font>
00507 <font class="comment">/* projected domains:                                                   */</font>
00508 <font class="comment">/*     m = D_m + E_m + L_m                                              */</font>
00509 <font class="comment">/*     n = D_n + E_n + L_n                                              */</font>
00510 <font class="comment">/* What dimension M-face, when projected onto parameter space,          */</font>
00511 <font class="comment">/* will give an L_m-face?                                               */</font>
00512 <font class="comment">/* What are the conditions?                                             */</font>
00513 <font class="comment">/*   - at least one vertex                                              */</font>
00514 <font class="comment">/*   - number of rays &gt;= D_m+1 after removal of redundants              */</font>
00515 <font class="comment">/*                                                                      */</font>
00516 <font class="comment">/* dim of face    nb saturated constraints   nb saturated lines,rays    */</font>
00517 <font class="comment">/* -----------    ------------------------   -----------------------    */</font>
00518 <font class="comment">/* (0+L)-face     all E eqns + &gt;=D ineq      all L lines + 1 ray        */</font>
00519 <font class="comment">/* (M+L)-face     all E eqns + &gt;=(D-M) ineq  all L lines + &gt;=(M+1) rays */</font>
00520 <font class="comment">/* (D+L)-face     all E eqns + 0 ineq        all L lines + &gt;=(D+1) rays */</font>
00521 <font class="comment">/*----------------------------------------------------------------------*/</font>
00522 <font class="comment">/*----------------------------------------------------------------------*/</font>
00523 <font class="comment">/* scan_m_face                                                          */</font>
00524 <font class="comment">/*      pos : the next candidate constraint position                    */</font>
00525 <font class="comment">/*    nb-un : number of saturated constraints needed to finish a face   */</font>
00526 <font class="comment">/*        D : the source polyhedron (context included )                 */</font>
00527 <font class="comment">/*       mf : bit-array marking rays which are saturated so far         */</font>
00528 <font class="comment">/* From Global area:                                                    */</font>
00529 <font class="comment">/* ----------------                                                     */</font>
00530 <font class="comment">/*        n : number of data indices                                    */</font>
00531 <font class="comment">/*        m : number of parameters                                      */</font>
00532 <font class="comment">/*  egalite : boolean vector marking saturated constraints in m-face    */</font>
00533 <font class="comment">/*      Sat : Saturation Matrix (row=constraints, col=rays)             */</font>
00534 <font class="comment">/*       ws : working space size                                        */</font>
00535 <font class="comment">/*       nr : (NbRays-1)/32 + 1                                         */</font>
00536 <font class="comment">/*                                                                      */</font>
00537 <font class="comment">/* Recursive function to find the rays and vertices of each m-face      */</font>
00538 <font class="comment">/*----------------------------------------------------------------------*/</font>
<a name="l00539"></a><a class="code" href="polyparam_8c.html#a28">00539</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="polyparam_8c.html#a19">scan_m_face</a>(<font class="keywordtype">int</font> pos,<font class="keywordtype">int</font> nb_un,Polyhedron *D,<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> *mf)<font class="keyword"> </font>{
00540   <font class="comment">/* pos   - the next candidate constraint position */</font>
00541   <font class="comment">/* nb_un - the number of constraints needed to finish a face */</font>
00542   <font class="comment">/* D     - the source polyhedron */</font>
00543   <font class="comment">/* mf    - (bit vector) marks rays that are saturated so far */</font>
00544 
00545   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> *new_mf;
00546 
00547 <font class="preprocessor">#ifdef DEBUGPP4</font>
00548 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"Start scan_m_face(pos=%d, nb_un=%d, n=%d, m=%d\n"</font>,
00549           pos,nb_un,<a class="code" href="polyparam_8c.html#a2">n</a>,<a class="code" href="polyparam_8c.html#a0">m</a>);
00550   fprintf(stderr,<font class="stringliteral">"mf = "</font>);
00551   {
00552     <font class="keywordtype">int</font> i;
00553     <font class="keywordflow">for</font>(i=0;i&lt;<a class="code" href="polyparam_8c.html#a4">nr</a>;i++)
00554       fprintf(stderr,<font class="stringliteral">"%08X"</font>, mf[i]);
00555     fprintf(stderr,<font class="stringliteral">"\nequality = ["</font>);
00556     <font class="keywordflow">for</font>(i=0;i&lt;D-&gt;NbConstraints;i++)
00557       fprintf(stderr,<font class="stringliteral">" %1d"</font>,<a class="code" href="polyparam_8c.html#a7">egalite</a>[i]);
00558     fprintf(stderr,<font class="stringliteral">"]\n"</font>);
00559   }
00560 <font class="preprocessor">#endif</font>
00561 <font class="preprocessor"></font>
00562   <font class="keywordflow">if</font>(nb_un == 0) {      <font class="comment">/* Base case */</font>   
00563     <font class="keywordtype">int</font> i,j;
00564     
00565     <font class="comment">/*********** ELIMINATION OF REDUNDANT FACES ***********/</font>
00566     <font class="comment">/* if all these vertices also verify a previous constraint */</font>
00567     <font class="comment">/* which is NOT already selected, we eliminate this face */</font>
00568     <font class="comment">/* This keeps the lexicographically greatest selection */</font>
00569         <font class="keywordflow">for</font>(i=0;i&lt;pos-1;i++)
00570         {
00571                 <font class="keywordflow">if</font>(<a class="code" href="polyparam_8c.html#a7">egalite</a>[i])
00572                         <font class="keywordflow">continue</font>;       <font class="comment">/* already selected */</font>
00573       
00574                 <font class="comment">/* if Sat[i] &amp; mf == mf then it's redundant */</font>
00575                 <font class="keywordflow">for</font> (j=0;j&lt;<a class="code" href="polyparam_8c.html#a4">nr</a>;j++)
00576                 {
00577         
00578 <font class="preprocessor">#ifdef DEBUGPP4</font>
00579 <font class="preprocessor"></font>                        fprintf(stderr,<font class="stringliteral">"mf=%08X Sat[%d]=%08X &amp;=%08X\n"</font>,mf[j],i,Sat-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i][j],
00580                                 (mf[j] &amp; Sat-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i][j]) );
00581 <font class="preprocessor">#endif</font>
00582 <font class="preprocessor"></font>
00583                         <font class="keywordflow">if</font> (((mf[j]) &amp; (<a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i][j])) != mf[j])
00584                                 <font class="keywordflow">break</font>;  <font class="comment">/* it's not redundant */</font>
00585                 }
00586       
00587 <font class="preprocessor">#ifdef DEBUGPP4</font>
00588 <font class="preprocessor"></font>                <font class="keywordflow">if</font> (j==<a class="code" href="polyparam_8c.html#a4">nr</a>) fprintf(stderr, <font class="stringliteral">"Redundant with constraint %d\n"</font>, i);
00589 <font class="preprocessor">#endif</font>
00590 <font class="preprocessor"></font>    
00591                 <font class="keywordflow">if</font> (j==<a class="code" href="polyparam_8c.html#a4">nr</a>) <font class="keywordflow">return</font>;      <font class="comment">/* it is redundant */</font>
00592         }
00593     <font class="comment">/********* END OF ELIMINATION OF DEGENERATE FACES *********/</font>    
00594     <font class="comment">/* if we haven't found a constraint verified by all */</font>
00595     <font class="comment">/* the rays, its OK, it's a new face. */</font>
00596     <a class="code" href="polyparam_8c.html#a18">traite_m_face</a>(D,mf);
00597     <font class="keywordflow">return</font>;
00598   }
00599 
00600   <font class="comment">/* See if there are enough constraints left to finish */</font>
00601   <font class="keywordflow">if</font>((pos+nb_un)&gt;D-&gt;NbConstraints) <font class="keywordflow">return</font>;
00602   
00603   <font class="comment">/* Recurring part of the procedure */</font>
00604   <font class="comment">/* Add the pos'th constraint, compute new saturation vector */</font>
00605   {     
00606     <font class="keywordtype">int</font> k;
00607     new_mf  = (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> *)malloc(<a class="code" href="polyparam_8c.html#a4">nr</a>*<font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>));
00608     <font class="keywordflow">for</font> (k=0; k&lt;<a class="code" href="polyparam_8c.html#a4">nr</a>; k++)
00609       new_mf[k] = mf[k] &amp; <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[pos][k];
00610   }
00611 <font class="preprocessor">#ifdef DEBUGPP4</font>
00612 <font class="preprocessor"></font>fprintf(stderr,<font class="stringliteral">"new_mf = "</font>);
00613  { 
00614    <font class="keywordtype">int</font> i;
00615    <font class="keywordflow">for</font>(i=0;i&lt;<a class="code" href="polyparam_8c.html#a4">nr</a>;i++) {
00616      fprintf(stderr,<font class="stringliteral">"%08X"</font>, new_mf[i]);
00617    }
00618    fprintf(stderr,<font class="stringliteral">"\ncount(new_mf) = %d\n"</font>,<a class="code" href="polyparam_8c.html#a27">count_sat</a>(new_mf));
00619  }
00620 <font class="preprocessor">#endif</font>
00621 <font class="preprocessor"></font>
00622   {
00623         <font class="keywordtype">int</font> c;
00624         c = <a class="code" href="polyparam_8c.html#a27">count_sat</a>(new_mf);
00625         <font class="comment">/* optimization : at least m_dim+1 rays must be saturated to add this constraint */</font>
00626         <font class="keywordflow">if</font> (c&gt;<a class="code" href="polyparam_8c.html#a1">m_dim</a> )
00627         {
00628                 <font class="comment">/* if this constraint does not change anything do not decrement nb_un</font>
00629 <font class="comment">                   (it's a redundant equality). */</font>
00630                 <font class="keywordflow">if</font>( c==<a class="code" href="polyparam_8c.html#a27">count_sat</a>(mf) )<font class="keyword"></font>
00631 <font class="keyword">                </font>{
00632                         <a class="code" href="polyparam_8c.html#a7">egalite</a>[pos]=1;         <font class="comment">/* Try it with the pos-th constraint */</font>
00633                    <a class="code" href="polyparam_8c.html#a19">scan_m_face</a>(pos+1,nb_un,D,new_mf);
00634                 }
00635                 <font class="keywordflow">else</font>
00636                 {
00637                    <a class="code" href="polyparam_8c.html#a7">egalite</a>[pos]=1;              <font class="comment">/* Try it with the pos-th constraint */</font>
00638                    <a class="code" href="polyparam_8c.html#a19">scan_m_face</a>(pos+1,nb_un-1,D,new_mf);
00639                 }
00640         }
00641   }
00642  free(new_mf);
00643  <a class="code" href="polyparam_8c.html#a7">egalite</a>[pos]=0;                <font class="comment">/* Try it without the pos-th constraint */</font>
00644  <font class="keywordflow">if</font> ((pos+nb_un)&gt;=D-&gt;NbConstraints) <font class="keywordflow">return</font>;
00645  <a class="code" href="polyparam_8c.html#a19">scan_m_face</a>(pos+1,nb_un,D,mf);
00646  <font class="keywordflow">return</font>;
00647 } <font class="comment">/* scan_m_face */</font>
00648 
00649 <font class="comment">/*</font>
00650 <font class="comment"> * Create a saturation matrix with rows correspond to the constraints and </font>
00651 <font class="comment"> * columns correspond to the rays of the polyhedron 'Pol'. Global variable </font>
00652 <font class="comment"> * 'nr' is set in the function.             </font>
00653 <font class="comment"> */</font>
<a name="l00654"></a><a class="code" href="polyparam_8c.html#a29">00654</a> <font class="keyword">static</font> <a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a29">Poly2Sat</a>(Polyhedron *Pol,<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> **L)<font class="keyword"> </font>{ 
00655   
00656   <a class="code" href="structSatMatrix.html">SatMatrix</a> *<a class="code" href="polyparam_8c.html#a6">Sat</a>;
00657   <font class="keywordtype">int</font> i, j, k, kx;
00658   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> *Temp;
00659   Value *p1, *p2, p3,tmp;
00660   <font class="keywordtype">unsigned</font> Dimension, NbRay, NbCon, bx;
00661   
00662   <font class="comment">/* Initialize all the 'Value' variables */</font>
00663   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(p3); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
00664   
00665   NbRay = Pol-&gt;NbRays;
00666   NbCon = Pol-&gt;NbConstraints;
00667   Dimension = Pol-&gt;Dimension+1;                <font class="comment">/* Homogeneous Dimension */</font>
00668   
00669   <font class="comment">/* Build the Sat matrix */</font>
00670   <a class="code" href="polyparam_8c.html#a4">nr</a>      = (NbRay - 1)/(<font class="keyword">sizeof</font>(int)*8) + 1;   <font class="comment">/* Set globally */</font>
00671   <a class="code" href="polyparam_8c.html#a6">Sat</a>     = <a class="code" href="polyparam_8c.html#a23">SMAlloc</a>(NbCon,<a class="code" href="polyparam_8c.html#a4">nr</a>);
00672   Temp     = (<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> *)malloc(<a class="code" href="polyparam_8c.html#a4">nr</a>*<font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>));
00673   memset(Sat-&gt;<a class="code" href="structSatMatrix.html#m3">p_init</a>,0,<a class="code" href="polyparam_8c.html#a4">nr</a>*NbCon*<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
00674   memset(Temp,0,<a class="code" href="polyparam_8c.html#a4">nr</a>*<font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font> <font class="keywordtype">int</font>));
00675   kx=0; bx=MSB;
00676   <font class="keywordflow">for</font> (k=0; k&lt;NbRay; k++) { 
00677     <font class="keywordflow">for</font> (i=0; i&lt;NbCon; i++) {
00678       p1 = &amp;Pol-&gt;Constraint[i][1];
00679       p2 = &amp;Pol-&gt;Ray[k][1];
00680       <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(p3,0);
00681       <font class="keywordflow">for</font> (j=0;j&lt;Dimension;j++) {
00682         <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp,*p1,*p2);
00683         <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(p3,p3,tmp);
00684         p1++; p2++;
00685       }
00686       <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(p3))
00687         <a class="code" href="polyparam_8c.html#a6">Sat</a>-&gt;<a class="code" href="structSatMatrix.html#m2">p</a>[i][kx]|=bx;
00688     }
00689     Temp[kx] |= bx;
00690     NEXT(kx, bx);
00691   }
00692   
00693   <font class="comment">/* Set 'L' to an array containing ones in every bit position of its */</font>
00694   <font class="comment">/* elements.                                                        */</font>
00695   *L = Temp;
00696   
00697   <font class="comment">/* Clear all the 'Value' variables */</font>
00698   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p3); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00699   
00700   <font class="keywordflow">return</font> <a class="code" href="polyparam_8c.html#a6">Sat</a>;
00701 } <font class="comment">/* Poly2Sat */</font>
00702 
00703 <font class="comment">/*</font>
00704 <font class="comment"> * Create a parametrized polyhedron with zero parametres. This function was </font>
00705 <font class="comment"> * first written by Xavier Redon, and was later modified by others.</font>
00706 <font class="comment"> */</font>
<a name="l00707"></a><a class="code" href="polyparam_8c.html#a30">00707</a> Param_Polyhedron *<a class="code" href="polyparam_8c.html#a30">GenParamPolyhedron</a>(Polyhedron *Pol)<font class="keyword"> </font>{
00708   
00709   Param_Polyhedron *result;
00710   Matrix *rays;
00711   <font class="keywordtype">int</font> nbRows, nbColumns;
00712   <font class="keywordtype">int</font> i, size;
00713   
00714   rays=<a class="code" href="polyhedron_8c.html#a33">Polyhedron2Rays</a>(Pol);
00715   nbRows=rays-&gt;NbRows;
00716   nbColumns=rays-&gt;NbColumns;
00717   
00718   <font class="comment">/* Check that the polyhedron is bounded */</font>
00719   <font class="keywordflow">for</font>(i=0;i&lt;nbRows;i++)
00720     <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a70">value_notone_p</a>(rays-&gt;p[i][0]) ||
00721        value_zero_p(rays-&gt;p[i][nbColumns-1]))
00722       <font class="keywordflow">return</font> NULL;
00723   
00724   <font class="comment">/* Initialize the result */</font>
00725   result=(Param_Polyhedron *)malloc(<font class="keyword">sizeof</font>(Param_Polyhedron));
00726   result-&gt;nbV=nbRows;
00727   result-&gt;V=NULL;
00728   
00729   <font class="comment">/* Build the parametric vertices */</font>
00730   <font class="keywordflow">for</font>(i=0;i&lt;nbRows;i++) {
00731     Matrix *vertex;
00732     Param_Vertices *paramVertex;
00733     <font class="keywordtype">int</font> j;
00734     
00735     vertex=<a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(nbColumns-2,2);
00736     <font class="keywordflow">for</font>(j=1;j&lt;nbColumns-1;j++) {
00737       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(vertex-&gt;p[j-1][0],rays-&gt;p[i][j]);
00738       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(vertex-&gt;p[j-1][1],rays-&gt;p[i][nbColumns-1]);
00739     }
00740     paramVertex=(Param_Vertices *)malloc(<font class="keyword">sizeof</font>(Param_Vertices));
00741     paramVertex-&gt;Vertex=vertex;
00742     
00743     <font class="comment">/* There is one validity domain : universe of dimension 0 */</font>
00744     paramVertex-&gt;Domain=<a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(1,2);
00745     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(paramVertex-&gt;Domain-&gt;p[0][0],1);
00746     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(paramVertex-&gt;Domain-&gt;p[0][1],1);    
00747     paramVertex-&gt;next=result-&gt;V;
00748     result-&gt;V=paramVertex;
00749   }
00750   
00751   <font class="comment">/* Build the parametric domains (only one here) */</font>
00752   <font class="keywordflow">if</font> (nbRows &gt; 1)
00753     size=(nbRows-1)/(8*<font class="keyword">sizeof</font>(int))+1;
00754   <font class="keywordflow">else</font>
00755     size = 1;
00756   result-&gt;D=(Param_Domain *)malloc(<font class="keyword">sizeof</font>(Param_Domain));
00757   result-&gt;D-&gt;next=NULL;
00758   result-&gt;D-&gt;Domain=<a class="code" href="polyhedron_8c.html#a23">Universe_Polyhedron</a>(0);
00759   result-&gt;D-&gt;F=(<font class="keywordtype">int</font> *)malloc(size*<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
00760   memset(&amp;result-&gt;D-&gt;F[0],0xFF,size*<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
00761   
00762   <font class="keywordflow">return</font> result;
00763 } <font class="comment">/* GenParamPolyhedron */</font>
00764 
00765 
00766 <font class="comment">/*----------------------------------------------------------------------*/</font>
00767 <font class="comment">/* PreElim_Columns                                                      */</font>
00768 <font class="comment">/* function being called before Elim_Columns                            */</font>
00769 <font class="comment">/* Equalities in E are analysed to initialize ref and p.                */</font>
00770 <font class="comment">/* These two vectors are used to construct the new constraint matrix    */</font>
00771 <font class="comment">/* PreElim_Columns returns the transformation matrix to re-convert the  */</font>
00772 <font class="comment">/* resulting domains in the same format (by adding empty columns)       */</font>
00773 <font class="comment">/* in the parameter space                                               */</font>
00774 <font class="comment">/*----------------------------------------------------------------------*/</font>
<a name="l00775"></a><a class="code" href="polyparam_8c.html#a31">00775</a> Matrix *<a class="code" href="polyparam_8c.html#a31">PreElim_Columns</a>(Polyhedron *E,<font class="keywordtype">int</font> *p,<font class="keywordtype">int</font> *ref,<font class="keywordtype">int</font> <a class="code" href="polyparam_8c.html#a0">m</a>)<font class="keyword"> </font>{
00776         
00777   <font class="keywordtype">int</font> i,j,l;
00778   Matrix *T;
00779   
00780   <font class="comment">/* find which columns to eliminate */</font>
00781   <font class="comment">/* p contains, for each line in E, the column to eliminate */</font>
00782   <font class="comment">/* (i.e. the corresponding parameter index to eliminate) */</font>
00783   <font class="comment">/* 0 &lt;= i &lt;= E-&gt;NbEq, and  1 &lt;= p[i] &lt;= E-&gt;Dimension */</font>
00784   memset(p,0,<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>)*(E-&gt;NbEq));
00785 
00786 <font class="preprocessor">#ifdef DEBUGPP32</font>
00787 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"\n\nPreElim_Columns starting\n"</font>);
00788   fprintf(stderr,<font class="stringliteral">"E =\n"</font>);
00789   <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,P_VALUE_FMT,E);
00790 <font class="preprocessor">#endif</font>
00791 <font class="preprocessor"></font>  
00792   <font class="keywordflow">for</font>(l=0;l&lt;E-&gt;NbEq;++l) {
00793     <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(E-&gt;Constraint[l][0]))<font class="keyword"> </font>{
00794       fprintf(stderr,<font class="stringliteral">"Internal error: Elim_Columns (polyparam.c), expecting equalities first in E.\n"</font>);
00795       free(p);
00796       <font class="keywordflow">return</font>(NULL);
00797     }
00798     <font class="keywordflow">for</font>(i=1;<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(E-&gt;Constraint[l][i]);++i) {
00799       <font class="keywordflow">if</font>(i==E-&gt;Dimension+1) {
00800         fprintf(stderr,<font class="stringliteral">"Internal error: Elim_Columns (polyparam.c), expecting non-empty constraint in E.\n"</font>);
00801         free(p);
00802         <font class="keywordflow">return</font>( NULL );
00803       }
00804     }
00805     p[l] = i;
00806     
00807 <font class="preprocessor">#ifdef DEBUGPP32</font>
00808 <font class="preprocessor"></font>    fprintf(stderr,<font class="stringliteral">"p[%d] = %d,"</font>,l,p[l]);
00809 <font class="preprocessor">#endif</font>
00810 <font class="preprocessor"></font>  }
00811 
00812   <font class="comment">/* Reference vector: column ref[i] in A corresponds to column i in M */</font>
00813   <font class="keywordflow">for</font>(i=0;i&lt;E-&gt;Dimension+2-E-&gt;NbEq;++i) {
00814     ref[i]=i;
00815     <font class="keywordflow">for</font>(j=0;j&lt;E-&gt;NbEq;++j)
00816       <font class="keywordflow">if</font>(p[j]&lt;=ref[i])
00817         ref[i]++;
00818     
00819 <font class="preprocessor">#ifdef DEBUGPP32</font>
00820 <font class="preprocessor"></font>    fprintf(stderr,<font class="stringliteral">"ref[%d] = %d,"</font>,i,ref[i]);
00821 <font class="preprocessor">#endif</font>
00822 <font class="preprocessor"></font>  }
00823   
00824   <font class="comment">/* Size of T : phdim-nbEq * phdim */</font>
00825   T = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(<a class="code" href="polyparam_8c.html#a0">m</a>+1-E-&gt;NbEq,<a class="code" href="polyparam_8c.html#a0">m</a>+1);
00826   <font class="keywordflow">for</font>(i=0;i&lt;T-&gt;NbColumns;i++)
00827     <font class="keywordflow">for</font>(j=0;j&lt;T-&gt;NbRows;j++)
00828       <font class="keywordflow">if</font>(ref[E-&gt;Dimension-<a class="code" href="polyparam_8c.html#a0">m</a>+j+1] == E-&gt;Dimension-<a class="code" href="polyparam_8c.html#a0">m</a>+i+1)
00829         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(T-&gt;p[j][i],1);
00830       <font class="keywordflow">else</font>
00831         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(T-&gt;p[j][i],0);
00832   
00833 <font class="preprocessor">#ifdef DEBUGPP32</font>
00834 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"\nTransMatrix =\n"</font>);
00835   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,P_VALUE_FMT,T);
00836 <font class="preprocessor">#endif</font>
00837 <font class="preprocessor"></font>  
00838   <font class="keywordflow">return</font>(T);
00839 
00840 } <font class="comment">/* PreElim_Columns */</font>
00841 
00842 <font class="comment">/*----------------------------------------------------------------------*/</font>
00843 <font class="comment">/* Elim_Columns                                                         */</font>
00844 <font class="comment">/* Eliminate columns from A, using the equalities in E.                 */</font>
00845 <font class="comment">/* ref and p are precalculated by PreElim_Columns, using E;             */</font>
00846 <font class="comment">/* these two vectors are used to construct the new constraint matrix    */</font>
00847 <font class="comment">/*----------------------------------------------------------------------*/</font>
<a name="l00848"></a><a class="code" href="polyparam_8c.html#a32">00848</a> Polyhedron *<a class="code" href="polyparam_8c.html#a32">Elim_Columns</a>(Polyhedron *A,Polyhedron *E,<font class="keywordtype">int</font> *p,<font class="keywordtype">int</font> *ref)<font class="keyword"> </font>{
00849   
00850   <font class="keywordtype">int</font> i,l,c;
00851   Matrix *M, *C;
00852   Polyhedron *R;
00853   Value tmp1,tmp2;
00854   
00855   <font class="comment">/* Initialize all the 'Value' variables */</font>
00856   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp1); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp2);
00857   
00858 <font class="preprocessor">#ifdef DEBUGPP32</font>
00859 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"\nElim_Columns starting\n"</font>);
00860   fprintf(stderr,<font class="stringliteral">"A =\n"</font> );
00861   <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,P_VALUE_FMT,A);
00862 <font class="preprocessor">#endif</font>
00863 <font class="preprocessor"></font>  
00864   <font class="comment">/* Builds M = constraint matrix of A, useless columns zeroed */</font>
00865   M = <a class="code" href="polyhedron_8c.html#a25">Polyhedron2Constraints</a>(A);
00866   <font class="keywordflow">for</font>(l=0;l&lt;E-&gt;NbEq;++l) {    
00867     <font class="keywordflow">for</font>(c=0;c&lt;M-&gt;NbRows;++c) {
00868       <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(M-&gt;p[c][p[l]]))<font class="keyword"> </font>{
00869         
00870         <font class="comment">/* A parameter to eliminate here ! */</font>
00871         <font class="keywordflow">for</font>(i=1;i&lt;M-&gt;NbColumns;++i) {
00872           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp1,M-&gt;p[c][i],E-&gt;Constraint[l][p[l]]);
00873           <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp2,E-&gt;Constraint[l][i],M-&gt;p[c][p[l]]);
00874           <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(M-&gt;p[c][i],tmp1,tmp2);
00875         }
00876       }
00877     }
00878   } 
00879   
00880 <font class="preprocessor">#ifdef DEBUGPP32</font>
00881 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"\nElim_Columns after zeroing columns of A.\n"</font>);
00882   fprintf(stderr,<font class="stringliteral">"M =\n"</font>);
00883   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,P_VALUE_FMT,M);
00884 <font class="preprocessor">#endif</font>
00885 <font class="preprocessor"></font>  
00886   <font class="comment">/* Builds C = constraint matrix, useless columns eliminated */</font>
00887   C = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(M-&gt;NbRows,M-&gt;NbColumns - E-&gt;NbEq);
00888   <font class="keywordflow">for</font>(l=0;l&lt;C-&gt;NbRows;++l)
00889     <font class="keywordflow">for</font>(c=0;c&lt;C-&gt;NbColumns;++c) {
00890       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(C-&gt;p[l][c],M-&gt;p[l][ref[c]]);
00891     }
00892     
00893 <font class="preprocessor">#ifdef DEBUGPP32</font>
00894 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"\nElim_Columns after eliminating columns of A.\n"</font>);
00895   fprintf(stderr,<font class="stringliteral">"C =\n"</font>);
00896   <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,P_VALUE_FMT,C);
00897 <font class="preprocessor">#endif</font>
00898 <font class="preprocessor"></font>    
00899   R = <a class="code" href="polyhedron_8c.html#a24">Constraints2Polyhedron</a>(C,<a class="code" href="polyparam_8c.html#a3">ws</a>);
00900   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(C);
00901   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(M);
00902   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp2);
00903   <font class="keywordflow">return</font>(R);
00904 } <font class="comment">/* Elim_Columns */</font>
00905 
00906 <font class="comment">/* </font>
00907 <font class="comment"> * Given a polyhedron 'Di' in combined data and parameter space and a context </font>
00908 <font class="comment"> * polyhedron 'C' representing the constraints on the parameter space, create</font>
00909 <font class="comment"> * a list of parameterized vertices and assign values to global variables: </font>
00910 <font class="comment"> * m,n,ws,Sat,egalite,mf,Xi,Pi,PiInv,RaysDi,CEqualities. </font>
00911 <font class="comment"> */</font>
<a name="l00912"></a><a class="code" href="polyparam_8c.html#a33">00912</a> Param_Polyhedron *<a class="code" href="polyparam_8c.html#a33">Find_m_faces</a>(Polyhedron **Di,Polyhedron *C,<font class="keywordtype">int</font> keep_dom,<font class="keywordtype">int</font> working_space,Polyhedron **CEq,Matrix **CT)<font class="keyword"> </font>{     
00913   
00914   <font class="keywordtype">unsigned</font> <font class="keywordtype">int</font> *mf;
00915   <font class="keywordtype">int</font> i, j;
00916   Polyhedron *D=*Di,
00917              *C1,         <font class="comment">/* true context */</font>
00918              *D1;         <font class="comment">/* the combined polyhedron, including context C */</font>
00919   Matrix *M;
00920   Param_Polyhedron *res;
00921   <font class="keywordtype">int</font> *p, *ref;
00922 
00923   <font class="keywordflow">if</font>(CT) {
00924     *CEq = NULL;
00925     *CT = NULL;
00926   }
00927   
00928   <font class="keywordflow">if</font>(!D || !C) 
00929     <font class="keywordflow">return</font> (Param_Polyhedron *) 0;
00930 
00931   <a class="code" href="polyparam_8c.html#a3">ws</a> = working_space;
00932   <a class="code" href="polyparam_8c.html#a0">m</a> = C-&gt;Dimension;
00933   <a class="code" href="polyparam_8c.html#a2">n</a> = D-&gt;Dimension - <a class="code" href="polyparam_8c.html#a0">m</a>;
00934   <font class="keywordflow">if</font>(<a class="code" href="polyparam_8c.html#a2">n</a>&lt;0) {
00935     fprintf(stderr,
00936             <font class="stringliteral">"Find_m_faces: ?%d parameters of a %d-polyhedron !\n"</font>,<a class="code" href="polyparam_8c.html#a0">m</a>,<a class="code" href="polyparam_8c.html#a2">n</a>);
00937     <font class="keywordflow">return</font> (Param_Polyhedron *) 0;
00938   }
00939   <font class="keywordflow">if</font>(<a class="code" href="polyparam_8c.html#a0">m</a>==0) {
00940     Param_Polyhedron *result=<a class="code" href="polyparam_8c.html#a30">GenParamPolyhedron</a>(D);
00941     <font class="keywordflow">if</font>(result)
00942       <font class="keywordflow">return</font> result;
00943     <font class="keywordflow">else</font> {
00944       fprintf(stderr,<font class="stringliteral">"Find_m_faces: polyhedron is not bounded!\n"</font>);
00945       <font class="keywordflow">return</font> (Param_Polyhedron *) 0;
00946     }
00947   }
00948   
00949   <font class="comment">/* Add constraints from Context to D -&gt; result in D1 */</font>
00950   C1 = <a class="code" href="polyhedron_8c.html#a47">align_context</a>(C,D-&gt;Dimension,<a class="code" href="polyparam_8c.html#a3">ws</a>);
00951 
00952 <font class="preprocessor">#ifdef DEBUGPP31</font>
00953 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"m = %d\n"</font>,<a class="code" href="polyparam_8c.html#a0">m</a>);
00954   fprintf(stderr, <font class="stringliteral">"D = "</font>);
00955   <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,P_VALUE_FMT,D);
00956   fprintf(stderr,<font class="stringliteral">"C1 = "</font>);
00957   <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,P_VALUE_FMT,C1);
00958 <font class="preprocessor">#endif</font>
00959 <font class="preprocessor"></font>  
00960   D1 = <a class="code" href="polyhedron_8c.html#a32">DomainIntersection</a>(D,C1,<a class="code" href="polyparam_8c.html#a3">ws</a>);
00961 
00962 <font class="preprocessor">#ifdef DEBUGPP31</font>
00963 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"D1 = "</font>);
00964   <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,P_VALUE_FMT,D1);
00965 <font class="preprocessor">#endif</font>
00966 <font class="preprocessor"></font>  
00967   <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(C1);
00968 
00969   <font class="keywordflow">if</font>(!D1 || emptyQ(D1))
00970     <font class="keywordflow">return</font>(NULL);
00971   
00972   <font class="comment">/* Compute the true context C1 */</font>
00973   <font class="comment">/* M : lines in the direction of the first n indices (index space) */</font>
00974   M   = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(<a class="code" href="polyparam_8c.html#a2">n</a>, D1-&gt;Dimension+2);
00975   <a class="code" href="vector_8c.html#a9">Vector_Set</a>(M-&gt;p[0],0,<a class="code" href="polyparam_8c.html#a2">n</a>*(D1-&gt;Dimension+2));
00976   <font class="keywordflow">for</font> (i=0; i&lt;<a class="code" href="polyparam_8c.html#a2">n</a>; i++)
00977     <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(M-&gt;p[i][i+1],1);
00978   C1 = <a class="code" href="polyhedron_8c.html#a35">DomainAddRays</a>(D1,M,<a class="code" href="polyparam_8c.html#a3">ws</a>);
00979   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(M);
00980   
00981 <font class="preprocessor">#ifdef DEBUGPP31</font>
00982 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"True context C1 = "</font>);
00983   <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,P_VALUE_FMT,C1);
00984 <font class="preprocessor">#endif</font>
00985 <font class="preprocessor"></font>  
00986   <font class="comment">/* CEqualities contains the constraints (to be added again later) */</font>
00987   <font class="comment">/* *CT is the transformation matrix to add the removed parameters */</font>
00988   <font class="keywordflow">if</font>(!CT) {
00989     <font class="keywordflow">if</font>(C1-&gt;NbEq == 0)
00990       <a class="code" href="polyparam_8c.html#a5">CEqualities</a> = NULL;
00991     <font class="keywordflow">else</font> {
00992       Polyhedron *CEq1, <font class="comment">/* CEqualities, in homogeneous dim */</font>
00993                  *C2,   <font class="comment">/* C1 (temporary) simplified */</font>
00994                  *D2;   <font class="comment">/* D1, (temporary) simplified */</font>
00995       
00996       <font class="comment">/* Remove equalities from true context C1 and from D1             */</font>     
00997       <font class="comment">/* Compute CEqualities = matrix of equalities in C1, projected in */</font>
00998       <font class="comment">/* the parameter space                                            */</font>
00999       M = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(C1-&gt;NbEq,<a class="code" href="polyparam_8c.html#a0">m</a>+2);
01000       <font class="keywordflow">for</font>(j=0,i=0;i&lt;C1-&gt;NbEq;++i,++j) {
01001         <font class="keywordflow">while</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(C1-&gt;Constraint[j][0]))
01002           ++j;
01003         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(M-&gt;p[i][0],C1-&gt;Constraint[j][0]);
01004         <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(&amp;C1-&gt;Constraint[j][D-&gt;Dimension-<a class="code" href="polyparam_8c.html#a0">m</a>+1],&amp;M-&gt;p[i][1],(<a class="code" href="polyparam_8c.html#a0">m</a>+1));
01005       }
01006       <a class="code" href="polyparam_8c.html#a5">CEqualities</a> = <a class="code" href="polyhedron_8c.html#a24">Constraints2Polyhedron</a>(M,<a class="code" href="polyparam_8c.html#a3">ws</a>);
01007       <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(M);
01008       CEq1 = <a class="code" href="polyhedron_8c.html#a47">align_context</a>(<a class="code" href="polyparam_8c.html#a5">CEqualities</a>,D-&gt;Dimension,<a class="code" href="polyparam_8c.html#a3">ws</a>);
01009 
01010       <font class="comment">/* Simplify D1 and C1 (remove the equalities) */</font>
01011       D2 = <a class="code" href="polyhedron_8c.html#a42">DomainSimplify</a>(D1,CEq1,<a class="code" href="polyparam_8c.html#a3">ws</a>);
01012       C2 = <a class="code" href="polyhedron_8c.html#a42">DomainSimplify</a>(C1,CEq1,<a class="code" href="polyparam_8c.html#a3">ws</a>);
01013       <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(D1);
01014       <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(C1);
01015       <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(CEq1);
01016       D1 = D2;
01017       C1 = C2;
01018     }
01019   }
01020   <font class="keywordflow">else</font> { <font class="comment">/* if( CT  ) */</font>
01021     Polyhedron *CEq1,   <font class="comment">/* CEqualities */</font>
01022                *C2,     <font class="comment">/* C1 (temporary) simplified */</font>
01023                *D2;     <font class="comment">/* D1, (temporary) simplified */</font>
01024 
01025     <font class="comment">/* Suppress all useless constraints in parameter domain */</font>
01026     <font class="comment">/* when CT is not NULL (ehrhart) */</font>
01027     <font class="comment">/* Vin100, march 01 */</font>
01028     CEq1 = C1;
01029     M = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(C1-&gt;NbConstraints,<a class="code" href="polyparam_8c.html#a0">m</a>+2);
01030     <font class="keywordflow">for</font>(i=0;i&lt;C1-&gt;NbConstraints;++i) {
01031       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(M-&gt;p[i][0],C1-&gt;Constraint[i][0]);
01032       <a class="code" href="vector_8c.html#a11">Vector_Copy</a>(&amp;C1-&gt;Constraint[i][D-&gt;Dimension-<a class="code" href="polyparam_8c.html#a0">m</a>+1],&amp;M-&gt;p[i][1],(<a class="code" href="polyparam_8c.html#a0">m</a>+1));
01033     }
01034     <a class="code" href="polyparam_8c.html#a5">CEqualities</a> = <a class="code" href="polyhedron_8c.html#a24">Constraints2Polyhedron</a>( M, <a class="code" href="polyparam_8c.html#a3">ws</a> );
01035     <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(M);
01036 
01037     D2 = <a class="code" href="polyhedron_8c.html#a42">DomainSimplify</a>(D1,CEq1,<a class="code" href="polyparam_8c.html#a3">ws</a>);
01038     <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(D1);
01039     D1 = D2;
01040     C1 = <a class="code" href="polyhedron_8c.html#a23">Universe_Polyhedron</a>(D2-&gt;Dimension);
01041     
01042     <font class="comment">/* if CT is not NULL, the constraints are eliminated                */</font>
01043     <font class="comment">/* *CT will contain the transformation matrix to come back to the   */</font>
01044     <font class="comment">/* original dimension (for a polyhedron, in the parameter space)    */</font>
01045     <font class="keywordflow">if</font>( CEq1-&gt;NbEq )
01046     {
01047       <a class="code" href="polyparam_8c.html#a0">m</a> -= CEq1-&gt;NbEq;
01048       p = (<font class="keywordtype">int</font> *)malloc(<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>)*(CEq1-&gt;NbEq));
01049     }
01050     <font class="keywordflow">else</font>
01051       p = NULL;
01052     ref = (<font class="keywordtype">int</font>*) malloc(<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>)*
01053                         (CEq1-&gt;Dimension+2-CEq1-&gt;NbEq));
01054     *CT = <a class="code" href="polyparam_8c.html#a31">PreElim_Columns</a>(CEq1,p,ref,CEqualities-&gt;Dimension);
01055     D2 = <a class="code" href="polyparam_8c.html#a32">Elim_Columns</a>(D1,CEq1,p,ref);
01056     C2 = <a class="code" href="polyparam_8c.html#a32">Elim_Columns</a>(C1,CEq1,p,ref);
01057     
01058 <font class="preprocessor">#ifdef DEBUGPP3</font>
01059 <font class="preprocessor"></font>    fprintf(stderr,<font class="stringliteral">"D2\t Dim = %3d\tNbEq = %3d\tLines = %3d\n"</font>,
01060             D2-&gt;Dimension,D2-&gt;NbEq,D2-&gt;NbBid);
01061     fprintf(stderr,<font class="stringliteral">"C2\t Dim = %3d\tNbEq = %3d\tLines = %3d\n"</font>,
01062             C2-&gt;Dimension,C2-&gt;NbEq,C2-&gt;NbBid);
01063 <font class="preprocessor">#endif</font>
01064 <font class="preprocessor"></font>    
01065     <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(D1);
01066     <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(C1);
01067     D1 = D2;
01068     C1 = C2;
01069     *CEq = <a class="code" href="polyparam_8c.html#a5">CEqualities</a>;
01070     
01071 <font class="preprocessor">#ifdef DEBUGPP3</font>
01072 <font class="preprocessor"></font>    fprintf(stderr,<font class="stringliteral">"Polyhedron CEq = "</font>);
01073     <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,P_VALUE_FMT,*CEq);
01074     fprintf(stderr,<font class="stringliteral">"Matrix CT = "</font>);
01075     <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stderr,P_VALUE_FMT,*CT);
01076 <font class="preprocessor">#endif</font>
01077 <font class="preprocessor"></font>    
01078     <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(CEq1);
01079     <a class="code" href="polyparam_8c.html#a5">CEqualities</a> = NULL; <font class="comment">/* don't simplify ! */</font>
01080 
01081     <font class="comment">/* m changed !!! */</font>
01082     <font class="keywordflow">if</font>(<a class="code" href="polyparam_8c.html#a0">m</a>==0) {
01083       Param_Polyhedron *result=<a class="code" href="polyparam_8c.html#a30">GenParamPolyhedron</a>(D1);
01084       
01085       <font class="comment">/* return the new D1 too */</font>
01086       *Di = D1;
01087       <font class="keywordflow">if</font>(result)
01088         <font class="keywordflow">return</font> result;
01089       <font class="keywordflow">else</font> {
01090         fprintf(stderr,<font class="stringliteral">"Find_m_faces: polyhedron is not bounded!\n"</font>);
01091         <font class="keywordflow">return</font> (Param_Polyhedron *) 0;
01092       }
01093     }
01094   }
01095 
01096 <font class="preprocessor">#ifdef DEBUGPP3</font>
01097 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"Polyhedron D1 (D AND C) = "</font>);
01098   <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,P_VALUE_FMT, D1);
01099   fprintf(stderr,<font class="stringliteral">"Polyhedron CEqualities = "</font>);
01100   <font class="keywordflow">if</font>(CEqualities) <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,P_VALUE_FMT, <a class="code" href="polyparam_8c.html#a5">CEqualities</a>);
01101   <font class="keywordflow">else</font> fprintf(stderr,<font class="stringliteral">"NULL\n"</font>);
01102 <font class="preprocessor">#endif</font>
01103 <font class="preprocessor"></font>  
01104   <a class="code" href="polyparam_8c.html#a13">KD</a> = keep_dom;
01105   <a class="code" href="polyparam_8c.html#a16">PDomains</a> = NULL;
01106   <a class="code" href="polyparam_8c.html#a15">PV_Result</a> = NULL;
01107   <a class="code" href="polyparam_8c.html#a14">nbPV</a> = 0;
01108   
01109   <font class="keywordflow">if</font> (D1-&gt;NbRays==0) <font class="keywordflow">return</font> 0;
01110   
01111   <font class="comment">/* mf : a bit array indicating which rays are part of the m-face */</font>
01112   <font class="comment">/* Poly2Sat initializes mf to all ones */</font>
01113   <font class="comment">/* set global variable nr to size (number of words) of mf */</font>
01114   <a class="code" href="polyparam_8c.html#a6">Sat</a> = <a class="code" href="polyparam_8c.html#a29">Poly2Sat</a>(D1,&amp;mf);
01115 
01116 <font class="preprocessor">#ifdef DEBUGPP4</font>
01117 <font class="preprocessor"></font><font class="comment">/*  fprintf(stderr,"Sat = ");</font>
01118 <font class="comment">    Matrix_Print(stderr,"%08X ", Sat); */</font>
01119 
01120   fprintf(stderr,<font class="stringliteral">"mf = "</font>);
01121   <font class="keywordflow">for</font> (i=0; i&lt;<a class="code" href="polyparam_8c.html#a4">nr</a>; i++)
01122     fprintf(stderr,<font class="stringliteral">"%08X"</font>, mf[i]);
01123   fprintf(stderr, <font class="stringliteral">"\n"</font>);
01124 <font class="preprocessor">#endif</font>
01125 <font class="preprocessor"></font>  
01126   <font class="comment">/* A boolean array saying which constraints are part of the m-face */</font>
01127   <a class="code" href="polyparam_8c.html#a7">egalite</a> = (<font class="keywordtype">int</font> *)malloc(<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>)*D1-&gt;NbConstraints );
01128   memset(<a class="code" href="polyparam_8c.html#a7">egalite</a>,0, <font class="keyword">sizeof</font>(<font class="keywordtype">int</font>)*D1-&gt;NbConstraints);
01129 
01130   <font class="keywordflow">for</font> (i=0; i&lt;D1-&gt;NbEq; i++)
01131     <a class="code" href="polyparam_8c.html#a7">egalite</a>[i] = 1;
01132 
01133   <a class="code" href="polyparam_8c.html#a8">Xi</a>     = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(<a class="code" href="polyparam_8c.html#a2">n</a>+1,<a class="code" href="polyparam_8c.html#a0">m</a>+1);
01134   <a class="code" href="polyparam_8c.html#a9">Pi</a>     = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(<a class="code" href="polyparam_8c.html#a0">m</a>+1,<a class="code" href="polyparam_8c.html#a0">m</a>+1);
01135   <a class="code" href="polyparam_8c.html#a10">PiTest</a> = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(<a class="code" href="polyparam_8c.html#a0">m</a>+1,<a class="code" href="polyparam_8c.html#a0">m</a>+1);
01136   <a class="code" href="polyparam_8c.html#a11">PiInv</a>  = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(<a class="code" href="polyparam_8c.html#a0">m</a>+1,<a class="code" href="polyparam_8c.html#a0">m</a>+2);
01137   <a class="code" href="polyparam_8c.html#a12">RaysDi</a> = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(D1-&gt;NbRays,<a class="code" href="polyparam_8c.html#a0">m</a>+2);
01138   <a class="code" href="polyparam_8c.html#a1">m_dim</a> = <a class="code" href="polyparam_8c.html#a0">m</a>;
01139   
01140 <font class="preprocessor">#ifdef DEBUGPP</font>
01141 <font class="preprocessor"></font>  nbfaces=0;
01142 <font class="preprocessor">#endif</font>
01143 <font class="preprocessor"></font><font class="preprocessor">#ifdef DEBUGPP3</font>
01144 <font class="preprocessor"></font>  fprintf(stderr,
01145           <font class="stringliteral">"Target: find faces that saturate %d constraints and %d rays/lines\n"</font>,
01146           D1-&gt;Dimension - <a class="code" href="polyparam_8c.html#a1">m_dim</a>,<a class="code" href="polyparam_8c.html#a1">m_dim</a>+1);
01147 <font class="preprocessor">#endif</font>
01148 <font class="preprocessor"></font>        
01149   <font class="comment">/* D1-&gt;NbEq constraints already saturated ! */</font>
01150   <a class="code" href="polyparam_8c.html#a19">scan_m_face</a>(D1-&gt;NbEq,(D1-&gt;Dimension - <a class="code" href="polyparam_8c.html#a1">m_dim</a> - D1-&gt;NbEq),D1,mf);
01151 
01152   <font class="comment">/* pos, number of constraints needed     */</font>
01153 
01154 <font class="preprocessor">#ifdef DEBUGPP</font>
01155 <font class="preprocessor"></font>  fprintf( stderr, <font class="stringliteral">"Number of m-faces: %d\n"</font>, nbfaces );
01156 <font class="preprocessor">#endif</font>
01157 <font class="preprocessor"></font>  
01158   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(<a class="code" href="polyparam_8c.html#a12">RaysDi</a>);
01159   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(<a class="code" href="polyparam_8c.html#a11">PiInv</a>);
01160   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(<a class="code" href="polyparam_8c.html#a10">PiTest</a>);
01161   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(<a class="code" href="polyparam_8c.html#a9">Pi</a>);
01162   <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(<a class="code" href="polyparam_8c.html#a8">Xi</a>);
01163   free(<a class="code" href="polyparam_8c.html#a7">egalite</a>);
01164   free(mf);
01165   <a class="code" href="polyparam_8c.html#a24">SMFree</a>(<a class="code" href="polyparam_8c.html#a6">Sat</a>);
01166   
01167   <font class="comment">/*    if(CEqualities &amp;&amp; keep_dom==0) {</font>
01168 <font class="comment">           Domain_Free(CEqualities);</font>
01169 <font class="comment">        }</font>
01170 <font class="comment">  */</font>
01171 
01172   <font class="keywordflow">if</font>(CT)                <font class="comment">/* return the new D1 too ! */</font>
01173     *Di = D1;
01174   <font class="keywordflow">else</font>
01175     <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(D1);
01176   <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(C1);
01177 
01178   res = (Param_Polyhedron *) malloc (<font class="keyword">sizeof</font>(Param_Polyhedron));
01179   res-&gt;nbV = <a class="code" href="polyparam_8c.html#a14">nbPV</a>;
01180   res-&gt;V = <a class="code" href="polyparam_8c.html#a15">PV_Result</a>;
01181   res-&gt;D = <a class="code" href="polyparam_8c.html#a16">PDomains</a>;
01182   <font class="keywordflow">return</font>(res);
01183 } <font class="comment">/* Find_m_faces */</font>
01184 
01185 <font class="comment">/*</font>
01186 <font class="comment"> * Given parametric domain 'PD' and number of parametric vertices 'nb_domains',</font>
01187 <font class="comment"> * find the vertices that belong to distinct sub-domains. </font>
01188 <font class="comment"> */</font>
<a name="l01189"></a><a class="code" href="polyparam_8c.html#a34">01189</a> <font class="keywordtype">void</font> <a class="code" href="polyparam_8c.html#a34">Compute_PDomains</a>(Param_Domain *PD,<font class="keywordtype">int</font> nb_domains,<font class="keywordtype">int</font> working_space)<font class="keyword"> </font>{
01190   
01191   <font class="keywordtype">unsigned</font> bx;
01192   <font class="keywordtype">int</font> i, ix, nv;
01193   Polyhedron *dx, *d1, *d2;
01194   Param_Domain *p1, *p2, *p2prev, *PDNew;
01195   
01196   <font class="keywordflow">if</font> (nb_domains==0) {
01197     
01198 <font class="preprocessor">#ifdef DEBUGPP5</font>
01199 <font class="preprocessor"></font>    fprintf(stderr,<font class="stringliteral">"No domains\n"</font>);
01200 <font class="preprocessor">#endif</font>
01201 <font class="preprocessor"></font>    
01202     <font class="keywordflow">return</font>;
01203   }
01204 
01205    <font class="comment">/* Initialization */</font>
01206    nv = (nb_domains - 1)/(8*<font class="keyword">sizeof</font>(int)) + 1;
01207 
01208 <font class="preprocessor">#ifdef DEBUGPP5</font>
01209 <font class="preprocessor"></font>   fprintf(stderr,<font class="stringliteral">"nv = %d\n"</font>,nv);
01210 <font class="preprocessor">#endif</font>
01211 <font class="preprocessor"></font>
01212    <font class="keywordflow">for</font>(p1=PD,i=0,ix=0,bx=MSB;p1;p1=p1-&gt;next,i++) {
01213      
01214      <font class="comment">/* Assign a bit array 'p1-&gt;F' of suitable size to include the vertices */</font>
01215      p1-&gt;F = (<font class="keywordtype">unsigned</font> *) malloc (nv * <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font>));
01216      
01217      <font class="comment">/* Set the bit array to zeros */</font>
01218      memset(p1-&gt;F,0,nv * <font class="keyword">sizeof</font>(<font class="keywordtype">unsigned</font>));
01219      p1-&gt;F[ix] |= bx;      <font class="comment">/* Set i'th bit to one */</font>
01220      NEXT(ix, bx);
01221    }
01222 
01223 <font class="preprocessor">#ifdef DEBUGPP5</font>
01224 <font class="preprocessor"></font>   fprintf(stderr,<font class="stringliteral">"nb of vertices=%d\n"</font>,i);
01225 <font class="preprocessor">#endif</font>
01226 <font class="preprocessor"></font>
01227    <font class="comment">/* Walk the PD list with two pointers */</font>
01228    ix = 0; bx=MSB;
01229    <font class="keywordflow">for</font> (p1=PD;p1;p1=p1-&gt;next) {
01230      <font class="keywordflow">for</font> (p2prev=p1,p2=p1-&gt;next;p2;p2prev=p2,p2=p2-&gt;next) {
01231         
01232        <font class="comment">/* Find intersection */</font>
01233        dx = <a class="code" href="polyparam_8c.html#a20">PDomainIntersection</a>(p1-&gt;Domain,p2-&gt;Domain,working_space);
01234        
01235        <font class="keywordflow">if</font> (!dx || emptyQ(dx))<font class="keyword"> </font>{
01236          
01237 <font class="preprocessor">#ifdef DEBUGPP5</font>
01238 <font class="preprocessor"></font>         fprintf( stderr, <font class="stringliteral">"Empty dx (p1 inter p2). Continuing\n"</font>);
01239 <font class="preprocessor">#endif</font>
01240 <font class="preprocessor"></font>         <font class="keywordflow">if</font>(dx)
01241            <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(dx);
01242          <font class="keywordflow">continue</font>;
01243        }
01244 
01245 <font class="preprocessor">#ifdef DEBUGPP5      </font>
01246 <font class="preprocessor"></font>       fprintf(stderr,<font class="stringliteral">"Begin PDomainDifference\n"</font>);
01247        fprintf(stderr, <font class="stringliteral">"p1="</font>);
01248        <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,P_VALUE_FMT,p1-&gt;Domain);
01249        fprintf(stderr,<font class="stringliteral">"p2="</font>);
01250        <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,P_VALUE_FMT,p2-&gt;Domain);
01251 <font class="preprocessor">#endif</font>
01252 <font class="preprocessor"></font>       d1 = <a class="code" href="polyparam_8c.html#a21">PDomainDifference</a>(p1-&gt;Domain,p2-&gt;Domain,working_space);
01253        d2 = <a class="code" href="polyparam_8c.html#a21">PDomainDifference</a>(p2-&gt;Domain,p1-&gt;Domain,working_space);       
01254 
01255 <font class="preprocessor">#ifdef DEBUGPP5       </font>
01256 <font class="preprocessor"></font>       fprintf(stderr,<font class="stringliteral">"p1\\p2="</font>);
01257        <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,P_VALUE_FMT,d1);
01258        fprintf(stderr,<font class="stringliteral">"p2\\p1="</font>);
01259        <a class="code" href="polyhedron_8c.html#a20">Polyhedron_Print</a>(stderr,P_VALUE_FMT,d2);
01260        fprintf(stderr,<font class="stringliteral">"END PDomainDifference\n\n"</font>);       
01261 <font class="preprocessor">#endif</font>
01262 <font class="preprocessor"></font>       <font class="keywordflow">if</font> (!d1 || emptyQ(d1) || d1-&gt;NbEq!=0)<font class="keyword"> </font>{
01263 
01264 <font class="preprocessor">#ifdef DEBUGPP5</font>
01265 <font class="preprocessor"></font>         fprintf(stderr,<font class="stringliteral">"Empty d1\n"</font>);
01266 <font class="preprocessor">#endif</font>
01267 <font class="preprocessor"></font>         <font class="keywordflow">if</font> (d1) 
01268            <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(d1);
01269          <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(dx);
01270          
01271          <font class="keywordflow">if</font> (!d2 || emptyQ(d2) || d2-&gt;NbEq!=0)<font class="keyword"> </font>{
01272            
01273 <font class="preprocessor">#ifdef DEBUGPP5</font>
01274 <font class="preprocessor"></font>           fprintf( stderr, <font class="stringliteral">"Empty d2 (deleting)\n"</font>);
01275 <font class="preprocessor">#endif</font>
01276 <font class="preprocessor"></font>           <font class="comment">/* dx = p1-&gt;Domain = p2-&gt;Domain */</font>
01277            <font class="keywordflow">if</font> (d2) <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(d2);
01278            
01279            <font class="comment">/* Update p1 */</font>
01280            <font class="keywordflow">for</font> (i=0;i&lt;nv;i++)
01281              p1-&gt;F[i] |= p2-&gt;F[i];
01282            
01283            <font class="comment">/* Delete p2 */</font>
01284            p2prev-&gt;next = p2-&gt;next;
01285            <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(p2-&gt;Domain);
01286            free(p2-&gt;F);
01287            free(p2);
01288            p2 = p2prev;
01289          }
01290          <font class="keywordflow">else</font> {  <font class="comment">/* d2 is not empty --&gt; dx==p1-&gt;domain */</font>
01291            
01292 <font class="preprocessor">#ifdef DEBUGPP5</font>
01293 <font class="preprocessor"></font>           fprintf( stderr, <font class="stringliteral">"p2 replaced by d2\n"</font>);
01294 <font class="preprocessor">#endif</font>
01295 <font class="preprocessor"></font>           <font class="comment">/* Update p1 */</font>
01296            <font class="keywordflow">for</font>(i=0;i&lt;nv;i++)
01297              p1-&gt;F[i] |= p2-&gt;F[i];
01298            
01299            <font class="comment">/* Replace p2 with d2 */</font>
01300            <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>( p2-&gt;Domain );
01301            p2-&gt;Domain = d2;
01302          }
01303        }
01304        <font class="keywordflow">else</font> { <font class="comment">/* d1 is not empty */</font>         
01305          <font class="keywordflow">if</font> (!d2 || emptyQ(d2) || d2-&gt;NbEq!=0)<font class="keyword"> </font>{
01306            
01307 <font class="preprocessor">#ifdef DEBUGPP5</font>
01308 <font class="preprocessor"></font>           fprintf( stderr, <font class="stringliteral">"p1 replaced by d1\n"</font>);
01309 <font class="preprocessor">#endif</font>
01310 <font class="preprocessor"></font>           <font class="keywordflow">if</font> (d2) <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(d2);
01311            
01312            <font class="comment">/* dx = p2-&gt;domain */</font>
01313            <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(dx);
01314            
01315            <font class="comment">/* Update p2 */</font>
01316            <font class="keywordflow">for</font>(i=0;i&lt;nv;i++)
01317              p2-&gt;F[i] |= p1-&gt;F[i];
01318 
01319            <font class="comment">/* Replace p1 with d1 */</font>
01320            <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(p1-&gt;Domain);
01321            p1-&gt;Domain = d1;
01322          }
01323          <font class="keywordflow">else</font> { <font class="comment">/*d2 is not empty--&gt;d1,d2,dx are distinct */</font>
01324            
01325 <font class="preprocessor">#ifdef DEBUGPP5</font>
01326 <font class="preprocessor"></font>           fprintf(stderr,<font class="stringliteral">"Non-empty d1 and d2\nNew node created\n"</font>);
01327 <font class="preprocessor">#endif</font>
01328 <font class="preprocessor"></font>           <font class="comment">/* Create a new node for dx */</font>
01329            PDNew = (Param_Domain *) malloc( <font class="keyword">sizeof</font>(Param_Domain) );
01330            PDNew-&gt;F = (<font class="keywordtype">int</font> *)malloc( nv*<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>) );
01331            memset(PDNew-&gt;F,0,nv*<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>));
01332            PDNew-&gt;Domain = dx;
01333            
01334            <font class="keywordflow">for</font> (i=0;i&lt;nv;i++)
01335              PDNew-&gt;F[i] = p1-&gt;F[i] | p2-&gt;F[i];
01336            
01337            <font class="comment">/* Replace p1 with d1 */</font>
01338            <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>( p1-&gt;Domain );
01339            p1-&gt;Domain = d1;
01340            
01341            <font class="comment">/* Replace p2 with d2 */</font>
01342            <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>( p2-&gt;Domain );
01343            p2-&gt;Domain = d2;
01344            
01345            <font class="comment">/* Insert new node after p1 */</font>
01346            PDNew-&gt;next = p1-&gt;next;
01347            p1-&gt;next = PDNew;
01348          }
01349        }
01350      }  <font class="comment">/* end of p2 scan */</font>
01351    } <font class="comment">/* end of p1 scan */</font>
01352 } <font class="comment">/* Compute_PDomains */</font>
01353                                         
01354 <font class="comment">/* </font>
01355 <font class="comment"> * Given a polyhedron 'Din' in combined data and parametre space, a context</font>
01356 <font class="comment"> * polyhedron 'Cin' representing the constraints on the parameter space and </font>
01357 <font class="comment"> * a working space size 'working_space', return a parametric polyhedron with</font>
01358 <font class="comment"> * a list of parametric vertices and their defining domains. </font>
01359 <font class="comment"> */</font>
<a name="l01360"></a><a class="code" href="polyparam_8c.html#a35">01360</a> Param_Polyhedron *<a class="code" href="polyparam_8c.html#a35">Polyhedron2Param_Vertices</a>(Polyhedron *Din,Polyhedron *Cin,<font class="keywordtype">int</font> working_space)<font class="keyword"> </font>{
01361   
01362   Param_Polyhedron *result;
01363   
01364 <font class="preprocessor">#ifdef DEBUGPP</font>
01365 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"Polyhedron2Param_Vertices algorithm starting at : %.2fs\n"</font>,
01366           (<font class="keywordtype">float</font>)clock()/CLOCKS_PER_SEC);
01367 <font class="preprocessor">#endif</font>
01368 <font class="preprocessor"></font>  
01369   <font class="comment">/***************** Scan the m-faces ****************/</font>
01370   result = <a class="code" href="polyparam_8c.html#a33">Find_m_faces</a>(&amp;Din,Cin,0,working_space,NULL,NULL);
01371   
01372 <font class="preprocessor">#ifdef DEBUGPP</font>
01373 <font class="preprocessor"></font>  fprintf(stderr, <font class="stringliteral">"nb of points : %d\n"</font>,result-&gt;nbV);
01374 <font class="preprocessor">#endif</font>
01375 <font class="preprocessor"></font>  
01376 <font class="preprocessor">#ifdef DEBUGPP</font>
01377 <font class="preprocessor"></font>  fprintf(stderr, <font class="stringliteral">"end main loop : %.2fs\n"</font>, (<font class="keywordtype">float</font>)clock()/CLOCKS_PER_SEC);
01378 <font class="preprocessor">#endif</font>
01379 <font class="preprocessor"></font>  
01380   <font class="keywordflow">return</font>(result);
01381 } <font class="comment">/* Polyhedron2Param_Vertices */</font>
01382 
01383 <font class="comment">/*</font>
01384 <font class="comment"> * Free the memory allocated to a list of parametrized vertices  </font>
01385 <font class="comment"> */</font>
<a name="l01386"></a><a class="code" href="polyparam_8c.html#a36">01386</a> <font class="keywordtype">void</font> <a class="code" href="polyparam_8c.html#a36">Param_Vertices_Free</a>(Param_Vertices *PV)<font class="keyword"> </font>{
01387   
01388   Param_Vertices *next_pv;
01389   
01390   <font class="keywordflow">while</font>(PV) {
01391     next_pv = PV-&gt;next;
01392     <font class="keywordflow">if</font> (PV-&gt;Vertex) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(PV-&gt;Vertex);
01393     <font class="keywordflow">if</font> (PV-&gt;Domain) <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(PV-&gt;Domain);
01394     free(PV);  
01395     PV = next_pv;
01396   }
01397 } <font class="comment">/* Param_Vertices_Free */</font>
01398 
01399 <font class="comment">/*</font>
01400 <font class="comment"> * Print a list of parametrized vertices *</font>
01401 <font class="comment"> */</font>
<a name="l01402"></a><a class="code" href="polyparam_8c.html#a37">01402</a> <font class="keywordtype">void</font> <a class="code" href="polyparam_8c.html#a37">Print_Vertex</a>(FILE *DST,Matrix *V,<font class="keywordtype">char</font> **param_names)<font class="keyword"></font>{
01403   
01404   <font class="keywordtype">int</font> l, v;
01405   <font class="keywordtype">int</font> first;
01406   Value gcd,tmp;
01407   
01408   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(gcd); <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
01409   
01410   fprintf(DST, <font class="stringliteral">"["</font> );
01411   <font class="keywordflow">for</font>(l=0;l&lt;V-&gt;NbRows;++l){
01412     
01413     <font class="comment">/* Variables */</font>
01414     first=1;
01415     fprintf(DST, <font class="stringliteral">" "</font> );
01416     <font class="keywordflow">for</font>(v=0;v &lt; V-&gt;NbColumns-2;++v) {
01417       <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(V-&gt;p[l][v]))<font class="keyword"> </font>{
01418         <a class="code" href="vector_8c.html#a3">Gcd</a>(V-&gt;p[l][v],V-&gt;p[l][V-&gt;NbColumns-1],&amp;gcd);
01419         <a class="code" href="arithmetique_8h.html#a55">value_absolute</a>(gcd,gcd);
01420         <a class="code" href="arithmetique_8h.html#a51">value_division</a>(tmp,V-&gt;p[l][v],gcd);
01421         <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a65">value_posz_p</a>(tmp))<font class="keyword"> </font>{
01422           <font class="keywordflow">if</font>(!first) 
01423             fprintf(DST, <font class="stringliteral">"+"</font>);
01424           <a class="code" href="arithmetique_8h.html#a51">value_division</a>(tmp,V-&gt;p[l][v],gcd);
01425           <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a70">value_notone_p</a>(tmp))<font class="keyword"> </font>{ 
01426             <a class="code" href="arithmetique_8h.html#a16">value_print</a>(DST,<a class="code" href="arithmetique_8h.html#a5">VALUE_FMT</a>,tmp);
01427           }  
01428         }
01429         <font class="keywordflow">else</font> { <font class="comment">/* V-&gt;p[l][v]/gcd&lt;0 */</font>
01430           <a class="code" href="arithmetique_8h.html#a51">value_division</a>(tmp,V-&gt;p[l][v],gcd);
01431           <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a71">value_mone_p</a>(tmp))
01432             fprintf(DST, <font class="stringliteral">"-"</font> );
01433           <font class="keywordflow">else</font> {
01434             <a class="code" href="arithmetique_8h.html#a16">value_print</a>(DST,<a class="code" href="arithmetique_8h.html#a5">VALUE_FMT</a>,tmp);
01435           }
01436         }
01437         <a class="code" href="arithmetique_8h.html#a51">value_division</a>(tmp,V-&gt;p[l][V-&gt;NbColumns-1],gcd);
01438         <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a70">value_notone_p</a>(tmp))<font class="keyword"> </font>{
01439           fprintf(DST, <font class="stringliteral">"%s/"</font>, param_names[v]);
01440           <a class="code" href="arithmetique_8h.html#a16">value_print</a>(DST,<a class="code" href="arithmetique_8h.html#a5">VALUE_FMT</a>,tmp);
01441         }
01442         <font class="keywordflow">else</font>
01443           fprintf(DST, <font class="stringliteral">"%s"</font>, param_names[v]);
01444         first=0;
01445       }
01446     }
01447 
01448     <font class="comment">/* Constant */</font>
01449     <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(V-&gt;p[l][v]) || first)<font class="keyword"> </font>{
01450       <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a65">value_posz_p</a>(V-&gt;p[l][v]) &amp;&amp; !first)
01451         fprintf(DST,<font class="stringliteral">"+"</font>);
01452         <a class="code" href="vector_8c.html#a3">Gcd</a>(V-&gt;p[l][v],V-&gt;p[l][V-&gt;NbColumns-1],&amp;gcd);
01453       <a class="code" href="arithmetique_8h.html#a55">value_absolute</a>(gcd,gcd);
01454       <a class="code" href="arithmetique_8h.html#a51">value_division</a>(tmp,V-&gt;p[l][v],gcd);
01455       <a class="code" href="arithmetique_8h.html#a16">value_print</a>(DST,<a class="code" href="arithmetique_8h.html#a5">VALUE_FMT</a>,tmp);
01456       <a class="code" href="arithmetique_8h.html#a51">value_division</a>(tmp,V-&gt;p[l][V-&gt;NbColumns-1],gcd);
01457       <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a70">value_notone_p</a>(tmp))<font class="keyword"> </font>{
01458         fprintf(DST,<font class="stringliteral">"/"</font>);
01459         <a class="code" href="arithmetique_8h.html#a16">value_print</a>(DST,<a class="code" href="arithmetique_8h.html#a5">VALUE_FMT</a>,tmp);
01460         fprintf(DST,<font class="stringliteral">" "</font>);
01461       }
01462     }
01463     <font class="keywordflow">if</font> (l&lt;V-&gt;NbRows-1) 
01464       fprintf(DST, <font class="stringliteral">", "</font>);
01465   }
01466   fprintf(DST, <font class="stringliteral">" ]"</font>);
01467   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(gcd); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
01468   <font class="keywordflow">return</font>;
01469 } <font class="comment">/* Print_Vertex */</font>
01470 
01471 <font class="comment">/*----------------------------------------------------------------------*/</font>
01472 <font class="comment">/* VertexCT                                                             */</font>
01473 <font class="comment">/* convert a paramvertex from reduced space to normal m-space           */</font>
01474 <font class="comment">/*----------------------------------------------------------------------*/</font>
<a name="l01475"></a><a class="code" href="polyparam_8c.html#a38">01475</a> Matrix *<a class="code" href="polyparam_8c.html#a38">VertexCT</a>(Matrix *V,Matrix *CT)<font class="keyword"> </font>{
01476   
01477   Matrix *Vt;
01478   <font class="keywordtype">int</font> i,j,k;
01479   
01480   <font class="keywordflow">if</font>(CT) {
01481     
01482     <font class="comment">/* Have to transform the vertices to original dimension */</font>
01483     Vt = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(V-&gt;NbRows,CT-&gt;NbColumns+1);
01484     <font class="keywordflow">for</font>(i=0;i&lt;V-&gt;NbRows;++i) {
01485       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Vt-&gt;p[i][CT-&gt;NbColumns],V-&gt;p[i][V-&gt;NbColumns-1]);
01486       <font class="keywordflow">for</font>(j=0;j&lt;CT-&gt;NbColumns;j++) {
01487         <font class="keywordflow">for</font>(k=0;k&lt;CT-&gt;NbRows;k++)
01488           <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(CT-&gt;p[k][j]))
01489             <font class="keywordflow">break</font>;
01490         <font class="keywordflow">if</font>(k&lt;CT-&gt;NbRows)
01491           <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(Vt-&gt;p[i][j],V-&gt;p[i][k]);
01492         <font class="keywordflow">else</font>
01493           <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(Vt-&gt;p[i][j],0);
01494       }
01495     }
01496     <font class="keywordflow">return</font>(Vt);
01497   }
01498   <font class="keywordflow">else</font>
01499     <font class="keywordflow">return</font>(NULL);
01500 } <font class="comment">/* VertexCT */</font>
01501 
01502 <font class="comment">/*</font>
01503 <font class="comment"> * Print the validity Domain 'D' of a parametric polyhedron </font>
01504 <font class="comment"> */</font> 
<a name="l01505"></a><a class="code" href="polyparam_8c.html#a39">01505</a> <font class="keywordtype">void</font> <a class="code" href="polyparam_8c.html#a39">Print_Domain</a>(FILE *DST,Polyhedron *D,<font class="keywordtype">char</font> **pname)<font class="keyword"> </font>{
01506   
01507   <font class="keywordtype">int</font> l, v;
01508   <font class="keywordtype">int</font> first;
01509   
01510   <font class="keywordflow">for</font>(l=0;l&lt;D-&gt;NbConstraints;++l) {
01511     fprintf(DST, <font class="stringliteral">"         "</font>);
01512     first = 1;
01513     <font class="keywordflow">for</font>(v=1;v&lt;=D-&gt;Dimension;++v) {
01514       <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(D-&gt;Constraint[l][v]))<font class="keyword"> </font>{
01515         <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a69">value_one_p</a>(D-&gt;Constraint[l][v]))<font class="keyword"> </font>{
01516           <font class="keywordflow">if</font>(first)
01517             fprintf(DST, <font class="stringliteral">"%s "</font>, pname[v-1]);
01518           <font class="keywordflow">else</font>
01519             fprintf(DST, <font class="stringliteral">"+ %s "</font>, pname[v-1] );
01520         }
01521         <font class="keywordflow">else</font> <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a71">value_mone_p</a>(D-&gt;Constraint[l][v]))
01522           fprintf(DST, <font class="stringliteral">"- %s "</font>, pname[v-1] );
01523         <font class="keywordflow">else</font> {
01524           <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a63">value_pos_p</a>(D-&gt;Constraint[l][v]) &amp;&amp; !first )
01525             fprintf(DST, <font class="stringliteral">"+ "</font> );
01526           <a class="code" href="arithmetique_8h.html#a16">value_print</a>(DST,<a class="code" href="arithmetique_8h.html#a5">VALUE_FMT</a>,D-&gt;Constraint[l][v]);
01527           fprintf(DST,<font class="stringliteral">"%s "</font>,pname[v-1]);
01528         }
01529         first = 0;
01530       }
01531     }
01532     <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(D-&gt;Constraint[l][v]))<font class="keyword"> </font>{
01533       <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a63">value_pos_p</a>(D-&gt;Constraint[l][v]) &amp;&amp; !first)
01534         fprintf(DST,<font class="stringliteral">"+"</font>);
01535       fprintf(DST,<font class="stringliteral">" "</font>);
01536       <a class="code" href="arithmetique_8h.html#a16">value_print</a>(DST,<a class="code" href="arithmetique_8h.html#a5">VALUE_FMT</a>,D-&gt;Constraint[l][v]);
01537     }
01538     fprintf(DST,(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(D-&gt;Constraint[l][0])) ?<font class="stringliteral">" &gt;= 0"</font>:<font class="stringliteral">" = 0"</font>);
01539     fprintf(DST, <font class="stringliteral">"\n"</font> );
01540   }
01541   fprintf(DST, <font class="stringliteral">"\n"</font>);
01542 
01543         <font class="keywordflow">if</font>( D-&gt;next )
01544         {
01545                 fprintf( DST, <font class="stringliteral">"UNION\n"</font> );
01546                 <a class="code" href="polyparam_8c.html#a39">Print_Domain</a>( DST, D-&gt;next, pname );
01547         }
01548   <font class="keywordflow">return</font>;
01549 } <font class="comment">/* Print_Domain */</font>
01550 
01551 <font class="comment">/* </font>
01552 <font class="comment"> * Given a list of parametrized vertices and an array of parameter names, Print</font>
01553 <font class="comment"> * a list of parametrized vertices in a comprehensible format. </font>
01554 <font class="comment"> */</font>
<a name="l01555"></a><a class="code" href="polyparam_8c.html#a40">01555</a> <font class="keywordtype">void</font> <a class="code" href="polyparam_8c.html#a40">Param_Vertices_Print</a>(FILE *DST,Param_Vertices *PV,<font class="keywordtype">char</font> **param_names)<font class="keyword"> </font>{
01556    
01557   Polyhedron *poly;
01558   
01559   <font class="keywordflow">while</font>(PV) {
01560     fprintf(DST, <font class="stringliteral">"Vertex :\n"</font> );
01561     <a class="code" href="polyparam_8c.html#a37">Print_Vertex</a>(DST,PV-&gt;Vertex,param_names);
01562     
01563     <font class="comment">/* Pour le domaine : */</font>
01564     fprintf(DST, <font class="stringliteral">"   If :\n"</font> );
01565     poly = <a class="code" href="polyhedron_8c.html#a24">Constraints2Polyhedron</a>(PV-&gt;Domain,200);
01566     <a class="code" href="polyparam_8c.html#a39">Print_Domain</a>(DST,poly,param_names);
01567     <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(poly);   
01568     PV = PV-&gt;next;
01569   }
01570   <font class="keywordflow">return</font>;
01571 } <font class="comment">/* Param_Vertices_Print */</font>
01572 
01573 <font class="comment">/* </font>
01574 <font class="comment"> * Given a polyhedron 'Din' in combined data and parametre space, a context</font>
01575 <font class="comment"> * polyhedron 'Cin' representing the constraints on the parameter space and </font>
01576 <font class="comment"> * a working space size 'working_space', return a parametric polyhedron with</font>
01577 <font class="comment"> * a list of distinct validity domains and a complete list of valid vertices </font>
01578 <font class="comment"> * associated to each validity domain. </font>
01579 <font class="comment"> */</font>
<a name="l01580"></a><a class="code" href="polyparam_8c.html#a41">01580</a> Param_Polyhedron *<a class="code" href="polyparam_8c.html#a41">Polyhedron2Param_Domain</a>(Polyhedron *Din,Polyhedron *Cin,<font class="keywordtype">int</font> working_space)<font class="keyword"> </font>{
01581                 
01582   Param_Polyhedron *result;
01583   Param_Domain *D;
01584 
01585 <font class="preprocessor">#ifdef DEBUGPP</font>
01586 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"Polyhedron2Param_Polyhedron algorithm starting at : %.2fs\n"</font>,
01587           (<font class="keywordtype">float</font>)clock()/CLOCKS_PER_SEC);
01588 <font class="preprocessor">#endif</font>
01589 <font class="preprocessor"></font>  
01590   <font class="comment">/* Find the m-faces, keeping the corresponding domains */</font>
01591   <font class="comment">/* in the linked list PDomains */</font>
01592   result = <a class="code" href="polyparam_8c.html#a33">Find_m_faces</a>(&amp;Din,Cin,1,working_space,NULL,NULL);
01593   
01594 <font class="preprocessor">#ifdef DEBUGPP</font>
01595 <font class="preprocessor"></font>  <font class="keywordflow">if</font>(result) fprintf(stderr, <font class="stringliteral">"Number of vertices : %d\n"</font>,result-&gt;nbV);
01596   fprintf(stderr,<font class="stringliteral">"Vertices found at : %.2fs\n"</font>,(<font class="keywordtype">float</font>)clock()/CLOCKS_PER_SEC);
01597 <font class="preprocessor">#endif</font>
01598 <font class="preprocessor"></font>  
01599   <font class="comment">/* Processing of PVResult and PDomains */</font>
01600   <font class="keywordflow">if</font>(result &amp;&amp; Cin-&gt;Dimension&gt;0)                <font class="comment">/* at least 1 parameter */</font>
01601     <a class="code" href="polyparam_8c.html#a34">Compute_PDomains</a>(result-&gt;D,result-&gt;nbV,working_space);
01602   <font class="keywordflow">if</font>(result &amp;&amp; <a class="code" href="polyparam_8c.html#a5">CEqualities</a>)
01603     <font class="keywordflow">for</font>(D=result-&gt;D;D;D=D-&gt;next)
01604       D-&gt;Domain = <a class="code" href="polyparam_8c.html#a25">Add_CEqualities</a>(D-&gt;Domain);
01605   
01606 <font class="preprocessor">#ifdef DEBUGPP</font>
01607 <font class="preprocessor"></font>  fprintf(stderr, <font class="stringliteral">"domains found at : %.2fs\n"</font>, (<font class="keywordtype">float</font>)clock()/CLOCKS_PER_SEC);
01608 <font class="preprocessor">#endif</font>
01609 <font class="preprocessor"></font>
01610   <font class="keywordflow">return</font>(result);
01611 } <font class="comment">/* Polyhedon2Param_Domain */</font>
01612 
01613 <font class="comment">/*</font>
01614 <font class="comment"> *</font>
01615 <font class="comment"> */</font>
<a name="l01616"></a><a class="code" href="polyparam_8c.html#a42">01616</a> Param_Polyhedron *<a class="code" href="polyparam_8c.html#a42">Polyhedron2Param_SimplifiedDomain</a>(Polyhedron **Din,Polyhedron *Cin,<font class="keywordtype">int</font> working_space,Polyhedron **CEq,Matrix **CT)<font class="keyword"> </font>{
01617                                                      
01618   Param_Polyhedron *result;
01619   
01620 <font class="preprocessor">#ifdef DEBUGPP</font>
01621 <font class="preprocessor"></font>  fprintf(stderr,<font class="stringliteral">"Polyhedron2Param_Polyhedron algorithm starting at : %.2fs\n"</font>,
01622           (<font class="keywordtype">float</font>)clock()/CLOCKS_PER_SEC);
01623 <font class="preprocessor">#endif</font>
01624 <font class="preprocessor"></font>  
01625   <font class="comment">/* Find the m-faces, keeping the corresponding domains */</font>
01626   <font class="comment">/* in the linked list PDomains */</font>
01627   result = <a class="code" href="polyparam_8c.html#a33">Find_m_faces</a>(Din,Cin,1,working_space,CEq,CT);
01628   
01629 <font class="preprocessor">#ifdef DEBUGPP</font>
01630 <font class="preprocessor"></font>  <font class="keywordflow">if</font>(result) fprintf(stderr, <font class="stringliteral">"Number of vertices : %d\n"</font>,result-&gt;nbV);
01631   fprintf(stderr,<font class="stringliteral">"Vertices found at : %.2fs\n"</font>,(<font class="keywordtype">float</font>)clock()/CLOCKS_PER_SEC);
01632 <font class="preprocessor">#endif</font>
01633 <font class="preprocessor"></font>
01634   <font class="comment">/* Processing of PVResult and PDomains */</font>
01635   <font class="keywordflow">if</font>(result &amp;&amp; Cin-&gt;Dimension&gt;0)                <font class="comment">/* at least 1 parameter */</font>
01636     <a class="code" href="polyparam_8c.html#a34">Compute_PDomains</a>(result-&gt;D,result-&gt;nbV,working_space);
01637   
01638   <font class="comment">/* Removed this, Vin100, March 01 */</font>
01639   <font class="comment">/*    if(result &amp;&amp; CEqualities )</font>
01640 <font class="comment">        for(D=result-&gt;D;D;D=D-&gt;next)</font>
01641 <font class="comment">        D-&gt;Domain = Add_CEqualities(D-&gt;Domain);</font>
01642 <font class="comment">  */</font>
01643   
01644 <font class="preprocessor">#ifdef DEBUGPP</font>
01645 <font class="preprocessor"></font>  fprintf(stderr, <font class="stringliteral">"domains found at : %.2fs\n"</font>, (<font class="keywordtype">float</font>)clock()/CLOCKS_PER_SEC);
01646 <font class="preprocessor">#endif</font>
01647 <font class="preprocessor"></font>  
01648   <font class="keywordflow">return</font>(result);
01649 } <font class="comment">/* Polyhedron2Param_SimplifiedDomain */</font>
01650 
01651 <font class="comment">/*</font>
01652 <font class="comment"> * Free the memory allocated to a list of validity domain of a parametrized </font>
01653 <font class="comment"> * polyhedron.</font>
01654 <font class="comment"> */</font>
<a name="l01655"></a><a class="code" href="polyparam_8c.html#a43">01655</a> <font class="keywordtype">void</font> <a class="code" href="polyparam_8c.html#a43">Param_Domain_Free</a>(Param_Domain *PD)<font class="keyword"> </font>{
01656         
01657   Param_Domain *next_pd;
01658   
01659   <font class="keywordflow">while</font>(PD) {
01660     free(PD-&gt;F);
01661     <a class="code" href="polyhedron_8c.html#a19">Domain_Free</a>(PD-&gt;Domain);
01662     next_pd = PD-&gt;next;
01663     free(PD);
01664     PD = next_pd;
01665   }
01666   <font class="keywordflow">return</font>;
01667 } <font class="comment">/* Param_Domain_Free */</font>
01668 
01669 <font class="comment">/*</font>
01670 <font class="comment"> * Free the memory allocated to a parametric polyhedron 'P' </font>
01671 <font class="comment"> */</font>
<a name="l01672"></a><a class="code" href="polyparam_8c.html#a44">01672</a> <font class="keywordtype">void</font> <a class="code" href="polyparam_8c.html#a44">Param_Polyhedron_Free</a>(Param_Polyhedron *P)<font class="keyword"> </font>{
01673   
01674   <font class="keywordflow">if</font> (!P) <font class="keywordflow">return</font>;
01675   <a class="code" href="polyparam_8c.html#a36">Param_Vertices_Free</a>(P-&gt;V);
01676   <a class="code" href="polyparam_8c.html#a43">Param_Domain_Free</a>(P-&gt;D);
01677   free(P);
01678   <font class="keywordflow">return</font>;
01679 } <font class="comment">/* Param_Polyhedron_Free */</font>
01680 
01681 
01682 
01683 
</pre></div><hr><address><small>Generated on Fri Oct 4 16:14:26 2002 for Polylib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.11.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
